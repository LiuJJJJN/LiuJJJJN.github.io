[{"categories":null,"content":"\rRecruitment Management System IBMå®šåˆ¶ç­ å®è®­é¡¹ç›® æ‹›è˜ç®¡ç†ç³»ç»Ÿ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#recruitment-management-system"},{"categories":null,"content":"\ré¡¹ç›®æŠ€æœ¯æ ˆ åç«¯ SpringBoot SpringSecurity Mybatis MySQL Redis å‰ç«¯ Vue axios Pinia Element-Plus i18n é¡¹ç›®ç®¡ç† SVN ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é¡¹ç›®æŠ€æœ¯æ ˆ"},{"categories":null,"content":"\rå‰åç«¯åˆ†ç¦»çš„æ ¡éªŒè§„åˆ™ å‰ç«¯æºå¸¦ç”¨æˆ·åå¯†ç è®¿é—®ç™»å½•æ¥å£ åç«¯è´Ÿè´£éªŒè¯å¹¶ç”Ÿæˆä¸€ä¸ª JWT (åŠ å¯†çš„ json æ ¼å¼çš„ç”¨æˆ·çš„ç­¾å(å”¯ä¸€æ ‡è¯†)) å“åº”ç»™å‰ç«¯ ä¹‹åå‰ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦è¿™ä¸ª JWT(Json Web Token) æ¯æ¬¡åç«¯æ¥æ”¶åˆ°è¯·æ±‚åéƒ½ä¼šè§£æè¿™ä¸ª token éªŒè¯ç”¨æˆ·æƒé™è¿”å›èµ„æº ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰åç«¯åˆ†ç¦»çš„æ ¡éªŒè§„åˆ™"},{"categories":null,"content":"\rå‰åç«¯åˆ†ç¦»çš„ä¼šè¯ç®¡ç† ã€é—®é¢˜ã€‘å‰åç«¯åˆ†ç¦»åï¼Œåç«¯æ€ä¹ˆçŸ¥é“è¿™æ¬¡è¯·æ±‚æ˜¯å¦æ˜¯è®¤è¯è¿‡äº†çš„ï¼ˆå·²ç»ç™»å½•è¿‡çš„ï¼‰éš¾é“æ¯æ¬¡è¯·æ±‚éƒ½è¦æŸ¥è¯¢æ•°æ®åº“éªŒè¯è´¦å·å¯†ç å˜›ï¼Ÿ åœ¨æˆåŠŸç™»å½•åå°†ç”¨æˆ·ä¿¡æ¯ä»¥ ç”¨æˆ· ID ä¸º Keyï¼Œç”¨æˆ·ä¿¡æ¯ ä¸º Value å­˜å…¥ Redis ä¹‹åçš„æ¯æ¬¡æ ¡éªŒè§£æ token è·å– ç”¨æˆ· ID ä» Redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯å­˜å…¥ SecurityContextHolder (Session) ã€é—®é¢˜ã€‘ä¸ºä»€ä¹ˆæ˜¯å­˜åˆ° SecurityContextHolder è€Œä¸æ˜¯ Session ä¸­ï¼Ÿ SpringSecurity ä¼šåœ¨è®¤è¯æˆåŠŸåå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ° SecurityContextHolder ä¸­ï¼Œæ˜¯é€šè¿‡ ThreadLocal æ¥å®ç°çš„ çº¿ç¨‹ç»‘å®š è¿™é‡Œé¢çš„å˜é‡åªèƒ½è¢«å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œä¸èƒ½è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ åœ¨æ¯æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒSpringSecurity ä¼šä» Session ä¸­å°†æ•°æ®å­˜å…¥ SecurityContextHolder, è¯·æ±‚å¤„ç†ç»“æŸåå°†å…¶ä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ä¿å­˜åˆ° Session ä¸­ï¼Œç„¶åå°† SecurityContextHolder ä¸­çš„æ•°æ®æ¸…ç©º è¿™ä¸€ç­–ç•¥éå¸¸æ–¹ä¾¿ç”¨æˆ·åœ¨ Controllerã€Service å±‚ä»¥åŠä»»ä½•ä»£ç ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·æ•°æ® ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰åç«¯åˆ†ç¦»çš„ä¼šè¯ç®¡ç†"},{"categories":null,"content":"\rç®€ç•¥è®¤è¯æˆæƒæµç¨‹ å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶å‘é€ login æ¥å£è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†è¿™ä¸ªå…è®¸åŒ¿åè®¿é—®çš„æ¥å£æ”¾è¡Œè¿›å…¥ Service å±‚ åœ¨ Service å±‚ä¼šå°†å‰ç«¯ä¼ æ¥çš„ç”¨æˆ·åå’Œå¯†ç å­˜å…¥ authenticationManager è¿›è¡Œè®¤è¯ è®¤è¯ï¼šåœ¨ UserDetailsService çš„å®ç°ç±»ä¸­æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® é”™è¯¯ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç”±å‰ç«¯å¤„ç† æ­£ç¡®ï¼šæŸ¥è¯¢å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°†ç”¨æˆ·å®ä¾‹å’Œæƒé™åˆ—è¡¨å°è£…æˆ UserDetails çš„å®ç°ç±» è®¤è¯é€šè¿‡åå°† UserDetails çš„å®ç°ç±»å­˜å…¥ Redis ç¼“å­˜æœåŠ¡å™¨ï¼Œå°†ç”¨æˆ·ID åˆ›å»ºä¸º JWT è¿”å›ç»™å‰ç«¯å­˜å‚¨ å½“ç”¨æˆ·å‘é€é login æ¥å£è¯·æ±‚æ—¶ï¼Œè¿›å…¥è¿‡æ»¤å™¨ æ£€æŸ¥è¯·æ±‚å¤´ä¸­æ˜¯å¦å«æœ‰ token ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ¥è®¤è¯é”™è¯¯ è§£æ token å¾—åˆ°ç”¨æˆ· ID ï¼Œå¦‚æœè§£æå¤±è´¥æŠ›å‡º token ä¸åˆæ³•å¼‚å¸¸ é€šè¿‡ç”¨æˆ· ID ä» Redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æ­¤ç”¨æˆ·æŠ›å‡ºç”¨æˆ·æœªç™»å½•å¼‚å¸¸ å°†ç”¨æˆ·ä¿¡æ¯å’ŒæŸ¥è¯¢åˆ°çš„æƒé™ä¿¡æ¯äº¤ç»™ SpringSecurity çš„ SecurityContextHolder æ”¾è¡Œ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ç®€ç•¥è®¤è¯æˆæƒæµç¨‹"},{"categories":null,"content":"\rä½¿ç”¨ UUID åšä¸»é”® MySQL çš„ 8.0 é€šè¿‡å®ç°ä¸‰ä¸ªæ–°çš„ SQL å‡½æ•°æé«˜ UUID æ“ä½œçš„æ˜“ç”¨æ€§ï¼šUUID_TO_BIN()ï¼ŒBIN_TO_UUID()ï¼Œå’Œ IS_UUID()ã€‚ç¬¬ä¸€ä¸ªä» UUID æ ¼å¼åŒ–æ–‡æœ¬è½¬æ¢ VARBINARY(16) ä¸ºç¬¬äºŒä¸ª VARBINARY(16) åˆ° UUID æ ¼å¼åŒ–æ–‡æœ¬ï¼Œæœ€åä¸€ä¸ªæ£€æŸ¥ UUID æ ¼å¼æ–‡æœ¬çš„æœ‰æ•ˆæ€§ã€‚å­˜å‚¨ä¸º UUID VARBINARY(16) å¯ä»¥ä½¿ç”¨åŠŸèƒ½ç´¢å¼•è¿›è¡Œç´¢å¼•ã€‚åŠŸèƒ½ UUID_TO_BIN() å’Œ UUID_TO_BIN() ä¹Ÿå¯ä»¥æ´—ç‰Œä¸æ—¶é—´ç›¸å…³çš„ä½ï¼Œåœ¨å¼€å§‹ç§»åŠ¨å®ƒä»¬ä½¿å¾—æŒ‡æ•°å‹å¥½ï¼Œé¿å…åœ¨ B æ ‘ä¸­çš„éšæœºæ’å…¥ï¼Œè¿™æ ·é™ä½äº†æ’å…¥æ—¶é—´ã€‚è¿™ç§åŠŸèƒ½çš„ç¼ºä¹è¢«è®¤ä¸ºæ˜¯ä½¿ç”¨ UUID çš„ç¼ºç‚¹ä¹‹ä¸€ã€‚ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä½¿ç”¨-uuid-åšä¸»é”®"},{"categories":null,"content":"\ræ•°æ®åº“å®šä¹‰ æ•°æ®å­—å…¸ç±»å‹è¡¨ æ‰€å±å…¬å¸ company ç”¨æˆ·çŠ¶æ€ user_status æ€§åˆ« sex å­¦å† education æŠ€æœ¯èƒ½åŠ› tech_ability è¯­è¨€èƒ½åŠ› lang_ability ç®€å†æ¥æº source æ˜¯å¦æœä» obey é¢è¯•çŠ¶æ€ interview_status é¢è¯•ç»“æœ result é¢è¯•ç»“æœå¾—åˆ†é¡¹ item å¤‡æ³¨ç±»å‹ comment_type ç”¨æˆ·è¡¨ statusï¼š0æ­£å¸¸ã€1ç¦ç”¨ ç®€å†è¡¨ sexï¼š0å¥³ã€1ç”· educationï¼š0æ— ã€1ä¸“ç§‘ã€2æœ¬ç§‘ã€3ç¡•å£«ã€4æµ·å½’ã€5å…¶å®ƒ tech_abilityï¼š0æ— ã€1Javaã€2C++ã€3Pythonã€4Goã€5PHPã€6Vue lang_abilityï¼š0æ— ã€1æ—¥è¯­N4ã€2æ—¥è¯­N3ã€3æ—¥è¯­N2ã€4æ—¥è¯­N1ã€5è‹±è¯­4çº§ã€6è‹±è¯­6çº§ sourceï¼š0æ ¡æ‹›ã€1å®˜ç½‘ã€2å†…æ¨ã€3å®£è®²ä¼šã€4æ‹›è˜è½¯ä»¶ã€5å…¶å®ƒ obeyï¼š0ä¸æœä»ã€1æœä» é¢è¯•è¡¨ statusï¼š0ç­‰å¾…æŒ‡å®šReviewerã€0+1ç­‰å¾…ç®€å†Reviewã€1+1ç­‰å¾…æŒ‡å®šé¢è¯•å®˜ã€2+1ç­‰å¾…ç¡®å®šé¢è¯•æ—¶é—´ã€3+1ç­‰å¾…é¢è¯•ã€4+1ç­‰å¾…é¢è¯•æäº¤åé¦ˆã€5+1ç®€å†ReviewNGã€6+1é¢è¯•OKã€7+1é¢è¯•NGã€8+1HOLD é¢è¯•åé¦ˆè¡¨ resultï¼š0NGã€1OK é¢è¯•åé¦ˆå¾—åˆ†è¡¨ itemï¼šâ€¦â€¦ å¤‡æ³¨è¡¨ comment_typeï¼š0ç®€å†ä¸Šä¼ å¤‡æ³¨ã€1reviewå¤‡æ³¨ã€2é¢è¯•åé¦ˆå¤‡æ³¨ æƒé™è¡¨ code çš„æ„ä¹‰ CVUpload:*:* ï¼šçš„æƒé™å°±æ˜¯å¯¹ CVUpload çš„æ‰€æœ‰æ•°æ®çš„æ‰€æœ‰æ“ä½œ è¡¨ ï¼šæ“ä½œ ï¼šæ•°æ® ï¼šä¾‹å¦‚ user:update:* çš„æƒé™å°±æ˜¯å¯¹ user è¡¨çš„æ‰€æœ‰å­—æ®µéƒ½æœ‰æ›´æ–°æƒé™ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ•°æ®åº“å®šä¹‰"},{"categories":null,"content":"\rä»£ç è§„èŒƒ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä»£ç è§„èŒƒ"},{"categories":null,"content":"\ré€šç”¨è§„èŒƒ ä»£ç å¿…é¡»ç»è¿‡ format ä»£ç å¿…é¡»ç»è¿‡è‡ªæ£€è¿è¡Œè·‘é€šåæ‰èƒ½æäº¤ SVN ä»£ç ä¹¦å†™åº”éµå¾ª æ²¡åšå®Œæˆ–éœ€è¦åæœŸæ›´æ”¹çš„åœ°æ–¹ï¼Œåº”å†™ä¸Š todo æ³¨é‡Šï¼Œå¹¶æ³¨æ˜ç”¨é€” ä¸€è¡Œä»£ç ä¸å¾—è¶…è¿‡ 120 å­—ç¬¦ å˜é‡åå¿…é¡»è§åçŸ¥æ„ï¼Œä¸å¾—ç”¨æ‹¼éŸ³ æ³¨é‡Šä¹¦å†™åº”éµå¾ª æ³¨é‡Šå†…å®¹ç”±ç©ºæ ¼å¼€å§‹ã€æ³¨é‡Šä¸­è‹±æ–‡å‰åæ·»åŠ ç©ºæ ¼ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:1","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é€šç”¨è§„èŒƒ"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰ç«¯ä»£ç è§„èŒƒ"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‘½åè§„èŒƒ"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ³¨é‡Š"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ¢è¡Œ"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åˆ†å·"},{"categories":null,"content":"\rå‰ç«¯ä»£ç è§„èŒƒ åŠŸèƒ½ç›¸è¿‘çš„å˜é‡ã€æ–¹æ³•ã€css æ ·å¼åº”å†™åœ¨ä¸€èµ· templatr æ ‡ç­¾å†…å®¹é¡ºåº: å†…å®¹æ ‡ç­¾ ğŸ‘‰ dialog æ ‡ç­¾ script æ ‡ç­¾å†…å®¹é¡ºåº: import ğŸ‘‰ åŠŸèƒ½æ€§å±æ€§ ğŸ‘‰ ref å±æ€§ ğŸ‘‰ reactive å±æ€§ ğŸ‘‰ æ–¹æ³• ğŸ‘‰ é’©å­æ–¹æ³• ç©ºçš„åŒæ ‡ç­¾åº”å°½å¯èƒ½å†™ä¸ºå•æ ‡ç­¾ å‘½åè§„èŒƒ views æ–‡ä»¶åï¼šå°é©¼å³° script å˜é‡å’Œæ–¹æ³•åï¼šå°é©¼å³° css é€‰æ‹©å™¨ï¼šå°é©¼å³° å¸¸é‡ï¼šå…¨å¤§å†™ æ³¨é‡Š template ä¸­ä»£ç æ³¨é‡Š script ä¸­ import è¯­å¥æ³¨é‡Š script ä¸­ const å±æ€§æ³¨é‡Š script ä¸­æ–¹æ³•æ³¨é‡Š style ä¸­æ³¨é‡Šï¼šéœ€æ ‡æ˜ç”Ÿæ•ˆä½ç½® on-ã€before- å¼€å¤´çš„å±æ€§åå¯¹åº”çš„æ–¹æ³•éƒ½å«åš é’©å­æ–¹æ³•ï¼Œv-onã€@ å¼€å¤´çš„å±æ€§å¯¹åº”çš„æ–¹æ³•å«åš äº‹ä»¶ æ¢è¡Œ åˆ†è¡Œä¹¦å†™æ ‡ç­¾å±æ€§æ—¶ï¼Œ\u003e æˆ– /\u003e éœ€å•ç‹¬ä¸€è¡Œ templateã€scriptã€style æ ‡ç­¾ä¹‹é—´ç©ºä¸€è¡Œï¼Œä»£ç æ–‡ä»¶æœ€åä¸€è¡Œç©ºä¸€è¡Œ å˜é‡ä¸å˜é‡ä¹‹é—´ã€æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ã€å¼æ ·ä¸å¼æ ·ä¹‹é—´ï¼Œç©ºä¸€è¡Œ åˆ†å· script ä¸­å†™çš„ä»£ç ç»“å°¾éƒ½åº”æ·»åŠ åˆ†å·ï¼Œæ–¹æ³•ä¸­çš„è¯­å¥éƒ½åº”ä»¥åˆ†å·ç»“å°¾ å…¶å®ƒ å›¾æ ‡çš„ç”¨æ³• ç¦æ­¢ä½¿ç”¨ :icon å±æ€§æŒ‡å®šå›¾æ ‡ elementPlus æ¨èä½¿ç”¨ el-icon æ ‡ç­¾æŒ‡å®šå›¾æ ‡ï¼Œä¸”ä¸éœ€è¦å•ç‹¬å¯¼å…¥ ts è¯´å˜é‡æ— æ³•è§£æï¼Ÿ å› ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰æ˜¾å¼å®šä¹‰åœ¨ resp ä¸­ å¯ä»¥ä½¿ç”¨ data['variable'] çš„æ–¹å¼å–å¾— ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…¶å®ƒ"},{"categories":null,"content":"\råç«¯ä»£ç è§„èŒƒ åç«¯å†™çš„ä»£ç ä¸­ä¸è¦å‡ºç°ä¸šåŠ¡ä¸Šçš„å¸¸é‡ï¼Œå¦‚éœ€è·å–è¦åœ¨ constValue.properties æ–‡ä»¶ä¸­å®šä¹‰ä½¿ç”¨ @PropertySource é…åˆ @Value è·å– å‘½åè§„èŒƒ Controller åŠ Service å±‚æ¥å£åŠæ–¹æ³•å‘½åé£æ ¼ï¼šaddã€removeã€editã€getï¼ˆgetXxxxListã€getXxxByXxxï¼‰ Mapper å±‚æ–¹æ³•å‘½åé£æ ¼ï¼šinsertã€deleteã€updateã€selectï¼ˆcountï¼‰ ç±»å˜é‡å‘½åï¼šç±»åå°é©¼å³° åŠŸèƒ½æ€§å¸¸é‡å®šä¹‰ï¼šå…¨å¤§å†™ã€_ åˆ†éš” æ³¨é‡Š æ¯ä¸ªç±»çš„ class è¯­å¥ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜ä½œè€…å’Œåˆ›å»ºæ—¶é—´ åœ¨æ§åˆ¶å±‚çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æ•°æ®è®¿é—®å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚å®ç°ç±»ä¸­ä¹¦å†™å•è¡Œæ³¨é‡Šï¼Œè¦æ±‚åªçœ‹æ³¨é‡Šå°±èƒ½æ˜ç™½ä¸šåŠ¡çš„æ‰§è¡Œæµç¨‹ æ¢è¡Œ ä¿è¯æ¯ä¸€ä¸ªç±»å˜é‡ã€æ–¹æ³•å‰åéƒ½æœ‰ä¸€ä¸ªç©ºè¡Œ æ¯ä¸ªæ–‡ä»¶æœ€åè¦æœ‰ä¸€ä¸ªç©ºè¡Œ è¾ƒé•¿çš„ä¸šåŠ¡å¯æŒ‰ç…§é€»è¾‘æ·»åŠ ç©ºè¡Œ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯ä»£ç è§„èŒƒ"},{"categories":null,"content":"\råç«¯ä»£ç è§„èŒƒ åç«¯å†™çš„ä»£ç ä¸­ä¸è¦å‡ºç°ä¸šåŠ¡ä¸Šçš„å¸¸é‡ï¼Œå¦‚éœ€è·å–è¦åœ¨ constValue.properties æ–‡ä»¶ä¸­å®šä¹‰ä½¿ç”¨ @PropertySource é…åˆ @Value è·å– å‘½åè§„èŒƒ Controller åŠ Service å±‚æ¥å£åŠæ–¹æ³•å‘½åé£æ ¼ï¼šaddã€removeã€editã€getï¼ˆgetXxxxListã€getXxxByXxxï¼‰ Mapper å±‚æ–¹æ³•å‘½åé£æ ¼ï¼šinsertã€deleteã€updateã€selectï¼ˆcountï¼‰ ç±»å˜é‡å‘½åï¼šç±»åå°é©¼å³° åŠŸèƒ½æ€§å¸¸é‡å®šä¹‰ï¼šå…¨å¤§å†™ã€_ åˆ†éš” æ³¨é‡Š æ¯ä¸ªç±»çš„ class è¯­å¥ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜ä½œè€…å’Œåˆ›å»ºæ—¶é—´ åœ¨æ§åˆ¶å±‚çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æ•°æ®è®¿é—®å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚å®ç°ç±»ä¸­ä¹¦å†™å•è¡Œæ³¨é‡Šï¼Œè¦æ±‚åªçœ‹æ³¨é‡Šå°±èƒ½æ˜ç™½ä¸šåŠ¡çš„æ‰§è¡Œæµç¨‹ æ¢è¡Œ ä¿è¯æ¯ä¸€ä¸ªç±»å˜é‡ã€æ–¹æ³•å‰åéƒ½æœ‰ä¸€ä¸ªç©ºè¡Œ æ¯ä¸ªæ–‡ä»¶æœ€åè¦æœ‰ä¸€ä¸ªç©ºè¡Œ è¾ƒé•¿çš„ä¸šåŠ¡å¯æŒ‰ç…§é€»è¾‘æ·»åŠ ç©ºè¡Œ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‘½åè§„èŒƒ-1"},{"categories":null,"content":"\råç«¯ä»£ç è§„èŒƒ åç«¯å†™çš„ä»£ç ä¸­ä¸è¦å‡ºç°ä¸šåŠ¡ä¸Šçš„å¸¸é‡ï¼Œå¦‚éœ€è·å–è¦åœ¨ constValue.properties æ–‡ä»¶ä¸­å®šä¹‰ä½¿ç”¨ @PropertySource é…åˆ @Value è·å– å‘½åè§„èŒƒ Controller åŠ Service å±‚æ¥å£åŠæ–¹æ³•å‘½åé£æ ¼ï¼šaddã€removeã€editã€getï¼ˆgetXxxxListã€getXxxByXxxï¼‰ Mapper å±‚æ–¹æ³•å‘½åé£æ ¼ï¼šinsertã€deleteã€updateã€selectï¼ˆcountï¼‰ ç±»å˜é‡å‘½åï¼šç±»åå°é©¼å³° åŠŸèƒ½æ€§å¸¸é‡å®šä¹‰ï¼šå…¨å¤§å†™ã€_ åˆ†éš” æ³¨é‡Š æ¯ä¸ªç±»çš„ class è¯­å¥ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜ä½œè€…å’Œåˆ›å»ºæ—¶é—´ åœ¨æ§åˆ¶å±‚çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æ•°æ®è®¿é—®å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚å®ç°ç±»ä¸­ä¹¦å†™å•è¡Œæ³¨é‡Šï¼Œè¦æ±‚åªçœ‹æ³¨é‡Šå°±èƒ½æ˜ç™½ä¸šåŠ¡çš„æ‰§è¡Œæµç¨‹ æ¢è¡Œ ä¿è¯æ¯ä¸€ä¸ªç±»å˜é‡ã€æ–¹æ³•å‰åéƒ½æœ‰ä¸€ä¸ªç©ºè¡Œ æ¯ä¸ªæ–‡ä»¶æœ€åè¦æœ‰ä¸€ä¸ªç©ºè¡Œ è¾ƒé•¿çš„ä¸šåŠ¡å¯æŒ‰ç…§é€»è¾‘æ·»åŠ ç©ºè¡Œ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ³¨é‡Š-1"},{"categories":null,"content":"\råç«¯ä»£ç è§„èŒƒ åç«¯å†™çš„ä»£ç ä¸­ä¸è¦å‡ºç°ä¸šåŠ¡ä¸Šçš„å¸¸é‡ï¼Œå¦‚éœ€è·å–è¦åœ¨ constValue.properties æ–‡ä»¶ä¸­å®šä¹‰ä½¿ç”¨ @PropertySource é…åˆ @Value è·å– å‘½åè§„èŒƒ Controller åŠ Service å±‚æ¥å£åŠæ–¹æ³•å‘½åé£æ ¼ï¼šaddã€removeã€editã€getï¼ˆgetXxxxListã€getXxxByXxxï¼‰ Mapper å±‚æ–¹æ³•å‘½åé£æ ¼ï¼šinsertã€deleteã€updateã€selectï¼ˆcountï¼‰ ç±»å˜é‡å‘½åï¼šç±»åå°é©¼å³° åŠŸèƒ½æ€§å¸¸é‡å®šä¹‰ï¼šå…¨å¤§å†™ã€_ åˆ†éš” æ³¨é‡Š æ¯ä¸ªç±»çš„ class è¯­å¥ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜ä½œè€…å’Œåˆ›å»ºæ—¶é—´ åœ¨æ§åˆ¶å±‚çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æ•°æ®è®¿é—®å±‚æ¥å£çš„æ¯ä¸ªæ–¹æ³•ä¸Šæ–¹ä¹¦å†™æ–‡æ¡£æ³¨é‡Šï¼Œå¹¶æ³¨æ˜æ¥å£ä½œç”¨ã€å‚æ•°å†…å®¹ã€è¿”å›å€¼åŠŸèƒ½ åœ¨æœåŠ¡å±‚å®ç°ç±»ä¸­ä¹¦å†™å•è¡Œæ³¨é‡Šï¼Œè¦æ±‚åªçœ‹æ³¨é‡Šå°±èƒ½æ˜ç™½ä¸šåŠ¡çš„æ‰§è¡Œæµç¨‹ æ¢è¡Œ ä¿è¯æ¯ä¸€ä¸ªç±»å˜é‡ã€æ–¹æ³•å‰åéƒ½æœ‰ä¸€ä¸ªç©ºè¡Œ æ¯ä¸ªæ–‡ä»¶æœ€åè¦æœ‰ä¸€ä¸ªç©ºè¡Œ è¾ƒé•¿çš„ä¸šåŠ¡å¯æŒ‰ç…§é€»è¾‘æ·»åŠ ç©ºè¡Œ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ¢è¡Œ-1"},{"categories":null,"content":"\rå¼æ ·ä¹¦è§„èŒƒ å„ç”»é¢ ID ç™»å½•ç”»é¢ï¼šRMSL0101 èœå•ç”»é¢ï¼šRMSM0101 å·¥ä½œå°ç”»é¢ï¼šRMSW0101 ç®€å†ä¸Šä¼ ç”»é¢ï¼šRMSU0101 é¢è¯•ä¸€è§ˆç”»é¢ï¼šRMSV0101 é¢è¯•Reviewç”»é¢ï¼šRMSR0101 é¢è¯•åé¦ˆç”»é¢ï¼šRMSF0101 å†å²é¢è¯•ç”»é¢ï¼šRMSH0101 æ•°æ®å­—å…¸ç±»å‹ç®¡ç†ç”»é¢ï¼šRMSD0101 æ•°æ®å­—å…¸å€¼ç®¡ç†ç”»é¢ï¼šRMSD0201 ç”¨æˆ·ç®¡ç†ç”»é¢ï¼šRMSU0201 è§’è‰²ç®¡ç†ç”»é¢ï¼šRMSU0202 æƒé™ç®¡ç†ç”»é¢ï¼šRMSU0203 éƒ¨é—¨ç®¡ç†ç”»é¢ï¼šRMSD0301 ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:4","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¼æ ·ä¹¦è§„èŒƒ"},{"categories":null,"content":"\rå‰ç«¯é‡åˆ°çš„é—®é¢˜","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰ç«¯é‡åˆ°çš„é—®é¢˜"},{"categories":null,"content":"\rVue3 å¦‚ä½•æ‰“åŒ…æˆèƒ½ç›´æ¥è¿è¡Œçš„æ ¼å¼ åœ¨ vite.config.js ä¸­è®¾ç½® base ä¸ºç›¸å¯¹è·¯å¾„ æ·»åŠ  plugin-legacy æ’ä»¶ç”Ÿæˆä¼ ç»Ÿæµè§ˆå™¨çš„ chunk åŠä¸å…¶ç›¸å¯¹åº” ES è¯­è¨€ç‰¹æ€§æ–¹é¢çš„ polyfill å°† router æ–‡ä»¶é…ç½®ä¸ºæ ¹æ® hash åŒ¹é…è·¯å¾„ æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ npm run build ä¿®æ”¹æ‰“åŒ… dist æ–‡ä»¶å¤¹ä¸­çš„ index.html åˆ é™¤çº¢æ¡†éƒ¨åˆ†ä»£ç  ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:1","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue3-å¦‚ä½•æ‰“åŒ…æˆèƒ½ç›´æ¥è¿è¡Œçš„æ ¼å¼"},{"categories":null,"content":"\rVue å¦‚ä½•ä¿®æ”¹ Element-Plus çš„åº•å±‚æ ·å¼ æ·»åŠ  :deep() :deep(.el-scrollbar__bar.is-horizontal\u003ediv) { height: 10px; margin-top: -5px; } ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-å¦‚ä½•ä¿®æ”¹-element-plus-çš„åº•å±‚æ ·å¼"},{"categories":null,"content":"\rVue3 å¦‚ä½•ä¿®æ”¹ reactive æ•°ç»„åšå“åº”å¼å¤„ç† ä¸ä½¿ç”¨æ•°æ®æ¥å£çš„æƒ…å†µ const xxxList = reactive({ arr: [] }) åœ¨ reactive é‡Œé¢å†å°è£…ä¸€å±‚ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ xxxList.arr = xxx ä¿®æ”¹æ•°ç»„ ä½¿ç”¨æ•°æ®æ¥å£çš„æƒ…å†µ const xxxList = reactive\u003cxxxInterface[]\u003e([]); ä½¿ç”¨ push æ–¹æ³•å°†å±•å¼€çš„æ•°æ®ä¼ è¿›æ•°ç»„ä¸­: xxxList.push(...resp.data); ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue3-å¦‚ä½•ä¿®æ”¹-reactive-æ•°ç»„åšå“åº”å¼å¤„ç†"},{"categories":null,"content":"\rVue3 ref å’Œ reactive çš„åŒºåˆ« ref æ˜¯ç”¨æ¥å®šä¹‰åŸºæœ¬ç±»å‹å’Œæ•°ç»„ç±»å‹å’Œå¯¹è±¡ç±»å‹çš„ï¼Œä½¿ç”¨ ref å®šä¹‰æ•°ç»„æˆ–å¯¹è±¡ç±»å‹æ—¶å†…éƒ¨è¿˜æ˜¯ä¼šè°ƒç”¨ reactive è½¬ä¸ºä»£ç†å¯¹è±¡ reactive ä¸€èˆ¬ç”¨æ¥å®šä¹‰å¯¹è±¡ç±»å‹ï¼Œå®ƒæ˜¯é€šè¿‡ä½¿ç”¨ Proxyï¼ˆä»£ç†æ¨¡å¼ï¼‰ æ¥å®ç°å“åº”å¼, å¹¶é€šè¿‡ Reflect æ“ä½œ æºå¯¹è±¡ å†…éƒ¨çš„æ•°æ® ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:4","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue3-ref-å’Œ-reactive-çš„åŒºåˆ«"},{"categories":null,"content":"\rVue @click äº‹ä»¶åªç‚¹å‡»ä¸€æ¬¡å´æ‰§è¡Œå¤šæ¬¡ åœ¨ä¸º v-for çš„æ ‡ç­¾æ·»åŠ  @click äº‹ä»¶ä¹‹åï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œæš‚æ—¶ä¸äº†è§£å› ä¸ºä»€ä¹ˆ ã€è§£å†³ã€‘: ä¸ºäº‹ä»¶æ·»åŠ  $event å‚æ•°ï¼Œå¹¶æ‰§è¡Œæ–¹æ³•å³å¯è§£å†³ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:5","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-click-äº‹ä»¶åªç‚¹å‡»ä¸€æ¬¡å´æ‰§è¡Œå¤šæ¬¡"},{"categories":null,"content":"\rnpm install ä¸‹è½½ç¼“æ…¢ å› ä¸ºæœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå¤§é™†æœ‰æ—¶å€™è¿æ¥ä¸ä¸Š æ‰§è¡Œè¿™æ¡å‘½ä»¤ä¿®æ”¹æœåŠ¡å™¨ä¸ºæ·˜å®çš„å°±å¥½äº† npm config set registry https://registry.npm.taobao.org ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:6","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#npm-install-ä¸‹è½½ç¼“æ…¢"},{"categories":null,"content":"\råç«¯é‡åˆ°çš„é—®é¢˜","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯é‡åˆ°çš„é—®é¢˜"},{"categories":null,"content":"\raxios ä¼ é€’çš„å‚æ•°ç»“å°¾å¤šäº†ä¸€ä¸ªç­‰äºå· â€˜=â€™ ?\rå› ä¸ºå‰ç«¯å‘é€ axios è¯·æ±‚æ—¶ï¼Œé»˜è®¤çš„è¯·æ±‚å¤´ headers å†…éƒ¨çš„ Content-Type æ˜¯ application/x-www-form-urlencoded;charset=UTF-8 è¿™æ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­æŠŠ json å½“ä½œ keyï¼Œè€Œ value å½“ä½œç©ºå€¼ï¼Œæ‰€ä»¥ä¼ è¾“åˆ°åç«¯ä¼šå¤šå‡ºç­‰å· ã€è§£å†³ã€‘ å¯ä»¥é€šè¿‡ä¿®æ”¹å‰ç«¯å’Œåç«¯çš„æ•°æ®ç¼–ç æ ¼å¼è§£å†³ å¯ä»¥åœ¨å‰ç«¯ç”¨èŠ±æ‹¬å·åŒ…èµ·æ¥ä½œä¸º json ä¼ è¾“ï¼Œåç«¯ç”¨ Map æ¥æ”¶ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:1","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#axios-ä¼ é€’çš„å‚æ•°ç»“å°¾å¤šäº†ä¸€ä¸ªç­‰äºå·--"},{"categories":null,"content":"\rmybatis çš„ resultMap æ˜ å°„é—®é¢˜ å½“æˆ‘å°† id å½“ä½œå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªæŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿™ä¸ªä¸»æŸ¥è¯¢çš„ id ç»“æœéƒ½ä¸º null ï¼Ÿ ã€è§£å†³ã€‘å› ä¸º mybatis ç†è§£ä¸ºè¿™ä¸ªå±æ€§åº”è¯¥è¢«æ˜ å°„ä¸ºåˆ«çš„å€¼å°±æ²¡æœ‰ç»™è¿™ä¸ªå±æ€§èµ‹å€¼ï¼Œå†æ¬¡æŒ‡å®šè¿™ä¸ªå±æ€§çš„æ˜ å°„å³å¯ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#mybatis-çš„-resultmap-æ˜ å°„é—®é¢˜"},{"categories":null,"content":"\rå¤§å†™å­—æ¯å¼€å¤´ä¼ å€¼ springboot ä¸º null å› ä¸º springboot é»˜è®¤æŒ‰ç…§å°é©¼å³°è§£æ json çš„å€¼ ã€è§£å†³ã€‘å°†å‰ç«¯æ”¹ä¸ºå°é©¼å³°å³å¯ï¼Œæˆ–ä½¿ç”¨ @JsonProperty æ³¨æ˜å±æ€§å ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:3","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¤§å†™å­—æ¯å¼€å¤´ä¼ å€¼-springboot-ä¸º-null"},{"categories":null,"content":"\ræœåŠ¡å™¨éƒ¨ç½²é‡åˆ°çš„é—®é¢˜","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:10:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æœåŠ¡å™¨éƒ¨ç½²é‡åˆ°çš„é—®é¢˜"},{"categories":null,"content":"\rvue é¡¹ç›®éƒ¨ç½²åˆ° nginx æœåŠ¡å™¨åï¼Œé™¤é¦–é¡µå¤–åˆ·æ–°éƒ½è·³è½¬ 404 é¡µé¢ ä¸º nginx è®¾ç½®è½¬å‘ try_files $uri $uri/ /index.html; ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:10:1","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-é¡¹ç›®éƒ¨ç½²åˆ°-nginx-æœåŠ¡å™¨åé™¤é¦–é¡µå¤–åˆ·æ–°éƒ½è·³è½¬-404-é¡µé¢"},{"categories":null,"content":"\ré•¿æ—¶é—´ä¸è¿›è¡Œæ“ä½œ redis æŠ›å‡ºå¼‚å¸¸ å¼‚å¸¸ä¿¡æ¯ï¼š org.springframework.data.redis.RedisSystemException: Redis exception; nested exception is io.lettuce.core.RedisException: java.io.IOException: è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥ã€‚ ä¼¼ä¹æ˜¯å› ä¸º ssh çš„è¿æ¥è¶…æ—¶é€ æˆçš„, æ ¹æ®ç½‘ä¸Šçš„æ–¹æ³•è®¾ç½®äº† ssh è¶…æ—¶æ—¶é•¿ å’Œ é‡è¯•æ¬¡æ•° ä½†ä¼¼ä¹æ— æ•ˆ 2022-12-16 07:21:55 è¯å®æ— æ•ˆæœï¼Œé‡è¯•æ¬¡æ•°è®¾ç½®è¿‡é«˜åè€Œé€ æˆå¤šæ¬¡æ— å“åº”ä¹‹åæ‰æç¤ºç™»å½•è¿‡æœŸ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:10:2","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é•¿æ—¶é—´ä¸è¿›è¡Œæ“ä½œ-redis-æŠ›å‡ºå¼‚å¸¸"},{"categories":null,"content":"\ré¡¹ç›®ç‰¹è‰² ä¸»è¦ çµæ´»æ€§ã€å¯æ‰©å±•æ€§ docker éƒ¨ç½²ã€åŸŸåè§£æ æ•°æ®åº“ æ ‡å‡†çš„ RBAC æ¨¡å‹ç»“æ„ MySQL8 çš„ UUID æ•°æ®å­—å…¸ ç´¢å¼• å‰ç«¯ axios çš„å‰åç½®æ‹¦æˆª é”™è¯¯é¡µé¢ Vue3 + Ts transition è¿‡åº¦åŠ¨ç”»ã€v-loading i18n ç»„ä»¶åŒ–å¼€å‘ æœªä½¿ç”¨ä»»ä½•å‰ç«¯æ¨¡æ¿ å®ç”¨çš„å·¥ä½œå°ç”»é¢ åç«¯ minioã€kkfileview ç®€å†é¢„è§ˆ springSecurity å®‰å…¨æ¡†æ¶ã€ä¸€ç”¨æˆ·å¯åŒæ—¶æ‹¥æœ‰å¤šè§’è‰² Redis ç”¨æˆ·è®¤è¯ã€ä»¤ç‰Œè‡ªåŠ¨ç»­çº¦ã€æ•°æ®å­—å…¸ç¼“å­˜ã€ç¼“å­˜å‡»ç©¿çš„è§£å†³ å®æ—¶çš„ç”¨æˆ·é”å®š å…¨å±€å¼‚å¸¸æ•è·ã€è¿”å›å€¼æšä¸¾ç±»ã€properties é…ç½®æ–‡ä»¶ äº‹åŠ¡ã€ä¹è§‚é” POI: easyExcel æ•°æ®å¯¼å‡º RabbitMQ é‚®ä»¶ ","date":"2022-12-10","objectID":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:11:0","series":null,"tags":null,"title":"æ‹›è˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/rms%E6%8B%9B%E8%81%98%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é¡¹ç›®ç‰¹è‰²"},{"categories":null,"content":"\rSpring Security å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2022-10-22 ç¬”è®°æ‘˜è‡ªï¼šbilibili ä¸‰æ›´è‰å ‚ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#spring-security"},{"categories":null,"content":"\rSpring Security æ˜¯ Spring å®¶æ—çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ ç›¸è¾ƒäº Shiro æ›´é€‚åˆå¤§å‹é¡¹ç›®ã€ä¸Šæ‰‹å¤æ‚ä¸€äº›ã€åŠŸèƒ½å’Œç¤¾åŒºèµ„æºæ›´ä¸°å¯Œ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#spring-security-1"},{"categories":null,"content":"\rå¦‚ä½•ä½¿ç”¨ æ·»åŠ  Spring Security ä¾èµ– \u003c!-- Spring Security çš„èµ·æ­¥ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-security\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- Spring Security æµ‹è¯•ç¯å¢ƒçš„èµ·æ­¥ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.security\u003c/groupId\u003e \u003cartifactId\u003espring-security-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å¦‚ä½•ä½¿ç”¨"},{"categories":null,"content":"\rç²—ç•¥åŸç†\rSpring Security çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ åˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ã€è®¤è¯ã€‘ å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­å‘ç”Ÿçš„ AccessDeniedWException å’Œ AuthenticationExceptionã€å¼‚å¸¸å¤„ç†ã€‘ åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œçš„æƒé™ã€æˆæƒã€‘ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç²—ç•¥åŸç†"},{"categories":null,"content":"\rè®¤è¯\rå¤§è‡´æµç¨‹ï¼š 1 - 6 åœ¨ UserDetailService æ¥å£å®ç°ç±»ä¸­æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯åŠå¯¹åº”æƒé™åœ¨å°è£…åè¿”å› 7 - 9 æ¯”å¯¹ç”¨æˆ·ååŠå¯†ç æ˜¯å¦æ­£ç¡®å¹¶è®¾ç½®æƒé™ä¿¡æ¯åˆ° Authentication ä¸­ 10 - end å°† Authentication ä¸­çš„æƒé™ä¿¡æ¯è®¾ç½®åˆ°ä¸€ä¸ªå…±äº«ä½œç”¨åŸŸä¸­æ–¹ä¾¿åç»­è®¤è¯ç¯èŠ‚ä½¿ç”¨ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:1","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è®¤è¯"},{"categories":null,"content":"\ræˆæƒ å€™è¡¥ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:2","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#æˆæƒ"},{"categories":null,"content":"\rè‡ªå®šä¹‰è®¤è¯\rè‡ªå®šä¹‰ UserDetailService æ¥å£å®ç°ç±»æŸ¥è¯¢æ•°æ®åº“ æŠŠè¿™ä¸ªç”¨æˆ·å®ä½“æŸ¥å‡ºæ¥ åœ¨ service.impl ä¸­åˆ›å»º UserDetailsService çš„å®ç°ç±» @Service public class UserDetailServiceImpl implements UserDetailsService { @Autowired private SysUserMapper sysUserMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { /*********************** è®¤è¯ ***********************/ // æŸ¥è¯¢æœ‰æ²¡æœ‰è¿™ä¸ªç”¨æˆ· List\u003cSysUser\u003e userList = sysUserMapper.selectByUsername(username); //å¦‚æœæ²¡æœ‰è¿™ä¸ªè´¦æˆ·åˆ™æŠ›å‡ºå¼‚å¸¸ if (userList == null || userList.size() == 0) { throw new RuntimeException(\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"); } /*********************** æˆæƒ ***********************/ //todo //æŠŠç”¨æˆ·å°è£…æˆ UserDetail è¿”å› return new LoginUser(userList.get(0)); } } åœ¨ domian ä¸­åˆ›å»º UserDetails çš„å®ç°ç±»å¹¶ä»£ç†ç”¨æˆ·å®ä½“ @Data @NoArgsConstructor @AllArgsConstructor public class LoginUser implements UserDetails { private SysUser sysUser; @Override public Collection\u003c? extends GrantedAuthority\u003e getAuthorities() { // è·å–æƒé™ä¿¡æ¯ return null; } @Override public String getPassword() { return sysUser.getPassword(); } @Override public String getUsername() { return sysUser.getUserName(); } @Override public boolean isAccountNonExpired() { return true; } @Override public boolean isAccountNonLocked() { return true; } @Override public boolean isCredentialsNonExpired() { return true; } @Override public boolean isEnabled() { return true; } } ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è‡ªå®šä¹‰è®¤è¯"},{"categories":null,"content":"\ré…ç½®å¯†ç åŠ å¯†ç­–ç•¥ é»˜è®¤ä½¿ç”¨çš„ PasswordEncoder è¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{id}password å®ƒä¼šæ ¹æ® id å»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨ SpringSecurity æä¾›çš„ BCryptPasswordEncoder å®ç°å¯†ç åŠ å¯†ï¼ˆåŠ ç›åŠ å¯†ï¼‰ åœ¨ config åŒ…ä¸‹åˆ›å»º SecurityConfig é…ç½®ç±» import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { @Bean public PasswordEncoder passwordEncoder(){ // è®¾ç½®å¯†ç åŠ å¯†æ–¹å¼ä¸º SpringSecurity æä¾›çš„ BCryptPasswordEncoder return new BCryptPasswordEncoder(); } } BCryptPasswordEncoder æä¾›çš„åŠŸèƒ½ï¼š BCryptPasswordEncoder b = new BCryptPasswordEncoder(); String b1 = b.encode(\"æ˜æ–‡å¯†ç \"); // å°†æ˜æ–‡å¯†ç åŠ å¯†ä¸ºå¯†æ–‡ String b2 = b.encode(\"æ˜æ–‡å¯†ç \"); // è‡ªå¸¦åŠ ç›åŠ å¯†ï¼Œæ¯æ¬¡çš„å¯†æ–‡éƒ½ä¸ä¸€è‡´ boolean matches = b.matches(\"æ˜æ–‡å¯†ç \", \"å¯†æ–‡\"); // æ¯”å¯¹å¯†æ–‡æ˜¯å¦æ˜¯æ˜æ–‡å¯†ç åŠ å¯†è€Œæ¥çš„ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:1","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#é…ç½®å¯†ç åŠ å¯†ç­–ç•¥"},{"categories":null,"content":"\ré…ç½®è®¤è¯ç›¸å…³é…ç½®åœ¨ SecurityConfig é…ç½®ç±»ä¸­æ·»åŠ å†…å®¹ @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { /** * é…ç½®å¯†ç åŠ å¯†æ–¹å¼ * @return */ @Bean public PasswordEncoder passwordEncoder() { // è®¾ç½®å¯†ç åŠ å¯†æ–¹å¼ä¸º SpringSecurity æä¾›çš„ BCryptPasswordEncoder return new BCryptPasswordEncoder(); } @Override protected void configure(HttpSecurity http) throws Exception { http // å…³é—­ csrf .csrf().disable() // ä¸é€šè¿‡ Session è·å– SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(\"/user/login\").anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); } /** * æš´éœ² AuthenticationManager åˆ° Spring å®¹å™¨ä¸­ä»¥ä¾¿ Service å±‚ä½¿ç”¨ * @return * @throws Exception */ @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } } ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:2","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#é…ç½®è®¤è¯ç›¸å…³é…ç½®"},{"categories":null,"content":"\rå®ç°ç™»å½•åŠŸèƒ½ ç¼–å†™ç™»å½•æ¥å£çš„ Service å±‚æ–¹æ³• // æ³¨å…¥ AuthenticationManager è¿›è¡Œç”¨æˆ·è®¤è¯ @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCacheUtil redisCacheUtil; @Override public ResponseResult login(SysUser user) { UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(), user.getPassword()); Authentication authenticate = authenticationManager.authenticate(authenticationToken); // å¦‚æœè®¤è¯æ²¡é€šè¿‡åˆ™ç»™å‡ºæç¤º if (Objects.isNull(authenticate)) { throw new RuntimeException(\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"); } // è®¤è¯é€šè¿‡åï¼Œä½¿ç”¨ userid ç”Ÿæˆ jwt LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getSysUser().getId().toString(); String jwt = JwtUtil.createJWT(userId); // æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ redis redisCacheUtil.setCacheObject(\"login:\" + userId, loginUser); // æŠŠ jwt å“åº”ç»™å‰ç«¯ HashMap\u003cString, String\u003e map = new HashMap\u003c\u003e(); map.put(\"token\", jwt); return new ResponseResult(200, \"ç™»é™†æˆåŠŸ\", map); } ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:3","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å®ç°ç™»å½•åŠŸèƒ½"},{"categories":null,"content":"\ré…ç½®è®¤è¯è¿‡æ»¤å™¨åœ¨ filter åŒ…ä¸­åˆ›å»º JwtAuthenticationTokenFilter è¿‡æ»¤å™¨ @Component public class JwtAuthenticationTokenFilter extends OncePerRequestFilter { @Autowired private RedisCacheUtil redisCache; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { // è·å–è¯·æ±‚å¤´ä¸­çš„ token String token = request.getHeader(\"token\"); if (!StringUtils.hasText(token)) { //æ”¾è¡Œ filterChain.doFilter(request, response); return; } // è§£æ token è·å–åˆ°ç”¨æˆ· ID String userid; try { Claims claims = JwtUtil.parseJWT(token); userid = claims.getSubject(); } catch (Exception e) { e.printStackTrace(); throw new RuntimeException(\"tokenä¸åˆæ³•\"); } // ä½¿ç”¨ç”¨æˆ· ID ä» redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ String redisKey = \"login:\" + userid; LoginUser loginUser = redisCache.getCacheObject(redisKey); if(Objects.isNull(loginUser)){ throw new RuntimeException(\"ç”¨æˆ·æœªç™»å½•\"); } // å­˜å…¥ SecurityContextHolder //TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ° Authentication ä¸­ UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginUser,null,null); SecurityContextHolder.getContext().setAuthentication(authenticationToken); // æ”¾è¡Œ filterChain.doFilter(request, response); } } æ·»åŠ é…ç½®ç±» @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { // æ³¨å…¥è¿‡æ»¤å™¨ @Autowired JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter; /** * é…ç½®å¯†ç åŠ å¯†æ–¹å¼ * @return */ @Bean public PasswordEncoder passwordEncoder() { // è®¾ç½®å¯†ç åŠ å¯†æ–¹å¼ä¸º SpringSecurity æä¾›çš„ BCryptPasswordEncoder return new BCryptPasswordEncoder(); } @Override protected void configure(HttpSecurity http) throws Exception { http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(\"/user/login\").anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); } /** * æš´éœ² AuthenticationManager åˆ° Spring å®¹å™¨ä¸­ä»¥ä¾¿ Service å±‚ä½¿ç”¨ * @return * @throws Exception */ @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } } ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:4","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#é…ç½®è®¤è¯è¿‡æ»¤å™¨"},{"categories":null,"content":"\rå¦‚ä½•é€€å‡ºç™»å½• å°† Redis ä¸­çš„ç”¨æˆ·ä¿¡æ¯åˆ é™¤å³å¯ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:5","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å¦‚ä½•é€€å‡ºç™»å½•"},{"categories":null,"content":"\rè‡ªå®šä¹‰æˆæƒ åœ¨ UserDetailsService ç±»ä¸­æŸ¥è¯¢ç”¨æˆ·å¯¹åº”çš„æƒé™ å°†ç”¨æˆ·çš„æƒé™ä¿¡æ¯å°è£…è‡³ SecurityContextHandler åœ¨ LoginUser ç±»ä¸­å®ç°è·å–æƒé™ä¿¡æ¯çš„æ–¹æ³• åœ¨éœ€è¦æƒé™çš„æ–¹æ³•ä¸Šæ–¹æ·»åŠ æ³¨è§£ 123 åœ¨ SecurityConfig ç±»ä¸Šæ–¹æ·»åŠ æ³¨è§£ï¼Œå¼€å¯å…¨å±€çš„æ³¨è§£æˆæƒæ–¹æ³• @EnableGlobalMethodSecurity(prePostEnabled = true) åœ¨éœ€è¦é‰´æƒæ‰èƒ½è®¿é—®çš„æ–¹æ³•æ·»åŠ æ³¨è§£ @PreAuthorize(\"hasAuthority('test')\") // åœ¨ UserDetailServiceImpl ç±»ä¸­è·å–ç”¨æˆ·å¯¹åº”çš„æƒé™åˆ—è¡¨ @Service public class UserDetailServiceImpl implements UserDetailsService { @Autowired private SysUserMapper sysUserMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { /*********************** æŸ¥è¯¢ç”¨æˆ· ***********************/ // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ SysUser sysUser = sysUserMapper.selectOneByUsername(username); //å¦‚æœæ²¡æœ‰è¿™ä¸ªè´¦æˆ·åˆ™æŠ›å‡ºå¼‚å¸¸ if (sysUser == null) { throw new RuntimeException(\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"); } /*********************** æŸ¥è¯¢æƒé™ä¿¡æ¯ ***********************/ List\u003cString\u003e permissionList = new ArrayList\u003c\u003e(Arrays.asList(\"test2\")); //æŠŠç”¨æˆ·å°è£…æˆ UserDetail è¿”å› return new LoginUser(sysUser, permissionList); } } ä¸º LoginUser ç±»å¢åŠ ä»£ç†æƒé™åˆ—è¡¨ã€å®ç° getAuthorities æ–¹æ³• // è¿™ä¸ªç±»è¦ä¿è¯æœ‰å®Œæ•´çš„æ„é€ å™¨ã€getã€set æ–¹æ³•ä»¥ä¾› fastJson åºåˆ—åŒ–å’Œååºåˆ—åŒ– public class LoginUser implements UserDetails { // ä»£ç†ç”¨æˆ·å®ä½“ private SysUser sysUser; // ä»£ç†ç”¨æˆ·å¯¹åº”çš„æƒé™åˆ—è¡¨ private List\u003cString\u003e permissions; //å­˜å‚¨SpringSecurityæ‰€éœ€è¦çš„æƒé™ä¿¡æ¯çš„é›†åˆ @JSONField(serialize = false) private List\u003cGrantedAuthority\u003e authorities; public LoginUser(SysUser sysUser, List\u003cString\u003e permissions) { this.sysUser = sysUser; this.permissions = permissions; } @Override public Collection\u003c? extends GrantedAuthority\u003e getAuthorities() { // è·å–æƒé™ä¿¡æ¯ if (authorities != null) { return authorities; } //æŠŠ permissions ä¸­å­—ç¬¦ä¸²ç±»å‹çš„æƒé™ä¿¡æ¯è½¬æ¢æˆ GrantedAuthority å¯¹è±¡å­˜å…¥ authorities ä¸­ authorities = permissions.stream(). map(SimpleGrantedAuthority::new) .collect(Collectors.toList()); return authorities; } åœ¨ JwtAuthenticationTokenFilter ä¼ å…¥æƒé™ä¿¡æ¯ ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è‡ªå®šä¹‰æˆæƒ"},{"categories":null,"content":"\rè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨ SpringSecurity åœ¨è®¤è¯å’Œæˆæƒå‡ºç°å¼‚å¸¸çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„å¼‚å¸¸å¤„ç†å™¨ è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šå°è£…æˆ AuthenticationException è°ƒç”¨ AuthenticationEntryPoint è¿›è¡Œå¼‚å¸¸å¤„ç† æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šå°è£…æˆ AccessDeniedException è°ƒç”¨ AccessDeniedHandler è¿›è¡Œå¼‚å¸¸å¤„ç† åœ¨ exceptionHandler ä¸­åˆ›å»ºå¯¹åº”çš„ç±» @Component public class AccessDeniedHandlerImpl implements AccessDeniedHandler { @Override public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException { ResponseResult result = new ResponseResult(HttpStatus.FORBIDDEN.value(), \"æƒé™ä¸è¶³\"); String json = JSON.toJSONString(result); // WebUtils.renderString(response,json); System.out.println(json); } } @Component public class AuthenticationEntryPointImpl implements AuthenticationEntryPoint { @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException { ResponseResult result = new ResponseResult(HttpStatus.UNAUTHORIZED.value(), \"è®¤è¯å¤±è´¥è¯·é‡æ–°ç™»å½•\"); String json = JSON.toJSONString(result); // WebUtils.renderString(response,json); System.out.println(json); } } åœ¨ SecurityConfig ä¸­æ³¨å…¥è¿™ä¸¤ä¸ªå®ç°ç±» @Autowired private AuthenticationEntryPoint authenticationEntryPoint; @Autowired private AccessDeniedHandler accessDeniedHandler; /******************** å¹¶é…ç½®åˆ° http ************************/ // æ³¨å†Œè®¤è¯å’Œæˆæƒå¼‚å¸¸çš„åˆ‡å…¥ç‚¹ http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint). accessDeniedHandler(accessDeniedHandler); ","date":"2022-10-22","objectID":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"Spring Securityè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springsecurity%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨"},{"categories":null,"content":"\råŸºç¡€ç¯‡è¡¥å……","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:0:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#åŸºç¡€ç¯‡è¡¥å……"},{"categories":null,"content":"\ræ•°æ®ç±»å‹","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®ç±»å‹"},{"categories":null,"content":"\ræ•°å€¼ç±»å‹ ç±»å‹ å¤§å° èŒƒå›´ï¼ˆæœ‰ç¬¦å·ï¼‰ èŒƒå›´ï¼ˆæ— ç¬¦å·ï¼‰ ç”¨é€” TINYINT 1 å­—èŠ‚ (-128ï¼Œ127) (0ï¼Œ255) å°æ•´æ•°å€¼ SMALLINT 2 å­—èŠ‚ (-32 768ï¼Œ32 767) (0ï¼Œ65 535) å¤§æ•´æ•°å€¼ MEDIUMINT 3 å­—èŠ‚ (-8 388 608ï¼Œ8 388 607) (0ï¼Œ16 777 215) å¤§æ•´æ•°å€¼ INTæˆ–INTEGER 4 å­—èŠ‚ (-2 147 483 648ï¼Œ2 147 483 647) (0ï¼Œ4 294 967 295) å¤§æ•´æ•°å€¼ BIGINT 8 å­—èŠ‚ (-9 233 372 036 854 775 808ï¼Œ 9 223 372 036 854 775 807) (0ï¼Œ18 446 744 073 709 551 615) æå¤§æ•´æ•°å€¼ FLOAT 4 å­—èŠ‚ (-3.402 823 466 E+38ï¼Œ -1.175 494 351 E-38)ï¼Œ 0ï¼Œ (1.175 494 351 E-38ï¼Œ 3.402 823 466 351 E+38) 0ï¼Œ (1.175 494 351 E-38ï¼Œ 3.402 823 466 E+38) å•ç²¾åº¦ æµ®ç‚¹æ•°å€¼ DOUBLE 8 å­—èŠ‚ (-1.797 693 134 862 315 7 E+308ï¼Œ -2.225 073 858 507 201 4 E-308)ï¼Œ 0ï¼Œ (2.225 073 858 507 201 4 E-308ï¼Œ 1.797 693 134 862 315 7 E+308) 0ï¼Œ (2.225 073 858 507 201 4 E-308ï¼Œ 1.797 693 134 862 315 7 E+308) åŒç²¾åº¦ æµ®ç‚¹æ•°å€¼ DECIMAL å¯¹DECIMAL(M,D) ï¼Œ å¦‚æœM\u003eDï¼Œä¸ºM+2å¦åˆ™ä¸ºD+2 ä¾èµ–äºMå’ŒDçš„å€¼ ä¾èµ–äºMå’ŒDçš„å€¼ å°æ•°å€¼ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°å€¼ç±»å‹"},{"categories":null,"content":"\ræ—¥æœŸå’Œæ—¶é—´ç±»å‹ ç±»å‹ å¤§å° (å­—èŠ‚) èŒƒå›´ æ ¼å¼ ç”¨é€” DATE 3 1000-01-01/9999-12-31 YYYY-MM-DD æ—¥æœŸå€¼ TIME 3 â€˜-838:59:59â€™/â€˜838:59:59â€™ HH:MM:SS æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´ YEAR 1 1901/2155 YYYY å¹´ä»½å€¼ DATETIME 8 1000-01-01 00:00:00/9999-12-31 23:59:59 YYYY-MM-DD HH:MM:SS æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ TIMESTAMP 4 1970-01-01 00:00:00/2038 ç»“æŸæ—¶é—´æ˜¯ç¬¬ 2147483647 ç§’ ( INTç±»å‹æœ€å¤§å€¼ )ï¼Œ åŒ—äº¬æ—¶é—´ 2038-1-19 11:14:07ï¼Œ æ ¼æ—å°¼æ²»æ—¶é—´ 2038-1-19 03:14:07 YYYYMMDD HHMMSS æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼ï¼Œæ—¶é—´æˆ³ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ—¥æœŸå’Œæ—¶é—´ç±»å‹"},{"categories":null,"content":"\rå­—ç¬¦ä¸²ç±»å‹ ç±»å‹ å¤§å° ç”¨é€” CHAR 0-255å­—èŠ‚ å®šé•¿å­—ç¬¦ä¸² VARCHAR 0-65535 å­—èŠ‚ å˜é•¿å­—ç¬¦ä¸² TINYBLOB 0-255å­—èŠ‚ ä¸è¶…è¿‡ 255 ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² TINYTEXT 0-255å­—èŠ‚ çŸ­æ–‡æœ¬å­—ç¬¦ä¸² BLOB 0-65 535å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ® TEXT 0-65 535å­—èŠ‚ é•¿æ–‡æœ¬æ•°æ® MEDIUMBLOB 0-16 777 215å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® MEDIUMTEXT 0-16 777 215å­—èŠ‚ ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ® LONGBLOB 0-4 294 967 295å­—èŠ‚ äºŒè¿›åˆ¶å½¢å¼çš„æå¤§æ–‡æœ¬æ•°æ® LONGTEXT 0-4 294 967 295å­—èŠ‚ æå¤§æ–‡æœ¬æ•°æ® VARCHAR çš„å¤§å°å¯ä»¥è¾¾åˆ° 65535 ï¼Ÿ åœ¨å®šä¹‰è¡¨ç»“æ„æ—¶ VARCHAR(M) ä¸­çš„ M æŒ‡çš„æ˜¯å­—ç¬¦é•¿åº¦å¹¶éå­—èŠ‚é•¿åº¦ï¼Œåœ¨ utf8mb4 ä¸­æ¯ä¸ªå­—ç¬¦å  4 å­—èŠ‚ æ‰€ä»¥åœ¨å®šä¹‰ varchar å­—æ®µæ—¶ï¼Œæœ€é«˜å¯ä»¥å®šä¹‰ 65535 / 4 = 16383.75 ä½†æ˜¯ç”±äº è¡Œæ ¼å¼ å’Œ è¡Œæº¢å‡º çš„é™åˆ¶å®æµ‹æœ€å¤šå¯ä»¥å­˜å‚¨ 48545 å­—èŠ‚ â‰ˆ 12136 å­—ç¬¦ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­—ç¬¦ä¸²ç±»å‹"},{"categories":null,"content":"\rå­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨è¿‡ç¨‹å­˜å‚¨å‡½æ•°"},{"categories":null,"content":"\rå­˜å‚¨è¿‡ç¨‹ Stored Procedure é˜¿é‡Œå¼€å‘è§„èŒƒ ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§ã€‚ MySQL ä» 5.0 å¼€å§‹æ”¯æŒå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° å°†å¤æ‚çš„ SQL é€»è¾‘å°è£…åœ¨ä¸€èµ·ï¼Œåº”ç”¨ç¨‹åºæ— é¡»å…³æ³¨å†…éƒ¨é€»è¾‘ï¼Œç®€å•çš„è°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å³å¯ åŸç†ï¼š å°±æ˜¯å°†ä¸€ç»„ç»è¿‡ é¢„å…ˆç¼–è¯‘ å¥½çš„ SQL è¯­å¥å°è£…åœ¨ MySQL æœåŠ¡å™¨ä¸Š éœ€è¦æ‰§è¡Œçš„æ—¶å€™åªéœ€è¦å‘èµ·è°ƒç”¨å‘½ä»¤ï¼ŒæœåŠ¡ç«¯å³å¯æ‰§è¡Œè¿™ç»„ SQL è¯­å¥ å¥½å¤„ï¼š ç®€åŒ–æ“ä½œï¼Œæé«˜ SQL è¯­å¥é‡ç”¨æ€§ å‡å°‘ç½‘ç»œä¼ è¾“é‡ é¿å…å¤±è¯¯ã€æé«˜æ•ˆç‡ å‡å°‘äº† SQL åœ¨ç½‘ç»œä¸­æš´éœ²çš„é£é™©ï¼Œæé«˜å®‰å…¨æ€§ ç”¨æ³• create procedure å­˜å‚¨è¿‡ç¨‹å (in|out|inout å‚æ•°å å‚æ•°ç±»å‹...) [characteristicsç‰¹å¾...] begin å­˜å‚¨è¿‡ç¨‹ä½“ end å‚æ•°ï¼ˆåˆ†ç±»ï¼‰ï¼š æ²¡æœ‰å‚æ•°ã€æ— å‚æ•°æ— è¿”å›ã€‘ INã€æœ‰å‚æ•°æ— è¿”å›ã€‘é»˜è®¤ OUTã€æ— å‚æ•°æœ‰è¿”å›ã€‘ IN OUT / INOUTã€æœ‰å‚æ•°æœ‰è¿”å›ã€‘ ç‰¹å¾ï¼š LANGUAGE SQLï¼šè¯´æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä½“æ˜¯ç”±SQLè¯­å¥ç»„æˆçš„ï¼Œå½“å‰ç³»ç»Ÿæ”¯æŒçš„è¯­è¨€ä¸ºSQLã€‚ [NOT] DETERMINISTICï¼šæŒ‡æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œçš„ç»“æœæ˜¯å¦ç¡®å®šã€‚DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ç¡®å®šçš„ã€‚æ¯æ¬¡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œç›¸åŒçš„è¾“å…¥ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºã€‚NOT DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œç›¸åŒçš„è¾“å…¥å¯èƒ½å¾—åˆ°ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šä»»æ„ä¸€ä¸ªå€¼ï¼Œé»˜è®¤ä¸ºNOT DETERMINISTICã€‚ { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }ï¼šæŒ‡æ˜å­ç¨‹åºä½¿ç”¨SQLè¯­å¥çš„é™åˆ¶ã€‚ CONTAINS SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºåŒ…å«SQLè¯­å¥ï¼Œä½†æ˜¯å¹¶ä¸åŒ…å«è¯»å†™æ•°æ®çš„SQLè¯­å¥ï¼› NO SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­ä¸åŒ…å«ä»»ä½•SQLè¯­å¥ï¼› READS SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«è¯»æ•°æ®çš„SQLè¯­å¥ï¼› MODIFIES SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«å†™æ•°æ®çš„SQLè¯­å¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæŒ‡å®šä¸ºCONTAINS SQLã€‚ SQL SECURITY { DEFINER | INVOKER }ï¼šæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹çš„æƒé™ï¼Œå³æŒ‡æ˜å“ªäº›ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚ DEFINERè¡¨ç¤ºåªæœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºè€…æˆ–è€…å®šä¹‰è€…æ‰èƒ½æ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ï¼› INVOKERè¡¨ç¤ºæ‹¥æœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„è®¿é—®æƒé™çš„ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ç›¸å…³çš„å€¼ï¼Œåˆ™MySQLé»˜è®¤æŒ‡å®šå€¼ä¸ºDEFINERã€‚ COMMENT 'string'ï¼šæ³¨é‡Šä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥æè¿°å­˜å‚¨è¿‡ç¨‹ã€‚ åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä¾‹ï¼š delimiter // CREATE PROCEDURE select_all_data() BEGIN SELECT * FROM emps; END // delimiter ; è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ä¾‹ï¼š CALL å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨) CALL select_all_data() ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨è¿‡ç¨‹-stored-procedure"},{"categories":null,"content":"\rå­˜å‚¨è¿‡ç¨‹ Stored Procedure é˜¿é‡Œå¼€å‘è§„èŒƒ ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§ã€‚ MySQL ä» 5.0 å¼€å§‹æ”¯æŒå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•° å°†å¤æ‚çš„ SQL é€»è¾‘å°è£…åœ¨ä¸€èµ·ï¼Œåº”ç”¨ç¨‹åºæ— é¡»å…³æ³¨å†…éƒ¨é€»è¾‘ï¼Œç®€å•çš„è°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å³å¯ åŸç†ï¼š å°±æ˜¯å°†ä¸€ç»„ç»è¿‡ é¢„å…ˆç¼–è¯‘ å¥½çš„ SQL è¯­å¥å°è£…åœ¨ MySQL æœåŠ¡å™¨ä¸Š éœ€è¦æ‰§è¡Œçš„æ—¶å€™åªéœ€è¦å‘èµ·è°ƒç”¨å‘½ä»¤ï¼ŒæœåŠ¡ç«¯å³å¯æ‰§è¡Œè¿™ç»„ SQL è¯­å¥ å¥½å¤„ï¼š ç®€åŒ–æ“ä½œï¼Œæé«˜ SQL è¯­å¥é‡ç”¨æ€§ å‡å°‘ç½‘ç»œä¼ è¾“é‡ é¿å…å¤±è¯¯ã€æé«˜æ•ˆç‡ å‡å°‘äº† SQL åœ¨ç½‘ç»œä¸­æš´éœ²çš„é£é™©ï¼Œæé«˜å®‰å…¨æ€§ ç”¨æ³• create procedure å­˜å‚¨è¿‡ç¨‹å (in|out|inout å‚æ•°å å‚æ•°ç±»å‹...) [characteristicsç‰¹å¾...] begin å­˜å‚¨è¿‡ç¨‹ä½“ end å‚æ•°ï¼ˆåˆ†ç±»ï¼‰ï¼š æ²¡æœ‰å‚æ•°ã€æ— å‚æ•°æ— è¿”å›ã€‘ INã€æœ‰å‚æ•°æ— è¿”å›ã€‘é»˜è®¤ OUTã€æ— å‚æ•°æœ‰è¿”å›ã€‘ IN OUT / INOUTã€æœ‰å‚æ•°æœ‰è¿”å›ã€‘ ç‰¹å¾ï¼š LANGUAGE SQLï¼šè¯´æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä½“æ˜¯ç”±SQLè¯­å¥ç»„æˆçš„ï¼Œå½“å‰ç³»ç»Ÿæ”¯æŒçš„è¯­è¨€ä¸ºSQLã€‚ [NOT] DETERMINISTICï¼šæŒ‡æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œçš„ç»“æœæ˜¯å¦ç¡®å®šã€‚DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ç¡®å®šçš„ã€‚æ¯æ¬¡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œç›¸åŒçš„è¾“å…¥ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºã€‚NOT DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œç›¸åŒçš„è¾“å…¥å¯èƒ½å¾—åˆ°ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šä»»æ„ä¸€ä¸ªå€¼ï¼Œé»˜è®¤ä¸ºNOT DETERMINISTICã€‚ { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }ï¼šæŒ‡æ˜å­ç¨‹åºä½¿ç”¨SQLè¯­å¥çš„é™åˆ¶ã€‚ CONTAINS SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºåŒ…å«SQLè¯­å¥ï¼Œä½†æ˜¯å¹¶ä¸åŒ…å«è¯»å†™æ•°æ®çš„SQLè¯­å¥ï¼› NO SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­ä¸åŒ…å«ä»»ä½•SQLè¯­å¥ï¼› READS SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«è¯»æ•°æ®çš„SQLè¯­å¥ï¼› MODIFIES SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«å†™æ•°æ®çš„SQLè¯­å¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæŒ‡å®šä¸ºCONTAINS SQLã€‚ SQL SECURITY { DEFINER | INVOKER }ï¼šæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹çš„æƒé™ï¼Œå³æŒ‡æ˜å“ªäº›ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚ DEFINERè¡¨ç¤ºåªæœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºè€…æˆ–è€…å®šä¹‰è€…æ‰èƒ½æ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ï¼› INVOKERè¡¨ç¤ºæ‹¥æœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„è®¿é—®æƒé™çš„ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ç›¸å…³çš„å€¼ï¼Œåˆ™MySQLé»˜è®¤æŒ‡å®šå€¼ä¸ºDEFINERã€‚ COMMENT 'string'ï¼šæ³¨é‡Šä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥æè¿°å­˜å‚¨è¿‡ç¨‹ã€‚ åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä¾‹ï¼š delimiter // CREATE PROCEDURE select_all_data() BEGIN SELECT * FROM emps; END // delimiter ; è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ä¾‹ï¼š CALL å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨) CALL select_all_data() ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æ³•"},{"categories":null,"content":"\rå­˜å‚¨å‡½æ•° Stored Function MySQL è‡ªå¸¦çš„ count(); è®¡æ•°ã€sum(); æ±‚å’Œã€avg(); å¹³å‡å€¼ã€max(); æœ€å¤§å€¼ã€min(); æœ€å°å€¼ éƒ½æ˜¯å‡½æ•° å­˜å‚¨å‡½æ•°å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•° å­˜å‚¨å‡½æ•°æ˜¯å¸¦æœ‰è¿”å›å€¼çš„ï¼Œå­˜å‚¨è¿‡ç¨‹å¯ä»¥ä¸å¸¦è¿”å›å€¼ ç”¨æ³• CREATE FUNCTION å‡½æ•°å(å‚æ•°å å‚æ•°ç±»å‹,...) RETURNS è¿”å›å€¼ç±»å‹ [characteristicsçº¦æŸ ...] BEGIN å‡½æ•°ä½“ #å‡½æ•°ä½“ä¸­è‚¯å®šæœ‰ RETURN è¯­å¥ END çº¦æŸ/ç‰¹å¾ åŒ å­˜å‚¨è¿‡ç¨‹ åˆ›å»ºå­˜å‚¨å‡½æ•°ä¾‹ï¼š delimiter // CREATE FUNCTION email_by_name() RETURNS VARCHAR( 25 ) DETERMINISTIC CONTAINS SQL BEGIN RETURN (SELECT email FROM employees WHERE last_name = 'Abel'); END // delimiter ; è°ƒç”¨å­˜å‚¨å‡½æ•°ä¾‹ï¼š SELECT å‡½æ•°å(å®å‚åˆ—è¡¨) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å‡½æ•°-stored-function"},{"categories":null,"content":"\rå­˜å‚¨å‡½æ•° Stored Function MySQL è‡ªå¸¦çš„ count(); è®¡æ•°ã€sum(); æ±‚å’Œã€avg(); å¹³å‡å€¼ã€max(); æœ€å¤§å€¼ã€min(); æœ€å°å€¼ éƒ½æ˜¯å‡½æ•° å­˜å‚¨å‡½æ•°å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•° å­˜å‚¨å‡½æ•°æ˜¯å¸¦æœ‰è¿”å›å€¼çš„ï¼Œå­˜å‚¨è¿‡ç¨‹å¯ä»¥ä¸å¸¦è¿”å›å€¼ ç”¨æ³• CREATE FUNCTION å‡½æ•°å(å‚æ•°å å‚æ•°ç±»å‹,...) RETURNS è¿”å›å€¼ç±»å‹ [characteristicsçº¦æŸ ...] BEGIN å‡½æ•°ä½“ #å‡½æ•°ä½“ä¸­è‚¯å®šæœ‰ RETURN è¯­å¥ END çº¦æŸ/ç‰¹å¾ åŒ å­˜å‚¨è¿‡ç¨‹ åˆ›å»ºå­˜å‚¨å‡½æ•°ä¾‹ï¼š delimiter // CREATE FUNCTION email_by_name() RETURNS VARCHAR( 25 ) DETERMINISTIC CONTAINS SQL BEGIN RETURN (SELECT email FROM employees WHERE last_name = 'Abel'); END // delimiter ; è°ƒç”¨å­˜å‚¨å‡½æ•°ä¾‹ï¼š SELECT å‡½æ•°å(å®å‚åˆ—è¡¨) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æ³•-1"},{"categories":null,"content":"\rå­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹å¯¹æ¯” å…³é”®å­— è°ƒç”¨è¯­æ³• è¿”å›å€¼ åº”ç”¨åœºæ™¯ å­˜å‚¨è¿‡ç¨‹ PROCEDURE CALL å­˜å‚¨è¿‡ç¨‹() ç†è§£ä¸ºæœ‰ 0 ä¸ªæˆ–å¤šä¸ª ä¸€èˆ¬ç”¨äºæ›´æ–° å­˜å‚¨å‡½æ•° FUNCTION SELECT å‡½æ•°() åªèƒ½æ˜¯ä¸€ä¸ª ä¸€èˆ¬ç”¨äºæŸ¥è¯¢ç»“æœä¸ºä¸€ä¸ªå€¼å¹¶è¿”å›æ—¶ å­˜å‚¨å‡½æ•°å¯ä»¥æ”¾åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸è¡Œ ã€‚ å­˜å‚¨è¿‡ç¨‹çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼ŒåŒ…æ‹¬èƒ½å¤Ÿæ‰§è¡Œå¯¹è¡¨çš„æ“ä½œï¼ˆæ¯”å¦‚åˆ›å»ºè¡¨ï¼Œåˆ é™¤è¡¨ç­‰ï¼‰å’Œäº‹åŠ¡æ“ä½œï¼Œè¿™äº›åŠŸèƒ½æ˜¯å­˜å‚¨å‡½æ•°ä¸å…·å¤‡çš„ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹å¯¹æ¯”"},{"categories":null,"content":"\ræŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤ç•¥ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹ä¿®æ”¹åˆ é™¤"},{"categories":null,"content":"\rå˜é‡ã€æµç¨‹æ§åˆ¶ã€æ¸¸æ ‡ è¿™å—æ˜¯ä¸ºä¾¿äºå’Œ å­˜å‚¨è¿‡ç¨‹ / å­˜å‚¨å‡½æ•° é…åˆä½¿ç”¨çš„ éœ€è¦æ—¶å¯ä»¥æŸ¥çœ‹é“¾æ¥å­¦ä¹ ä½¿ç”¨ wzblog ç•¥ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å˜é‡æµç¨‹æ§åˆ¶æ¸¸æ ‡"},{"categories":null,"content":"\rè§¦å‘å™¨ è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨ MySQL æœåŠ¡å™¨ä¸­çš„ä¸€æ®µç¨‹åº ä¸è¿‡å­˜å‚¨è¿‡ç¨‹æ˜¯æ‰‹åŠ¨è§¦å‘çš„ï¼Œè§¦å‘å™¨æ˜¯åœ¨æ‰§è¡Œä¸€äº›äº‹ä»¶çš„æ—¶å€™è‡ªåŠ¨è§¦å‘çš„ å½“ä¸€ä¸ªä¸šåŠ¡éœ€è¦å‘ å•†å“è¡¨ åº“å­˜è¡¨ ä¸­æ·»åŠ æ•°æ®æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨äº‹åŠ¡å®ç°æ•°æ®çš„å®Œæ•´æ€§ï¼Œä½†ä¸€æ—¦é‡åˆ°ç‰¹æ®Šæƒ…å†µå¿˜è®°äº†å…¶ä¸­ä¸€æ­¥ï¼Œä¼šå¯¼è‡´æ•°æ®ç¼ºå¤± è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨è§¦å‘å™¨ï¼Œå®ç°å½“ å•†å“è¡¨ æœ‰æ•°æ®æ’å…¥æ—¶ åº“å­˜è¡¨ è‡ªåŠ¨è§¦å‘æ’å…¥ ä¼˜ç‚¹ï¼š å¯ä»¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§ å¯ä»¥è®°å½•æ“ä½œæ—¥å¿— åœ¨æ“ä½œæ•°æ®å‰ï¼Œè¿›è¡Œæ•°æ®åˆæ³•æ€§æ ¡éªŒ ç¼ºç‚¹ï¼š å¯è¯»æ€§å·® è¡¨ç»“æ„æˆ–æ•°æ®å˜æ›´ï¼Œå®¹æ˜“å¯¼è‡´è§¦å‘å™¨å‡ºé”™ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è§¦å‘å™¨"},{"categories":null,"content":"\rç”¨æ³•ï¼š CREATE TRIGGER è§¦å‘å™¨åç§° {BEFORE|AFTER} {INSERT|UPDATE|DELETE} ON è¡¨å FOR EACH ROW BEGIN è§¦å‘å™¨æ‰§è¡Œçš„è¯­å¥å—; END è¯´æ˜ï¼š è¡¨åï¼šè¡¨ç¤ºè§¦å‘å™¨ç›‘æ§çš„å¯¹è±¡ã€‚ BEFORE|AFTERï¼šè¡¨ç¤ºè§¦å‘çš„æ—¶é—´ã€‚BEFORE è¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹å‰è§¦å‘ï¼›AFTER è¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹åè§¦å‘ã€‚ INSERT|UPDATE|DELETEï¼šè¡¨ç¤ºè§¦å‘çš„äº‹ä»¶ã€‚ INSERT è¡¨ç¤ºæ’å…¥è®°å½•æ—¶è§¦å‘ï¼› UPDATE è¡¨ç¤ºæ›´æ–°è®°å½•æ—¶è§¦å‘ï¼› DELETE è¡¨ç¤ºåˆ é™¤è®°å½•æ—¶è§¦å‘ã€‚ è§¦å‘å™¨æ‰§è¡Œçš„è¯­å¥å—ï¼šå¯ä»¥æ˜¯å•æ¡SQLè¯­å¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”±BEGINâ€¦ENDç»“æ„ç»„æˆçš„å¤åˆè¯­å¥å—ã€‚ åˆ›å»ºè§¦å‘å™¨ä¾‹1ï¼š DELIMITER // create trigger before_insert_test_tri before insert on test_trigger for each row begin insert into test_trigger_log(t_log) value('insert_trigger'); end // DELIMITER ; åˆ›å»ºè§¦å‘å™¨ä¾‹2ï¼šå®šä¹‰è§¦å‘å™¨â€œsalary_check_triggerâ€ï¼ŒåŸºäºå‘˜å·¥è¡¨â€œemployeesâ€çš„INSERTäº‹ä»¶ï¼Œåœ¨INSERTä¹‹å‰æ£€æŸ¥å°†è¦æ·»åŠ çš„æ–°å‘˜å·¥è–ªèµ„æ˜¯å¦å¤§äºä»–é¢†å¯¼çš„è–ªèµ„ï¼Œå¦‚æœå¤§äºé¢†å¯¼è–ªèµ„ï¼Œåˆ™æŠ¥sqlstate_valueä¸ºâ€™HY000â€™çš„é”™è¯¯ï¼Œä»è€Œä½¿å¾—æ·»åŠ å¤±è´¥ã€‚ DELIMITER // CREATE TRIGGER salary_check_trigger BEFORE INSERT ON employees FOR EACH ROW BEGIN DECLARE mgrsalary DOUBLE; # åˆ›å»º double ç±»å‹å˜é‡ mgrsalary ç”¨äºå­˜å‚¨å½“å‰å‘˜å·¥é¢†å¯¼çš„è–ªèµ„ SELECT salary INTO mgrsalary FROM employees WHERE employee_id = NEW.manager_id; IF NEW.salary \u003e mgrsalary THEN SIGNAL SQLSTATE 'HY000' SET MESSAGE_TEXT = 'è–ªèµ„é«˜äºé¢†å¯¼è–ªèµ„é”™è¯¯'; # æŠ›å‡ºé”™è¯¯ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œ END IF; END // DELIMITER ; NEW å…³é”®å­—ä»£è¡¨ INSERT æ·»åŠ è¯­å¥çš„æ–°è®°å½•ï¼ŒåŒç† OLD ä¸º DELETE ä¸­è¦åˆ é™¤çš„å·²æœ‰çš„è®°å½• SIGNAL æŠ›å‡ºé”™è¯¯ï¼Œä»£ç ä¸º SQLSTATE åå­—ç¬¦é”™è¯¯ä¿¡æ¯ä¸º MESSAGE_TEXT æŸ¥çœ‹è§¦å‘å™¨ï¼š æŸ¥çœ‹è§¦å‘å™¨æ˜¯æŸ¥çœ‹æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„è§¦å‘å™¨çš„å®šä¹‰ã€çŠ¶æ€å’Œè¯­æ³•ä¿¡æ¯ç­‰ã€‚ æ–¹å¼ 1 ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è§¦å‘å™¨çš„å®šä¹‰ SHOW TRIGGERS\\G æ–¹å¼ 2 ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æŸä¸ªè§¦å‘å™¨çš„å®šä¹‰ SHOW CREATE TRIGGER è§¦å‘å™¨å æ–¹å¼ 3 ï¼šä»ç³»ç»Ÿåº“information_schemaçš„TRIGGERSè¡¨ä¸­æŸ¥è¯¢â€œsalary_check_triggerâ€è§¦å‘å™¨çš„ä¿¡æ¯ã€‚ SELECT * FROM information_schema.TRIGGERS; åˆ é™¤è§¦å‘å™¨ï¼š è§¦å‘å™¨ä¹Ÿæ˜¯æ•°æ®åº“å¯¹è±¡ï¼Œåˆ é™¤è§¦å‘å™¨ä¹Ÿç”¨DROPè¯­å¥ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š DROP TRIGGER IF EXISTS è§¦å‘å™¨åç§°; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æ³•-2"},{"categories":null,"content":"\rDELIMITER åœ¨å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°ã€è§¦å‘å™¨ä¾‹å­ä¸­éƒ½ç”¨åˆ°äº† delimiter ä½œç”¨ä¸º ä¿®æ”¹ç¨‹åºæ‰§è¡Œç»“æŸçš„æ ‡è¯†ï¼Œé¿å…è¯­å¥å—ä¸­å‡ºç°åˆ†å·æ—¶ç¨‹åºå°±ç»“æŸæ‰§è¡Œäº† ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#delimiter"},{"categories":null,"content":"\rMySQL8 æ–°ç‰¹æ€§","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql8-æ–°ç‰¹æ€§"},{"categories":null,"content":"\ræ–°å¢çš„å†…å®¹å­—ç¬¦é›†æ”¯æŒï¼š MySQL 5 ä¸­é»˜è®¤å­—ç¬¦é›†ä¸º latin1ï¼Œé€šå¸¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸º utf8 å³ utf8mb3 é¿å…ä¹±ç é—®é¢˜ MySQL 8 ä¸­é»˜è®¤å­—ç¬¦é›†ä¸º utf8md4 åŠ å¯†è§„åˆ™ï¼š MySQL 5 ä¸­é»˜è®¤å¯†ç åŠ å¯†æ–¹å¼ä¸º mysql_native_password MySQL 8 ä¸­é»˜è®¤åŠ å¯†æ–¹å¼æ”¹ä¸ºäº† caching_sha2_password æˆæƒæ’ä»¶ã€è§’è‰²ã€å¯†ç å†å²è®°å½•å’Œ FIPS æ¨¡å¼æ”¯æŒï¼Œè¿™äº›ç‰¹æ€§æé«˜äº†æ•°æ®åº“çš„å®‰å…¨æ€§å’Œæ€§èƒ½ï¼Œä½¿æ•°æ®åº“ç®¡ç†å‘˜èƒ½å¤Ÿæ›´çµæ´»åœ°è¿›è¡Œè´¦æˆ·ç®¡ç†å·¥ä½œ å¯¼è‡´åœ¨ä½¿ç”¨ä¸€äº›æ—§ç‰ˆçš„å›¾å½¢ç•Œé¢å·¥å…·è¿æ¥æ—¶æŠ¥å¼‚å¸¸ï¼Œæ›´æ–°å›¾å½¢ç•Œé¢å·¥å…· æˆ– ä¿®æ”¹å¯†ç åŠ å¯†æ–¹å¼å³å¯è§£å†³ use mysql; ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'ThePassword'; # ä¿®æ”¹å¯†ç åŠ å¯†æ–¹å¼ flush privileges; # åˆ·æ–°æƒé™ æ›´ç®€ä¾¿çš„ NoSQL æ”¯æŒï¼š MySQL 5.6 å¼€å§‹å°±æ”¯æŒ NoSQL åœ¨ MySQL 8 å¯¹è¿™ä¸€åŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸å†ä½¿ç”¨ä¾èµ–æ¨¡å— (schema)ï¼Œ æ›´çµæ´» æ›´å¥½çš„ç´¢å¼•ï¼š MySQL 8 ä¸­æ–°å¢äº† éšè—ç´¢å¼• é™åºç´¢å¼• éšè—ç´¢å¼•å¯ä»¥ç”¨æ¥æµ‹è¯•å»æ‰ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ åœ¨æŸ¥è¯¢ä¸­æ··åˆå­˜åœ¨å¤šåˆ—ç´¢å¼•æ—¶ï¼Œä½¿ç”¨é™åºç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢çš„æ€§èƒ½ æ›´å®Œå–„çš„ JSON æ”¯æŒï¼š MySQL 5.7 å¼€å§‹æ”¯æŒåŸç”Ÿ JSON æ•°æ®çš„å­˜å‚¨ï¼Œæœ‰ä¸€äº›èšåˆå‡½æ•°å®ç° å­—ç¬¦ä¸² å’Œ JSON æ•°æ®çš„è§£æå’Œè½¬æ¢ç­‰ MySQL 8 å¯¹è¿™ä¸€åŠŸèƒ½åšäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†èšåˆå‡½æ•° JSON_ARRAYAGG() å’Œ JSON_OBJECTAGG() ï¼Œå°†å‚æ•°èšåˆä¸º JSON æ•°ç»„æˆ–å¯¹è±¡ï¼Œæ–°å¢äº†è¡Œå†…æ“ä½œç¬¦ -Â»ï¼Œæ˜¯åˆ—è·¯å¾„è¿ç®—ç¬¦ -\u003e çš„å¢å¼ºï¼Œå¯¹ JSON æ’åºåšäº†æå‡ï¼Œå¹¶ä¼˜åŒ–äº† JSON çš„æ›´æ–°æ“ä½œã€‚ æ”¹è¿›ã€ä¼˜åŒ– InnoDB å­˜å‚¨å¼•æ“ï¼š InnoDB æ˜¯ MySQL é»˜è®¤çš„ å­˜å‚¨å¼•æ“ï¼Œæ˜¯äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨è¡¨ï¼ˆACIDï¼‰ï¼Œæ”¯æŒè¡Œé”å®šå’Œå¤–é”®ã€‚åœ¨ MySQL 8 ç‰ˆæœ¬ä¸­ï¼ŒInnoDB åœ¨è‡ªå¢ã€ç´¢å¼•ã€åŠ å¯†ã€æ­»é”ã€å…±äº«é”ç­‰æ–¹é¢åšäº†å¤§é‡çš„ æ”¹è¿›å’Œä¼˜åŒ–ï¼Œå¹¶ä¸”æ”¯æŒåŸå­æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ï¼Œæé«˜äº†æ•°æ®å®‰å…¨æ€§ï¼Œå¯¹äº‹åŠ¡æä¾›æ›´å¥½çš„æ”¯æŒã€‚ æ•°æ®å­—å…¸ï¼š åœ¨ä¹‹å‰çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ•°æ®éƒ½å­˜å‚¨åœ¨å…ƒæ•°æ®æ–‡ä»¶å’Œéäº‹åŠ¡è¡¨ä¸­ã€‚ ä»MySQL 8å¼€å§‹æ–°å¢äº†äº‹åŠ¡æ•°æ®å­—å…¸ï¼Œåœ¨è¿™ä¸ªå­—å…¸é‡Œå­˜å‚¨ç€æ•°æ®åº“å¯¹è±¡ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®å­—å…¸å­˜å‚¨åœ¨å†…éƒ¨äº‹åŠ¡è¡¨ä¸­ åŸå­æ•°æ®å®šä¹‰è¯­å¥ï¼š MySQL 8å¼€å§‹æ”¯æŒåŸå­æ•°æ®å®šä¹‰è¯­å¥ï¼ˆAutomic DDLï¼‰ï¼Œå³ åŸå­DDLã€‚ç›®å‰ï¼Œåªæœ‰ InnoDB å­˜å‚¨å¼•æ“æ”¯æŒåŸå­ DDLã€‚ åœ¨ä½¿ç”¨æ”¯æŒåŸå­æ•°æ®å®šä¹‰çš„å­˜å‚¨å¼•æ“ä¸­ï¼Œå³äº‹åŠ¡è¦ä¹ˆå®Œå…¨æ“ä½œæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥åå›æ»šï¼Œä¸å†è¿›è¡Œéƒ¨åˆ†æäº¤ã€‚ èµ„æºç®¡ç†ï¼š MySQL 8 å¼€å§‹æ”¯æŒåˆ›å»ºå’Œç®¡ç†èµ„æºç»„â€¦ èµ„æºç®¡ç†æ›´é«˜æ•ˆã€åˆç† ä¼˜åŒ–å™¨å¢å¼ºï¼š MySQL ä¼˜åŒ–å™¨å¼€å§‹æ”¯æŒéšè—ç´¢å¼•å’Œé™åºç´¢å¼•ã€‚ éšè—ç´¢å¼•ä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼ŒéªŒè¯ç´¢å¼•çš„å¿…è¦æ€§æ—¶ä¸éœ€è¦åˆ é™¤ç´¢å¼•ï¼Œå…ˆå°†ç´¢å¼•éšè—ï¼Œå¦‚æœä¼˜åŒ–å™¨æ€§èƒ½æ— å½±å“å°±å¯ä»¥çœŸæ­£åœ°åˆ é™¤ç´¢å¼•ã€‚ é™åºç´¢å¼•å…è®¸ä¼˜åŒ–å™¨å¯¹å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å…è®¸æ’åºé¡ºåºä¸ä¸€è‡´ã€‚ å…±ç”¨è¡¨è¡¨è¾¾å¼ï¼š å…±ç”¨è¡¨è¡¨è¾¾å¼è¯¦æƒ… çª—å£å‡½æ•°ï¼š çª—å£å‡½æ•°è¯¦æƒ… æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒï¼š MySQL åœ¨ 8.0.4 ä»¥åçš„ç‰ˆæœ¬ä¸­é‡‡ç”¨æ”¯æŒ Unicode çš„å›½é™…åŒ–ç»„ä»¶åº“å®ç°æ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼Œè¿™ç§æ–¹å¼ä¸ä»…èƒ½æä¾›å®Œå…¨çš„ Unicode æ”¯æŒï¼Œè€Œä¸”æ˜¯å¤šå­—èŠ‚å®‰å…¨ç¼–ç ã€‚ å†…éƒ¨ä¸´æ—¶è¡¨ ï¼š TempTable å­˜å‚¨å¼•æ“å–ä»£ MEMORY å­˜å‚¨å¼•æ“æˆä¸ºå†…éƒ¨ä¸´æ—¶è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“ æ—¥å¿—è®°å½•ï¼š åœ¨ MySQL 8 ä¸­é”™è¯¯æ—¥å¿—å­ç³»ç»Ÿç”±ä¸€ç³»åˆ— MySQL ç»„ä»¶æ„æˆã€‚è¿™äº›ç»„ä»¶çš„æ„æˆç”±ç³»ç»Ÿå˜é‡ log_error_services æ¥é…ç½®ï¼Œèƒ½å¤Ÿå®ç°æ—¥å¿—äº‹ä»¶çš„è¿‡æ»¤å’Œå†™å…¥ã€‚ å¤‡ä»½é”ï¼š æ–°çš„å¤‡ä»½é”å…è®¸åœ¨çº¿å¤‡ä»½æœŸé—´æ‰§è¡Œæ•°æ®æ“ä½œè¯­å¥ï¼ŒåŒæ—¶é˜»æ­¢å¯èƒ½é€ æˆå¿«ç…§ä¸ä¸€è‡´çš„æ“ä½œã€‚ æ–°å¤‡ä»½é”ç”± LOCK INSTANCE FOR BACKUP å’Œ UNLOCK INSTANCE è¯­æ³•æä¾›æ”¯æŒï¼Œæ‰§è¡Œè¿™äº›æ“ä½œéœ€è¦å¤‡ä»½ç®¡ç†å‘˜ç‰¹æƒã€‚ å¢å¼ºçš„MySQLå¤åˆ¶ï¼š MySQL 8 å¤åˆ¶æ”¯æŒå¯¹ JSONæ–‡æ¡£ è¿›è¡Œéƒ¨åˆ†æ›´æ–°çš„ äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ï¼Œè¯¥è®°å½• ä½¿ç”¨ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œä»è€ŒèŠ‚çœè®°å½•å®Œæ•´ JSON æ–‡æ¡£çš„ç©ºé—´ã€‚ å½“ä½¿ç”¨åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•æ—¶ï¼Œè¿™ç§ç´§å‡‘çš„æ—¥å¿—è®°å½•ä¼šè‡ªåŠ¨å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å°†æ–°çš„ binlog_row_value_options ç³»ç»Ÿå˜é‡å€¼è®¾ç½®ä¸º PARTIAL_JSON æ¥å¯ç”¨ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ–°å¢çš„å†…å®¹"},{"categories":null,"content":"\rç§»é™¤çš„å†…å®¹æŸ¥è¯¢ç¼“å­˜ï¼š æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡å¤ªå°ï¼Œå¾ˆé¸¡è‚‹ åŒ…æ‹¬ï¼šè¯­å¥â€¦ ã€ç³»ç»Ÿå˜é‡â€¦ ã€çŠ¶æ€å˜é‡â€¦ ã€çº¿ç¨‹çŠ¶æ€â€¦ åŠ å¯†ç›¸å…³ï¼š åˆ é™¤çš„åŠ å¯†ç›¸å…³çš„å†…å®¹æœ‰ï¼šENCODE()ã€DECODE()ã€ENCRYPT()ã€DES_ENCRYPT() å’Œ DES_DECRYPT() å‡½æ•° é…ç½®é¡¹ des-key-fileï¼Œç³»ç»Ÿå˜é‡ have_cryptï¼ŒFLUSH è¯­å¥çš„ DES_KEY_FILE é€‰é¡¹ï¼ŒHAVE_CRYPT CMake é€‰é¡¹ã€‚ å¯¹äºç§»é™¤çš„ENCRYPT() å‡½æ•°ï¼Œè€ƒè™‘ä½¿ç”¨ SHA2() æ›¿ä»£ï¼Œå¯¹äºå…¶ä»–ç§»é™¤çš„å‡½æ•°ï¼Œä½¿ç”¨ AES_ENCRYPT() å’Œ AES_DECRYPT() æ›¿ä»£ã€‚ ç©ºé—´å‡½æ•°ç›¸å…³ï¼š åœ¨ MySQL 5.7 ç‰ˆæœ¬ä¸­ï¼Œå¤šä¸ªç©ºé—´å‡½æ•°å·²è¢«æ ‡è®°ä¸ºè¿‡æ—¶ã€‚è¿™äº›è¿‡æ—¶å‡½æ•°åœ¨ MySQL 8 ä¸­éƒ½å·²è¢«ç§»é™¤ï¼Œåªä¿ç•™äº†å¯¹åº”çš„ ST_ å’Œ MBR å‡½æ•°ã€‚ \\Nå’ŒNULLï¼š åœ¨ SQL è¯­å¥ä¸­ï¼Œè§£æå™¨ä¸å†å°† \\N è§†ä¸º NULLï¼Œæ‰€ä»¥åœ¨ SQL è¯­å¥ä¸­åº”ä½¿ç”¨ NULL ä»£æ›¿ \\Nã€‚ è¿™é¡¹å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨ LOAD DATA INFILE æˆ–è€… SELECTâ€¦INTO OUTFILEæ“ä½œæ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºã€‚åœ¨è¿™ç±»æ“ä½œä¸­ï¼ŒNULL ä»ç­‰åŒäº \\Nã€‚ mysql_install_dbï¼š åœ¨ MySQL åˆ†å¸ƒä¸­ï¼Œå·²ç§»é™¤äº† mysql_install_db ç¨‹åºï¼Œæ•°æ®å­—å…¸åˆå§‹åŒ–éœ€è¦è°ƒç”¨å¸¦ç€ â€“initialize æˆ–è€… â€“initialize-insecure é€‰é¡¹çš„mysqld æ¥ä»£æ›¿å®ç°ã€‚å¦å¤–ï¼Œâ€“bootstrap å’Œ INSTALL_SCRIPTDIR CMake ä¹Ÿå·²è¢«åˆ é™¤ã€‚ é€šç”¨åˆ†åŒºå¤„ç†ç¨‹åºï¼š é€šç”¨åˆ†åŒºå¤„ç†ç¨‹åºå·²ä» MySQL æœåŠ¡ä¸­è¢«ç§»é™¤ã€‚ä¸ºäº†å®ç°ç»™å®šè¡¨åˆ†åŒºï¼Œè¡¨æ‰€ä½¿ç”¨çš„å­˜å‚¨å¼•æ“éœ€è¦è‡ªæœ‰çš„åˆ†åŒºå¤„ç†ç¨‹åºã€‚ æä¾›æœ¬åœ°åˆ†åŒºæ”¯æŒçš„ MySQL å­˜å‚¨å¼•æ“æœ‰ä¸¤ä¸ªï¼Œå³ InnoDB å’Œ NDBï¼Œè€Œåœ¨ MySQL 8 ä¸­åªæ”¯æŒ InnoDBã€‚ ç³»ç»Ÿå’ŒçŠ¶æ€å˜é‡ä¿¡æ¯ï¼š åœ¨ INFORMATION_SCHEMA æ•°æ®åº“ä¸­ï¼Œå¯¹ç³»ç»Ÿå’ŒçŠ¶æ€å˜é‡ä¿¡æ¯ä¸å†è¿›è¡Œç»´æŠ¤ã€‚ GLOBAL_VARIABLESã€SESSION_VARIABLESã€GLOBAL_STATUSã€SESSION_STATUSè¡¨éƒ½å·²è¢«åˆ é™¤ã€‚ å¦å¤–ï¼Œç³»ç»Ÿå˜é‡ show_compatibility_56 ä¹Ÿå·²è¢«åˆ é™¤ã€‚è¢«åˆ é™¤çš„çŠ¶æ€å˜é‡æœ‰ Slave_heartbeat_periodã€Slave_last_heartbeat , Slave_received_heartbeatsã€Slave_retried_transactionsã€Slave_running ã€‚ ä»¥ä¸Šè¢«åˆ é™¤çš„å†…å®¹éƒ½å¯ä½¿ç”¨æ€§èƒ½æ¨¡å¼ä¸­å¯¹åº”çš„å†…å®¹è¿›è¡Œæ›¿ä»£ã€‚ mysql_pluginå·¥å…·ï¼š mysql_plugin å·¥å…·ç”¨æ¥é…ç½® MySQL æœåŠ¡å™¨æ’ä»¶ï¼Œç°å·²è¢«åˆ é™¤ï¼Œå¯ä½¿ç”¨ â€“plugin-load æˆ– â€“plugin-load-add é€‰é¡¹åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åŠ è½½æ’ä»¶æˆ–è€…åœ¨è¿è¡Œæ—¶ä½¿ç”¨ INSTALL PLUGIN è¯­å¥åŠ è½½æ’ä»¶æ¥æ›¿ä»£è¯¥å·¥å…·ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç§»é™¤çš„å†…å®¹"},{"categories":null,"content":"\rå…±ç”¨è¡¨è¡¨è¾¾å¼ æ¦‚å¿µï¼š å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆæˆ–é€šç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç®€ç§°ä¸º CTEï¼ˆCommon Table Expressionsï¼‰ CTE æ˜¯ä¸€ä¸ªå‘½äº†åçš„ä¸´æ—¶ç»“æœé›†ï¼Œä½œç”¨èŒƒå›´æ˜¯å½“å‰è¯­å¥ æˆ‘ç†è§£ CTE æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„å­æŸ¥è¯¢ï¼Œä½†æ˜¯ CTE å¯ä»¥å¼•ç”¨å…¶å®ƒ CTE ï¼Œå­æŸ¥è¯¢ä¸è¡Œ ç”¨æ³• WITH CTEåç§° AS ï¼ˆå­æŸ¥è¯¢ï¼‰ SELECT|DELETE|UPDATE è¯­å¥; æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼ # æŸ¥è¯¢å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨çš„è¯¦ç»†ä¿¡æ¯ SELECT * FROM departments WHERE department_id IN ( SELECT DISTINCT department_id FROM employees ); å…±ç”¨è¡¨è¡¨è¾¾å¼å†™æ³• æˆ‘ç†è§£ä¸ºè®²ä¸€ä¸ªæŸ¥è¯¢ä¸­å¯èƒ½ä¼šé‡å¤ç”¨åˆ°çš„å­æŸ¥è¯¢è¡¨ä¿å­˜èµ·æ¥ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥å½“ä½œä¸€ä¸ªè¡¨æ¥ä½¿ç”¨ WITH emp_dept_id AS (SELECT DISTINCT department_id FROM employees) SELECT * FROM departments d JOIN emp_dept_id e ON d.department_id = e.department_id; +---------------+------------------+------------+-------------+ | department_id | department_name | manager_id | location_id | +---------------+------------------+------------+-------------+ | 10 | Administration | 200 | 1700 | | 20 | Marketing | 201 | 1800 | | 30 | Purchasing | 114 | 1700 | | 40 | Human Resources | 203 | 2400 | | 50 | Shipping | 121 | 1500 | | 60 | IT | 103 | 1400 | | 70 | Public Relations | 204 | 2700 | | 80 | Sales | 145 | 2500 | | 90 | Executive | 100 | 1700 | | 100 | Finance | 108 | 1700 | | 110 | Accounting | 205 | 1700 | +---------------+------------------+------------+-------------+ 11 rows in set (0.00 sec) é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ CTE å¯ä»¥è°ƒç”¨è‡ªèº« å’Œè‡ªèº«è¿æ¥ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ä¸ªå…±åŒæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®ä¸Šéå¸¸é«˜æ•ˆ # æ‰¾åˆ°å‘˜å·¥è¡¨ä¸­ä¸‹ä¸‹å±çš„å‘˜å·¥ä¿¡æ¯ï¼Œä¸‰ä»£ä¸‹å±ä»¥ä¸‹ WITH RECURSIVE cte AS ( SELECT employee_id, last_name, manager_id, 1 AS n FROM employees WHERE employee_id = 100 -- ç§å­æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä»£é¢†å¯¼ UNION ALL SELECT a.employee_id, a.last_name, a.manager_id, n + 1 FROM employees AS a JOIN cte ON (a.manager_id = cte.employee_id) -- é€’å½’æŸ¥è¯¢ï¼Œæ‰¾å‡ºä»¥é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„äººä¸ºé¢†å¯¼çš„äºº ) SELECT employee_id, last_name FROM cte WHERE n \u003e= 3; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…±ç”¨è¡¨è¡¨è¾¾å¼-a-idgybbds-a"},{"categories":null,"content":"\rå…±ç”¨è¡¨è¡¨è¾¾å¼ æ¦‚å¿µï¼š å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆæˆ–é€šç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç®€ç§°ä¸º CTEï¼ˆCommon Table Expressionsï¼‰ CTE æ˜¯ä¸€ä¸ªå‘½äº†åçš„ä¸´æ—¶ç»“æœé›†ï¼Œä½œç”¨èŒƒå›´æ˜¯å½“å‰è¯­å¥ æˆ‘ç†è§£ CTE æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„å­æŸ¥è¯¢ï¼Œä½†æ˜¯ CTE å¯ä»¥å¼•ç”¨å…¶å®ƒ CTE ï¼Œå­æŸ¥è¯¢ä¸è¡Œ ç”¨æ³• WITH CTEåç§° AS ï¼ˆå­æŸ¥è¯¢ï¼‰ SELECT|DELETE|UPDATE è¯­å¥; æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼ # æŸ¥è¯¢å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨çš„è¯¦ç»†ä¿¡æ¯ SELECT * FROM departments WHERE department_id IN ( SELECT DISTINCT department_id FROM employees ); å…±ç”¨è¡¨è¡¨è¾¾å¼å†™æ³• æˆ‘ç†è§£ä¸ºè®²ä¸€ä¸ªæŸ¥è¯¢ä¸­å¯èƒ½ä¼šé‡å¤ç”¨åˆ°çš„å­æŸ¥è¯¢è¡¨ä¿å­˜èµ·æ¥ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥å½“ä½œä¸€ä¸ªè¡¨æ¥ä½¿ç”¨ WITH emp_dept_id AS (SELECT DISTINCT department_id FROM employees) SELECT * FROM departments d JOIN emp_dept_id e ON d.department_id = e.department_id; +---------------+------------------+------------+-------------+ | department_id | department_name | manager_id | location_id | +---------------+------------------+------------+-------------+ | 10 | Administration | 200 | 1700 | | 20 | Marketing | 201 | 1800 | | 30 | Purchasing | 114 | 1700 | | 40 | Human Resources | 203 | 2400 | | 50 | Shipping | 121 | 1500 | | 60 | IT | 103 | 1400 | | 70 | Public Relations | 204 | 2700 | | 80 | Sales | 145 | 2500 | | 90 | Executive | 100 | 1700 | | 100 | Finance | 108 | 1700 | | 110 | Accounting | 205 | 1700 | +---------------+------------------+------------+-------------+ 11 rows in set (0.00 sec) é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ CTE å¯ä»¥è°ƒç”¨è‡ªèº« å’Œè‡ªèº«è¿æ¥ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ä¸ªå…±åŒæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®ä¸Šéå¸¸é«˜æ•ˆ # æ‰¾åˆ°å‘˜å·¥è¡¨ä¸­ä¸‹ä¸‹å±çš„å‘˜å·¥ä¿¡æ¯ï¼Œä¸‰ä»£ä¸‹å±ä»¥ä¸‹ WITH RECURSIVE cte AS ( SELECT employee_id, last_name, manager_id, 1 AS n FROM employees WHERE employee_id = 100 -- ç§å­æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä»£é¢†å¯¼ UNION ALL SELECT a.employee_id, a.last_name, a.manager_id, n + 1 FROM employees AS a JOIN cte ON (a.manager_id = cte.employee_id) -- é€’å½’æŸ¥è¯¢ï¼Œæ‰¾å‡ºä»¥é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„äººä¸ºé¢†å¯¼çš„äºº ) SELECT employee_id, last_name FROM cte WHERE n \u003e= 3; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æ³•-3"},{"categories":null,"content":"\rå…±ç”¨è¡¨è¡¨è¾¾å¼ æ¦‚å¿µï¼š å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆæˆ–é€šç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç®€ç§°ä¸º CTEï¼ˆCommon Table Expressionsï¼‰ CTE æ˜¯ä¸€ä¸ªå‘½äº†åçš„ä¸´æ—¶ç»“æœé›†ï¼Œä½œç”¨èŒƒå›´æ˜¯å½“å‰è¯­å¥ æˆ‘ç†è§£ CTE æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„å­æŸ¥è¯¢ï¼Œä½†æ˜¯ CTE å¯ä»¥å¼•ç”¨å…¶å®ƒ CTE ï¼Œå­æŸ¥è¯¢ä¸è¡Œ ç”¨æ³• WITH CTEåç§° AS ï¼ˆå­æŸ¥è¯¢ï¼‰ SELECT|DELETE|UPDATE è¯­å¥; æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼ # æŸ¥è¯¢å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨çš„è¯¦ç»†ä¿¡æ¯ SELECT * FROM departments WHERE department_id IN ( SELECT DISTINCT department_id FROM employees ); å…±ç”¨è¡¨è¡¨è¾¾å¼å†™æ³• æˆ‘ç†è§£ä¸ºè®²ä¸€ä¸ªæŸ¥è¯¢ä¸­å¯èƒ½ä¼šé‡å¤ç”¨åˆ°çš„å­æŸ¥è¯¢è¡¨ä¿å­˜èµ·æ¥ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥å½“ä½œä¸€ä¸ªè¡¨æ¥ä½¿ç”¨ WITH emp_dept_id AS (SELECT DISTINCT department_id FROM employees) SELECT * FROM departments d JOIN emp_dept_id e ON d.department_id = e.department_id; +---------------+------------------+------------+-------------+ | department_id | department_name | manager_id | location_id | +---------------+------------------+------------+-------------+ | 10 | Administration | 200 | 1700 | | 20 | Marketing | 201 | 1800 | | 30 | Purchasing | 114 | 1700 | | 40 | Human Resources | 203 | 2400 | | 50 | Shipping | 121 | 1500 | | 60 | IT | 103 | 1400 | | 70 | Public Relations | 204 | 2700 | | 80 | Sales | 145 | 2500 | | 90 | Executive | 100 | 1700 | | 100 | Finance | 108 | 1700 | | 110 | Accounting | 205 | 1700 | +---------------+------------------+------------+-------------+ 11 rows in set (0.00 sec) é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ CTE å¯ä»¥è°ƒç”¨è‡ªèº« å’Œè‡ªèº«è¿æ¥ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ä¸ªå…±åŒæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®ä¸Šéå¸¸é«˜æ•ˆ # æ‰¾åˆ°å‘˜å·¥è¡¨ä¸­ä¸‹ä¸‹å±çš„å‘˜å·¥ä¿¡æ¯ï¼Œä¸‰ä»£ä¸‹å±ä»¥ä¸‹ WITH RECURSIVE cte AS ( SELECT employee_id, last_name, manager_id, 1 AS n FROM employees WHERE employee_id = 100 -- ç§å­æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä»£é¢†å¯¼ UNION ALL SELECT a.employee_id, a.last_name, a.manager_id, n + 1 FROM employees AS a JOIN cte ON (a.manager_id = cte.employee_id) -- é€’å½’æŸ¥è¯¢ï¼Œæ‰¾å‡ºä»¥é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„äººä¸ºé¢†å¯¼çš„äºº ) SELECT employee_id, last_name FROM cte WHERE n \u003e= 3; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼"},{"categories":null,"content":"\rå…±ç”¨è¡¨è¡¨è¾¾å¼ æ¦‚å¿µï¼š å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆæˆ–é€šç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç®€ç§°ä¸º CTEï¼ˆCommon Table Expressionsï¼‰ CTE æ˜¯ä¸€ä¸ªå‘½äº†åçš„ä¸´æ—¶ç»“æœé›†ï¼Œä½œç”¨èŒƒå›´æ˜¯å½“å‰è¯­å¥ æˆ‘ç†è§£ CTE æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„å­æŸ¥è¯¢ï¼Œä½†æ˜¯ CTE å¯ä»¥å¼•ç”¨å…¶å®ƒ CTE ï¼Œå­æŸ¥è¯¢ä¸è¡Œ ç”¨æ³• WITH CTEåç§° AS ï¼ˆå­æŸ¥è¯¢ï¼‰ SELECT|DELETE|UPDATE è¯­å¥; æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼ # æŸ¥è¯¢å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨çš„è¯¦ç»†ä¿¡æ¯ SELECT * FROM departments WHERE department_id IN ( SELECT DISTINCT department_id FROM employees ); å…±ç”¨è¡¨è¡¨è¾¾å¼å†™æ³• æˆ‘ç†è§£ä¸ºè®²ä¸€ä¸ªæŸ¥è¯¢ä¸­å¯èƒ½ä¼šé‡å¤ç”¨åˆ°çš„å­æŸ¥è¯¢è¡¨ä¿å­˜èµ·æ¥ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥å½“ä½œä¸€ä¸ªè¡¨æ¥ä½¿ç”¨ WITH emp_dept_id AS (SELECT DISTINCT department_id FROM employees) SELECT * FROM departments d JOIN emp_dept_id e ON d.department_id = e.department_id; +---------------+------------------+------------+-------------+ | department_id | department_name | manager_id | location_id | +---------------+------------------+------------+-------------+ | 10 | Administration | 200 | 1700 | | 20 | Marketing | 201 | 1800 | | 30 | Purchasing | 114 | 1700 | | 40 | Human Resources | 203 | 2400 | | 50 | Shipping | 121 | 1500 | | 60 | IT | 103 | 1400 | | 70 | Public Relations | 204 | 2700 | | 80 | Sales | 145 | 2500 | | 90 | Executive | 100 | 1700 | | 100 | Finance | 108 | 1700 | | 110 | Accounting | 205 | 1700 | +---------------+------------------+------------+-------------+ 11 rows in set (0.00 sec) é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ CTE å¯ä»¥è°ƒç”¨è‡ªèº« å’Œè‡ªèº«è¿æ¥ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ä¸ªå…±åŒæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®ä¸Šéå¸¸é«˜æ•ˆ # æ‰¾åˆ°å‘˜å·¥è¡¨ä¸­ä¸‹ä¸‹å±çš„å‘˜å·¥ä¿¡æ¯ï¼Œä¸‰ä»£ä¸‹å±ä»¥ä¸‹ WITH RECURSIVE cte AS ( SELECT employee_id, last_name, manager_id, 1 AS n FROM employees WHERE employee_id = 100 -- ç§å­æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä»£é¢†å¯¼ UNION ALL SELECT a.employee_id, a.last_name, a.manager_id, n + 1 FROM employees AS a JOIN cte ON (a.manager_id = cte.employee_id) -- é€’å½’æŸ¥è¯¢ï¼Œæ‰¾å‡ºä»¥é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„äººä¸ºé¢†å¯¼çš„äºº ) SELECT employee_id, last_name FROM cte WHERE n \u003e= 3; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼"},{"categories":null,"content":"\rçª—å£å‡½æ•° æ¡ˆä¾‹ï¼š ç°æœ‰è¡¨ï¼šsales è®¡ç®—è¿™ä¸ªç½‘ç«™åœ¨ æ¯ä¸ªåŸå¸‚çš„é”€å”®æ€»é¢ã€åœ¨å…¨å›½çš„é”€å”®æ€»é¢ã€æ¯ä¸ªåŒºçš„é”€å”®é¢å æ‰€åœ¨åŸå¸‚é”€å”®é¢ä¸­çš„æ¯”ç‡ï¼Œä»¥åŠå æ€»é”€å”®é¢ä¸­çš„æ¯”ç‡ã€‚ # 1.åˆ›å»ºå…¨å›½æ€»é”€å”®é¢ä¸´æ—¶è¡¨ CREATE TEMPORARY TABLE a -- åˆ›å»ºä¸´æ—¶è¡¨ SELECT SUM(sales_value) AS sales_value -- è®¡ç®—æ€»è®¡é‡‘é¢ FROM sales; # 2.åˆ›å»ºæ¯ä¸ªåŸå¸‚çš„æ€»é”€å”®é¢ä¸´æ—¶è¡¨ CREATE TEMPORARY TABLE b -- åˆ›å»ºä¸´æ—¶è¡¨ SELECT city,SUM(sales_value) AS sales_value -- è®¡ç®—åŸå¸‚é”€å”®åˆè®¡ FROM sales GROUP BY city; # 3.æŸ¥è¯¢ SELECT s.city AS åŸå¸‚,s.county AS åŒº, s.sales_value AS åŒºé”€å”®é¢, b.sales_value AS å¸‚é”€å”®é¢, s.sales_value/b.sales_value AS å¸‚æ¯”ç‡, a.sales_value AS æ€»é”€å”®é¢, s.sales_value/a.sales_value AS æ€»æ¯”ç‡ FROM sales s JOIN b ON (s.city=b.city) -- è¿æ¥å¸‚ç»Ÿè®¡ç»“æœä¸´æ—¶è¡¨ JOIN a -- è¿æ¥æ€»è®¡é‡‘é¢ä¸´æ—¶è¡¨ ORDER BY s.city,s.county; ä½¿ç”¨çª—å£å‡½æ•°å®ç° SELECT city AS åŸå¸‚,county AS åŒº, sales_value AS åŒºé”€å”®é¢, SUM(sales_value) OVER(PARTITION BY city) AS å¸‚é”€å”®é¢, -- è®¡ç®—å¸‚é”€å”®é¢ sales_value/SUM(sales_value) OVER(PARTITION BY city) AS å¸‚æ¯”ç‡, SUM(sales_value) OVER() AS æ€»é”€å”®é¢, -- è®¡ç®—æ€»é”€å”®é¢ sales_value/SUM(sales_value) OVER() AS æ€»æ¯”ç‡ FROM sales ORDER BY city,county; ç”±äºæ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œçš„æ•ˆç‡ä¹Ÿæ›´é«˜äº†ã€‚ åœ¨è¿™ç§éœ€è¦ç”¨åˆ°åˆ†ç»„ç»Ÿè®¡çš„ç»“æœå¯¹æ¯ä¸€æ¡è®°å½•è¿›è¡Œè®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çª—å£å‡½æ•°æ›´å¥½ ã€‚ æ¦‚å¿µï¼š çª—å£å‡½æ•°æ˜¯ä»‹äºå•è¡Œå’Œåˆ†ç»„å‡½æ•°ä¹‹é—´çš„ï¼š åˆ†ç»„å‡½æ•°æ˜¯å°†æ•°æ®åˆ†ç»„å¹¶åˆå¹¶ çª—å£å‡½æ•°æ˜¯å°†æ•°æ®åˆ†ç»„ä½†ä¸åˆå¹¶ï¼Œå°†ç»“æœç½®äºæ¯ä¸€æ¡æ•°æ®è®°å½•ä¸­ çª—å£å‡½æ•°çš„åˆ†ç±»ï¼š é™æ€çª—å£å‡½æ•° é™æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå› ä¸ºè®°å½•çš„ä¸åŒè€Œä¸åŒ åŠ¨æ€çª—å£å‡½æ•° åŠ¨æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°ä¼šéšç€è®°å½•çš„ä¸åŒè€Œå˜åŒ– çª—å£å‡½æ•°æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºåºå·å‡½æ•°ã€åˆ†å¸ƒå‡½æ•°ã€å‰åå‡½æ•°ã€é¦–å°¾å‡½æ•°å’Œå…¶ä»–å‡½æ•°ï¼Œå¦‚ä¸‹è¡¨ï¼š ç”¨æ³• PARTITION BY ï¼šåˆ†ç‰‡ã€åˆ†åŒº å‡½æ•° OVERï¼ˆ[PARTITION BY å­—æ®µå ][ ORDER BY å­—æ®µå ASC|DESC]ï¼‰ æˆ–è€…æ˜¯ï¼š # ç›¸å½“äºç»™ over åå†…å®¹ç»Ÿä¸€å®šä¹‰ï¼Œåœ¨ over ååªéœ€å†™çª—å£åå³å¯ å‡½æ•° OVER çª—å£å ... WINDOW çª—å£å AS ï¼ˆ[PARTITION BY å­—æ®µå ORDER BY å­—æ®µå ASC|DESC]ï¼‰ åºå·å‡½æ•°ï¼š row_number( ) é¡ºåºæ’åº ç°æœ‰è¡¨ goods éœ€æ±‚ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼é™åºæ’åˆ—çš„å„ä¸ªå•†å“ä¿¡æ¯ã€‚ # æ ¹æ® category_id åˆ†ç»„å¹¶æŒ‰ç…§ price é™åºæ’åº select row_number() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods; éœ€æ±‚ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼æœ€é«˜çš„ 3 ç§å•†å“ä¿¡æ¯ã€‚ select * from ( select row_number() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods ) as t where row_num \u003c= 3; rank( ) å¹¶åˆ—æ’åº å¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º 1 ã€ 1 ã€ 3 ã€2 è¢«è¦†ç›–äº†ã€‘ select rank() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods dense_rank( ) å¹¶åˆ—æ’åº å¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¸ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º1 ã€1 ã€2ã€2 è¿˜åœ¨ç»§ç»­æ’åºã€‘ select dense_rank() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods åˆ†å¸ƒå‡½æ•°ï¼š percent_rank( ) ç­‰çº§å€¼ç™¾åˆ†æ¯” æŒ‰ç…§ (rank - 1 ) / (rows - 1 ) è®¡ç®—ç­‰çº§å€¼ç™¾åˆ†æ¯”ï¼Œå€¼ä¸º 0 - 1 ç›¸å½“äºè®¡ç®—æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ç†è§£ä¸ºç™¾åˆ†æ¯”çš„æ’åºã€è¿›åº¦æ¡ # è®¡ç®— goods æ•°æ®è¡¨ä¸­çš„å•†å“çš„PERCENT_RANKå€¼ã€‚ SELECT RANK() OVER w AS r, PERCENT_RANK() OVER w AS pr, id, category_id, category, NAME, price, stock FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price DESC); cume_dist() ç´¯è®¡åˆ†å¸ƒå€¼ ä¸»è¦ç”¨äºæŸ¥è¯¢å°äºæˆ–ç­‰äºæŸä¸ªå€¼çš„æ¯”ä¾‹ã€‚ # è®¡ç®—å°äºç­‰äºå½“å‰ä»·æ ¼çš„æ¯”ä¾‹ SELECT CUME_DIST() OVER(PARTITION BY category_id ORDER BY price ASC) AS cd, id, category, NAME, price FROM goods; å‰åå‡½æ•°ï¼š lag(expr, n) è¿”å›å½“å‰è¡Œçš„å‰ n è¡Œçš„ expr çš„å€¼ # æŸ¥è¯¢ goods è¡¨ä¸­å½“å‰å•†å“çš„ä»·æ ¼å’Œå‰ä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price,LAG(price, 1 ) OVER (PARTITION BY category_id ORDER BY price) AS pre_price FROM goods # æŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­å‰ä¸€ä¸ªå•†å“ä»·æ ¼ä¸å½“å‰å•†å“ä»·æ ¼çš„å·®å€¼ã€‚ SELECT id, category, NAME, price, pre_price, price - pre_price AS diff_price FROM ( SELECT id, category, NAME, price,LAG(price, 1 ) OVER w AS pre_price FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price) ) t; lead() è¿”å›å½“å‰è¡Œçš„å n è¡Œçš„ expr çš„å€¼ # æŸ¥è¯¢ goods è¡¨ä¸­å½“å‰å•†å“çš„ä»·æ ¼å’Œåç¬¬äºŒä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, LEAD(price, 2 ) OVER (PARTITION BY category_id ORDER BY price) AS pre_price FROM goods é¦–å°¾å‡½æ•°ï¼š first_value(expr) è¿”å›ç¬¬ä¸€ä¸ª expr çš„å€¼ # æŸ¥è¯¢ category_id åˆ†ç»„åçš„å•†å“ä»·æ ¼ä¿¡æ¯å’Œæ¯ç»„ç¬¬ä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, first_value(price) OVER (PARTITION BY category_id ORDER BY price) AS first_price FROM goods last_value(expr) è¿”å›æœ€åä¸€ä¸ª expr çš„å€¼ # æŸ¥è¯¢ category_id åˆ†ç»„åçš„å•†å“ä»·æ ¼ä¿¡æ¯å’Œæ¯ç»„æœ€åä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, last_value(price) OVER (PARTITION BY category_id ORDER BY price range between unbounded preceding and unbounded following) AS last_price FROM goods order by åé¢çš„ range between unbounded preceding and unbounded following ä¸ºè®¾ç½®å–å€¼åŒºé—´ä¸ºåˆ†ç»„çš„å‰åæ— ç•Œé™ å…¶å®ƒå‡½æ•°ï¼š NTH_VALUE(expr,n) è¿”å›ç¬¬ n ä¸ª expr çš„å€¼ # æŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ’åç¬¬ 2 å’Œç¬¬ 3 çš„ä»·æ ¼ä¿¡æ¯ SELECT id, category, NAME, price,NTH_VALUE(price, 2 ) OVER w AS second_pric","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#çª—å£å‡½æ•°-a-idckhs-a"},{"categories":null,"content":"\rçª—å£å‡½æ•° æ¡ˆä¾‹ï¼š ç°æœ‰è¡¨ï¼šsales è®¡ç®—è¿™ä¸ªç½‘ç«™åœ¨ æ¯ä¸ªåŸå¸‚çš„é”€å”®æ€»é¢ã€åœ¨å…¨å›½çš„é”€å”®æ€»é¢ã€æ¯ä¸ªåŒºçš„é”€å”®é¢å æ‰€åœ¨åŸå¸‚é”€å”®é¢ä¸­çš„æ¯”ç‡ï¼Œä»¥åŠå æ€»é”€å”®é¢ä¸­çš„æ¯”ç‡ã€‚ # 1.åˆ›å»ºå…¨å›½æ€»é”€å”®é¢ä¸´æ—¶è¡¨ CREATE TEMPORARY TABLE a -- åˆ›å»ºä¸´æ—¶è¡¨ SELECT SUM(sales_value) AS sales_value -- è®¡ç®—æ€»è®¡é‡‘é¢ FROM sales; # 2.åˆ›å»ºæ¯ä¸ªåŸå¸‚çš„æ€»é”€å”®é¢ä¸´æ—¶è¡¨ CREATE TEMPORARY TABLE b -- åˆ›å»ºä¸´æ—¶è¡¨ SELECT city,SUM(sales_value) AS sales_value -- è®¡ç®—åŸå¸‚é”€å”®åˆè®¡ FROM sales GROUP BY city; # 3.æŸ¥è¯¢ SELECT s.city AS åŸå¸‚,s.county AS åŒº, s.sales_value AS åŒºé”€å”®é¢, b.sales_value AS å¸‚é”€å”®é¢, s.sales_value/b.sales_value AS å¸‚æ¯”ç‡, a.sales_value AS æ€»é”€å”®é¢, s.sales_value/a.sales_value AS æ€»æ¯”ç‡ FROM sales s JOIN b ON (s.city=b.city) -- è¿æ¥å¸‚ç»Ÿè®¡ç»“æœä¸´æ—¶è¡¨ JOIN a -- è¿æ¥æ€»è®¡é‡‘é¢ä¸´æ—¶è¡¨ ORDER BY s.city,s.county; ä½¿ç”¨çª—å£å‡½æ•°å®ç° SELECT city AS åŸå¸‚,county AS åŒº, sales_value AS åŒºé”€å”®é¢, SUM(sales_value) OVER(PARTITION BY city) AS å¸‚é”€å”®é¢, -- è®¡ç®—å¸‚é”€å”®é¢ sales_value/SUM(sales_value) OVER(PARTITION BY city) AS å¸‚æ¯”ç‡, SUM(sales_value) OVER() AS æ€»é”€å”®é¢, -- è®¡ç®—æ€»é”€å”®é¢ sales_value/SUM(sales_value) OVER() AS æ€»æ¯”ç‡ FROM sales ORDER BY city,county; ç”±äºæ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œçš„æ•ˆç‡ä¹Ÿæ›´é«˜äº†ã€‚ åœ¨è¿™ç§éœ€è¦ç”¨åˆ°åˆ†ç»„ç»Ÿè®¡çš„ç»“æœå¯¹æ¯ä¸€æ¡è®°å½•è¿›è¡Œè®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çª—å£å‡½æ•°æ›´å¥½ ã€‚ æ¦‚å¿µï¼š çª—å£å‡½æ•°æ˜¯ä»‹äºå•è¡Œå’Œåˆ†ç»„å‡½æ•°ä¹‹é—´çš„ï¼š åˆ†ç»„å‡½æ•°æ˜¯å°†æ•°æ®åˆ†ç»„å¹¶åˆå¹¶ çª—å£å‡½æ•°æ˜¯å°†æ•°æ®åˆ†ç»„ä½†ä¸åˆå¹¶ï¼Œå°†ç»“æœç½®äºæ¯ä¸€æ¡æ•°æ®è®°å½•ä¸­ çª—å£å‡½æ•°çš„åˆ†ç±»ï¼š é™æ€çª—å£å‡½æ•° é™æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå› ä¸ºè®°å½•çš„ä¸åŒè€Œä¸åŒ åŠ¨æ€çª—å£å‡½æ•° åŠ¨æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°ä¼šéšç€è®°å½•çš„ä¸åŒè€Œå˜åŒ– çª—å£å‡½æ•°æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºåºå·å‡½æ•°ã€åˆ†å¸ƒå‡½æ•°ã€å‰åå‡½æ•°ã€é¦–å°¾å‡½æ•°å’Œå…¶ä»–å‡½æ•°ï¼Œå¦‚ä¸‹è¡¨ï¼š ç”¨æ³• PARTITION BY ï¼šåˆ†ç‰‡ã€åˆ†åŒº å‡½æ•° OVERï¼ˆ[PARTITION BY å­—æ®µå ][ ORDER BY å­—æ®µå ASC|DESC]ï¼‰ æˆ–è€…æ˜¯ï¼š # ç›¸å½“äºç»™ over åå†…å®¹ç»Ÿä¸€å®šä¹‰ï¼Œåœ¨ over ååªéœ€å†™çª—å£åå³å¯ å‡½æ•° OVER çª—å£å ... WINDOW çª—å£å AS ï¼ˆ[PARTITION BY å­—æ®µå ORDER BY å­—æ®µå ASC|DESC]ï¼‰ åºå·å‡½æ•°ï¼š row_number( ) é¡ºåºæ’åº ç°æœ‰è¡¨ goods éœ€æ±‚ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼é™åºæ’åˆ—çš„å„ä¸ªå•†å“ä¿¡æ¯ã€‚ # æ ¹æ® category_id åˆ†ç»„å¹¶æŒ‰ç…§ price é™åºæ’åº select row_number() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods; éœ€æ±‚ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼æœ€é«˜çš„ 3 ç§å•†å“ä¿¡æ¯ã€‚ select * from ( select row_number() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods ) as t where row_num \u003c= 3; rank( ) å¹¶åˆ—æ’åº å¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º 1 ã€ 1 ã€ 3 ã€2 è¢«è¦†ç›–äº†ã€‘ select rank() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods dense_rank( ) å¹¶åˆ—æ’åº å¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¸ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º1 ã€1 ã€2ã€2 è¿˜åœ¨ç»§ç»­æ’åºã€‘ select dense_rank() over(partition by category_id order by price desc) as row_num, id, category_id, category, NAME, price, stock from goods åˆ†å¸ƒå‡½æ•°ï¼š percent_rank( ) ç­‰çº§å€¼ç™¾åˆ†æ¯” æŒ‰ç…§ (rank - 1 ) / (rows - 1 ) è®¡ç®—ç­‰çº§å€¼ç™¾åˆ†æ¯”ï¼Œå€¼ä¸º 0 - 1 ç›¸å½“äºè®¡ç®—æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ç†è§£ä¸ºç™¾åˆ†æ¯”çš„æ’åºã€è¿›åº¦æ¡ # è®¡ç®— goods æ•°æ®è¡¨ä¸­çš„å•†å“çš„PERCENT_RANKå€¼ã€‚ SELECT RANK() OVER w AS r, PERCENT_RANK() OVER w AS pr, id, category_id, category, NAME, price, stock FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price DESC); cume_dist() ç´¯è®¡åˆ†å¸ƒå€¼ ä¸»è¦ç”¨äºæŸ¥è¯¢å°äºæˆ–ç­‰äºæŸä¸ªå€¼çš„æ¯”ä¾‹ã€‚ # è®¡ç®—å°äºç­‰äºå½“å‰ä»·æ ¼çš„æ¯”ä¾‹ SELECT CUME_DIST() OVER(PARTITION BY category_id ORDER BY price ASC) AS cd, id, category, NAME, price FROM goods; å‰åå‡½æ•°ï¼š lag(expr, n) è¿”å›å½“å‰è¡Œçš„å‰ n è¡Œçš„ expr çš„å€¼ # æŸ¥è¯¢ goods è¡¨ä¸­å½“å‰å•†å“çš„ä»·æ ¼å’Œå‰ä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price,LAG(price, 1 ) OVER (PARTITION BY category_id ORDER BY price) AS pre_price FROM goods # æŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­å‰ä¸€ä¸ªå•†å“ä»·æ ¼ä¸å½“å‰å•†å“ä»·æ ¼çš„å·®å€¼ã€‚ SELECT id, category, NAME, price, pre_price, price - pre_price AS diff_price FROM ( SELECT id, category, NAME, price,LAG(price, 1 ) OVER w AS pre_price FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price) ) t; lead() è¿”å›å½“å‰è¡Œçš„å n è¡Œçš„ expr çš„å€¼ # æŸ¥è¯¢ goods è¡¨ä¸­å½“å‰å•†å“çš„ä»·æ ¼å’Œåç¬¬äºŒä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, LEAD(price, 2 ) OVER (PARTITION BY category_id ORDER BY price) AS pre_price FROM goods é¦–å°¾å‡½æ•°ï¼š first_value(expr) è¿”å›ç¬¬ä¸€ä¸ª expr çš„å€¼ # æŸ¥è¯¢ category_id åˆ†ç»„åçš„å•†å“ä»·æ ¼ä¿¡æ¯å’Œæ¯ç»„ç¬¬ä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, first_value(price) OVER (PARTITION BY category_id ORDER BY price) AS first_price FROM goods last_value(expr) è¿”å›æœ€åä¸€ä¸ª expr çš„å€¼ # æŸ¥è¯¢ category_id åˆ†ç»„åçš„å•†å“ä»·æ ¼ä¿¡æ¯å’Œæ¯ç»„æœ€åä¸€ä¸ªå•†å“çš„ä»·æ ¼ SELECT id, category, NAME, price, last_value(price) OVER (PARTITION BY category_id ORDER BY price range between unbounded preceding and unbounded following) AS last_price FROM goods order by åé¢çš„ range between unbounded preceding and unbounded following ä¸ºè®¾ç½®å–å€¼åŒºé—´ä¸ºåˆ†ç»„çš„å‰åæ— ç•Œé™ å…¶å®ƒå‡½æ•°ï¼š NTH_VALUE(expr,n) è¿”å›ç¬¬ n ä¸ª expr çš„å€¼ # æŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ’åç¬¬ 2 å’Œç¬¬ 3 çš„ä»·æ ¼ä¿¡æ¯ SELECT id, category, NAME, price,NTH_VALUE(price, 2 ) OVER w AS second_pric","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æ³•-4"},{"categories":null,"content":"\ré«˜çº§ç¯‡","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:0:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é«˜çº§ç¯‡"},{"categories":null,"content":"\rå­—ç¬¦é›† utf8mb3 é˜‰å‰²è¿‡çš„ utf8 å­—ç¬¦é›†ï¼Œç”¨ 1 - 3 ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼ŒMySQL ä¸­ utf8 é»˜è®¤æŒ‡çš„å°±æ˜¯ utf8mb3 utf8mb4 æ­£å®—çš„ utf8 å­—ç¬¦é›†ï¼Œç”¨ 1 - 4 ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼Œå¦‚éœ€å­˜å‚¨ emoji è¡¨æƒ…ï¼Œå°±éœ€è¦ç”¨åˆ° utf8mb4 MySQL 8 ä¹‹å‰ç‰ˆæœ¬é»˜è®¤å­—ç¬¦é›†ä¸º latin1ï¼Œå¦‚æœæƒ³å­˜å‚¨ä¸­æ–‡å­—ç¬¦ï¼Œéœ€ åœ¨ my.cnf ä¸­è®¾ç½®æ•°æ®åº“é»˜è®¤å­—ç¬¦é›† vim /etc/my.cnf æ·»åŠ  character_set_server=utf8 é‡å¯ MySQL æœåŠ¡ systemctl restart mysqld åœ¨åˆ›å»ºæ•°æ®åº“æˆ–è¡¨æ—¶æŒ‡å®šå­—ç¬¦é›† æ•°æ®åº“ CREATE DATABASE æ•°æ®åº“å [[DEFAULT] CHARACTER SET å­—ç¬¦é›†åç§°] [[DEFAULT] COLLATE æ¯”è¾ƒè§„åˆ™åç§°]; è¡¨ CREATE TABLE è¡¨å ( åˆ—å å­—ç¬¦ä¸²ç±»å‹ [CHARACTER SET å­—ç¬¦é›†åç§°] [COLLATE æ¯”è¾ƒè§„åˆ™åç§°], åˆ—çš„ä¿¡æ¯... ) [[DEFAULT] CHARACTER SET å­—ç¬¦é›†åç§°] [COLLATE æ¯”è¾ƒè§„åˆ™åç§°]] ä¿®æ”¹å·²åˆ›å»ºæ•°æ®åº“çš„å­—ç¬¦é›† alter database dbtest1 character set 'utf8'; ä¿®æ”¹å·²åˆ›å»ºæ•°æ®è¡¨çš„å­—ç¬¦é›† alter table t_emp convert to character set 'utf8'; å­—ç¬¦ä¸²æ¯”è¾ƒè§„åˆ™ï¼š å…¶ä¸­ Default collation å­—æ®µä¸ºé»˜è®¤æ¯”è¾ƒè§„åˆ™ åç¼€ è‹±æ–‡é‡Šä¹‰ æè¿° _ai accent insensitive ä¸åŒºåˆ†é‡éŸ³ _as accent sensitive åŒºåˆ†é‡éŸ³ _ci case insensitive ä¸åŒºåˆ†å¤§å°å†™ _cs case sensitive åŒºåˆ†å¤§å°å†™ _bin binary ä»¥äºŒè¿›åˆ¶æ–¹å¼æ¯”è¾ƒ æŸ¥çœ‹ã€ä¿®æ”¹å­—ç¬¦ä¸²æ¯”è¾ƒè§„åˆ™ #æŸ¥çœ‹æœåŠ¡å™¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ SHOW VARIABLES LIKE '%_server'; #æŸ¥çœ‹æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ SHOW VARIABLES LIKE '%_database'; #æŸ¥çœ‹å…·ä½“æ•°æ®åº“çš„å­—ç¬¦é›† SHOW CREATE DATABASE dbtest1; #ä¿®æ”¹å…·ä½“æ•°æ®åº“çš„å­—ç¬¦é›† ALTER DATABASE dbtest1 DEFAULT CHARACTER SET 'utf8' COLLATE 'utf8_general_ci'; #æŸ¥çœ‹è¡¨çš„å­—ç¬¦é›† show create table employees; #æŸ¥çœ‹è¡¨çš„æ¯”è¾ƒè§„åˆ™ show table status from atguigudb like 'employees'; #ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ ALTER TABLE emp1 DEFAULT CHARACTER SET 'utf8' COLLATE 'utf8_general_ci'; åœ¨æ•°æ®åº“è®¾ç½®ä¸­å°±éœ€è¦ä¿è¯ character_set_client å’Œ character_set_connection å’Œ character_set_results è®¾ç½®ä¸€è‡´ï¼Œä»¥é¿å…æ•°æ®åº“æœåŠ¡å™¨å¤„ç†ä¸­å‡ºç°ä¹±ç é—®é¢˜ ä½¿ç”¨ SET NAMES utf8; æˆ– è®¾ç½®my.cnf ä¸­å†…å®¹ æˆ– å•ç‹¬è®¾ç½®è¿™ä¸‰ä¸ªå€¼ æ•ˆæœä¸€è‡´ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­—ç¬¦é›†"},{"categories":null,"content":"\rSQL å¤§å°å†™è§„èŒƒ åœ¨ windows ç³»ç»Ÿä¸­ SHOW VARIABLES LIKE '%lower_case_table_names%' çš„ value å€¼ä¸º 0 å³: å¤§å°å†™ä¸æ•æ„Ÿ åœ¨ linux ç³»ç»Ÿä¸­ SHOW VARIABLES LIKE '%lower_case_table_names%' çš„ value å€¼ä¸º 1 ï¼Œéƒ¨åˆ†æƒ…å†µä¸‹å¤§å°å†™æ•æ„Ÿ è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥è®¾ç½®ä¸º 2 å³: æ— è®ºå¤§å°å†™å­—ç¬¦ï¼Œå‡¡æ˜¯æŸ¥æ‰¾å°±éƒ½æ˜¯æŒ‰ç…§å°å†™è¿›è¡Œ åœ¨ MySQL 5 è®¾ç½® my.cnf ä¸­åŠ å…¥ lower_case_table_names=1 ã€éœ€è¦æå‰å°†è¡¨æ˜å…¨éƒ¨æ”¹ä¸ºå°å†™ï¼Œé‡å¯ç”Ÿæ•ˆã€‘ åœ¨ MySQL 8 è®¾ç½®ã€ä¸å»ºè®®æ”¹ã€‘ 1ã€åœæ­¢MySQLæœåŠ¡ 2ã€åˆ é™¤æ•°æ®ç›®å½•ï¼Œå³åˆ é™¤ /var/lib/mysql ç›®å½• 3ã€åœ¨MySQLé…ç½®æ–‡ä»¶ (/etc/my.cnf) ä¸­æ·»åŠ  lower_case_table_names=1 4ã€å¯åŠ¨MySQLæœåŠ¡ MySQL åœ¨ Linux ä¸‹æ•°æ®åº“åã€è¡¨åã€åˆ—åã€åˆ«åå¤§å°å†™è§„åˆ™æ˜¯è¿™æ ·çš„ï¼š æ•°æ®åº“åã€è¡¨åã€è¡¨çš„åˆ«åã€å˜é‡åæ˜¯ä¸¥æ ¼åŒºåˆ†å¤§å°å†™çš„ï¼šdbtest99; å…³é”®å­—ã€å‡½æ•°åç§°åœ¨ SQL ä¸­ä¸åŒºåˆ†å¤§å°å†™ï¼šCOUNT() sum() åˆ—åï¼ˆæˆ–å­—æ®µåï¼‰ä¸åˆ—çš„åˆ«åï¼ˆæˆ–å­—æ®µåˆ«åï¼‰åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹å‡æ˜¯å¿½ç•¥å¤§å°å†™çš„ï¼šId, NaME, PassWORD å»ºè®®ï¼š å…³é”®å­—å’Œå‡½æ•°åç§°å…¨éƒ¨å¤§å†™ æ•°æ®åº“åã€è¡¨åã€è¡¨åˆ«åã€å­—æ®µåã€å­—æ®µåˆ«åç­‰å…¨éƒ¨å°å†™ SQL è¯­å¥å¿…é¡»ä»¥åˆ†å·ç»“å°¾ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#sql-å¤§å°å†™è§„èŒƒ"},{"categories":null,"content":"\rsql_mode sql_mode æ˜¯ä¸€ç»„è¯­æ³•æ ¡éªŒè§„åˆ™ï¼Œä¼šå½±å“ MySQL çš„æ•°æ®éªŒè¯æ£€æŸ¥ é€šè¿‡è®¾ç½® sql_mode å®ç°ä¸åŒä¸¥æ ¼ç¨‹åº¦çš„æ•°æ®æ ¡éªŒï¼Œæœ‰æ•ˆä¿è¯æ•°æ®å‡†ç¡®æ€§ ã€å®½æ¾æ¨¡å¼ã€‘MySQL 5.6 é»˜è®¤ä¸ºå®½æ¾æ¨¡å¼ NO_ENGINE_SUBSTITUTIONï¼Œæ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œå…è®¸ä¸€äº›éæ³•æ•°æ®çš„æ’å…¥ å®½æ¾æ¨¡å¼åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå³ä½¿ç»™äº†ä¸€ä¸ªé”™è¯¯çš„æ•°æ®ï¼Œä»ç„¶å¯èƒ½è¢«æ¥å—ä¸æŠ¥é”™ã€‚ ä¸¾ä¾‹ï¼šåœ¨ç»™ä¸€ä¸ª char(10) çš„å­—æ®µæ’å…¥ 1234567890abc è¿™æ ·ä¸€ä¸ªé•¿åº¦è¶…è¿‡ 10 çš„æ•°æ®æ—¶ï¼ŒMySQL ä¼šè‡ªè¡Œå¤„ç†å¹¶æ¥å—ï¼Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œæ˜¯å°†å‰åä½æ•°æ®æ’å…¥åé¢çš„èˆå¼ƒã€‚ åº”ç”¨åœºæ™¯ï¼šåœ¨åšæ•°æ®è¿ç§»æ—¶å¯ä»¥æ‰“å¼€å®½æ¾æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å³ä¾¿ä½¿ç”¨çš„æ˜¯ MySQL 5.6 ä¹Ÿåº”è®¾ç½®ä¸ºä¸¥æ ¼æ¨¡å¼ ã€ä¸¥æ ¼æ¨¡å¼ã€‘MySQL 5.7 é»˜è®¤ä¸ºä¸¥æ ¼æ¨¡å¼ STRICT_TRANS_TABLESï¼Œå¯¹æ•°æ®è¿›è¡Œä¸¥æ ¼çš„æ ¡éªŒï¼Œé”™è¯¯æ—¶æŠ¥ ERROR å¹¶å›æ»š ä¸¥æ ¼æ¨¡å¼åˆ™ä¸¥æ ¼æŒ‰ç…§æ•°æ®çš„çº¦æŸè¿›è¡Œæ ¡éªŒï¼Œå½“é‡åˆ°çš„æ˜¯é”™è¯¯çš„æ•°æ®æ—¶ç«‹å³æŠ¥ ERROR é—®é¢˜ï¼šä½¿ç”¨ä¸¥æ ¼æ¨¡å¼æ—¶è‹¥è®¾ç½®æ¨¡å¼ä¸­åŒ…å«äº† NO_ZERO_DATE ä¸å…è®¸æ’å…¥é›¶æ—¥æœŸã€‚å½“ä¸€ä¸ªå­—æ®µä½¿ç”¨çš„æ˜¯ TIMESTAMP æ—¶é—´æˆ³ç±»å‹æ—¶ï¼Œæœªå£°æ˜ä¸º NULL æˆ– default å€¼æ—¶ï¼Œå°†è‡ªåŠ¨åˆ†é… DEFAULT â€˜0000-00-00 00:00:00â€™ ( é›¶æ—¶é—´æˆ³ )ï¼Œæ­¤æ—¶ä¼šæŠ¥é”™è¯¯ ERROR sql_mode å€¼ æè¿° ONLY_FULL_GROUP_BY å¯¹äº GROUP BY èšåˆæ“ä½œï¼Œå¦‚æœåœ¨SELECTä¸­çš„åˆ—ï¼Œæ²¡æœ‰åœ¨ GROUP BY ä¸­å‡ºç°ï¼Œé‚£ä¹ˆè¿™ä¸ª SQL æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºåˆ—ä¸åœ¨ GROUP BY ä»å¥ä¸­ NO_AUTO_VALUE_ON_ZERO è¯¥å€¼å½±å“è‡ªå¢é•¿åˆ—çš„æ’å…¥ã€‚é»˜è®¤è®¾ç½®ä¸‹ï¼Œæ’å…¥ 0 æˆ– NULL ä»£è¡¨ç”Ÿæˆä¸‹ä¸€ä¸ªè‡ªå¢é•¿å€¼ã€‚å¦‚æœç”¨æˆ· å¸Œæœ›æ’å…¥çš„å€¼ä¸º 0ï¼Œè€Œè¯¥åˆ—åˆæ˜¯è‡ªå¢é•¿çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å°±æœ‰ç”¨äº† ==STRICT_TRANS_TABLES== åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå€¼ä¸èƒ½æ’å…¥åˆ°ä¸€ä¸ªäº‹åŠ¡è¡¨ä¸­ï¼Œåˆ™ä¸­æ–­å½“å‰çš„æ“ä½œï¼Œå¯¹éäº‹åŠ¡è¡¨ä¸åšé™åˆ¶ NO_ZERO_IN_DATE åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸å…è®¸æ—¥æœŸå’Œæœˆä»½ä¸ºé›¶ NO_ZERO_DATE MySQL æ•°æ®åº“ä¸å…è®¸æ’å…¥é›¶æ—¥æœŸï¼Œæ’å…¥é›¶æ—¥æœŸä¼šæŠ›å‡ºé”™è¯¯è€Œä¸æ˜¯è­¦å‘Š ERROR_FOR_DIVISION_BY_ZERO åœ¨ INSERT æˆ– UPDATE è¿‡ç¨‹ä¸­,å¦‚æœæ•°æ®è¢«é›¶é™¤ï¼Œåˆ™äº§ç”Ÿé”™è¯¯è€Œéè­¦å‘Šã€‚å¦‚æœæœªç»™å‡ºè¯¥æ¨¡å¼ï¼Œé‚£ä¹ˆæ•°æ®è¢«é›¶é™¤æ—¶ MySQL è¿”å› NULL NO_AUTO_CREATE_USER ç¦æ­¢ GRANT åˆ›å»ºå¯†ç ä¸ºç©ºçš„ç”¨æˆ· ==NO_ENGINE_SUBSTITUTION== å¦‚æœéœ€è¦çš„å­˜å‚¨å¼•æ“è¢«ç¦ç”¨æˆ–æœªç¼–è¯‘ï¼Œé‚£ä¹ˆæŠ›å‡ºé”™è¯¯ã€‚ä¸è®¾ç½®æ­¤å€¼æ—¶ï¼Œç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“æ›¿ä»£ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ PIPES_AS_CONCAT å°† â€œ||â€ è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œè¿™å’Œ Oracle æ•°æ®åº“æ˜¯ä¸€æ ·ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•° Concat ç›¸ç±»ä¼¼ ANSI_QUOTES å¯ç”¨ ANSI_QUOTES åï¼Œä¸èƒ½ç”¨åŒå¼•å·æ¥å¼•ç”¨å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«è§£é‡Šä¸ºè¯†åˆ«ç¬¦ æŸ¥çœ‹å½“å‰çš„ sql_mode select @@session.sql_mode select @@global.sql_mode #æˆ–è€… show variables like 'sql_mode'; ä¸´æ—¶è®¾ç½® sql_mode SET GLOBAL sql_mode = 'modes...'; #å…¨å±€ SET SESSION sql_mode = 'modes...'; #å½“å‰ä¼šè¯ #æ”¹ä¸ºä¸¥æ ¼æ¨¡å¼ã€‚æ­¤æ–¹æ³•åœ¨å½“å‰æœåŠ¡ä¸­ç”Ÿæ•ˆï¼Œé‡å¯MySQLæœåŠ¡åå¤±æ•ˆã€‚ set GLOBAL sql_mode='STRICT_TRANS_TABLES'; #æ”¹ä¸ºä¸¥æ ¼æ¨¡å¼ã€‚æ­¤æ–¹æ³•åªåœ¨å½“å‰ä¼šè¯ä¸­ç”Ÿæ•ˆï¼Œå…³é—­å½“å‰ä¼šè¯å°±ä¸ç”Ÿæ•ˆäº†ã€‚ set SESSION sql_mode='STRICT_TRANS_TABLES'; æ°¸ä¹…è®¾ç½® sql_mode åœ¨ my.cnf ä¸­æ·»åŠ  [mysqld] sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION é‡å¯ MySQL æœåŠ¡ã€ç”Ÿäº§åœºæ™¯æ¨èä½¿ç”¨ä¸´æ—¶ + æ°¸ä¹…è®¾ç½®é…åˆã€‘ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:1:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#sql_mode"},{"categories":null,"content":"\rMySQL çš„æ•°æ®ç›®å½•","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-çš„æ•°æ®ç›®å½•"},{"categories":null,"content":"\rä¸»è¦ç›®å½•ç»“æ„Windows ä¸­çš„ MySQL æ•°æ®å­˜æ”¾ç›®å½• C:\\ProgramData\\MySQL\\MySQL Server 8.0 â”‚ installer_config.xml â”‚ my.ini â”‚ â”œâ”€Data â”‚ â”œâ”€#innodb_temp â”‚ â”œâ”€æ•°æ®åº“å â”‚ â”‚ è¡¨å.ibd â”‚ â”‚ è¡¨å.ibd â”‚ â”œâ”€mysql â”‚ â”œâ”€performance_schema â”‚ â””â”€sys â””â”€Uploads Linux ä¸­çš„ MySQL æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ç›¸å…³å‘½ä»¤ç›®å½• /usr/bin(mysqladminã€mysqlbinlogã€mysqldump ç­‰å‘½ä»¤) å’Œ /usr/sbin é…ç½®æ–‡ä»¶ç›®å½• /usr/share/mysql-8.0 (å‘½ä»¤åŠé…ç½®æ–‡ä»¶) /etc/mysql (å¦‚ my.cnf) æŸ¥çœ‹ MySQL ç›¸å…³çš„ç›®å½• find / -name mysql ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸»è¦ç›®å½•ç»“æ„"},{"categories":null,"content":"\ræ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ ã€å­˜å‚¨å¼•æ“ã€‘ï¼šInnoDB / MyISAM çš„ä½œç”¨å°±æ˜¯ æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Š ã€‚ åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–æ•°æ®å¹¶è¿”å› ==MySQL è‡ªå¸¦çš„æ•°æ®åº“== mysqlï¼šMySQL çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·è´¦æˆ·ã€æƒé™ä¿¡æ¯ï¼Œå­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œæ—¥å¿—ï¼Œå¸®åŠ©ä¿¡æ¯ã€æ—¶åŒºä¿¡æ¯ç­‰ information_schemaï¼šå­˜å‚¨æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ æè¿°æ€§ä¿¡æ¯ / å…ƒæ•°æ® ï¼Œæ¯”å¦‚è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹/å‡½æ•°ã€è§¦å‘å™¨ã€åˆ—ã€ç´¢å¼•ç­‰ performance_schemaï¼šå­˜å‚¨ MySQL æ•°æ®åº“åœ¨è¿è¡Œæ—¶æœŸçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ€§èƒ½æŒ‡æ ‡ã€‚ç»Ÿè®¡æ‰§è¡Œçš„è¯­å¥ã€èŠ±è´¹çš„æ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰ sysï¼šé€šè¿‡ è§†å›¾ å°† information_schemaã€performance_schema ç»“åˆèµ·æ¥ã€‚å¸®åŠ©å¼€å‘äººå‘˜ç›‘æ§ MySQL çš„æŠ€æœ¯æ€§èƒ½ MySQL 5.7 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1ã€dbtest2 è¿›å…¥ dbtest1 ç›®å½• db.optï¼šå­˜å‚¨å½“å‰æ•°æ®åº“ä¸‹çš„ä¿¡æ¯ ( å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ç­‰ ) emp1.frmï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ ) emp1.idbï¼šå­˜å‚¨è¡¨æ•°æ®ã€é»˜è®¤ã€‘( MySQL 5.5 å‰è¡¨æ•°æ®å­˜æ”¾åœ¨ä¸Šçº§ç›®å½• ibdata1 ä¸­ ) ibdata1ï¼šã€ç³»ç»Ÿè¡¨ç©ºé—´ã€‘system tablespace MySQL 5.5 å‰ï¼Œè¡¨æ•°æ®é»˜è®¤éƒ½å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­ æ˜¯ä¸€ä¸ª è‡ªæ‰©å±•æ–‡ä»¶ é»˜è®¤å¤§å° 12M å¯ä»¥ä¿®æ”¹ my.cnf é…ç½®ç³»ç»Ÿè¡¨ç©ºé—´é»˜è®¤è·¯å¾„åŠå¤§å° [server] innodb_data_file_path=data1:512M;data2:512M:autoextend è¡¨å.ibdï¼šã€ç‹¬ç«‹è¡¨ç©ºé—´ã€‘file-per-table tablespace åœ¨ MySQL 5.6.6 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ è®¾ç½®ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼š å¯ä»¥ä¿®æ”¹ my.cnf é…ç½® [server] innodb_file_per_table=0 # 0ï¼šä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼› 1ï¼šä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ MySQL 8 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1 è¿›å…¥ dbtest1 ç›®å½• emp1.ibdï¼šé›†æˆäº† è¡¨ç»“æ„ä¿¡æ¯ å’Œ è¡¨æ•°æ® çš„æ–‡ä»¶ è§£æ ibd æ–‡ä»¶ï¼š ä½¿ç”¨ Oracle æä¾›é›†æˆçš„ ibd2sdi å·¥å…· ibd2sdi --dump-file=tbl_dic_type.txt tbl_dic_type.ibd ç”Ÿæˆ tbl_dic_type.txt æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¯¹è¡¨ç»“æ„ä¿¡æ¯çš„æè¿° MyISAM å­˜å‚¨å¼•æ“çš„æ–‡ä»¶ç»“æ„ MyISAM å­˜å‚¨å¼•æ“çš„è¡¨ç”±ä¸‰ä¸ªæ–‡ä»¶æ„æˆ è¡¨å.frmï¼šç­‰åŒäº InnoDB ä¸­çš„ frm æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ )ã€MySQL 8 ä¸­ä¸º è¡¨å_xxx.sdiã€‘ è¡¨å.MYDï¼šMYData å­˜å‚¨è¡¨æ•°æ® ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„è¡¨æ•°æ®å’Œç´¢å¼•ä¿¡æ¯æ˜¯åˆ†å¼€å­˜å‚¨çš„ ) è¡¨å.MYIï¼šMYIndex å­˜å‚¨ç´¢å¼• ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼• ) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ"},{"categories":null,"content":"\ræ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ ã€å­˜å‚¨å¼•æ“ã€‘ï¼šInnoDB / MyISAM çš„ä½œç”¨å°±æ˜¯ æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Š ã€‚ åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–æ•°æ®å¹¶è¿”å› ==MySQL è‡ªå¸¦çš„æ•°æ®åº“== mysqlï¼šMySQL çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·è´¦æˆ·ã€æƒé™ä¿¡æ¯ï¼Œå­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œæ—¥å¿—ï¼Œå¸®åŠ©ä¿¡æ¯ã€æ—¶åŒºä¿¡æ¯ç­‰ information_schemaï¼šå­˜å‚¨æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ æè¿°æ€§ä¿¡æ¯ / å…ƒæ•°æ® ï¼Œæ¯”å¦‚è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹/å‡½æ•°ã€è§¦å‘å™¨ã€åˆ—ã€ç´¢å¼•ç­‰ performance_schemaï¼šå­˜å‚¨ MySQL æ•°æ®åº“åœ¨è¿è¡Œæ—¶æœŸçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ€§èƒ½æŒ‡æ ‡ã€‚ç»Ÿè®¡æ‰§è¡Œçš„è¯­å¥ã€èŠ±è´¹çš„æ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰ sysï¼šé€šè¿‡ è§†å›¾ å°† information_schemaã€performance_schema ç»“åˆèµ·æ¥ã€‚å¸®åŠ©å¼€å‘äººå‘˜ç›‘æ§ MySQL çš„æŠ€æœ¯æ€§èƒ½ MySQL 5.7 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1ã€dbtest2 è¿›å…¥ dbtest1 ç›®å½• db.optï¼šå­˜å‚¨å½“å‰æ•°æ®åº“ä¸‹çš„ä¿¡æ¯ ( å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ç­‰ ) emp1.frmï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ ) emp1.idbï¼šå­˜å‚¨è¡¨æ•°æ®ã€é»˜è®¤ã€‘( MySQL 5.5 å‰è¡¨æ•°æ®å­˜æ”¾åœ¨ä¸Šçº§ç›®å½• ibdata1 ä¸­ ) ibdata1ï¼šã€ç³»ç»Ÿè¡¨ç©ºé—´ã€‘system tablespace MySQL 5.5 å‰ï¼Œè¡¨æ•°æ®é»˜è®¤éƒ½å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­ æ˜¯ä¸€ä¸ª è‡ªæ‰©å±•æ–‡ä»¶ é»˜è®¤å¤§å° 12M å¯ä»¥ä¿®æ”¹ my.cnf é…ç½®ç³»ç»Ÿè¡¨ç©ºé—´é»˜è®¤è·¯å¾„åŠå¤§å° [server] innodb_data_file_path=data1:512M;data2:512M:autoextend è¡¨å.ibdï¼šã€ç‹¬ç«‹è¡¨ç©ºé—´ã€‘file-per-table tablespace åœ¨ MySQL 5.6.6 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ è®¾ç½®ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼š å¯ä»¥ä¿®æ”¹ my.cnf é…ç½® [server] innodb_file_per_table=0 # 0ï¼šä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼› 1ï¼šä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ MySQL 8 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1 è¿›å…¥ dbtest1 ç›®å½• emp1.ibdï¼šé›†æˆäº† è¡¨ç»“æ„ä¿¡æ¯ å’Œ è¡¨æ•°æ® çš„æ–‡ä»¶ è§£æ ibd æ–‡ä»¶ï¼š ä½¿ç”¨ Oracle æä¾›é›†æˆçš„ ibd2sdi å·¥å…· ibd2sdi --dump-file=tbl_dic_type.txt tbl_dic_type.ibd ç”Ÿæˆ tbl_dic_type.txt æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¯¹è¡¨ç»“æ„ä¿¡æ¯çš„æè¿° MyISAM å­˜å‚¨å¼•æ“çš„æ–‡ä»¶ç»“æ„ MyISAM å­˜å‚¨å¼•æ“çš„è¡¨ç”±ä¸‰ä¸ªæ–‡ä»¶æ„æˆ è¡¨å.frmï¼šç­‰åŒäº InnoDB ä¸­çš„ frm æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ )ã€MySQL 8 ä¸­ä¸º è¡¨å_xxx.sdiã€‘ è¡¨å.MYDï¼šMYData å­˜å‚¨è¡¨æ•°æ® ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„è¡¨æ•°æ®å’Œç´¢å¼•ä¿¡æ¯æ˜¯åˆ†å¼€å­˜å‚¨çš„ ) è¡¨å.MYIï¼šMYIndex å­˜å‚¨ç´¢å¼• ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼• ) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-57-æ–‡ä»¶ç»“æ„"},{"categories":null,"content":"\ræ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ ã€å­˜å‚¨å¼•æ“ã€‘ï¼šInnoDB / MyISAM çš„ä½œç”¨å°±æ˜¯ æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Š ã€‚ åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–æ•°æ®å¹¶è¿”å› ==MySQL è‡ªå¸¦çš„æ•°æ®åº“== mysqlï¼šMySQL çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·è´¦æˆ·ã€æƒé™ä¿¡æ¯ï¼Œå­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œæ—¥å¿—ï¼Œå¸®åŠ©ä¿¡æ¯ã€æ—¶åŒºä¿¡æ¯ç­‰ information_schemaï¼šå­˜å‚¨æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ æè¿°æ€§ä¿¡æ¯ / å…ƒæ•°æ® ï¼Œæ¯”å¦‚è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹/å‡½æ•°ã€è§¦å‘å™¨ã€åˆ—ã€ç´¢å¼•ç­‰ performance_schemaï¼šå­˜å‚¨ MySQL æ•°æ®åº“åœ¨è¿è¡Œæ—¶æœŸçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ€§èƒ½æŒ‡æ ‡ã€‚ç»Ÿè®¡æ‰§è¡Œçš„è¯­å¥ã€èŠ±è´¹çš„æ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰ sysï¼šé€šè¿‡ è§†å›¾ å°† information_schemaã€performance_schema ç»“åˆèµ·æ¥ã€‚å¸®åŠ©å¼€å‘äººå‘˜ç›‘æ§ MySQL çš„æŠ€æœ¯æ€§èƒ½ MySQL 5.7 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1ã€dbtest2 è¿›å…¥ dbtest1 ç›®å½• db.optï¼šå­˜å‚¨å½“å‰æ•°æ®åº“ä¸‹çš„ä¿¡æ¯ ( å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ç­‰ ) emp1.frmï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ ) emp1.idbï¼šå­˜å‚¨è¡¨æ•°æ®ã€é»˜è®¤ã€‘( MySQL 5.5 å‰è¡¨æ•°æ®å­˜æ”¾åœ¨ä¸Šçº§ç›®å½• ibdata1 ä¸­ ) ibdata1ï¼šã€ç³»ç»Ÿè¡¨ç©ºé—´ã€‘system tablespace MySQL 5.5 å‰ï¼Œè¡¨æ•°æ®é»˜è®¤éƒ½å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­ æ˜¯ä¸€ä¸ª è‡ªæ‰©å±•æ–‡ä»¶ é»˜è®¤å¤§å° 12M å¯ä»¥ä¿®æ”¹ my.cnf é…ç½®ç³»ç»Ÿè¡¨ç©ºé—´é»˜è®¤è·¯å¾„åŠå¤§å° [server] innodb_data_file_path=data1:512M;data2:512M:autoextend è¡¨å.ibdï¼šã€ç‹¬ç«‹è¡¨ç©ºé—´ã€‘file-per-table tablespace åœ¨ MySQL 5.6.6 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ è®¾ç½®ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼š å¯ä»¥ä¿®æ”¹ my.cnf é…ç½® [server] innodb_file_per_table=0 # 0ï¼šä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼› 1ï¼šä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ MySQL 8 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1 è¿›å…¥ dbtest1 ç›®å½• emp1.ibdï¼šé›†æˆäº† è¡¨ç»“æ„ä¿¡æ¯ å’Œ è¡¨æ•°æ® çš„æ–‡ä»¶ è§£æ ibd æ–‡ä»¶ï¼š ä½¿ç”¨ Oracle æä¾›é›†æˆçš„ ibd2sdi å·¥å…· ibd2sdi --dump-file=tbl_dic_type.txt tbl_dic_type.ibd ç”Ÿæˆ tbl_dic_type.txt æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¯¹è¡¨ç»“æ„ä¿¡æ¯çš„æè¿° MyISAM å­˜å‚¨å¼•æ“çš„æ–‡ä»¶ç»“æ„ MyISAM å­˜å‚¨å¼•æ“çš„è¡¨ç”±ä¸‰ä¸ªæ–‡ä»¶æ„æˆ è¡¨å.frmï¼šç­‰åŒäº InnoDB ä¸­çš„ frm æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ )ã€MySQL 8 ä¸­ä¸º è¡¨å_xxx.sdiã€‘ è¡¨å.MYDï¼šMYData å­˜å‚¨è¡¨æ•°æ® ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„è¡¨æ•°æ®å’Œç´¢å¼•ä¿¡æ¯æ˜¯åˆ†å¼€å­˜å‚¨çš„ ) è¡¨å.MYIï¼šMYIndex å­˜å‚¨ç´¢å¼• ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼• ) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-8-æ–‡ä»¶ç»“æ„"},{"categories":null,"content":"\ræ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ ã€å­˜å‚¨å¼•æ“ã€‘ï¼šInnoDB / MyISAM çš„ä½œç”¨å°±æ˜¯ æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Š ã€‚ åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–æ•°æ®å¹¶è¿”å› ==MySQL è‡ªå¸¦çš„æ•°æ®åº“== mysqlï¼šMySQL çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·è´¦æˆ·ã€æƒé™ä¿¡æ¯ï¼Œå­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œæ—¥å¿—ï¼Œå¸®åŠ©ä¿¡æ¯ã€æ—¶åŒºä¿¡æ¯ç­‰ information_schemaï¼šå­˜å‚¨æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ æè¿°æ€§ä¿¡æ¯ / å…ƒæ•°æ® ï¼Œæ¯”å¦‚è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹/å‡½æ•°ã€è§¦å‘å™¨ã€åˆ—ã€ç´¢å¼•ç­‰ performance_schemaï¼šå­˜å‚¨ MySQL æ•°æ®åº“åœ¨è¿è¡Œæ—¶æœŸçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ€§èƒ½æŒ‡æ ‡ã€‚ç»Ÿè®¡æ‰§è¡Œçš„è¯­å¥ã€èŠ±è´¹çš„æ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰ sysï¼šé€šè¿‡ è§†å›¾ å°† information_schemaã€performance_schema ç»“åˆèµ·æ¥ã€‚å¸®åŠ©å¼€å‘äººå‘˜ç›‘æ§ MySQL çš„æŠ€æœ¯æ€§èƒ½ MySQL 5.7 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1ã€dbtest2 è¿›å…¥ dbtest1 ç›®å½• db.optï¼šå­˜å‚¨å½“å‰æ•°æ®åº“ä¸‹çš„ä¿¡æ¯ ( å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ç­‰ ) emp1.frmï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ ) emp1.idbï¼šå­˜å‚¨è¡¨æ•°æ®ã€é»˜è®¤ã€‘( MySQL 5.5 å‰è¡¨æ•°æ®å­˜æ”¾åœ¨ä¸Šçº§ç›®å½• ibdata1 ä¸­ ) ibdata1ï¼šã€ç³»ç»Ÿè¡¨ç©ºé—´ã€‘system tablespace MySQL 5.5 å‰ï¼Œè¡¨æ•°æ®é»˜è®¤éƒ½å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­ æ˜¯ä¸€ä¸ª è‡ªæ‰©å±•æ–‡ä»¶ é»˜è®¤å¤§å° 12M å¯ä»¥ä¿®æ”¹ my.cnf é…ç½®ç³»ç»Ÿè¡¨ç©ºé—´é»˜è®¤è·¯å¾„åŠå¤§å° [server] innodb_data_file_path=data1:512M;data2:512M:autoextend è¡¨å.ibdï¼šã€ç‹¬ç«‹è¡¨ç©ºé—´ã€‘file-per-table tablespace åœ¨ MySQL 5.6.6 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ è®¾ç½®ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼š å¯ä»¥ä¿®æ”¹ my.cnf é…ç½® [server] innodb_file_per_table=0 # 0ï¼šä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼› 1ï¼šä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ MySQL 8 æ–‡ä»¶ç»“æ„ è¿›å…¥ Linux ç‰ˆæœ¬ MySQL çš„æ•°æ®å­˜æ”¾ç›®å½• /var/lib/mysql ï¼Œå¯ä»¥çœ‹åˆ° MySQL è‡ªå¸¦çš„æ•°æ®åº“ç›®å½•ï¼Œä»¥åŠæˆ‘åˆ›å»ºçš„æ•°æ®åº“ç›®å½•ï¼šdbtest1 è¿›å…¥ dbtest1 ç›®å½• emp1.ibdï¼šé›†æˆäº† è¡¨ç»“æ„ä¿¡æ¯ å’Œ è¡¨æ•°æ® çš„æ–‡ä»¶ è§£æ ibd æ–‡ä»¶ï¼š ä½¿ç”¨ Oracle æä¾›é›†æˆçš„ ibd2sdi å·¥å…· ibd2sdi --dump-file=tbl_dic_type.txt tbl_dic_type.ibd ç”Ÿæˆ tbl_dic_type.txt æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¯¹è¡¨ç»“æ„ä¿¡æ¯çš„æè¿° MyISAM å­˜å‚¨å¼•æ“çš„æ–‡ä»¶ç»“æ„ MyISAM å­˜å‚¨å¼•æ“çš„è¡¨ç”±ä¸‰ä¸ªæ–‡ä»¶æ„æˆ è¡¨å.frmï¼šç­‰åŒäº InnoDB ä¸­çš„ frm æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯ ( å­—æ®µåã€å­—æ®µç±»å‹ã€çº¦æŸç­‰ )ã€MySQL 8 ä¸­ä¸º è¡¨å_xxx.sdiã€‘ è¡¨å.MYDï¼šMYData å­˜å‚¨è¡¨æ•°æ® ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„è¡¨æ•°æ®å’Œç´¢å¼•ä¿¡æ¯æ˜¯åˆ†å¼€å­˜å‚¨çš„ ) è¡¨å.MYIï¼šMYIndex å­˜å‚¨ç´¢å¼• ( MyISAM å­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼• ) ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:2:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#myisam-å­˜å‚¨å¼•æ“çš„æ–‡ä»¶ç»“æ„"},{"categories":null,"content":"\rç”¨æˆ·ä¸æƒé™ç®¡ç†","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æˆ·ä¸æƒé™ç®¡ç†"},{"categories":null,"content":"\rç”¨æˆ·ç®¡ç†ç™»å½• MySQL æœåŠ¡å™¨å‘½ä»¤ï¼š mysql â€“h hostname|hostIP â€“P port â€“u username â€“p æ•°æ®åº“å â€“e \"SQLè¯­å¥\" -h æŒ‡å®šä¸»æœºåæˆ–ä¸»æœº IPï¼Œçœç•¥æ—¶ä¸º localhost -P æŒ‡å®šè¿æ¥çš„ç«¯å£ï¼Œçœç•¥æ—¶ä¸º 3306 -u ç”¨æˆ·å -p å¯†ç  æ•°æ®åº“å æŒ‡å®šç™»å½•çš„æ•°æ®åº“ï¼Œçœç•¥æ—¶éœ€è¦ç™»å½•å use æ•°æ®åº“ -e æŒ‡å®šç™»å½•åæ‰§è¡Œçš„ SQL è¯­å¥ï¼Œæ‰§è¡Œç»“æŸè‡ªåŠ¨é€€å‡º åˆ›å»ºç”¨æˆ·ï¼š CREATE USER ç”¨æˆ·å [IDENTIFIED BY 'å¯†ç '][,ç”¨æˆ·å [IDENTIFIED BY 'å¯†ç ']]; åˆ›å»ºç”¨æˆ·åŸºç¡€å†™æ³• create user zhangsan identified by '123456' æ­¤æ—¶é»˜è®¤ host ä¸º â€˜%â€™ åˆ›å»ºç”¨æˆ·å†™æ³•ä¸¾ä¾‹ create user 'kangshifu'@'localhost' identified by '123456'; æŒ‡å®šç”¨æˆ· kangshifu å¯ä½¿ç”¨çš„ host ä¸º localhostï¼Œåœ¨ mysql æ•°æ®åº“çš„ user è¡¨ä¸­ï¼Œç”± host å’Œ user å…±åŒç»„æˆå¤åˆä¸»é”® ä¿®æ”¹ç”¨æˆ·ï¼š UPDATE mysql.user SET USER='lisi' WHERE USER='zhangsan'; FLUSH PRIVILEGES; ä¿®æ”¹ç”¨æˆ·åæ˜¯å¯¹ user è¡¨è¿›è¡Œä¿®æ”¹ï¼Œå¼€å‘ä¸­å¾ˆå°‘è¿™ä¹ˆåš ä¿®æ”¹æ•°æ® update user set user = 'lisi' where user = 'zhangsan'; åˆ·æ–°æƒé™ flush privileges; åˆ é™¤ç”¨æˆ·ï¼š ä½¿ç”¨ DROP æ–¹å¼åˆ é™¤ã€æ¨èã€‘ DROP USER user[,user]â€¦; ä½¿ç”¨ DELETE æ–¹å¼åˆ é™¤ ä½¿ç”¨ delete æ–¹å¼åˆ é™¤ä¼šæœ‰æ®‹ç•™ä¿¡æ¯ä¿ç•™ ä¿®æ”¹è‡ªèº«å¯†ç ï¼š åœ¨ MySQL 8 ä¸­ç§»é™¤äº† PASSWORD( ) å‡½æ•°ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ update è¯­å¥å¯¹å¯†ç è¿›è¡Œä¿®æ”¹ # ä¿®æ”¹å½“å‰ç”¨æˆ·çš„å¯†ç ï¼šï¼ˆMySQL5.7æµ‹è¯•æœ‰æ•ˆï¼‰ SET PASSWORD = PASSWORD('æ–°å¯†ç '); ä½¿ç”¨ alter user å‘½ä»¤ä¿®æ”¹è‡ªèº«å¯†ç  ALTER USER USER() IDENTIFIED BY 'æ–°å¯†ç '; ä½¿ç”¨ set å‘½ä»¤ä¿®æ”¹è‡ªèº«å¯†ç  SET PASSWORD = 'æ–°å¯†ç '; ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç ï¼š ä½¿ç”¨ update ä¿®æ”¹å…¶å®ƒç”¨æˆ·å¯†ç ã€ä¸æ¨èã€‘ # åœ¨ MySQL 5.7 åŠä¹‹å‰å¯ç”¨ UPDATE MySQL.user SET authentication_string=PASSWORD(\"123456\") WHERE User = \"username\" AND Host = \"hostname\"; ä½¿ç”¨ ALTER è¯­å¥æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç  å¯ä»¥ä½¿ç”¨ ALTER USER è¯­å¥æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç  ALTER USER user [IDENTIFIED BY 'æ–°å¯†ç '] [,user[IDENTIFIED BY 'æ–°å¯†ç ']]â€¦; ä½¿ç”¨ SET å‘½ä»¤æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç  ä½¿ç”¨ root ç”¨æˆ·ç™»å½•åˆ° MySQL æœåŠ¡å™¨åï¼Œå¯ä»¥ä½¿ç”¨ SET è¯­å¥æ¥ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç  SET PASSWORD FOR 'username'@'hostname' = 'æ–°å¯†ç '; å¯†ç è¿‡æœŸç­–ç•¥ã€å¯†ç é‡ç”¨ç­–ç•¥ï¼š è®¾ç½®å…¨å±€å¯†ç è¿‡æœŸç­–ç•¥ æ–¹å¼â‘ ï¼šä½¿ç”¨SQLè¯­å¥æ›´æ”¹è¯¥å˜é‡çš„å€¼å¹¶æŒä¹…åŒ– SET PERSIST default_password_lifetime = 180; # å»ºç«‹å…¨å±€ç­–ç•¥ï¼Œè®¾ç½®å¯†ç æ¯éš”180å¤©è¿‡æœŸ æ–¹å¼â‘¡ï¼šé…ç½®æ–‡ä»¶my.cnfä¸­è¿›è¡Œç»´æŠ¤ [mysqld] default_password_lifetime=180 #å»ºç«‹å…¨å±€ç­–ç•¥ï¼Œè®¾ç½®å¯†ç æ¯éš”180å¤©è¿‡æœŸ å•ç‹¬è®¾ç½®å¯†ç è¿‡å»ç­–ç•¥ é€šè¿‡ PASSWORD EXPIRE å®ç°å•ç‹¬è®¾ç½®å¯†ç è¿‡æœŸç­–ç•¥ #è®¾ç½®kangshifuè´¦å·å¯†ç æ¯90å¤©è¿‡æœŸï¼š CREATE USER 'kangshifu'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY; ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY; #è®¾ç½®å¯†ç æ°¸ä¸è¿‡æœŸï¼š CREATE USER 'kangshifu'@'localhost' PASSWORD EXPIRE NEVER; ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE NEVER; #å»¶ç”¨å…¨å±€å¯†ç è¿‡æœŸç­–ç•¥ï¼š CREATE USER 'kangshifu'@'localhost' PASSWORD EXPIRE DEFAULT; ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE DEFAULT; è®¾ç½®å…¨å±€å¯†ç é‡ç”¨ç­–ç•¥ æ–¹å¼â‘ ï¼šä½¿ç”¨SQL SET PERSIST password_history = 6; #è®¾ç½®ä¸èƒ½é€‰æ‹©æœ€è¿‘ä½¿ç”¨è¿‡çš„6ä¸ªå¯†ç  SET PERSIST password_reuse_interval = 365; #è®¾ç½®ä¸èƒ½é€‰æ‹©æœ€è¿‘ä¸€å¹´å†…çš„å¯†ç  æ–¹å¼â‘¡ï¼šmy.cnfé…ç½®æ–‡ä»¶ [mysqld] password_history=6 password_reuse_interval=365 å•ç‹¬è®¾ç½®å¯†ç é‡ç”¨ç­–ç•¥ #ä¸èƒ½ä½¿ç”¨æœ€è¿‘5ä¸ªå¯†ç ï¼š CREATE USER 'kangshifu'@'localhost' PASSWORD HISTORY 5; ALTER USER 'kangshifu'@'localhost' PASSWORD HISTORY 5; #ä¸èƒ½ä½¿ç”¨æœ€è¿‘365å¤©å†…çš„å¯†ç ï¼š CREATE USER 'kangshifu'@'localhost' PASSWORD REUSE INTERVAL 365 DAY; ALTER USER 'kangshifu'@'localhost' PASSWORD REUSE INTERVAL 365 DAY; #æ—¢ä¸èƒ½ä½¿ç”¨æœ€è¿‘5ä¸ªå¯†ç ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨365å¤©å†…çš„å¯†ç  CREATE USER 'kangshifu'@'localhost' PASSWORD HISTORY 5 PASSWORD REUSE INTERVAL 365 DAY; ALTER USER 'kangshifu'@'localhost' PASSWORD HISTORY 5 PASSWORD REUSE INTERVAL 365 DAY; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç”¨æˆ·ç®¡ç†"},{"categories":null,"content":"\ræƒé™ç®¡ç† # æŸ¥çœ‹ MySQL éƒ½æœ‰å“ªäº›æƒé™ show privileges; æƒé™åˆ†ç±»åŠå¸¸ç”¨çš„æƒé™ CREATE å’Œ DROP æƒé™ï¼Œå…è®¸åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œè¡¨ï¼Œæˆ–åˆ é™¤ï¼ˆç§»æ‰ï¼‰å·²æœ‰çš„æ•°æ®åº“å’Œè¡¨ SELECT ã€ INSERT ã€ UPDATE å’Œ DELETE æƒé™ï¼Œå…è®¸åœ¨ä¸€ä¸ªæ•°æ®åº“ç°æœ‰çš„è¡¨ä¸Šå®æ–½æ“ä½œ SELECT æƒé™ï¼Œåªæœ‰åœ¨å®ƒä»¬çœŸæ­£ä»ä¸€ä¸ªè¡¨ä¸­æ£€ç´¢è¡Œæ—¶æ‰è¢«ç”¨åˆ° INDEX æƒé™ï¼Œå…è®¸åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œé€‚ç”¨äºå·²æœ‰çš„è¡¨ã€‚å¦‚æœå…·æœ‰æŸä¸ªè¡¨çš„ CREATE æƒé™ï¼Œå°±å¯ä»¥åœ¨ CREATE TABLE è¯­å¥ä¸­åŒ…æ‹¬ç´¢å¼•å®šä¹‰ ALTER æƒé™ï¼Œå…è®¸ä½¿ç”¨ ALTER TABLE æ¥æ›´æ”¹è¡¨çš„ç»“æ„å’Œé‡æ–°å‘½åè¡¨ CREATE ROUTINE æƒé™ï¼Œå…è®¸åˆ›å»ºä¿å­˜çš„ç¨‹åºï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ï¼Œæ›´æ”¹å’Œåˆ é™¤ä¿å­˜çš„ç¨‹åºï¼Œ EXECUTE æƒé™å…è®¸æ‰§è¡Œä¿å­˜çš„ç¨‹åº GRANT æƒé™ï¼Œå…è®¸æˆæƒç»™å…¶ä»–ç”¨æˆ·ï¼Œå¯ç”¨äºæ•°æ®åº“ã€è¡¨å’Œä¿å­˜çš„ç¨‹åº FILE æƒé™ï¼Œå…è®¸ä½¿ç”¨ LOAD DATA INFILE å’Œ SELECT â€¦ INTO OUTFILE è¯­å¥è¯»æˆ–å†™æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»»ä½•è¢«æˆäºˆ FILE æƒé™çš„ç”¨æˆ·éƒ½èƒ½è¯»æˆ–å†™ MySQL æœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼ˆè¯´æ˜ç”¨æˆ·å¯ä»¥è¯»ä»»ä½•æ•°æ®åº“ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› ä¸ºæœåŠ¡å™¨å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼‰ æƒé™çš„æŸ¥çœ‹ã€èµ‹äºˆå’Œæ’¤é”€æˆäºˆæƒé™ï¼š å¯ä»¥ èµ‹äºˆè§’è‰²æƒé™åå°†è§’è‰²èµ‹äºˆç»™ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ ç›´æ¥èµ‹äºˆç”¨æˆ·æƒé™ ç›´æ¥èµ‹äºˆæƒé™å‘½ä»¤ï¼š GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO ç”¨æˆ·å@ç”¨æˆ·åœ°å€ [IDENTIFIED BY â€˜å¯†ç å£ä»¤â€™]; ä¸¾ä¾‹ï¼šæˆäºˆ zhangsan æŸ¥è¯¢ dbtest99 æ•°æ®åº“ä¸­ emp è¡¨çš„æƒé™ grant select on dbtest99.emp to 'zhangsan'@'%'; å½“ zhangsan è¦ update æ•°æ®æ—¶ï¼Œä¼šæç¤ºæƒé™ä¸è¶³ å†æ¬¡èµ‹äºˆæƒé™ æ—¶ï¼Œç›¸å½“äºæ·»åŠ æƒé™ã€å¹¶é›†ã€‘ èµ‹äºˆæ‰€æœ‰æƒé™ grant all privileges on *.* to zhangsan; æˆäºˆæƒé™çš„ æ¨ªå‘åˆ†ç»„ ä¸ çºµå‘åˆ†ç»„ æ‰€è°“æ¨ªå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥æ¥è§¦åˆ°çš„æ•°æ®çš„èŒƒå›´ï¼Œæ¯”å¦‚å¯ä»¥çœ‹åˆ°å“ªäº›è¡¨çš„æ•°æ®ï¼› æ‰€è°“çºµå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯¹æ¥è§¦åˆ°çš„æ•°æ®èƒ½è®¿é—®åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæ¯”å¦‚èƒ½çœ‹ã€èƒ½æ”¹ï¼Œç”šè‡³æ˜¯ åˆ é™¤ã€‚ æŸ¥çœ‹æƒé™ï¼š æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ SHOW GRANTS; # æˆ– SHOW GRANTS FOR CURRENT_USER; # æˆ– SHOW GRANTS FOR CURRENT_USER(); æŸ¥çœ‹æŸç”¨æˆ·çš„å…¨å±€æƒé™ SHOW GRANTS FOR 'user'@'ä¸»æœºåœ°å€'; æ”¶å›æƒé™ï¼š å›æ”¶æƒé™å‘½ä»¤ REVOKE æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° FROM ç”¨æˆ·å@ç”¨æˆ·åœ°å€; ä¸¾ä¾‹ï¼šå›æ”¶ zhangsan ç”¨æˆ·çš„æ‰€æœ‰æƒé™ REVOKE ALL PRIVILEGES ON *.* FROM zhangsan@'%'; ã€æ³¨æ„ã€‘åœ¨å°†ç”¨æˆ·è´¦æˆ·ä»userè¡¨åˆ é™¤ä¹‹å‰ï¼Œåº”è¯¥æ”¶å›ç›¸åº”ç”¨æˆ·çš„æ‰€æœ‰æƒé™ å¼€å‘ä¸­å°½å¯èƒ½ä¸è¦ä½¿ç”¨ root è¶…çº§ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“ï¼Œå› ä¸º root çš„å¯†ç æ”¾åœ¨ä»£ç ä¸­ä¸å®‰å…¨ï¼Œä¸€æ—¦æ³„æ¼ï¼Œæ•°æ®åº“å°†å®Œå…¨å¤±å»ä¿æŠ¤ æƒé™è¡¨ MySQL é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œåœ¨ mysql æ•°æ®åº“ä¸­ç”± userã€db è¡¨å’Œ table_privã€column_privã€proc_priv è¡¨æ¥è®°å½•æƒé™ä¿¡æ¯ user è¡¨å­—æ®µè§£é‡Š db è¡¨å­—æ®µè§£é‡Š é€šè¿‡ hostã€dbã€user ç»„æˆå¤åˆä¸»é”®ï¼Œä½“ç°ç”¨æˆ·å¯¹æŸä¸€æ•°æ®åº“çš„ç›¸å…³æ“ä½œæƒé™ Create_routine_priv å’Œ Alter_routine_priv å­—æ®µå†³å®šç”¨æˆ·æ˜¯å¦å…·æœ‰åˆ›å»ºå’Œä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„æƒé™ tables_priv è¡¨å’Œ columns_priv è¡¨ tables_priv è¡¨ç”¨æ¥ å¯¹è¡¨è®¾ç½®æ“ä½œæƒé™ columns_priv è¡¨ç”¨æ¥å¯¹è¡¨çš„ æŸä¸€åˆ—è®¾ç½®æƒé™ procs_privè¡¨ procs_priv è¡¨å¯ä»¥å¯¹ å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°è®¾ç½®æ“ä½œæƒé™ è¿æ¥æ ¸å®é˜¶æ®µï¼š é€šè¿‡ user è¡¨ä¸­çš„ hostã€user å’Œ authentication_string è¿™ 3 ä¸ªå­—æ®µåŒ¹é…å®¢æˆ·ç«¯æä¾›ä¿¡æ¯ è¯·æ±‚æ ¸å®é˜¶æ®µï¼š æ ¹æ®ç”¨æˆ·çš„æ“ä½œï¼ŒæŒ‰ç…§ user - db - tables_priv - columns_priv æ£€æŸ¥ç¡®è®¤æƒé™ è§’è‰² è§’è‰²ï¼Œå°±ç›¸å½“äºæƒé™çš„é›†åˆ åˆ›å»ºè§’è‰²ï¼š åˆ›å»ºè§’è‰²å‘½ä»¤ CREATE ROLE 'role_name'[@'host_name'] [,'role_name'[@'host_name']]... ç»™è§’è‰²èµ‹äºˆæƒé™ï¼š ç»™è§’è‰²èµ‹äºˆæƒé™å‘½ä»¤ GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO 'è§’è‰²å'[@'host_name']; æŸ¥çœ‹è§’è‰²çš„æƒé™ï¼š æŸ¥çœ‹æŒ‡å®šè§’è‰²æƒé™å‘½ä»¤ SHOW GRANTS FOR 'è§’è‰²å'; å›æ”¶è§’è‰²çš„æƒé™ï¼š å›æ”¶è§’è‰²çš„æƒé™å‘½ä»¤ REVOKE privileges ON tablename FROM 'rolename'; åˆ é™¤è§’è‰²ï¼š åˆ é™¤è§’è‰²å‘½ä»¤ DROP ROLE 'è§’è‰²å'; ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²å‘½ä»¤ GRANT role [,role2,...] TO user [,user2,...]; æ¿€æ´»è§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²åéœ€è¦æ¿€æ´»è§’è‰²ï¼Œç”¨æˆ·é‡æ–°ç™»å½•æ‰çœŸæ­£æ‹¥æœ‰è§’è‰² æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼ä¸€ã€‘ SET DEFAULT ROLE ALL TO 'ç”¨æˆ·å'@'host'; æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼äºŒã€‘ # å¯¹æ‰€æœ‰è§’è‰²æ°¸ä¹…æ¿€æ´» SET GLOBAL activate_all_roles_on_login = ON; æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è§’è‰² SELECT CURRENT_ROLE(); æ’¤é”€ç”¨æˆ·çš„è§’è‰²ï¼š èµŠé”€ç”¨æˆ·è§’è‰²å‘½ä»¤ REVOKE è§’è‰²å FROM ç”¨æˆ·; è®¾ç½®å¼ºåˆ¶è§’è‰²ï¼š å¼ºåˆ¶è§’è‰²ç›¸å½“äºä¸ºæ‰€æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤è§’è‰² æœåŠ¡å¯åŠ¨å‰è®¾ç½® my.cnfã€æ–¹å¼ä¸€ã€‘ [mysqld] mandatory_roles='role1,role2@localhost,r3@%.atguigu.com' è¿è¡Œæ—¶è®¾ç½®ã€æ–¹å¼äºŒã€‘ SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åä»ç„¶ æœ‰æ•ˆ SET GLOBAL mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åå¤±æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æƒé™ç®¡ç†"},{"categories":null,"content":"\ræƒé™ç®¡ç† # æŸ¥çœ‹ MySQL éƒ½æœ‰å“ªäº›æƒé™ show privileges; æƒé™åˆ†ç±»åŠå¸¸ç”¨çš„æƒé™ CREATE å’Œ DROP æƒé™ï¼Œå…è®¸åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œè¡¨ï¼Œæˆ–åˆ é™¤ï¼ˆç§»æ‰ï¼‰å·²æœ‰çš„æ•°æ®åº“å’Œè¡¨ SELECT ã€ INSERT ã€ UPDATE å’Œ DELETE æƒé™ï¼Œå…è®¸åœ¨ä¸€ä¸ªæ•°æ®åº“ç°æœ‰çš„è¡¨ä¸Šå®æ–½æ“ä½œ SELECT æƒé™ï¼Œåªæœ‰åœ¨å®ƒä»¬çœŸæ­£ä»ä¸€ä¸ªè¡¨ä¸­æ£€ç´¢è¡Œæ—¶æ‰è¢«ç”¨åˆ° INDEX æƒé™ï¼Œå…è®¸åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œé€‚ç”¨äºå·²æœ‰çš„è¡¨ã€‚å¦‚æœå…·æœ‰æŸä¸ªè¡¨çš„ CREATE æƒé™ï¼Œå°±å¯ä»¥åœ¨ CREATE TABLE è¯­å¥ä¸­åŒ…æ‹¬ç´¢å¼•å®šä¹‰ ALTER æƒé™ï¼Œå…è®¸ä½¿ç”¨ ALTER TABLE æ¥æ›´æ”¹è¡¨çš„ç»“æ„å’Œé‡æ–°å‘½åè¡¨ CREATE ROUTINE æƒé™ï¼Œå…è®¸åˆ›å»ºä¿å­˜çš„ç¨‹åºï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ï¼Œæ›´æ”¹å’Œåˆ é™¤ä¿å­˜çš„ç¨‹åºï¼Œ EXECUTE æƒé™å…è®¸æ‰§è¡Œä¿å­˜çš„ç¨‹åº GRANT æƒé™ï¼Œå…è®¸æˆæƒç»™å…¶ä»–ç”¨æˆ·ï¼Œå¯ç”¨äºæ•°æ®åº“ã€è¡¨å’Œä¿å­˜çš„ç¨‹åº FILE æƒé™ï¼Œå…è®¸ä½¿ç”¨ LOAD DATA INFILE å’Œ SELECT â€¦ INTO OUTFILE è¯­å¥è¯»æˆ–å†™æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»»ä½•è¢«æˆäºˆ FILE æƒé™çš„ç”¨æˆ·éƒ½èƒ½è¯»æˆ–å†™ MySQL æœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼ˆè¯´æ˜ç”¨æˆ·å¯ä»¥è¯»ä»»ä½•æ•°æ®åº“ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› ä¸ºæœåŠ¡å™¨å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼‰ æƒé™çš„æŸ¥çœ‹ã€èµ‹äºˆå’Œæ’¤é”€æˆäºˆæƒé™ï¼š å¯ä»¥ èµ‹äºˆè§’è‰²æƒé™åå°†è§’è‰²èµ‹äºˆç»™ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ ç›´æ¥èµ‹äºˆç”¨æˆ·æƒé™ ç›´æ¥èµ‹äºˆæƒé™å‘½ä»¤ï¼š GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO ç”¨æˆ·å@ç”¨æˆ·åœ°å€ [IDENTIFIED BY â€˜å¯†ç å£ä»¤â€™]; ä¸¾ä¾‹ï¼šæˆäºˆ zhangsan æŸ¥è¯¢ dbtest99 æ•°æ®åº“ä¸­ emp è¡¨çš„æƒé™ grant select on dbtest99.emp to 'zhangsan'@'%'; å½“ zhangsan è¦ update æ•°æ®æ—¶ï¼Œä¼šæç¤ºæƒé™ä¸è¶³ å†æ¬¡èµ‹äºˆæƒé™ æ—¶ï¼Œç›¸å½“äºæ·»åŠ æƒé™ã€å¹¶é›†ã€‘ èµ‹äºˆæ‰€æœ‰æƒé™ grant all privileges on *.* to zhangsan; æˆäºˆæƒé™çš„ æ¨ªå‘åˆ†ç»„ ä¸ çºµå‘åˆ†ç»„ æ‰€è°“æ¨ªå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥æ¥è§¦åˆ°çš„æ•°æ®çš„èŒƒå›´ï¼Œæ¯”å¦‚å¯ä»¥çœ‹åˆ°å“ªäº›è¡¨çš„æ•°æ®ï¼› æ‰€è°“çºµå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯¹æ¥è§¦åˆ°çš„æ•°æ®èƒ½è®¿é—®åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæ¯”å¦‚èƒ½çœ‹ã€èƒ½æ”¹ï¼Œç”šè‡³æ˜¯ åˆ é™¤ã€‚ æŸ¥çœ‹æƒé™ï¼š æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ SHOW GRANTS; # æˆ– SHOW GRANTS FOR CURRENT_USER; # æˆ– SHOW GRANTS FOR CURRENT_USER(); æŸ¥çœ‹æŸç”¨æˆ·çš„å…¨å±€æƒé™ SHOW GRANTS FOR 'user'@'ä¸»æœºåœ°å€'; æ”¶å›æƒé™ï¼š å›æ”¶æƒé™å‘½ä»¤ REVOKE æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° FROM ç”¨æˆ·å@ç”¨æˆ·åœ°å€; ä¸¾ä¾‹ï¼šå›æ”¶ zhangsan ç”¨æˆ·çš„æ‰€æœ‰æƒé™ REVOKE ALL PRIVILEGES ON *.* FROM zhangsan@'%'; ã€æ³¨æ„ã€‘åœ¨å°†ç”¨æˆ·è´¦æˆ·ä»userè¡¨åˆ é™¤ä¹‹å‰ï¼Œåº”è¯¥æ”¶å›ç›¸åº”ç”¨æˆ·çš„æ‰€æœ‰æƒé™ å¼€å‘ä¸­å°½å¯èƒ½ä¸è¦ä½¿ç”¨ root è¶…çº§ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“ï¼Œå› ä¸º root çš„å¯†ç æ”¾åœ¨ä»£ç ä¸­ä¸å®‰å…¨ï¼Œä¸€æ—¦æ³„æ¼ï¼Œæ•°æ®åº“å°†å®Œå…¨å¤±å»ä¿æŠ¤ æƒé™è¡¨ MySQL é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œåœ¨ mysql æ•°æ®åº“ä¸­ç”± userã€db è¡¨å’Œ table_privã€column_privã€proc_priv è¡¨æ¥è®°å½•æƒé™ä¿¡æ¯ user è¡¨å­—æ®µè§£é‡Š db è¡¨å­—æ®µè§£é‡Š é€šè¿‡ hostã€dbã€user ç»„æˆå¤åˆä¸»é”®ï¼Œä½“ç°ç”¨æˆ·å¯¹æŸä¸€æ•°æ®åº“çš„ç›¸å…³æ“ä½œæƒé™ Create_routine_priv å’Œ Alter_routine_priv å­—æ®µå†³å®šç”¨æˆ·æ˜¯å¦å…·æœ‰åˆ›å»ºå’Œä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„æƒé™ tables_priv è¡¨å’Œ columns_priv è¡¨ tables_priv è¡¨ç”¨æ¥ å¯¹è¡¨è®¾ç½®æ“ä½œæƒé™ columns_priv è¡¨ç”¨æ¥å¯¹è¡¨çš„ æŸä¸€åˆ—è®¾ç½®æƒé™ procs_privè¡¨ procs_priv è¡¨å¯ä»¥å¯¹ å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°è®¾ç½®æ“ä½œæƒé™ è¿æ¥æ ¸å®é˜¶æ®µï¼š é€šè¿‡ user è¡¨ä¸­çš„ hostã€user å’Œ authentication_string è¿™ 3 ä¸ªå­—æ®µåŒ¹é…å®¢æˆ·ç«¯æä¾›ä¿¡æ¯ è¯·æ±‚æ ¸å®é˜¶æ®µï¼š æ ¹æ®ç”¨æˆ·çš„æ“ä½œï¼ŒæŒ‰ç…§ user - db - tables_priv - columns_priv æ£€æŸ¥ç¡®è®¤æƒé™ è§’è‰² è§’è‰²ï¼Œå°±ç›¸å½“äºæƒé™çš„é›†åˆ åˆ›å»ºè§’è‰²ï¼š åˆ›å»ºè§’è‰²å‘½ä»¤ CREATE ROLE 'role_name'[@'host_name'] [,'role_name'[@'host_name']]... ç»™è§’è‰²èµ‹äºˆæƒé™ï¼š ç»™è§’è‰²èµ‹äºˆæƒé™å‘½ä»¤ GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO 'è§’è‰²å'[@'host_name']; æŸ¥çœ‹è§’è‰²çš„æƒé™ï¼š æŸ¥çœ‹æŒ‡å®šè§’è‰²æƒé™å‘½ä»¤ SHOW GRANTS FOR 'è§’è‰²å'; å›æ”¶è§’è‰²çš„æƒé™ï¼š å›æ”¶è§’è‰²çš„æƒé™å‘½ä»¤ REVOKE privileges ON tablename FROM 'rolename'; åˆ é™¤è§’è‰²ï¼š åˆ é™¤è§’è‰²å‘½ä»¤ DROP ROLE 'è§’è‰²å'; ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²å‘½ä»¤ GRANT role [,role2,...] TO user [,user2,...]; æ¿€æ´»è§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²åéœ€è¦æ¿€æ´»è§’è‰²ï¼Œç”¨æˆ·é‡æ–°ç™»å½•æ‰çœŸæ­£æ‹¥æœ‰è§’è‰² æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼ä¸€ã€‘ SET DEFAULT ROLE ALL TO 'ç”¨æˆ·å'@'host'; æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼äºŒã€‘ # å¯¹æ‰€æœ‰è§’è‰²æ°¸ä¹…æ¿€æ´» SET GLOBAL activate_all_roles_on_login = ON; æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è§’è‰² SELECT CURRENT_ROLE(); æ’¤é”€ç”¨æˆ·çš„è§’è‰²ï¼š èµŠé”€ç”¨æˆ·è§’è‰²å‘½ä»¤ REVOKE è§’è‰²å FROM ç”¨æˆ·; è®¾ç½®å¼ºåˆ¶è§’è‰²ï¼š å¼ºåˆ¶è§’è‰²ç›¸å½“äºä¸ºæ‰€æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤è§’è‰² æœåŠ¡å¯åŠ¨å‰è®¾ç½® my.cnfã€æ–¹å¼ä¸€ã€‘ [mysqld] mandatory_roles='role1,role2@localhost,r3@%.atguigu.com' è¿è¡Œæ—¶è®¾ç½®ã€æ–¹å¼äºŒã€‘ SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åä»ç„¶ æœ‰æ•ˆ SET GLOBAL mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åå¤±æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æƒé™çš„æŸ¥çœ‹èµ‹äºˆå’Œæ’¤é”€"},{"categories":null,"content":"\ræƒé™ç®¡ç† # æŸ¥çœ‹ MySQL éƒ½æœ‰å“ªäº›æƒé™ show privileges; æƒé™åˆ†ç±»åŠå¸¸ç”¨çš„æƒé™ CREATE å’Œ DROP æƒé™ï¼Œå…è®¸åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œè¡¨ï¼Œæˆ–åˆ é™¤ï¼ˆç§»æ‰ï¼‰å·²æœ‰çš„æ•°æ®åº“å’Œè¡¨ SELECT ã€ INSERT ã€ UPDATE å’Œ DELETE æƒé™ï¼Œå…è®¸åœ¨ä¸€ä¸ªæ•°æ®åº“ç°æœ‰çš„è¡¨ä¸Šå®æ–½æ“ä½œ SELECT æƒé™ï¼Œåªæœ‰åœ¨å®ƒä»¬çœŸæ­£ä»ä¸€ä¸ªè¡¨ä¸­æ£€ç´¢è¡Œæ—¶æ‰è¢«ç”¨åˆ° INDEX æƒé™ï¼Œå…è®¸åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œé€‚ç”¨äºå·²æœ‰çš„è¡¨ã€‚å¦‚æœå…·æœ‰æŸä¸ªè¡¨çš„ CREATE æƒé™ï¼Œå°±å¯ä»¥åœ¨ CREATE TABLE è¯­å¥ä¸­åŒ…æ‹¬ç´¢å¼•å®šä¹‰ ALTER æƒé™ï¼Œå…è®¸ä½¿ç”¨ ALTER TABLE æ¥æ›´æ”¹è¡¨çš„ç»“æ„å’Œé‡æ–°å‘½åè¡¨ CREATE ROUTINE æƒé™ï¼Œå…è®¸åˆ›å»ºä¿å­˜çš„ç¨‹åºï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ï¼Œæ›´æ”¹å’Œåˆ é™¤ä¿å­˜çš„ç¨‹åºï¼Œ EXECUTE æƒé™å…è®¸æ‰§è¡Œä¿å­˜çš„ç¨‹åº GRANT æƒé™ï¼Œå…è®¸æˆæƒç»™å…¶ä»–ç”¨æˆ·ï¼Œå¯ç”¨äºæ•°æ®åº“ã€è¡¨å’Œä¿å­˜çš„ç¨‹åº FILE æƒé™ï¼Œå…è®¸ä½¿ç”¨ LOAD DATA INFILE å’Œ SELECT â€¦ INTO OUTFILE è¯­å¥è¯»æˆ–å†™æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»»ä½•è¢«æˆäºˆ FILE æƒé™çš„ç”¨æˆ·éƒ½èƒ½è¯»æˆ–å†™ MySQL æœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼ˆè¯´æ˜ç”¨æˆ·å¯ä»¥è¯»ä»»ä½•æ•°æ®åº“ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› ä¸ºæœåŠ¡å™¨å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼‰ æƒé™çš„æŸ¥çœ‹ã€èµ‹äºˆå’Œæ’¤é”€æˆäºˆæƒé™ï¼š å¯ä»¥ èµ‹äºˆè§’è‰²æƒé™åå°†è§’è‰²èµ‹äºˆç»™ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ ç›´æ¥èµ‹äºˆç”¨æˆ·æƒé™ ç›´æ¥èµ‹äºˆæƒé™å‘½ä»¤ï¼š GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO ç”¨æˆ·å@ç”¨æˆ·åœ°å€ [IDENTIFIED BY â€˜å¯†ç å£ä»¤â€™]; ä¸¾ä¾‹ï¼šæˆäºˆ zhangsan æŸ¥è¯¢ dbtest99 æ•°æ®åº“ä¸­ emp è¡¨çš„æƒé™ grant select on dbtest99.emp to 'zhangsan'@'%'; å½“ zhangsan è¦ update æ•°æ®æ—¶ï¼Œä¼šæç¤ºæƒé™ä¸è¶³ å†æ¬¡èµ‹äºˆæƒé™ æ—¶ï¼Œç›¸å½“äºæ·»åŠ æƒé™ã€å¹¶é›†ã€‘ èµ‹äºˆæ‰€æœ‰æƒé™ grant all privileges on *.* to zhangsan; æˆäºˆæƒé™çš„ æ¨ªå‘åˆ†ç»„ ä¸ çºµå‘åˆ†ç»„ æ‰€è°“æ¨ªå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥æ¥è§¦åˆ°çš„æ•°æ®çš„èŒƒå›´ï¼Œæ¯”å¦‚å¯ä»¥çœ‹åˆ°å“ªäº›è¡¨çš„æ•°æ®ï¼› æ‰€è°“çºµå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯¹æ¥è§¦åˆ°çš„æ•°æ®èƒ½è®¿é—®åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæ¯”å¦‚èƒ½çœ‹ã€èƒ½æ”¹ï¼Œç”šè‡³æ˜¯ åˆ é™¤ã€‚ æŸ¥çœ‹æƒé™ï¼š æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ SHOW GRANTS; # æˆ– SHOW GRANTS FOR CURRENT_USER; # æˆ– SHOW GRANTS FOR CURRENT_USER(); æŸ¥çœ‹æŸç”¨æˆ·çš„å…¨å±€æƒé™ SHOW GRANTS FOR 'user'@'ä¸»æœºåœ°å€'; æ”¶å›æƒé™ï¼š å›æ”¶æƒé™å‘½ä»¤ REVOKE æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° FROM ç”¨æˆ·å@ç”¨æˆ·åœ°å€; ä¸¾ä¾‹ï¼šå›æ”¶ zhangsan ç”¨æˆ·çš„æ‰€æœ‰æƒé™ REVOKE ALL PRIVILEGES ON *.* FROM zhangsan@'%'; ã€æ³¨æ„ã€‘åœ¨å°†ç”¨æˆ·è´¦æˆ·ä»userè¡¨åˆ é™¤ä¹‹å‰ï¼Œåº”è¯¥æ”¶å›ç›¸åº”ç”¨æˆ·çš„æ‰€æœ‰æƒé™ å¼€å‘ä¸­å°½å¯èƒ½ä¸è¦ä½¿ç”¨ root è¶…çº§ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“ï¼Œå› ä¸º root çš„å¯†ç æ”¾åœ¨ä»£ç ä¸­ä¸å®‰å…¨ï¼Œä¸€æ—¦æ³„æ¼ï¼Œæ•°æ®åº“å°†å®Œå…¨å¤±å»ä¿æŠ¤ æƒé™è¡¨ MySQL é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œåœ¨ mysql æ•°æ®åº“ä¸­ç”± userã€db è¡¨å’Œ table_privã€column_privã€proc_priv è¡¨æ¥è®°å½•æƒé™ä¿¡æ¯ user è¡¨å­—æ®µè§£é‡Š db è¡¨å­—æ®µè§£é‡Š é€šè¿‡ hostã€dbã€user ç»„æˆå¤åˆä¸»é”®ï¼Œä½“ç°ç”¨æˆ·å¯¹æŸä¸€æ•°æ®åº“çš„ç›¸å…³æ“ä½œæƒé™ Create_routine_priv å’Œ Alter_routine_priv å­—æ®µå†³å®šç”¨æˆ·æ˜¯å¦å…·æœ‰åˆ›å»ºå’Œä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„æƒé™ tables_priv è¡¨å’Œ columns_priv è¡¨ tables_priv è¡¨ç”¨æ¥ å¯¹è¡¨è®¾ç½®æ“ä½œæƒé™ columns_priv è¡¨ç”¨æ¥å¯¹è¡¨çš„ æŸä¸€åˆ—è®¾ç½®æƒé™ procs_privè¡¨ procs_priv è¡¨å¯ä»¥å¯¹ å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°è®¾ç½®æ“ä½œæƒé™ è¿æ¥æ ¸å®é˜¶æ®µï¼š é€šè¿‡ user è¡¨ä¸­çš„ hostã€user å’Œ authentication_string è¿™ 3 ä¸ªå­—æ®µåŒ¹é…å®¢æˆ·ç«¯æä¾›ä¿¡æ¯ è¯·æ±‚æ ¸å®é˜¶æ®µï¼š æ ¹æ®ç”¨æˆ·çš„æ“ä½œï¼ŒæŒ‰ç…§ user - db - tables_priv - columns_priv æ£€æŸ¥ç¡®è®¤æƒé™ è§’è‰² è§’è‰²ï¼Œå°±ç›¸å½“äºæƒé™çš„é›†åˆ åˆ›å»ºè§’è‰²ï¼š åˆ›å»ºè§’è‰²å‘½ä»¤ CREATE ROLE 'role_name'[@'host_name'] [,'role_name'[@'host_name']]... ç»™è§’è‰²èµ‹äºˆæƒé™ï¼š ç»™è§’è‰²èµ‹äºˆæƒé™å‘½ä»¤ GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO 'è§’è‰²å'[@'host_name']; æŸ¥çœ‹è§’è‰²çš„æƒé™ï¼š æŸ¥çœ‹æŒ‡å®šè§’è‰²æƒé™å‘½ä»¤ SHOW GRANTS FOR 'è§’è‰²å'; å›æ”¶è§’è‰²çš„æƒé™ï¼š å›æ”¶è§’è‰²çš„æƒé™å‘½ä»¤ REVOKE privileges ON tablename FROM 'rolename'; åˆ é™¤è§’è‰²ï¼š åˆ é™¤è§’è‰²å‘½ä»¤ DROP ROLE 'è§’è‰²å'; ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²å‘½ä»¤ GRANT role [,role2,...] TO user [,user2,...]; æ¿€æ´»è§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²åéœ€è¦æ¿€æ´»è§’è‰²ï¼Œç”¨æˆ·é‡æ–°ç™»å½•æ‰çœŸæ­£æ‹¥æœ‰è§’è‰² æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼ä¸€ã€‘ SET DEFAULT ROLE ALL TO 'ç”¨æˆ·å'@'host'; æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼äºŒã€‘ # å¯¹æ‰€æœ‰è§’è‰²æ°¸ä¹…æ¿€æ´» SET GLOBAL activate_all_roles_on_login = ON; æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è§’è‰² SELECT CURRENT_ROLE(); æ’¤é”€ç”¨æˆ·çš„è§’è‰²ï¼š èµŠé”€ç”¨æˆ·è§’è‰²å‘½ä»¤ REVOKE è§’è‰²å FROM ç”¨æˆ·; è®¾ç½®å¼ºåˆ¶è§’è‰²ï¼š å¼ºåˆ¶è§’è‰²ç›¸å½“äºä¸ºæ‰€æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤è§’è‰² æœåŠ¡å¯åŠ¨å‰è®¾ç½® my.cnfã€æ–¹å¼ä¸€ã€‘ [mysqld] mandatory_roles='role1,role2@localhost,r3@%.atguigu.com' è¿è¡Œæ—¶è®¾ç½®ã€æ–¹å¼äºŒã€‘ SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åä»ç„¶ æœ‰æ•ˆ SET GLOBAL mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åå¤±æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æƒé™è¡¨"},{"categories":null,"content":"\ræƒé™ç®¡ç† # æŸ¥çœ‹ MySQL éƒ½æœ‰å“ªäº›æƒé™ show privileges; æƒé™åˆ†ç±»åŠå¸¸ç”¨çš„æƒé™ CREATE å’Œ DROP æƒé™ï¼Œå…è®¸åˆ›å»ºæ–°çš„æ•°æ®åº“å’Œè¡¨ï¼Œæˆ–åˆ é™¤ï¼ˆç§»æ‰ï¼‰å·²æœ‰çš„æ•°æ®åº“å’Œè¡¨ SELECT ã€ INSERT ã€ UPDATE å’Œ DELETE æƒé™ï¼Œå…è®¸åœ¨ä¸€ä¸ªæ•°æ®åº“ç°æœ‰çš„è¡¨ä¸Šå®æ–½æ“ä½œ SELECT æƒé™ï¼Œåªæœ‰åœ¨å®ƒä»¬çœŸæ­£ä»ä¸€ä¸ªè¡¨ä¸­æ£€ç´¢è¡Œæ—¶æ‰è¢«ç”¨åˆ° INDEX æƒé™ï¼Œå…è®¸åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ï¼Œé€‚ç”¨äºå·²æœ‰çš„è¡¨ã€‚å¦‚æœå…·æœ‰æŸä¸ªè¡¨çš„ CREATE æƒé™ï¼Œå°±å¯ä»¥åœ¨ CREATE TABLE è¯­å¥ä¸­åŒ…æ‹¬ç´¢å¼•å®šä¹‰ ALTER æƒé™ï¼Œå…è®¸ä½¿ç”¨ ALTER TABLE æ¥æ›´æ”¹è¡¨çš„ç»“æ„å’Œé‡æ–°å‘½åè¡¨ CREATE ROUTINE æƒé™ï¼Œå…è®¸åˆ›å»ºä¿å­˜çš„ç¨‹åºï¼ˆå‡½æ•°å’Œç¨‹åºï¼‰ï¼Œæ›´æ”¹å’Œåˆ é™¤ä¿å­˜çš„ç¨‹åºï¼Œ EXECUTE æƒé™å…è®¸æ‰§è¡Œä¿å­˜çš„ç¨‹åº GRANT æƒé™ï¼Œå…è®¸æˆæƒç»™å…¶ä»–ç”¨æˆ·ï¼Œå¯ç”¨äºæ•°æ®åº“ã€è¡¨å’Œä¿å­˜çš„ç¨‹åº FILE æƒé™ï¼Œå…è®¸ä½¿ç”¨ LOAD DATA INFILE å’Œ SELECT â€¦ INTO OUTFILE è¯­å¥è¯»æˆ–å†™æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»»ä½•è¢«æˆäºˆ FILE æƒé™çš„ç”¨æˆ·éƒ½èƒ½è¯»æˆ–å†™ MySQL æœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼ˆè¯´æ˜ç”¨æˆ·å¯ä»¥è¯»ä»»ä½•æ•°æ®åº“ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› ä¸ºæœåŠ¡å™¨å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼‰ æƒé™çš„æŸ¥çœ‹ã€èµ‹äºˆå’Œæ’¤é”€æˆäºˆæƒé™ï¼š å¯ä»¥ èµ‹äºˆè§’è‰²æƒé™åå°†è§’è‰²èµ‹äºˆç»™ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ ç›´æ¥èµ‹äºˆç”¨æˆ·æƒé™ ç›´æ¥èµ‹äºˆæƒé™å‘½ä»¤ï¼š GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO ç”¨æˆ·å@ç”¨æˆ·åœ°å€ [IDENTIFIED BY â€˜å¯†ç å£ä»¤â€™]; ä¸¾ä¾‹ï¼šæˆäºˆ zhangsan æŸ¥è¯¢ dbtest99 æ•°æ®åº“ä¸­ emp è¡¨çš„æƒé™ grant select on dbtest99.emp to 'zhangsan'@'%'; å½“ zhangsan è¦ update æ•°æ®æ—¶ï¼Œä¼šæç¤ºæƒé™ä¸è¶³ å†æ¬¡èµ‹äºˆæƒé™ æ—¶ï¼Œç›¸å½“äºæ·»åŠ æƒé™ã€å¹¶é›†ã€‘ èµ‹äºˆæ‰€æœ‰æƒé™ grant all privileges on *.* to zhangsan; æˆäºˆæƒé™çš„ æ¨ªå‘åˆ†ç»„ ä¸ çºµå‘åˆ†ç»„ æ‰€è°“æ¨ªå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯ä»¥æ¥è§¦åˆ°çš„æ•°æ®çš„èŒƒå›´ï¼Œæ¯”å¦‚å¯ä»¥çœ‹åˆ°å“ªäº›è¡¨çš„æ•°æ®ï¼› æ‰€è°“çºµå‘çš„åˆ†ç»„ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·å¯¹æ¥è§¦åˆ°çš„æ•°æ®èƒ½è®¿é—®åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œæ¯”å¦‚èƒ½çœ‹ã€èƒ½æ”¹ï¼Œç”šè‡³æ˜¯ åˆ é™¤ã€‚ æŸ¥çœ‹æƒé™ï¼š æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ SHOW GRANTS; # æˆ– SHOW GRANTS FOR CURRENT_USER; # æˆ– SHOW GRANTS FOR CURRENT_USER(); æŸ¥çœ‹æŸç”¨æˆ·çš„å…¨å±€æƒé™ SHOW GRANTS FOR 'user'@'ä¸»æœºåœ°å€'; æ”¶å›æƒé™ï¼š å›æ”¶æƒé™å‘½ä»¤ REVOKE æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° FROM ç”¨æˆ·å@ç”¨æˆ·åœ°å€; ä¸¾ä¾‹ï¼šå›æ”¶ zhangsan ç”¨æˆ·çš„æ‰€æœ‰æƒé™ REVOKE ALL PRIVILEGES ON *.* FROM zhangsan@'%'; ã€æ³¨æ„ã€‘åœ¨å°†ç”¨æˆ·è´¦æˆ·ä»userè¡¨åˆ é™¤ä¹‹å‰ï¼Œåº”è¯¥æ”¶å›ç›¸åº”ç”¨æˆ·çš„æ‰€æœ‰æƒé™ å¼€å‘ä¸­å°½å¯èƒ½ä¸è¦ä½¿ç”¨ root è¶…çº§ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“ï¼Œå› ä¸º root çš„å¯†ç æ”¾åœ¨ä»£ç ä¸­ä¸å®‰å…¨ï¼Œä¸€æ—¦æ³„æ¼ï¼Œæ•°æ®åº“å°†å®Œå…¨å¤±å»ä¿æŠ¤ æƒé™è¡¨ MySQL é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œåœ¨ mysql æ•°æ®åº“ä¸­ç”± userã€db è¡¨å’Œ table_privã€column_privã€proc_priv è¡¨æ¥è®°å½•æƒé™ä¿¡æ¯ user è¡¨å­—æ®µè§£é‡Š db è¡¨å­—æ®µè§£é‡Š é€šè¿‡ hostã€dbã€user ç»„æˆå¤åˆä¸»é”®ï¼Œä½“ç°ç”¨æˆ·å¯¹æŸä¸€æ•°æ®åº“çš„ç›¸å…³æ“ä½œæƒé™ Create_routine_priv å’Œ Alter_routine_priv å­—æ®µå†³å®šç”¨æˆ·æ˜¯å¦å…·æœ‰åˆ›å»ºå’Œä¿®æ”¹å­˜å‚¨è¿‡ç¨‹çš„æƒé™ tables_priv è¡¨å’Œ columns_priv è¡¨ tables_priv è¡¨ç”¨æ¥ å¯¹è¡¨è®¾ç½®æ“ä½œæƒé™ columns_priv è¡¨ç”¨æ¥å¯¹è¡¨çš„ æŸä¸€åˆ—è®¾ç½®æƒé™ procs_privè¡¨ procs_priv è¡¨å¯ä»¥å¯¹ å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°è®¾ç½®æ“ä½œæƒé™ è¿æ¥æ ¸å®é˜¶æ®µï¼š é€šè¿‡ user è¡¨ä¸­çš„ hostã€user å’Œ authentication_string è¿™ 3 ä¸ªå­—æ®µåŒ¹é…å®¢æˆ·ç«¯æä¾›ä¿¡æ¯ è¯·æ±‚æ ¸å®é˜¶æ®µï¼š æ ¹æ®ç”¨æˆ·çš„æ“ä½œï¼ŒæŒ‰ç…§ user - db - tables_priv - columns_priv æ£€æŸ¥ç¡®è®¤æƒé™ è§’è‰² è§’è‰²ï¼Œå°±ç›¸å½“äºæƒé™çš„é›†åˆ åˆ›å»ºè§’è‰²ï¼š åˆ›å»ºè§’è‰²å‘½ä»¤ CREATE ROLE 'role_name'[@'host_name'] [,'role_name'[@'host_name']]... ç»™è§’è‰²èµ‹äºˆæƒé™ï¼š ç»™è§’è‰²èµ‹äºˆæƒé™å‘½ä»¤ GRANT æƒé™1,æƒé™2,â€¦æƒé™n ON æ•°æ®åº“åç§°.è¡¨åç§° TO 'è§’è‰²å'[@'host_name']; æŸ¥çœ‹è§’è‰²çš„æƒé™ï¼š æŸ¥çœ‹æŒ‡å®šè§’è‰²æƒé™å‘½ä»¤ SHOW GRANTS FOR 'è§’è‰²å'; å›æ”¶è§’è‰²çš„æƒé™ï¼š å›æ”¶è§’è‰²çš„æƒé™å‘½ä»¤ REVOKE privileges ON tablename FROM 'rolename'; åˆ é™¤è§’è‰²ï¼š åˆ é™¤è§’è‰²å‘½ä»¤ DROP ROLE 'è§’è‰²å'; ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²å‘½ä»¤ GRANT role [,role2,...] TO user [,user2,...]; æ¿€æ´»è§’è‰²ï¼š ä¸ºç”¨æˆ·èµ‹äºˆè§’è‰²åéœ€è¦æ¿€æ´»è§’è‰²ï¼Œç”¨æˆ·é‡æ–°ç™»å½•æ‰çœŸæ­£æ‹¥æœ‰è§’è‰² æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼ä¸€ã€‘ SET DEFAULT ROLE ALL TO 'ç”¨æˆ·å'@'host'; æ¿€æ´»è§’è‰²å‘½ä»¤ã€æ–¹å¼äºŒã€‘ # å¯¹æ‰€æœ‰è§’è‰²æ°¸ä¹…æ¿€æ´» SET GLOBAL activate_all_roles_on_login = ON; æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è§’è‰² SELECT CURRENT_ROLE(); æ’¤é”€ç”¨æˆ·çš„è§’è‰²ï¼š èµŠé”€ç”¨æˆ·è§’è‰²å‘½ä»¤ REVOKE è§’è‰²å FROM ç”¨æˆ·; è®¾ç½®å¼ºåˆ¶è§’è‰²ï¼š å¼ºåˆ¶è§’è‰²ç›¸å½“äºä¸ºæ‰€æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤è§’è‰² æœåŠ¡å¯åŠ¨å‰è®¾ç½® my.cnfã€æ–¹å¼ä¸€ã€‘ [mysqld] mandatory_roles='role1,role2@localhost,r3@%.atguigu.com' è¿è¡Œæ—¶è®¾ç½®ã€æ–¹å¼äºŒã€‘ SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åä»ç„¶ æœ‰æ•ˆ SET GLOBAL mandatory_roles = 'role1,role2@localhost,r3@%.example.com'; #ç³»ç»Ÿé‡å¯åå¤±æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:3:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è§’è‰²"},{"categories":null,"content":"\ré…ç½®æ–‡ä»¶ä¸ç³»ç»Ÿå˜é‡","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é…ç½®æ–‡ä»¶ä¸ç³»ç»Ÿå˜é‡"},{"categories":null,"content":"\ré…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶çš„å¯åŠ¨é€‰é¡¹è¢«åˆ†ä¸ºå¾ˆå¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„éƒ½æ˜¯ç”± æ‹¬èµ·æ¥çš„ç»„åå¼€å¤´ MySQL 8 é»˜è®¤çš„ my.cnf é…ç½®æ–‡ä»¶ ç±»ä¼¼çš„ç»„åå¯ä»¥æœ‰å¾ˆå¤š [server] ç»„åä¸‹è¾¹çš„å¯åŠ¨é€‰é¡¹å°†ä½œç”¨äºæ‰€æœ‰çš„æœåŠ¡å™¨ç¨‹åº [client] ç»„åä¸‹è¾¹çš„å¯åŠ¨é€‰é¡¹å°†ä½œç”¨äºæ‰€æœ‰çš„å®¢æˆ·ç«¯ç¨‹åº åœ¨æŒ‡å®šå¯¹åº”çš„æŒ‡ä»¤æ—¶ä¼šå¯ç”¨å¯¹åº”çš„æ ‡ç­¾ç»„ ä¾‹å¦‚ï¼šåœ¨æœåŠ¡å™¨ä¸­è®¾ç½®çš„å¯åŠ¨é€‰é¡¹å°±éœ€è¦å†™åœ¨ [mysqld] æˆ– [server] æ ‡ç­¾ç»„ä¸‹ å¯ä»¥æŒ‡å®šæ ‡ç­¾ç»„æ‰§è¡Œçš„ MySQL ç‰ˆæœ¬ ä¾‹å¦‚ï¼š[mysqld-5.7] çš„æ ‡ç­¾ç»„ä¸­çš„å†…å®¹å°±åªèƒ½åœ¨ MySQL 5.7 çš„æœåŠ¡å™¨ç‰ˆæœ¬ä¸­è¢«æ‰§è¡Œ å½“é…ç½®å‡ºç°çŸ›ç›¾æ—¶ï¼Œä»¥ä¸‹æ–¹çš„é…ç½®ä¸ºå‡† [server] default-storage-engine = InnoDB [mysqld] # å½“é…ç½®å‡ºç°çŸ›ç›¾æ—¶ï¼Œä»¥ä¸‹è¡Œä¸ºå‡† default-storage-engine = MyISAM å½“å¯åŠ¨å‘½ä»¤ä¸ my.cnf ä¸­å†…å®¹å‡ºç°çŸ›ç›¾æ—¶ï¼Œä»¥å¯åŠ¨å‘½ä»¤åæ–¹çš„é…ç½®ä¸ºå‡† [server] default-storage-engine = InnoDB # å¯åŠ¨å‘½ä»¤æ¯”é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§é«˜ mysql.server start --default-storage-engine=MyISAM ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é…ç½®æ–‡ä»¶"},{"categories":null,"content":"\rç³»ç»Ÿå˜é‡ åœ¨ my.cnf ä¸­çš„é…ç½®å’Œåœ¨å¯åŠ¨å‘½ä»¤ä¸­å†™çš„éƒ½æ˜¯ç³»ç»Ÿå˜é‡ è®¾ç½®ç³»ç»Ÿå˜é‡ set [global|session] ç³»ç»Ÿå˜é‡å = ç³»ç»Ÿå˜é‡å€¼; æŸ¥çœ‹ç³»ç»Ÿå˜é‡ show [global|session] variables [like åŒ¹é…çš„æ¨¡å¼]; è¿™é‡Œçš„å†…å®¹ä»…éœ€äº†è§£ åœ¨ my.cnf ä¸­çš„é…ç½® å’Œ åœ¨å¯åŠ¨å‘½ä»¤åæ–¹å†™çš„ éƒ½æ˜¯ç³»ç»Ÿå˜é‡ å³å¯ å¦‚æœéœ€è¦ä½¿ç”¨å¯ä»¥æŸ¥çœ‹ï¼šwzblog ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:4:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç³»ç»Ÿå˜é‡"},{"categories":null,"content":"\ré€»è¾‘æ¶æ„ MySQL æ˜¯å…¸å‹çš„ Client/Server æ¶æ„ï¼Œå®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡ç«¯è¿›ç¨‹å‘é€ä¸€æ®µæ–‡æœ¬ ( SQL è¯­å¥ ) ï¼ŒæœåŠ¡ç«¯è¿›ç¨‹å¤„ç†åå†å‘å®¢æˆ·ç«¯è¿›ç¨‹è¿”å›ä¸€æ®µæ–‡æœ¬ ( å¤„ç†ç»“æœ ) é€»è¾‘æ¶æ„å±•å¼€è¯´æ˜ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é€»è¾‘æ¶æ„"},{"categories":null,"content":"\rè¿æ¥å±‚ å®¢æˆ·ç«¯åœ¨è®¿é—® MySQL æœåŠ¡å™¨å‰ï¼Œä¼šå…ˆç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ TCP è¿æ¥ï¼Œå MySQL æœåŠ¡å™¨å¯¹ TCP ä¼ è¾“è¿‡æ¥çš„è´¦å·å¯†ç è¿›è¡ŒéªŒè¯ï¼Œèº«ä»½éªŒè¯ã€æƒé™è·å– éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œé”™è¯¯æç¤º Access denied for user ç»“æŸå®¢æˆ·ç«¯ç¨‹åº æŸ¥è¯¢å‡ºè´¦å·æ‹¥æœ‰çš„æƒé™å¹¶ä¸è¿æ¥å…³è”ï¼Œä¹‹åçš„æƒé™åˆ¤æ–­éƒ½ä¾ç…§æ­¤æ—¶è¯»åˆ°çš„æƒé™ åœ¨è¿æ¥æ± ä¸­åˆ›å»ºä¸€ä¸ª TCP çš„é•¿è¿æ¥ï¼Œåä¼šåœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºçº¿ç¨‹å¤„ç†å…·ä½“æ“ä½œ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¿æ¥å±‚"},{"categories":null,"content":"\ræœåŠ¡å±‚ æœåŠ¡å™¨åœ¨è¯¥å±‚ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºå¯¹åº”çš„è§£ææ ‘ï¼Œå®Œæˆç›¸åº”çš„ä¼˜åŒ– SQL Interfaceï¼šSQL æ¥å£ æ¥å—ç”¨æˆ·çš„ SQL å‘½ä»¤ï¼Œå¹¶è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœ ä¾‹å¦‚ï¼šSELECT â€¦ FROM å°±æ˜¯è°ƒç”¨çš„ SQL Interface Parserï¼šè§£æå™¨ å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œå¹¶ç”Ÿæˆ è¯­æ³•æ ‘ å¦‚æœ SQL è¯­å¥çš„å…³é”®å­—æ‹¼å†™é”™è¯¯æˆ–è¯­ä¹‰ä¸åˆç†ï¼Œåœ¨æ­¤æ—¶å°±ä¼šæŠ¥é”™ Optimizerï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨ ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œç”Ÿæˆ æ‰§è¡Œè®¡åˆ’ æŒ‡å®šä½¿ç”¨çš„ç´¢å¼•ï¼Œé€‰å– é€‰å–-æŠ•å½±-è¿æ¥ ç­–ç•¥è¿›è¡ŒæŸ¥è¯¢ é€‰å– æ ¹æ® where è¯­å¥è¿›è¡Œé€‰å–ï¼Œè€Œä¸æ˜¯å°†è¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥å†è¿‡æ»¤ æŠ•å½± æ ¹æ® select åçš„å­—æ®µè¿›è¡Œå±æ€§æŠ•å½±ï¼Œè€Œä¸æ˜¯å°†å…¨éƒ¨å­—æ®µéƒ½æŸ¥è¯¢å‡ºæ¥å†è¿‡æ»¤ è¿æ¥ å°†è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶è¿æ¥èµ·æ¥ç”Ÿæˆæœ€ç»ˆçš„æŸ¥è¯¢ç»“æœ Caches \u0026 Buffersï¼šæŸ¥è¯¢ç¼“å­˜ç»„ä»¶ å†…éƒ¨ç»´æŒç€ä¸€äº› Cache å’Œ Bufferï¼Œæ¯”å¦‚ Query Cache ç”¨æ¥ç¼“å­˜ä¸€æ¡ SELECT è¯­å¥çš„æ‰§è¡Œç»“æœ è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkey ç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰ æŸ¥è¯¢ç¼“å­˜å¯ä»¥åœ¨ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å…±äº«ï¼Œç”±äºå‘½ä¸­ç‡è¾ƒä½åœ¨ MySQL 8 ä¸­è¢«åˆ é™¤ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æœåŠ¡å±‚"},{"categories":null,"content":"\rå¼•æ“å±‚ æ˜¯æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“ï¼Œè´Ÿè´£ MySQL ä¸­æ•°æ®å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œ æŸ¥çœ‹ MySQL é»˜è®¤æ”¯æŒçš„å¼•æ“å‘½ä»¤ show engines; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¼•æ“å±‚"},{"categories":null,"content":"\rå­˜å‚¨å±‚ å®æ‰“å®çš„åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜å‚¨æ–‡ä»¶ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å±‚"},{"categories":null,"content":"\rMySQL çš„ä¸‰å±‚æ¶æ„ è¿æ¥å±‚ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ SQL è‡³æœåŠ¡å™¨ç«¯ SQL å±‚ï¼ˆæœåŠ¡å±‚ï¼‰ï¼šå¯¹ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›ä¸æ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼æ— å…³ å­˜å‚¨å¼•æ“å±‚ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å– ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:5:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-çš„ä¸‰å±‚æ¶æ„"},{"categories":null,"content":"\rSQL çš„æ‰§è¡Œæµç¨‹\r","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#sql-çš„æ‰§è¡Œæµç¨‹"},{"categories":null,"content":"\r1.æŸ¥è¯¢ç¼“å­˜ æŸ¥è¯¢ SQL ä¸æŸ¥è¯¢ç»“æœå¯èƒ½æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ã€‚å¦‚æœ SQL è¯­å¥å‘½ä¸­äº† key é‚£ä¹ˆç›´æ¥è¿”å› valueï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç»§ç»­æ‰§è¡Œå¹¶å°†æ‰§è¡Œç»“æœå­˜å‚¨åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ ç”±äºä¸¤ä¸ªæŸ¥è¯¢è¯·æ±‚åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒï¼ˆä¾‹å¦‚ï¼šç©ºæ ¼ã€æ³¨é‡Šã€ å¤§å°å†™ï¼‰ï¼Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸ä¼šå‘½ä¸­ã€‚å› æ­¤ MySQL çš„ æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ åœ¨ä½¿ç”¨åˆ°ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°å¦‚ now() æ—¶ï¼ŒæŸ¥è¯¢ç¼“å­˜å°±ä¸åº”è¯¥å¼€å¯ã€‚åœ¨æ‰§è¡Œ INSERTã€UPDATEã€ DELETEã€TRUNCATE TABLEã€ ALTER TABLEã€DROPTABLE æˆ– DROP DATABASE è¯­å¥æ—¶ç¼“å­˜å¤±æ•ˆã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡è¾ƒä½ ä¸€èˆ¬æ¨èåœ¨é™æ€è¡¨ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œå³å¸¸å¸¸æŸ¥è¯¢ä½†ä¸å¸¸æ›´æ–°çš„è¡¨ã€‚åœ¨ MySQL 5.7 ä¸­å¼€å¯æŸ¥è¯¢ç¼“å­˜é…ç½® my.cnf æ–‡ä»¶ï¼š # query_cache_type æœ‰ 3 ä¸ªå€¼ 0 ä»£è¡¨å…³é—­æŸ¥è¯¢ç¼“å­˜ OFF, 1 ä»£è¡¨å¼€å¯ ON , 2 (DEMAND) æŒ‰éœ€ä½¿ç”¨ query_cache_type = 2 # åœ¨ä½¿ç”¨ SQL_CACHE å…³é”®å­—çš„æŸ¥è¯¢ä¸­ï¼Œæ‰ä¼šå¼€å¯æŸ¥è¯¢ç¼“å­˜ select SQL_CACHE * from test where ID = 5; # æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ show global variables like \"%query_cache_type%\"; # æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ show status like '%Qcache%'; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#1æŸ¥è¯¢ç¼“å­˜"},{"categories":null,"content":"\r2.è§£æå™¨ å¯¹ SQL è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æ é¦–å…ˆå¯¹ SQL è¿›è¡Œ **è¯æ³•åˆ†æ **è¯†åˆ«å…³é”®è¯å’Œä¸€äº›å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„æ˜¯ä»€ä¹ˆ ç„¶åå¯¹ SQL è¿›è¡Œ è¯­æ³•åˆ†æ æ ¹æ®è¯­æ³•è§„åˆ™åˆ¤æ–­è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³• å¦‚æœè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æå‡é€šè¿‡ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè¯­æ³•æ ‘ SELECT username, ismale FROM userinfo WHERE age \u003e 20 AND level \u003e 5 AND 1 = 1; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#2è§£æå™¨"},{"categories":null,"content":"\r3.ä¼˜åŒ–å™¨ ç¡®å®š SQL çš„æ‰§è¡Œè®¡åˆ’å¹¶äº¤å‡ºæ‰§è¡Œè®¡åˆ’ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®å…¨è¡¨æ£€ç´¢è¿˜æ˜¯æ ¹æ®ç´¢å¼•æ£€ç´¢ç­‰ åœ¨æŸ¥è¯¢ä¼˜åŒ–ä¸­ä¸»è¦åˆ†ä¸º é€»è¾‘ä¼˜åŒ–é˜¶æ®µ å’Œ ç‰©ç†ä¼˜åŒ–é˜¶æ®µ ã€‚åœ¨ç´¢å¼•ç« èŠ‚æœ‰è¡¥å…… ä¾‹å¦‚åœ¨æŸ¥è¯¢è¯­å¥ä¸­ where åæ–¹æœ‰ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆå…ˆåæ‰§è¡Œå“ªä¸ªæ¡ä»¶çš„é¡ºåºæ˜¯ä¼˜åŒ–å™¨æ‰€åšçš„äº‹ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#3ä¼˜åŒ–å™¨"},{"categories":null,"content":"\r4.æ‰§è¡Œå™¨ å…ˆåˆ¤æ–­æ˜¯å¦å…·æœ‰æ‰§è¡Œçš„æƒé™ï¼Œå†è°ƒç”¨å­˜å‚¨å¼•æ“ API è¿›è¡Œæ‰§è¡Œ ä¾‹å¦‚åœ¨æ‰§è¡Œ select SQL_CACHE * from test where ID = 1; è¯­å¥ï¼š è°ƒç”¨ InnoDB å¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­ ID å€¼æ˜¯ä¸æ˜¯ 1ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ è°ƒç”¨å¼•æ“æ¥å£å– â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚ æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ MySQL æ‰§è¡Œé¡ºåºï¼š ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#4æ‰§è¡Œå™¨"},{"categories":null,"content":"\rMySQL 8 æ‰§è¡Œæµç¨‹ ==å¼€å¯ Profiling==ï¼šè®© MySQL æ”¶é›† SQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„èµ„æºæƒ…å†µ # æŸ¥çœ‹æ˜¯å¦å¼€å¯äº† Profiling, 0 ä¸ºæœªå¼€å¯ select @@profiling; # æˆ– show variables like 'profiling'; # å¼€å¯ Profiling set profiling = 1; æŸ¥çœ‹å½“å‰ä¼šè¯æœ€è¿‘å‡ æ¬¡çš„æŸ¥è¯¢ Profiles show profiles; æŸ¥çœ‹æŒ‡å®šçš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ # æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æŸ¥è¯¢çš„æŸ¥è¯¢è®¡åˆ’ show profile; # æŸ¥çœ‹æŒ‡å®š Query_ID çš„æŸ¥è¯¢è®¡åˆ’ show profile for query 6; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-8-æ‰§è¡Œæµç¨‹-a-idprofile-a"},{"categories":null,"content":"\rMySQL 5.7 æ‰§è¡Œæµç¨‹ å¼€å¯æŸ¥è¯¢ç¼“å­˜ query_cache åœ¨ /etc/my.cnf ä¸­æ–°å¢ä¸€è¡Œ query_cache_type = 1 é‡å¯ MySQL æœåŠ¡ systemctl restart mysqld å¼€å¯æ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼šåŒ MySQL 8 æŸ¥çœ‹ Profiles æŸ¥çœ‹ Profile å¯ä»¥æŸ¥çœ‹æŒ‡å®š type çš„æ‰§è¡Œè®¡åˆ’ ä¾‹å¦‚ï¼šæŸ¥çœ‹ cpu å’Œ io æœ‰å…³çš„æ‰§è¡Œæƒ…å†µ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:6","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-57-æ‰§è¡Œæµç¨‹"},{"categories":null,"content":"\rOracle ä¸­çš„æ‰§è¡Œæµç¨‹\rè¯­æ³•æ£€æŸ¥ï¼šæ£€æŸ¥ SQL æ‹¼å†™ï¼Œé”™è¯¯æŠ¥è¯­æ³•é”™è¯¯ è¯­ä¹‰æ£€æŸ¥ï¼šæ£€æŸ¥è®¿é—®çš„å¯¹è±¡æ˜¯å¦å­˜åœ¨ æƒé™æ£€æŸ¥ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰ç›¸åº”çš„æƒé™ å…±äº«æ± æ£€æŸ¥ï¼šç¼“å­˜ SQL è¯­å¥å’Œè¯¥è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ å¯¹ SQL è¯­å¥è¿›è¡Œ hash è¿ç®—ï¼Œå¦‚æœåœ¨ åº“ç¼“å­˜(Library Cache) ä¸­æ‰¾åˆ°åˆ™ç›´æ¥è¿›å…¥ æ‰§è¡Œå™¨ã€è½¯è§£æã€‘ å¦‚æœæ²¡æœ‰ hash åˆ°ï¼Œåˆ™åˆ›å»ºè§£ææ ‘è¿›è¡Œè§£æï¼Œè¿›å…¥ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ‰§è¡Œã€ç¡¬è§£æã€‘ Oracle æ•°æ®åº“æ¶æ„å›¾ç®€å›¾ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:7","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#oracle-ä¸­çš„æ‰§è¡Œæµç¨‹"},{"categories":null,"content":"\ræ•°æ®åº“ç¼“å†²æ±  InnoDB å°† æ•°æ®é¡µ ä½œä¸ºå•ä½å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®é¡µå  16KB DBMS ä¼šå ç”¨å†…å­˜ä½œä¸ºç¼“å†²æ± ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„ Buffer Pool ä¹‹åæ‰å¯ä»¥è®¿é—®ï¼Œä»è€Œå‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´ ç¼“å†²åŸåˆ™ æ ¹æ® â€œ ä½ç½® * é¢‘æ¬¡ â€ è¿™ä¸ªåŸåˆ™ï¼Œä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½ åœ¨ç¼“å­˜ç©ºé—´å…è®¸çš„å‰æä¸‹ï¼Œä¼šæå°†æŠŠæŸ¥è¯¢ç»“æœæˆ–å°†æŸ¥è¯¢ç»“æœå‘¨å›´çš„æ•°æ®æ”¾åˆ°ç¼“å†²æ± ä¸­ã€é¢„è¯»ç‰¹æ€§ã€‘ ç¼“å†²æ± åœ¨ MySQL ä¸­çš„ç»“æ„å’Œä½œç”¨ï¼š åœ¨æ•°æ®æ›´æ–°åä¸ä¼šç«‹å³æ›´æ–°ç£ç›˜æ•°æ®ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´ç­–ç•¥å¯¹æœ¬åœ°ç£ç›˜è¿›è¡Œæ›´æ–° å½“ Buffer Pool æœªå¯¹ç£ç›˜æ›´æ–°æ•°æ®æ—¶å®•æœºæ€ä¹ˆåŠï¼Ÿ ç­”ï¼šRedo Log \u0026 Undo Logï¼ˆåœ¨äº‹åŠ¡ç« èŠ‚ä¼šè¡¥å……ï¼‰ æŸ¥çœ‹ç¼“å†²æ± çš„å¤§å°ï¼š # æŸ¥çœ‹ InnoDB ç¼“å†²æ± å¤§å° show variables like 'innodb_buffer_pool_size'; # æŸ¥çœ‹ MyISAM ç¼“å†²æ± å¤§å° show variables like 'key_buffer_size'; è®¾ç½®ç¼“å†²æ± å¤§å°ï¼š é€šè¿‡å˜é‡è®¾ç½®ç¼“å†²æ± å¤§å°ä¸º 256MB : 256 * 1024 * 1024 = 268435456 set global innodb_buffer_pool_size = 268435456; é€šè¿‡é…ç½® my.cnf è®¾ç½®ç¼“å†²æ± å¤§å° [server] innodb_buffer_pool_size = 268435456 Buffer Pool å®ä¾‹ä¸ªæ•° å°†ç¼“å†²æ±  æ‹†åˆ† æˆè‹¥å¹²ä¸ªå° Buffer Pool ï¼Œè‹¥ Buffer Pool å¤§å°è®¾ç½®ä¸º 1GB å®ä¾‹ä¸ªæ•°è®¾ç½®ä¸º 2ï¼Œåˆ™æ¯ä¸ªå®ä¾‹å  512 MB å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿æ¥æ•°æ®åº“æ—¶ï¼Œè®©å…¶åˆ†åˆ«è®¿é—®å„è‡ªçš„ Buffer Pool é¿å…ä¸º Buffer Pool åŠ é”å½±å“æ€§èƒ½ é€šè¿‡é…ç½® my.cnf è®¾ç½® Buffer Pool å®ä¾‹ä¸ªæ•° [server] innodb_buffer_pool_instances = 2 Buffer Pool å®ä¾‹ä¸ªæ•°å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç®¡ç†å„ä¸ª Buffer Pool ä¹Ÿæ˜¯éœ€è¦æ€§èƒ½å¼€é”€çš„ï¼Œåœ¨ç¼“å†²æ± å†…å­˜å¤§å° \u003e 1GB æ—¶æ‰æœ‰æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:8","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“ç¼“å†²æ± "},{"categories":null,"content":"\ræ•°æ®åº“ç¼“å†²æ±  InnoDB å°† æ•°æ®é¡µ ä½œä¸ºå•ä½å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®é¡µå  16KB DBMS ä¼šå ç”¨å†…å­˜ä½œä¸ºç¼“å†²æ± ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„ Buffer Pool ä¹‹åæ‰å¯ä»¥è®¿é—®ï¼Œä»è€Œå‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´ ç¼“å†²åŸåˆ™ æ ¹æ® â€œ ä½ç½® * é¢‘æ¬¡ â€ è¿™ä¸ªåŸåˆ™ï¼Œä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½ åœ¨ç¼“å­˜ç©ºé—´å…è®¸çš„å‰æä¸‹ï¼Œä¼šæå°†æŠŠæŸ¥è¯¢ç»“æœæˆ–å°†æŸ¥è¯¢ç»“æœå‘¨å›´çš„æ•°æ®æ”¾åˆ°ç¼“å†²æ± ä¸­ã€é¢„è¯»ç‰¹æ€§ã€‘ ç¼“å†²æ± åœ¨ MySQL ä¸­çš„ç»“æ„å’Œä½œç”¨ï¼š åœ¨æ•°æ®æ›´æ–°åä¸ä¼šç«‹å³æ›´æ–°ç£ç›˜æ•°æ®ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´ç­–ç•¥å¯¹æœ¬åœ°ç£ç›˜è¿›è¡Œæ›´æ–° å½“ Buffer Pool æœªå¯¹ç£ç›˜æ›´æ–°æ•°æ®æ—¶å®•æœºæ€ä¹ˆåŠï¼Ÿ ç­”ï¼šRedo Log \u0026 Undo Logï¼ˆåœ¨äº‹åŠ¡ç« èŠ‚ä¼šè¡¥å……ï¼‰ æŸ¥çœ‹ç¼“å†²æ± çš„å¤§å°ï¼š # æŸ¥çœ‹ InnoDB ç¼“å†²æ± å¤§å° show variables like 'innodb_buffer_pool_size'; # æŸ¥çœ‹ MyISAM ç¼“å†²æ± å¤§å° show variables like 'key_buffer_size'; è®¾ç½®ç¼“å†²æ± å¤§å°ï¼š é€šè¿‡å˜é‡è®¾ç½®ç¼“å†²æ± å¤§å°ä¸º 256MB : 256 * 1024 * 1024 = 268435456 set global innodb_buffer_pool_size = 268435456; é€šè¿‡é…ç½® my.cnf è®¾ç½®ç¼“å†²æ± å¤§å° [server] innodb_buffer_pool_size = 268435456 Buffer Pool å®ä¾‹ä¸ªæ•° å°†ç¼“å†²æ±  æ‹†åˆ† æˆè‹¥å¹²ä¸ªå° Buffer Pool ï¼Œè‹¥ Buffer Pool å¤§å°è®¾ç½®ä¸º 1GB å®ä¾‹ä¸ªæ•°è®¾ç½®ä¸º 2ï¼Œåˆ™æ¯ä¸ªå®ä¾‹å  512 MB å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿æ¥æ•°æ®åº“æ—¶ï¼Œè®©å…¶åˆ†åˆ«è®¿é—®å„è‡ªçš„ Buffer Pool é¿å…ä¸º Buffer Pool åŠ é”å½±å“æ€§èƒ½ é€šè¿‡é…ç½® my.cnf è®¾ç½® Buffer Pool å®ä¾‹ä¸ªæ•° [server] innodb_buffer_pool_instances = 2 Buffer Pool å®ä¾‹ä¸ªæ•°å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç®¡ç†å„ä¸ª Buffer Pool ä¹Ÿæ˜¯éœ€è¦æ€§èƒ½å¼€é”€çš„ï¼Œåœ¨ç¼“å†²æ± å†…å­˜å¤§å° \u003e 1GB æ—¶æ‰æœ‰æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:8","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç¼“å†²åŸåˆ™"},{"categories":null,"content":"\ræ•°æ®åº“ç¼“å†²æ±  InnoDB å°† æ•°æ®é¡µ ä½œä¸ºå•ä½å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®é¡µå  16KB DBMS ä¼šå ç”¨å†…å­˜ä½œä¸ºç¼“å†²æ± ï¼Œéœ€è¦æŠŠåœ¨ç£ç›˜ä¸Šçš„é¡µç¼“å­˜åˆ°å†…å­˜ä¸­çš„ Buffer Pool ä¹‹åæ‰å¯ä»¥è®¿é—®ï¼Œä»è€Œå‡å°‘ä¸ç£ç›˜ç›´æ¥è¿›è¡Œ I/O çš„æ—¶é—´ ç¼“å†²åŸåˆ™ æ ¹æ® â€œ ä½ç½® * é¢‘æ¬¡ â€ è¿™ä¸ªåŸåˆ™ï¼Œä¼˜å…ˆå¯¹ä½¿ç”¨é¢‘æ¬¡é«˜çš„çƒ­æ•°æ®è¿›è¡ŒåŠ è½½ åœ¨ç¼“å­˜ç©ºé—´å…è®¸çš„å‰æä¸‹ï¼Œä¼šæå°†æŠŠæŸ¥è¯¢ç»“æœæˆ–å°†æŸ¥è¯¢ç»“æœå‘¨å›´çš„æ•°æ®æ”¾åˆ°ç¼“å†²æ± ä¸­ã€é¢„è¯»ç‰¹æ€§ã€‘ ç¼“å†²æ± åœ¨ MySQL ä¸­çš„ç»“æ„å’Œä½œç”¨ï¼š åœ¨æ•°æ®æ›´æ–°åä¸ä¼šç«‹å³æ›´æ–°ç£ç›˜æ•°æ®ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´ç­–ç•¥å¯¹æœ¬åœ°ç£ç›˜è¿›è¡Œæ›´æ–° å½“ Buffer Pool æœªå¯¹ç£ç›˜æ›´æ–°æ•°æ®æ—¶å®•æœºæ€ä¹ˆåŠï¼Ÿ ç­”ï¼šRedo Log \u0026 Undo Logï¼ˆåœ¨äº‹åŠ¡ç« èŠ‚ä¼šè¡¥å……ï¼‰ æŸ¥çœ‹ç¼“å†²æ± çš„å¤§å°ï¼š # æŸ¥çœ‹ InnoDB ç¼“å†²æ± å¤§å° show variables like 'innodb_buffer_pool_size'; # æŸ¥çœ‹ MyISAM ç¼“å†²æ± å¤§å° show variables like 'key_buffer_size'; è®¾ç½®ç¼“å†²æ± å¤§å°ï¼š é€šè¿‡å˜é‡è®¾ç½®ç¼“å†²æ± å¤§å°ä¸º 256MB : 256 * 1024 * 1024 = 268435456 set global innodb_buffer_pool_size = 268435456; é€šè¿‡é…ç½® my.cnf è®¾ç½®ç¼“å†²æ± å¤§å° [server] innodb_buffer_pool_size = 268435456 Buffer Pool å®ä¾‹ä¸ªæ•° å°†ç¼“å†²æ±  æ‹†åˆ† æˆè‹¥å¹²ä¸ªå° Buffer Pool ï¼Œè‹¥ Buffer Pool å¤§å°è®¾ç½®ä¸º 1GB å®ä¾‹ä¸ªæ•°è®¾ç½®ä¸º 2ï¼Œåˆ™æ¯ä¸ªå®ä¾‹å  512 MB å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿æ¥æ•°æ®åº“æ—¶ï¼Œè®©å…¶åˆ†åˆ«è®¿é—®å„è‡ªçš„ Buffer Pool é¿å…ä¸º Buffer Pool åŠ é”å½±å“æ€§èƒ½ é€šè¿‡é…ç½® my.cnf è®¾ç½® Buffer Pool å®ä¾‹ä¸ªæ•° [server] innodb_buffer_pool_instances = 2 Buffer Pool å®ä¾‹ä¸ªæ•°å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç®¡ç†å„ä¸ª Buffer Pool ä¹Ÿæ˜¯éœ€è¦æ€§èƒ½å¼€é”€çš„ï¼Œåœ¨ç¼“å†²æ± å†…å­˜å¤§å° \u003e 1GB æ—¶æ‰æœ‰æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:6:8","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#buffer-pool-å®ä¾‹ä¸ªæ•°"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ å­˜å‚¨å¼•æ“å®é™…ä¸Šå°±æ˜¯æŒ‡è¡¨çš„ç±»å‹ï¼Œä¹‹å‰å«è¡¨å¤„ç†å™¨ ç”¨äºæ¥å—ä¸Šå±‚ä¼ ä¸‹æ¥çš„æŒ‡ä»¤ï¼Œå¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œè¯»å–å’Œå†™å…¥çš„æ“ä½œ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“çš„æŸ¥çœ‹ä¸ä¿®æ”¹æŸ¥çœ‹æ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š show engines; æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼š show variables like '%storage_engine%'; #æˆ– SELECT @@default_storage_engine; ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼š é€šè¿‡è®¾ç½®å˜é‡è®¾ç½®é»˜è®¤å­˜å‚¨å¼•æ“ SET DEFAULT_STORAGE_ENGINE = MyISAM; é€šè¿‡ä¿®æ”¹ my.cnf è®¾ç½®é»˜è®¤å­˜å‚¨å¼•æ“ default-storage-engine = MyISAM # é‡å¯æœåŠ¡ systemctl restart mysqld.service åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡æ˜å­˜å‚¨å¼•æ“ï¼š CREATE TABLE è¡¨å( å»ºè¡¨è¯­å¥; ) ENGINE = å­˜å‚¨å¼•æ“åç§°; ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“ï¼š ALTER TABLE è¡¨å ENGINE = å­˜å‚¨å¼•æ“åç§°; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å¼•æ“çš„æŸ¥çœ‹ä¸ä¿®æ”¹"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­˜å‚¨å¼•æ“ä»‹ç»"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#innodb-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#myisam-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#archive-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#blackhole-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#csv-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#memory-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#federated-å¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mergeå¼•æ“"},{"categories":null,"content":"\rå­˜å‚¨å¼•æ“ä»‹ç»\rInnoDB å¼•æ“ å…·å¤‡ å¤–é”® æ”¯æŒåŠŸèƒ½çš„ äº‹åŠ¡ å­˜å‚¨å¼•æ“ï¼Œæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ ä» 3.23.34a ç‰ˆæœ¬å¼€å§‹åŒ…å« InnoDB å¼•æ“ï¼Œ5.5 å³ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨ InnoDB ä¼˜ç‚¹ï¼š æ”¯æŒå¤–é”® æ”¯æŒäº‹åŠ¡ï¼šäº‹åŠ¡çš„æäº¤ä¸å›æ»šã€‚è‹¥æœåŠ¡å™¨å´©æºƒï¼Œå¯ä»¥è‡ªåŠ¨çš„æ¢å¤å·²æäº¤çš„äº‹åŠ¡ï¼Œæ’¤é”€æœªæäº¤çš„äº‹åŠ¡ä¸éœ€è¦é¢å¤–çš„æ“ä½œ é¢‘ç¹çš„å¢åŠ æˆ–æŸ¥è¯¢æ“ä½œæ¨è MyISAMï¼Œé¢‘ç¹çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ¨è InnoDB ç›¸æ¯” MyISAM åªæ”¯æŒè¡¨çº§é”ï¼ŒInnoDB è¿˜æ”¯æŒè¡Œçº§é” ç¼ºç‚¹ï¼š ç›¸æ¯” MyISAMï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€ç‚¹ MyISAM åªç¼“å­˜ç´¢å¼•ï¼ŒInnoDB è¿˜ä¼šç¼“å­˜æ•°æ®ï¼Œæ‰€ä»¥å¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ MyISAM å¼•æ“ æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ æ˜¯ MySQL 5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ ä¼˜ç‚¹ï¼š é’ˆå¯¹äºå¢åŠ å’ŒæŸ¥è¯¢æ“ä½œï¼ŒMyISAM çš„é€Ÿåº¦æ›´å¿« æœ‰å¸¸é‡å­˜å‚¨æ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œcount(*) çš„æ•ˆç‡é«˜ ç¼ºç‚¹ï¼š ä¸æ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é” é€‚åˆæ•°æ®é‡å°çš„åœºæ™¯ä½¿ç”¨ï¼Œå´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ Archive å¼•æ“ archive (å½’æ¡£) ä¸»è¦è®¾è®¡ç”¨äºæ•°æ®å­˜æ¡£ï¼Œä»…æ”¯æŒæ’å…¥å’ŒæŸ¥è¯¢ä¸¤ç§åŠŸèƒ½ åœ¨ MySQL 5.5 ç‰ˆæœ¬åæ”¯æŒç´¢å¼• æ”¯æŒ zlib å‹ç¼©åº“ï¼Œç›¸åŒæ•°æ®é‡æ–‡ä»¶ä½“ç§¯æ¯” MyISAM å° 75% æ•°æ®æ–‡ä»¶åç¼€åä¸º .ARZ ï¼Œæ”¯æŒè¡Œçº§é” Blackhole å¼•æ“ ä¸¢å¼ƒå†™æ“ä½œï¼Œè¯»æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ ä¼šè®°å½•æ—¥å¿—ï¼Œä¸æ¨èä½¿ç”¨ CSV å¼•æ“ å­˜å‚¨æ•°æ®æ—¶ï¼Œä»¥é€—å·åˆ†éš”å„ä¸ªæ•°æ®é¡¹ã€‚ä¸æ”¯æŒ null æ•°æ® æ•°æ®æ–‡ä»¶åç¼€åä¸º .CSM .CSV å¯ä»¥ä½¿ç”¨ Excel æ‰“å¼€ç¼–è¾‘ Memory å¼•æ“ ç½®äºå†…å­˜çš„è¡¨ï¼Œè¡¨æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œè¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ è¦æ±‚æ•°æ®æ˜¯é•¿åº¦ä¸å˜çš„æ ¼å¼ï¼ŒBLOBã€TEXTç±»å‹çš„æ•°æ®ä¸å¯ç”¨ æŸ¥è¯¢é€Ÿåº¦æ¯” MyISAM å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œéœ€è¦è®¾ç½®é™åˆ¶è¡¨çš„å¤§å° åŒæ—¶æ”¯æŒ hash ç´¢å¼•ã€é»˜è®¤ã€‘å’Œ B+ æ ‘ç´¢å¼• é€šå¸¸åœ¨æ•°æ®é‡å°è®¿é—®é¢‘ç¹æ—¶ä½¿ç”¨ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®å³æ—¶ä½¿ç”¨æ—¶ä½¿ç”¨ Federated å¼•æ“ æ˜¯ä¸€ä¸ªè®¿é—®å…¶å®ƒ MySQL æ•°æ®åº“çš„ä»£ç†ï¼Œæä¾›è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ é—®é¢˜è¾ƒå¤šï¼Œé»˜è®¤è¢«ç¦ç”¨ Mergeå¼•æ“ ç®¡ç†å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ NDBå¼•æ“ MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“ ä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ndbå¼•æ“"},{"categories":null,"content":"\rå¸¸è§å­˜å‚¨å¼•æ“å¯¹æ¯” ç‰¹ç‚¹ MyISAM InnoDB MEMORY MERGE NDB å­˜å‚¨é™åˆ¶ æœ‰ 64TB æœ‰ æ²¡æœ‰ æœ‰ äº‹åŠ¡å®‰å…¨ æ”¯æŒ é”æœºåˆ¶ è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€æ¡è®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘çš„æ“ä½œ è¡¨é”ï¼Œè¡Œé”ï¼šæ“ä½œæ—¶åªé”æŸä¸€è¡Œï¼Œä¸å¯¹å…¶å®ƒè¡Œæœ‰å½±å“ï¼Œé€‚åˆé«˜å¹¶å‘çš„æ“ä½œ è¡¨é” è¡¨é” è¡Œé” Bæ ‘ç´¢å¼• æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ”¯æŒ å“ˆå¸Œç´¢å¼• æ”¯æŒ æ”¯æŒ å…¨æ–‡ç´¢å¼• æ”¯æŒ é›†ç¾¤ç´¢å¼• æ”¯æŒ æ•°æ®ç¼“å­˜ æ”¯æŒ æ”¯æŒ æ”¯æŒ ç´¢å¼•ç¼“å­˜ åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ® ä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ æ”¯æŒ æ”¯æŒ æ”¯æŒ æ•°æ®å¯å‹ç¼© æ”¯æŒ ç©ºé—´ä½¿ç”¨ ä½ é«˜ N/A ä½ ä½ å†…å­˜ä½¿ç”¨ ä½ é«˜ ä¸­ç­‰ ä½ é«˜ æ‰¹é‡ æ’å…¥ çš„é€Ÿåº¦ é«˜ ä½ é«˜ é«˜ é«˜ æ”¯æŒå¤–é”® æ”¯æŒ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¸¸è§å­˜å‚¨å¼•æ“å¯¹æ¯”"},{"categories":null,"content":"\rMyISAM ä¸ InnoDBå¯¹æ¯” å¯¹æ¯”é¡¹ MyISAM InnoDB å¤–é”® ä¸æ”¯æŒ æ”¯æŒ äº‹åŠ¡ ä¸æ”¯æŒ æ”¯æŒ è¡Œè¡¨é” è¡¨é”ï¼Œå³ä½¿æ“ä½œä¸€æ¡è®°å½•ä¹Ÿä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä¸é€‚åˆé«˜å¹¶å‘çš„æ“ä½œ è¡Œé”ï¼Œæ“ä½œæ—¶åªé”æŸä¸€è¡Œï¼Œä¸å¯¹å…¶å®ƒè¡Œæœ‰å½±å“ï¼Œé€‚åˆé«˜å¹¶å‘çš„æ“ä½œ ç¼“å­˜ åªç¼“å­˜ç´¢å¼•ï¼Œä¸ç¼“å­˜çœŸå®æ•°æ® ä¸ä»…ç¼“å­˜ç´¢å¼•è¿˜è¦ç¼“å­˜çœŸå®æ•°æ®ï¼Œå¯¹å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”å†…å­˜å¤§å°å¯¹æ€§èƒ½æœ‰å†³å®šæ€§çš„å½±å“ è‡ªå¸¦ç³»ç»Ÿè¡¨ä½¿ç”¨ Y N å…³æ³¨ç‚¹ æ€§èƒ½ï¼šèŠ‚çœèµ„æºã€æ¶ˆè€—å°‘ã€ç®€å•ä¸šåŠ¡ äº‹åŠ¡ï¼šå¹¶å‘å†™ã€äº‹åŠ¡ã€æ›´å¤§èµ„æº é»˜è®¤å®‰è£… Y Y é»˜è®¤ä½¿ç”¨ N Y ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#myisam-ä¸-innodbå¯¹æ¯”"},{"categories":null,"content":"\rè¯¾å¤–è¡¥å……1ã€InnoDB è¡¨çš„ä¼˜åŠ¿ InnoDB å­˜å‚¨å¼•æ“åœ¨å®é™…åº”ç”¨ä¸­æ‹¥æœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚æ“ä½œä¾¿åˆ©ã€æé«˜äº†æ•°æ®åº“çš„æ€§èƒ½ã€ç»´æŠ¤æˆæœ¬ä½ç­‰ã€‚å¦‚æœç”±äºç¡¬ä»¶æˆ–è½¯ä»¶çš„åŸå› å¯¼è‡´æœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆåœ¨é‡å¯æœåŠ¡å™¨ä¹‹åä¸éœ€è¦è¿›è¡Œé¢å¤–çš„æ“ä½œã€‚InnoDB å´©æºƒæ¢å¤åŠŸèƒ½è‡ªåŠ¨å°†ä¹‹å‰æäº¤çš„å†…å®¹å®šå‹ï¼Œç„¶åæ’¤é”€æ²¡æœ‰æäº¤çš„è¿›ç¨‹ï¼Œé‡å¯ä¹‹åç»§ç»­ä»å´©æºƒç‚¹å¼€å§‹æ‰§è¡Œã€‚ InnoDB å­˜å‚¨å¼•æ“åœ¨ä¸»å†…å­˜ä¸­ç»´æŠ¤ç¼“å†²æ± ï¼Œé«˜é¢‘ç‡ä½¿ç”¨çš„æ•°æ®å°†åœ¨å†…å­˜ä¸­ç›´æ¥è¢«å¤„ç†ã€‚è¿™ç§ç¼“å­˜æ–¹å¼åº”ç”¨äºå¤šç§ä¿¡æ¯ï¼ŒåŠ é€Ÿäº†å¤„ç†è¿›ç¨‹ã€‚ åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œç‰©ç†å†…å­˜ä¸­é«˜è¾¾80%çš„éƒ¨åˆ†è¢«åº”ç”¨äºç¼“å†²æ± ã€‚å¦‚æœéœ€è¦å°†æ•°æ®æ’å…¥ä¸åŒçš„è¡¨ä¸­ï¼Œå¯ä»¥è®¾ç½®å¤–é”®åŠ å¼ºæ•°æ®çš„å®Œæ•´æ€§ã€‚æ›´æ–°æˆ–è€…åˆ é™¤æ•°æ®ï¼Œå…³è”æ•°æ®å°†ä¼šè¢«è‡ªåŠ¨æ›´æ–°æˆ–åˆ é™¤ã€‚å¦‚æœè¯•å›¾å°†æ•°æ®æ’å…¥ä»è¡¨ï¼Œä½†åœ¨ä¸»è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œæ’å…¥çš„æ•°æ®å°†è¢«è‡ªåŠ¨ç§»é™¤ã€‚å¦‚æœç£ç›˜æˆ–å†…å­˜ä¸­çš„æ•°æ®å‡ºç°å´©æºƒï¼Œåœ¨ä½¿ç”¨è„æ•°æ®ä¹‹å‰ï¼Œæ ¡éªŒå’Œæœºåˆ¶ä¼šå‘å‡ºè­¦å‘Šã€‚å½“æ¯ä¸ªè¡¨çš„ä¸»é”®éƒ½è®¾ç½®åˆç†æ—¶ï¼Œä¸è¿™äº›åˆ—æœ‰å…³çš„æ“ä½œä¼šè¢«è‡ªåŠ¨ä¼˜åŒ–ã€‚æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œé€šè¿‡åšæ”¹å˜ç¼“å†²è‡ªåŠ¨æœºåˆ¶è¿›è¡Œä¼˜åŒ–ã€‚ InnoDB ä¸ä»…æ”¯æŒå½“å‰è¯»å†™ï¼Œä¹Ÿä¼šç¼“å†²æ”¹å˜çš„æ•°æ®åˆ°æ•°æ®æµç£ç›˜ ã€‚ InnoDB çš„æ€§èƒ½ä¼˜åŠ¿ä¸åªå­˜åœ¨äºé•¿æ—¶è¿è¡ŒæŸ¥è¯¢çš„å¤§å‹è¡¨ã€‚åœ¨åŒä¸€åˆ—å¤šæ¬¡è¢«æŸ¥è¯¢æ—¶ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ä¼šæé«˜æŸ¥è¯¢çš„é€Ÿåº¦ã€‚ä½¿ç”¨ InnoDB å¯ä»¥å‹ç¼©è¡¨å’Œç›¸å…³çš„ç´¢å¼•ï¼Œå¯ä»¥ åœ¨ä¸å½±å“æ€§èƒ½å’Œå¯ç”¨æ€§çš„æƒ…å†µä¸‹åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼• ã€‚å¯¹äºå¤§å‹æ–‡æœ¬å’Œ BLOB æ•°æ®ï¼Œä½¿ç”¨åŠ¨æ€è¡Œå½¢å¼ï¼Œè¿™ç§å­˜å‚¨å¸ƒå±€æ›´é«˜æ•ˆã€‚é€šè¿‡æŸ¥è¯¢ INFORMATION_SCHEMA åº“ä¸­çš„è¡¨å¯ä»¥ç›‘æ§å­˜å‚¨å¼•æ“çš„å†…éƒ¨å·¥ä½œã€‚åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­ï¼ŒInnoDB è¡¨å¯ä»¥ä¸å…¶ä»–å­˜å‚¨å¼•æ“è¡¨æ··ç”¨ã€‚å³ä½¿æœ‰äº›æ“ä½œç³»ç»Ÿé™åˆ¶æ–‡ä»¶å¤§å°ä¸º 2GBï¼ŒInnoDB ä»ç„¶å¯ä»¥å¤„ç†ã€‚ å½“å¤„ç†å¤§æ•°æ®é‡æ—¶,InnoDB å…¼é¡¾ CPU,ä»¥è¾¾åˆ°æœ€å¤§æ€§èƒ½ ã€‚ 2ã€InnoDB å’Œ ACID æ¨¡å‹ ACID æ¨¡å‹æ˜¯ä¸€ç³»åˆ—æ•°æ®åº“è®¾è®¡è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç€é‡å¼ºè°ƒå¯é æ€§ï¼Œè€Œå¯é æ€§å¯¹äºå•†ä¸šæ•°æ®å’Œä»»åŠ¡å…³é”®å‹åº”ç”¨éå¸¸é‡è¦ã€‚MySQL åŒ…å«ç±»ä¼¼InnoDB å­˜å‚¨å¼•æ“çš„ç»„ä»¶ï¼Œä¸ ACID æ¨¡å‹ç´§å¯†ç›¸è¿ï¼Œè¿™æ ·å‡ºç°æ„å¤–æ—¶ï¼Œæ•°æ®ä¸ä¼šå´©æºƒï¼Œç»“æœä¸ä¼šå¤±çœŸã€‚å¦‚æœä¾èµ– ACID æ¨¡å‹ï¼Œå¯ä»¥ä¸ä½¿ç”¨ä¸€è‡´æ€§æ£€æŸ¥å’Œå´©æºƒæ¢å¤æœºåˆ¶ã€‚å¦‚æœæ‹¥æœ‰é¢å¤–çš„è½¯ä»¶ä¿æŠ¤ï¼Œæå¯é çš„ç¡¬ä»¶æˆ–è€…åº”ç”¨å¯ä»¥å®¹å¿ä¸€å°éƒ¨åˆ†çš„æ•°æ®ä¸¢å¤±å’Œä¸ä¸€è‡´ï¼Œå¯ä»¥å°† MySQL è®¾ç½®è°ƒæ•´ä¸ºåªä¾èµ–éƒ¨åˆ† ACID ç‰¹æ€§ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½ã€‚ä¸‹é¢è®²è§£ InnoDB å­˜å‚¨å¼•æ“ä¸ ACID æ¨¡å‹ç›¸åŒä½œç”¨çš„å››ä¸ªæ–¹é¢ã€‚ åŸå­æ–¹é¢ ACID çš„åŸå­æ–¹é¢ä¸»è¦æ¶‰åŠ InnoDB äº‹åŠ¡ï¼Œä¸ MySQL ç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š è‡ªåŠ¨æäº¤è®¾ç½®ã€‚ COMMIT è¯­å¥ã€‚ ROLLBACK è¯­å¥ã€‚ æ“ä½œ INFORMATION_SCHEMA åº“ä¸­çš„è¡¨æ•°æ®ã€‚ ä¸€è‡´æ€§æ–¹é¢ ACID æ¨¡å‹çš„ä¸€è‡´æ€§ä¸»è¦æ¶‰åŠä¿æŠ¤æ•°æ®ä¸å´©æºƒçš„å†…éƒ¨ InnoDB å¤„ç†è¿‡ç¨‹ï¼Œä¸ MySQL ç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š InnoDB åŒå†™ç¼“å­˜ã€‚ InnoDB å´©æºƒæ¢å¤ã€‚ éš”ç¦»æ–¹é¢ éš”ç¦»æ˜¯åº”ç”¨äºäº‹åŠ¡çš„çº§åˆ«ï¼Œä¸ MySQL ç›¸å…³çš„ç‰¹æ€§ä¸»è¦åŒ…æ‹¬ï¼š è‡ªåŠ¨æäº¤è®¾ç½®ã€‚ SET ISOLATION LEVEL è¯­å¥ã€‚ InnoDB é”çš„ä½çº§åˆ«ä¿¡æ¯ã€‚ è€ä¹…æ€§æ–¹é¢ ACID æ¨¡å‹çš„è€ä¹…æ€§ä¸»è¦æ¶‰åŠä¸ç¡¬ä»¶é…ç½®ç›¸äº’å½±å“çš„ MySQL è½¯ä»¶ç‰¹æ€§ã€‚ç”±äºç¡¬ä»¶å¤æ‚å¤šæ ·åŒ–ï¼Œè€ä¹…æ€§æ–¹é¢æ²¡æœ‰å…·ä½“çš„è§„åˆ™å¯å¾ªã€‚ä¸ MySQL ç›¸å…³çš„ç‰¹æ€§æœ‰ï¼š InnoDB åŒå†™ç¼“å­˜ï¼Œé€šè¿‡ innodb_doublewrite é…ç½®é¡¹é…ç½®ã€‚ é…ç½®é¡¹ innodb_flush_log_at_trx_commitã€‚ é…ç½®é¡¹ sync_binlogã€‚ é…ç½®é¡¹ innodb_file_per_tableã€‚ å­˜å‚¨è®¾å¤‡çš„å†™å…¥ç¼“å­˜ã€‚ å­˜å‚¨è®¾å¤‡çš„å¤‡ç”¨ç”µæ± ç¼“å­˜ã€‚ è¿è¡Œ MySQL çš„æ“ä½œç³»ç»Ÿã€‚ æŒç»­çš„ç”µåŠ›ä¾›åº”ã€‚ å¤‡ä»½ç­–ç•¥ã€‚ å¯¹åˆ†å¸ƒå¼æˆ–æ‰˜ç®¡çš„åº”ç”¨ï¼Œæœ€ä¸»è¦çš„åœ¨äºç¡¬ä»¶è®¾å¤‡çš„åœ°ç‚¹ä»¥åŠç½‘ç»œæƒ…å†µã€‚ 3ã€InnoDB æ¶æ„ ç¼“å†²æ±  ç¼“å†²æ± æ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œç”¨æ¥ç¼“å­˜å·²ä½¿ç”¨çš„è¡¨å’Œç´¢å¼•æ•°æ®ã€‚ç¼“å†²æ± ä½¿å¾—ç»å¸¸è¢«ä½¿ç”¨çš„æ•°æ®èƒ½å¤Ÿç›´æ¥åœ¨å†…å­˜ä¸­è·å¾—ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚ æ›´æ”¹ç¼“å­˜ æ›´æ”¹ç¼“å­˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå½“å—å½±å“çš„ç´¢å¼•é¡µä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œæ›´æ”¹ç¼“å­˜ä¼šç¼“å­˜è¾…åŠ©ç´¢å¼•é¡µçš„æ›´æ”¹ã€‚ç´¢å¼•é¡µè¢«å…¶ä»–è¯»å–æ“ä½œæ—¶ä¼šåŠ è½½åˆ°ç¼“å­˜æ± ï¼Œç¼“å­˜çš„æ›´æ”¹å†…å®¹å°±ä¼šè¢«åˆå¹¶ã€‚ä¸åŒäºé›†ç¾¤ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•å¹¶éç‹¬ä¸€æ— äºŒçš„ã€‚å½“ç³»ç»Ÿå¤§éƒ¨åˆ†é—²ç½®æ—¶ï¼Œæ¸…é™¤æ“ä½œä¼šå®šæœŸè¿è¡Œï¼Œå°†æ›´æ–°çš„ç´¢å¼•é¡µåˆ·å…¥ç£ç›˜ã€‚æ›´æ–°ç¼“å­˜åˆå¹¶æœŸé—´ï¼Œå¯èƒ½ä¼šå¤§å¤§é™ä½æŸ¥è¯¢çš„æ€§èƒ½ã€‚åœ¨å†…å­˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜å ç”¨ä¸€éƒ¨åˆ† InnoDB ç¼“å†²æ± ã€‚åœ¨ç£ç›˜ä¸­ï¼Œæ›´æ–°ç¼“å­˜æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚æ›´æ–°ç¼“å­˜çš„æ•°æ®ç±»å‹ç”± innodb_change_buffering é…ç½®é¡¹ç®¡ç†ã€‚ è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å°†è´Ÿè½½å’Œè¶³å¤Ÿçš„å†…å­˜ç»“åˆèµ·æ¥ï¼Œä½¿å¾— InnoDB åƒå†…å­˜æ•°æ®åº“ä¸€æ ·è¿è¡Œï¼Œ ä¸éœ€è¦é™ä½äº‹åŠ¡ä¸Šçš„æ€§èƒ½æˆ–å¯é æ€§ã€‚è¿™ä¸ªç‰¹æ€§é€šè¿‡ innodb_adaptive_hash_index é€‰é¡¹é…ç½®ï¼Œæˆ–è€…é€šè¿‡ -skip-innodb_adaptive_hash_index å‘½ä»¤è¡Œåœ¨æœåŠ¡å¯åŠ¨æ—¶å…³é—­ã€‚ é‡åšæ—¥å¿—ç¼“å­˜ é‡åšæ—¥å¿—ç¼“å­˜å­˜æ”¾è¦æ”¾å…¥é‡åšæ—¥å¿—çš„æ•°æ®ã€‚é‡åšæ—¥å¿—ç¼“å­˜å¤§å°é€šè¿‡ innodb_log_buffer_size é…ç½®é¡¹é…ç½®ã€‚é‡åšæ—¥å¿—ç¼“å­˜ä¼šå®šæœŸåœ°å°†æ—¥å¿—æ–‡ä»¶åˆ·å…¥ç£ç›˜ã€‚å¤§å‹çš„é‡åšæ—¥å¿—ç¼“å­˜ä½¿å¾—å¤§å‹äº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œè€Œä¸éœ€è¦å†™å…¥ç£ç›˜ã€‚ ç³»ç»Ÿè¡¨ç©ºé—´ ç³»ç»Ÿè¡¨ç©ºé—´åŒ…æ‹¬ InnoDB æ•°æ®å­—å…¸ã€åŒå†™ç¼“å­˜ã€æ›´æ–°ç¼“å­˜å’Œæ’¤é”€æ—¥å¿—ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬è¡¨å’Œç´¢å¼• æ•°æ®ã€‚å¤šè¡¨å…±äº«ï¼Œç³»ç»Ÿè¡¨ç©ºé—´è¢«è§†ä¸ºå…±äº«è¡¨ç©ºé—´ã€‚ åŒå†™ç¼“å­˜ åŒå†™ç¼“å­˜ä½äºç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œç”¨äºå†™å…¥ä»ç¼“å­˜æ± åˆ·æ–°çš„æ•°æ®é¡µã€‚åªæœ‰åœ¨åˆ·æ–°å¹¶å†™å…¥åŒå†™ç¼“å­˜åï¼ŒInnoDB æ‰ä¼šå°†æ•°æ®é¡µå†™å…¥åˆé€‚çš„ä½ç½®ã€‚ æ’¤é”€æ—¥å¿— æ’¤é”€æ—¥å¿—æ˜¯ä¸€ç³»åˆ—ä¸äº‹åŠ¡ç›¸å…³çš„æ’¤é”€è®°å½•çš„é›†åˆï¼ŒåŒ…å«å¦‚ä½•æ’¤é”€äº‹åŠ¡æœ€è¿‘çš„æ›´æ”¹ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡è¦æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œå¯ä»¥ä»æ’¤é”€æ—¥å¿—è®°å½•ä¸­è¿½æº¯æœªæ›´æ”¹çš„æ•°æ®ã€‚æ’¤é”€æ—¥å¿—å­˜åœ¨äºæ’¤é”€æ—¥å¿—ç‰‡æ®µä¸­ï¼Œè¿™äº›ç‰‡æ®µåŒ…å«äºå›æ»šç‰‡æ®µä¸­ã€‚ æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´ æ¯ä¸ªè¡¨ä¸€ä¸ªæ–‡ä»¶çš„è¡¨ç©ºé—´æ˜¯æŒ‡æ¯ä¸ªå•ç‹¬çš„è¡¨ç©ºé—´åˆ›å»ºåœ¨è‡ªèº«çš„æ•°æ®æ–‡ä»¶ä¸­ï¼Œ è€Œä¸æ˜¯ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡ innodb_file_per_table é…ç½®é¡¹å¼€å¯ã€‚æ¯ä¸ªè¡¨ç©ºé—´ç”±ä¸€ä¸ªå•ç‹¬çš„ .ibd æ•°æ®æ–‡ä»¶ä»£è¡¨ï¼Œè¯¥æ–‡ä»¶é»˜è®¤è¢«åˆ›å»ºåœ¨æ•°æ®åº“ç›®å½•ä¸­ã€‚ é€šç”¨è¡¨ç©ºé—´ ä½¿ç”¨ CREATE TABLESPACE è¯­æ³•åˆ›å»ºå…±äº«çš„ InnoDB è¡¨ç©ºé—´ã€‚é€šç”¨è¡¨ç©ºé—´å¯ä»¥åˆ›å»ºåœ¨ MySQL æ•°æ®ç›®å½•ä¹‹å¤–èƒ½å¤Ÿç®¡ç†å¤šä¸ªè¡¨å¹¶æ”¯æŒæ‰€æœ‰è¡Œæ ¼å¼çš„è¡¨ã€‚ æ’¤é”€è¡¨ç©ºé—´ æ’¤é”€è¡¨ç©ºé—´ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«æ’¤é”€æ—¥å¿—çš„æ–‡ä»¶ç»„æˆã€‚æ’¤é”€è¡¨ç©ºé—´çš„æ•°é‡ç”± innodb_undo_tablespaces é…ç½®é¡¹é…ç½®ã€‚ ä¸´æ—¶è¡¨ç©ºé—´ ç”¨æˆ·åˆ›å»ºçš„ä¸´æ—¶è¡¨ç©ºé—´å’ŒåŸºäºç£ç›˜çš„å†…éƒ¨ä¸´æ—¶è¡¨éƒ½åˆ›å»ºäºä¸´æ—¶è¡¨ç©ºé—´ã€‚innodb_temp_data_file_path é…ç½®é¡¹å®šä¹‰äº†ç›¸å…³çš„è·¯å¾„ã€åç§°ã€å¤§å°å’Œå±æ€§ã€‚å¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œé»˜è®¤ä¼šåœ¨ innodb_data_home_dir å˜é‡æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ‰©å±•çš„æ•°æ®æ–‡ä»¶ã€‚ é‡åšæ—¥å¿— é‡åšæ—¥å¿—æ˜¯åŸºäºç£ç›˜çš„æ•°æ®ç»“æ„ï¼Œåœ¨å´©æºƒæ¢å¤æœŸé—´ä½¿ç”¨ï¼Œç”¨æ¥çº æ­£æ•°æ®ã€‚æ­£å¸¸æ“ä½œæœŸé—´ï¼Œ é‡åšæ—¥å¿—ä¼šå°†è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œè¿™äº›è¯·æ±‚ä¼šæ”¹å˜ InnoDB è¡¨æ•°æ®ã€‚é‡åˆ°æ„å¤–å´©æºƒåï¼Œæœªå®Œæˆçš„æ›´æ”¹ä¼šè‡ªåŠ¨åœ¨åˆå§‹åŒ–æœŸé—´é‡æ–°è¿›è¡Œã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:7:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¯¾å¤–è¡¥å……"},{"categories":null,"content":"\rç´¢å¼•çš„æ•°æ®ç»“æ„ ç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“ç”¨äºå¿«é€Ÿæ‰¾åˆ°æ•°æ®è®°å½•çš„ä¸€ç§æ•°æ®ç»“æ„ ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“ä¸­å®ç°çš„ ç´¢å¼•çš„ä¼˜ç‚¹ï¼š ç”¨äºå‡å°‘ç£ç›˜çš„ I/O æ¬¡æ•°ï¼Œé¿å…å…¨è¡¨æ‰«æ åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œä¿è¯æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ å¯¹äºæœ‰ä¾èµ–å…³ç³»çš„è¡¨ä¹‹é—´å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºæ—¶é—´ï¼Œé™ä½ CPU æ¶ˆè€— ç´¢å¼•çš„ç¼ºç‚¹ï¼š åˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•éƒ½è¦æ¶ˆè€—æ—¶é—´ ç´¢å¼•éœ€è¦å ç”¨ç£ç›˜ç©ºé—´ï¼ˆæ¯ä¸ªæ•°æ®é¡µé»˜è®¤å ç”¨ 16KB ç©ºé—´ï¼‰ ç´¢å¼•ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå› ä¸ºå½“æ•°æ®æ›´æ”¹æ—¶ç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ ä½¿ç”¨ç´¢å¼•ä¹‹å‰ï¼š æŸ¥æ‰¾ä¸€æ¡æ•°æ®ï¼Œéœ€è¦å…ˆç¡®è®¤æ•°æ®å­˜åœ¨çš„æ•°æ®é¡µï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªæ•°æ®é¡µæ²¿ç€ åŒå‘é“¾è¡¨ ä¸€ç›´å¾€ä¸‹æ‰¾ æ‰¾åˆ°æ•°æ®å¯¹åº”çš„æ•°æ®é¡µå å¦‚æœå·²ä¸»é”®ä½œä¸ºæœç´¢æ¡ä»¶ï¼šä½¿ç”¨ äºŒåˆ†æ³• å¿«é€ŸæŸ¥æ‰¾ å¦‚æœå·²å…¶ä»–åˆ—ä½œä¸ºæœç´¢æ¡ä»¶ï¼šä»æœ€å°è®°å½•å¼€å§‹ä¾æ¬¡éå† å•é“¾è¡¨ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•çš„æ•°æ®ç»“æ„"},{"categories":null,"content":"\rç´¢å¼•è®¾è®¡çš„è¿­ä»£è¿‡ç¨‹ä¸€ä¸ªç®€å•çš„ç´¢å¼•è®¾è®¡æ¡ˆä¾‹ï¼š åˆ›å»ºä¸€ä¸ª è¡Œæ ¼å¼ ä¸º Compact çš„ä»¥ c1 ä¸ºä¸»é”®çš„è¡¨ index_demo CREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY(c1) ) ROW_FORMAT = Compact; Compact è¡Œæ ¼å¼å­˜å‚¨çš„ä¸€è¡Œè®°å½• record_type ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ï¼Œ 0 è¡¨ç¤ºæ™®é€šè®°å½•ã€ 2 è¡¨ç¤ºæœ€å°è®° å½•ã€ 3 è¡¨ç¤ºæœ€å¤§è®°å½•ã€ 1 ä¸‹é¢è®² next_record ï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¡åœ°å€ç›¸å¯¹äºæœ¬æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œæˆ‘ä»¬ç”¨ç®­å¤´æ¥è¡¨æ˜ä¸‹ä¸€æ¡è®°å½•æ˜¯è° å„ä¸ªåˆ—çš„å€¼ ï¼šè¿™é‡Œåªè®°å½•åœ¨ index_demo è¡¨ä¸­çš„ä¸‰ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯ c1 ã€ c2 å’Œ c3 å…¶ä»–ä¿¡æ¯ ï¼šé™¤äº†ä¸Šè¿° 3 ç§ä¿¡æ¯ä»¥å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–éšè—åˆ—çš„å€¼ä»¥åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ æ­¤æ—¶å‘è¡¨ä¸­æ’å…¥ä¸‰æ¡æ•°æ®ï¼Œæ•°æ®è¢«æ’å…¥åˆ°æ•°æ®é¡µ 10 ä¸­ insert into index_demo values(1, 4, 'u'), (3, 9, 'd'), (5, 3, 'y'); å‡è®¾é¡µ 10 æœ€å¤šåªèƒ½å­˜æ”¾ 3 æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ–°æ’å…¥çš„æ•°æ®å°±è¢«å­˜æ”¾åˆ°äº†ä¸€ä¸ªæ–°çš„æ•°æ®é¡µä¸­ ç”±äºæ’å…¥çš„æ–°æ•°æ®ä½¿å¾— c1 åˆ—ä¸ç¬¦åˆä¸»é”®å€¼å¾—è¦æ±‚ï¼Œéœ€è¦è¿›è¡Œè®°å½•ç§»åŠ¨ã€é¡µåˆ†è£‚ã€‘ ç”±äºè¿™äº› 16KB æ•°æ®é¡µæ˜¯ä¸è¿ç»­çš„ï¼Œå½“æ•°æ®é‡å¤§æ—¶æ— æ³•å¿«é€Ÿå®šä½æ•°æ®æ‰€åœ¨çš„æ•°æ®é¡µ æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨æ¯é¡µä¸­ä¸»é”®æœ€å°çš„å€¼ä½œä¸º key å»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œå½“æŸ¥è¯¢ä¸€ä¸ªæ•°æ®æ—¶å¯ä»¥å¿«é€Ÿå®šä½æ•°æ®é¡µï¼Œä¹‹åå¯ä»¥å†ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾æ•°æ® ç´¢å¼•è®¾è®¡ç¬¬ä¸€æ¬¡è¿­ä»£ï¼š å½“æ•°æ®é¡µä¸æ–­å¢åŠ å¯¹åº”çš„ç›®å½•é¡¹ä¹Ÿåœ¨ä¸æ–­å¢åŠ ï¼Œæ­¤æ—¶å°†ç›®å½•é¡¹æ”¾åˆ°ç›®å½•é¡µä¸­ æ­¤æ—¶å¦‚æœå‘æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œå°±å¯ä»¥å…ˆå¯¹ é¡µç›®å½• ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾åˆ°å¯¹åº”çš„ç›®å½•é¡µï¼Œå³å¯åœ¨ç›®å½•é¡µå¯¹åº”çš„æ•°æ®é¡µä¸­æŸ¥æ‰¾ æ­¤æ—¶ä»…éœ€è¦å‘ç¡¬ç›˜è¯»å–ç›®å½•é¡µå’Œæ•°æ®é¡µä¸¤æ¬¡ I/O å³å¯æ‰¾åˆ°æƒ³è¦çš„æ•°æ® ç´¢å¼•è®¾è®¡ç¬¬äºŒæ¬¡è¿­ä»£ï¼š ä½¿ç”¨å¤šä¸ªç›®å½•é¡µè¿æ¥æ•°æ®é¡µ ç´¢å¼•è®¾è®¡ç¬¬ä¸‰æ¬¡è¿­ä»£ï¼š å½“ç›®å½•é¡µå¤§äº 1 æ—¶ç”Ÿæˆæ›´é«˜ä¸€çº§çš„ç›®å½•é¡µï¼Œè¿™ä¸ªç»“æ„å°±æ˜¯ B+ æ ‘ B+ æ ‘ï¼š å¦‚æœæ¯ä¸ªæ•°æ®é¡µå¯ä»¥å­˜æ”¾ 100 æ¡æ•°æ®ï¼Œæ¯ä¸ªç›®å½•é¡µå¯ä»¥å­˜æ”¾ 1000 æ¡æ•°æ® å½“ B+ æ ‘æœ‰ä¸€å±‚ï¼Œå¯ä»¥å­˜æ”¾ 100 æ¡æ•°æ® å½“ B+ æ ‘æœ‰ä¸¤å±‚ï¼Œå¯ä»¥å­˜æ”¾ 1000 * 100 æ¡æ•°æ® å½“ B+ æ ‘æœ‰ä¸‰å±‚ï¼Œå¯ä»¥å­˜æ”¾ 1000 * 1000 * 100 ä¸€äº¿æ¡æ•°æ® å½“ B+ æ ‘æœ‰ N å±‚ï¼Œå¯ä»¥å­˜æ”¾ 1000n-1 * 100 æ¡æ•°æ® ä¸€èˆ¬æƒ…å†µ B+ æ ‘çš„å±‚æ•°ä¸ä¼šè¶…è¿‡ 4 å±‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•è®¾è®¡çš„è¿­ä»£è¿‡ç¨‹"},{"categories":null,"content":"\rç´¢å¼•çš„å¸¸è§æ¦‚å¿µ èšç°‡ç´¢å¼• ã€èšç°‡ã€‘è¡¨ç¤ºæ•°æ®è¡Œå’Œç›¸é‚»çš„é”®å€¼èšç°‡æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ã€‚ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼• InnoDB æ”¯æŒï¼ŒMyISAM ä¸æ”¯æŒ èšç°‡ç´¢å¼• å¦‚æœæ²¡æœ‰æ˜¾å¼çš„å®šä¹‰ä¸»é”®ï¼ŒInnoDB ä¼šéšå¼çš„å®šä¹‰ä¸€ä¸ªä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼• æ•°æ®é¡µå†…ä½¿ç”¨å•å‘é“¾è¡¨ï¼Œæ•°æ®é¡µé—´ä½¿ç”¨åŒå‘é“¾è¡¨ ç›®å½•é¡µåˆ†ä¸ºä¸åŒå±‚ï¼Œæ¯ä¸€å±‚å†…çš„ç›®å½•é¡µé—´ä½¿ç”¨åŒå‘é“¾è¡¨ ä¼˜ç‚¹ï¼š è®¿é—®é€Ÿåº¦å¿«ï¼Œèšç°‡ç´¢å¼•å°†æ•°æ®å’Œç´¢å¼•å­˜å‚¨åœ¨ä¸€ä¸ª B+ æ ‘ï¼Œåœ¨æŸ¥è¯¢æ—¶ä¸éœ€è¦å›è¡¨ å¯¹äºä¸»é”®çš„ æ’åºæŸ¥æ‰¾ å’Œ èŒƒå›´æŸ¥æ‰¾ çš„é€Ÿåº¦å¾ˆå¿« èŠ‚çœå¤§é‡ I/O æ“ä½œ ç¼ºç‚¹ï¼š æ’å…¥çš„é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºï¼Œæ¨èä½¿ç”¨è‡ªå¢é•¿ä¸»é”® æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜ äºŒçº§ç´¢å¼•éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œéœ€è¦å…ˆæ‰¾åˆ°ä¸»é”®å€¼å†æ ¹æ®ä¸»é”®å€¼æŸ¥æ‰¾æ•°æ® äºŒçº§ç´¢å¼• (è¾…åŠ©ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•) å½“æˆ‘ä»¬ä¸ºéä¸»é”®å­—æ®µæ·»åŠ ç´¢å¼•æ—¶ï¼Œè¿™ä¸ªç´¢å¼•å°±æ˜¯äºŒçº§ç´¢å¼•ï¼Œä¼šæ ¹æ®è¿™ä¸ªéä¸»é”®çš„å­—æ®µå†æ„å»ºä¸€ä¸ª B+ æ ‘ ã€å›è¡¨ã€‘åœ¨ä»¥éä¸»é”®å­—æ®µæŸ¥è¯¢åˆ°äº†æ•°æ®ä¹‹åï¼Œè¿˜éœ€è¦æ ¹æ®å¯¹åº”çš„ä¸»é”®å­—æ®µåœ¨ä¸»é”® B+ æ ‘èšç°‡ç´¢å¼•å†æ¬¡æŸ¥è¯¢ è”åˆç´¢å¼• è”åˆç´¢å¼•ä¹Ÿå±äºéèšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªè”åˆç´¢å¼•æœ€å¤šåŒ…æ‹¬ 16 ä¸ªå­—æ®µ è”åˆç´¢å¼•åªä¼šåˆ›å»ºä¸€é¢— B+ æ ‘ï¼Œåœ¨æŸ¥è¯¢æ—¶ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªå­—æ®µæŸ¥è¯¢ï¼Œæ‰¾åˆ°åå†æ ¹æ®ç¬¬äºŒä¸ªå­—æ®µæŸ¥è¯¢â€¦ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•çš„å¸¸è§æ¦‚å¿µ"},{"categories":null,"content":"\rInnoDB çš„ B+ æ ‘ç´¢å¼• æ ¹é¡µé¢ä½ç½®ä¸‡å¹´ä¸åŠ¨ æ•°æ®åº“åœ¨ç”Ÿæˆ B+ æ ‘æ—¶å®é™…ä¸Šæ˜¯å…ˆç”Ÿæˆæ ¹ç›®å½•é¡µ å½“ç›®å½•é¡µçš„å±‚æ•°ä¸è¶³ä¼šå…ˆå°†æ•°æ®é¡µå¤åˆ¶èµ°ï¼Œç„¶åå°†åŸæ•°æ®é¡µå˜æˆç›®å½•é¡µ å†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§ åœ¨äºŒçº§ç´¢å¼•çš„ç›®å½•é¡µä¸­ä¹Ÿä¼šä¿å­˜ä¸»é”®çš„å€¼ï¼Œä¸ºäº†ä¿è¯æŒ‡å‘çš„å”¯ä¸€æ€§ ä¸€ä¸ªé¡µé¢æœ€å°‘å­˜å‚¨2æ¡è®°å½• æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤ä¸ªåˆ†æ”¯æ‰å¤åˆæ ‘çš„æ•°æ®ç»“æ„ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#innodb-çš„-b-æ ‘ç´¢å¼•"},{"categories":null,"content":"\rMyISAM çš„ B+ æ ‘ç´¢å¼• MyISAM å¼•æ“ä¸­ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€å­˜æ”¾çš„ .MYD .MYI MyISAM ä¸æ”¯æŒèšç°‡ç´¢å¼•åªæ”¯æŒäºŒçº§ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨ ä¸»é”®å€¼ + æ•°æ®è®°å½•åœ°å€ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#myisam-çš„-b-æ ‘ç´¢å¼•"},{"categories":null,"content":"\rInnoDB å’Œ MyISAM ç´¢å¼•çš„åŒºåˆ« åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œä»…éœ€æ ¹æ®ä¸»é”®å€¼å¯¹ èšç°‡ç´¢å¼• è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨ MyISAM ä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡ å›è¡¨ æ“ä½œï¼Œæ„å‘³ç€ MyISAM ä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯ äºŒçº§ç´¢å¼• ã€‚ InnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€Œ MyISAM ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯ åˆ†ç¦»çš„ ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚ InnoDB çš„éèšç°‡ç´¢å¼• data åŸŸå­˜å‚¨ç›¸åº”è®°å½• ä¸»é”®çš„å€¼ ï¼Œè€Œ MyISAM ç´¢å¼•è®°å½•çš„æ˜¯ åœ°å€ ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDB çš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸º data åŸŸã€‚ MyISAM çš„å›è¡¨æ“ä½œæ˜¯ååˆ† å¿«é€Ÿ çš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚ InnoDB æ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚ InnoDB è¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆ MyISAM å¯ä»¥æ²¡æœ‰ ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™ MySQL ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥éç©ºä¸”å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™ MySQL è‡ªåŠ¨ä¸º InnoDB è¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º 6 å­—èŠ‚ï¼Œç±»å‹ä¸º é•¿æ•´å‹ ã€‚ ä¸è¦ä¸ºä¸»é”®è®¾ç½®è¿‡é•¿çš„å­—æ®µ æ¨èä½¿ç”¨è‡ªå¢é•¿ä¸»é”®è€Œä¸æ˜¯ UUID ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#innodb-å’Œ-myisam-ç´¢å¼•çš„åŒºåˆ«"},{"categories":null,"content":"\ræ•°æ®ç»“æ„é€‰æ‹© ç´¢å¼•çš„æ•°æ®ç»“æ„é€‰æ‹©çš„åŸåˆ™æ˜¯ å¯¹ç¡¬ç›˜çš„ I/O æ¬¡æ•° ä¸å¯èƒ½æ¯æ¬¡éƒ½åŠ è½½å…¨éƒ¨æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œåªèƒ½ é€ä¸€åŠ è½½ å…¨è¡¨éå†ï¼š ç£ç›˜ I/O æ¬¡æ•°å¤šï¼Œé€Ÿåº¦ææ…¢ Hash ç»“æ„ï¼š Hash å‡½æ•°ä¹Ÿç§°æ•£åˆ—å‡½æ•°ï¼Œç›¸åŒçš„è¾“å…¥æ°¸è¿œå¯ä»¥å¾—åˆ°ç›¸åŒçš„è¾“å‡º Hash ç®—æ³•çš„å¤æ‚åº¦ä¸º O(1) ï¼Œé€Ÿåº¦è¾ƒ B+ å¿«å¾ˆå¤š ä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡ç”¨ Hash è€Œæ˜¯ B+ ? Hash ä»…èƒ½æ»¡è¶³ ==ã€\u003c\u003eã€in æŸ¥è¯¢ï¼Œå¦‚æœè¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œ B+ æ ‘çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log2N) Hash çš„å­˜å‚¨æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œä½¿ç”¨ order by æ—¶è¿˜éœ€è¦é‡æ–°æ’åº å¯¹äºè”åˆç´¢å¼•ï¼ŒHash ä¼šå°†ç´¢å¼•é”®åˆå¹¶åå†è®¡ç®—ï¼Œæ— æ³•å¯¹å•ç‹¬çš„é”®è®¡ç®— å¦‚æœç´¢å¼•åˆ—çš„é‡å¤å€¼æ¯”è¾ƒå¤šï¼Œæ•ˆç‡ä¼šé™ä½ å¼€å¯ è‡ªé€‚åº” Hash ç´¢å¼• æ–¹ä¾¿æ ¹æ® SQL çš„æŸ¥è¯¢æ¡ä»¶åŠ é€Ÿå®šä½åˆ°å¶å­èŠ‚ç‚¹ # æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†è‡ªé€‚åº” Hash ç´¢å¼•ï¼Œé»˜è®¤ä¸º on show variables like '%adaptive_hash_index'; äºŒå‰æœç´¢æ ‘ï¼š å·¦èŠ‚ç‚¹ \u003c æœ¬èŠ‚ç‚¹ï¼ŒåˆèŠ‚ç‚¹ \u003e= æœ¬èŠ‚ç‚¹ ä½¿ç”¨äºŒå‰æœç´¢æ ‘åº”å°½å¯èƒ½çš„é™ä½æ ‘çš„é«˜åº¦ï¼Œè®©æ ‘å˜å¾—çŸ®èƒ–ï¼Œç”±æ­¤é™ä½å¯¹ç£ç›˜çš„ I/O æ¬¡æ•° AVL æ ‘ï¼š å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®ä¸èƒ½è¶…è¿‡ 1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ é‡‡ç”¨ M å‰æ ‘ (M \u003e 2)ï¼Œé™ä½æ ‘çš„å±‚æ•°å‡å°‘ I/O æ¬¡æ•° B-Tree B æ ‘ï¼š å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸¤ä¸ªå€¼ï¼Œé€šè¿‡æ¯”å¯¹å€¼çš„ \u003c \u003c= \u003e= \u003e æ¥æ‰¾åˆ°å¯¹åº”çš„æŒ‡é’ˆ B+Tree B+ æ ‘ï¼š æ”¹è¿›çš„ B-Tree æ›´é€‚åˆæ–‡ä»¶æ£€ç´¢ç³»ç»Ÿ B+Tree ä¸ B-Tree çš„åŒºåˆ«ï¼š å…³é”®å­—æ•° = å­èŠ‚ç‚¹æ•°ï¼ŒB æ ‘ä¸­å…³é”®å­—æ•° = å­èŠ‚ç‚¹æ•° - 1 éå¶å­èŠ‚ç‚¹ä¸­ä¹Ÿä¼šå­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­çš„å€¼ï¼ŒB æ ‘ä¸ä¼š åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼ŒB æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ® ç”±å¶å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ„æˆä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼ŒB æ ‘çš„å¶å­èŠ‚ç‚¹æ•°æ®ä¸å…¨ R æ ‘ï¼š è§£å†³äº†é«˜çº¬åº¦ç©ºé—´çš„æœç´¢é—®é¢˜ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:6","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®ç»“æ„é€‰æ‹©"},{"categories":null,"content":"\rç®—æ³•çš„æ—¶é—´å¤æ‚åº¦\r","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:8:7","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#innodb-æ•°æ®å­˜å‚¨ç»“æ„"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®é¡µå†…éƒ¨ç»“æ„"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äºŒç©ºé—²ç©ºé—´-ç”¨æˆ·è®°å½•-æœ€å¤§æœ€å°è®°å½•"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸‰é¡µç›®å½•-é¡µé¢å¤´éƒ¨"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#innodb-è¡Œæ ¼å¼"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#compact-è¡Œæ ¼å¼"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#dynamic-è¡Œæ ¼å¼-a-idè¡Œæº¢å‡º-a"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#compressed-è¡Œæ ¼å¼"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#redundant-è¡Œæ ¼å¼"},{"categories":null,"content":"\rInnoDB æ•°æ®å­˜å‚¨ç»“æ„\ræ•°æ®é¡µå†…éƒ¨ç»“æ„ InnoDB å°†æ•°æ®ä»¥ é¡µ ä¸ºåŸºæœ¬å•ä½ä½œä¸ºç£ç›˜ä¸å†…å­˜çš„äº¤äº’å•ä½ï¼ˆé»˜è®¤16KBï¼‰ æ¯é¡µä¹‹é—´ç”¨ åŒå‘é“¾è¡¨ é€»è¾‘è¿æ¥ï¼Œæ•°æ®é¡µä¸­çš„è®°å½•ä½¿ç”¨ å•é“¾è¡¨ è¿æ¥ æ¯ä¸ªæ•°æ®é¡µä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ª é¡µç›®å½• ï¼Œé¡µç›®å½•ä»¥ æ•°ç»„ çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¯¹åº”è®°å½• é¡µçš„ä¸Šå±‚ä¸º åŒº ï¼šæ¯ä¸ªåŒºåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µï¼Œ64 * 16KB = 1MB åŒºçš„ä¸Šå±‚ä¸º æ®µ ï¼šæ®µæ˜¯æ•°æ®åº“çš„åˆ†é…å•ä½ï¼ŒæŒ‰ç…§æ•°æ®åº“å¯¹è±¡æ¥åˆ†ï¼ˆè¡¨æ®µã€ç´¢å¼•æ®µï¼‰ æ®µçš„ä¸Šå±‚ä¸º è¡¨ç©ºé—´ ï¼šåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ å’Œ ç‹¬ç«‹è¡¨ç©ºé—´ é¡µæŒ‰ç…§ç±»å‹åˆ’åˆ†åˆ†ä¸º æ•°æ®é¡µ ã€ç³»ç»Ÿé¡µã€undoé¡µã€äº‹åŠ¡æ•°æ®é¡µ ç­‰ æ¯ä¸ªæ•°æ®é¡µå  16KB å¤§å°ï¼Œè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªéƒ¨åˆ† File Header (æ–‡ä»¶å¤´éƒ¨)ã€Page Header (é¡µé¢å¤´éƒ¨)ã€Infimum + Supremum (æœ€å°æœ€å¤§è®°å½•)ã€User Records (ç”¨æˆ·è®°å½•)ã€Free Space (ç©ºé—²ç©ºé—´)ã€Page Directory (é¡µç›®å½•)ã€File Trailer (æ–‡ä»¶å°¾éƒ¨) ä¸€ã€æ–‡ä»¶å¤´éƒ¨å’Œæ–‡ä»¶å°¾éƒ¨æ–‡ä»¶å¤´ï¼š38å­—èŠ‚ï¼Œæè¿°é¡µçš„ä¿¡æ¯ FIL_PAGE_OFFSETï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸€ä¸ªé¡µå·ï¼ŒInnoDB é€šè¿‡é¡µå·å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ FIL_PAGE_TYPEï¼ˆ2å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºå½“å‰é¡µçš„ç±»å‹ FIL_PAGE_PREVï¼ˆ4å­—èŠ‚ï¼‰å’ŒFIL_PAGE_NEXTï¼ˆ4å­—èŠ‚ï¼‰ï¼šè®°å½•ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„é¡µå·ï¼Œå½¢æˆåŒå‘é“¾è¡¨ä½¿é¡µä¹‹é—´é€»è¾‘è¿ç»­ FIL_PAGE_SPACE_OR_CHKSUMï¼ˆ4å­—èŠ‚ï¼‰ï¼šå½“å‰é¡µé¢çš„ æ ¡éªŒå’Œï¼ˆchecksumï¼‰ã€‚ ã€æ ¡éªŒå’Œã€‘é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆçš„è¾ƒçŸ­çš„å€¼ï¼Œé¿å…å¯¹æ¯” é•¿å­—ç¬¦ä¸² æˆ– ä¸¤ä¸ªé¡µ æ—¶çš„æ—¶é—´æ¶ˆè€— åœ¨ åˆ·ç›˜å‰åœ¨æ–‡ä»¶å¤´ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œåˆ·ç›˜ å®Œæˆååœ¨æ–‡ä»¶å°¾ è®°å½•ä¸€ä¸ªæ ¡éªŒå’Œï¼Œæ ¹æ®ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ç›¸åŒæ¥éªŒè¯æ•°æ®é¡µåœ¨ ç£ç›˜å’Œå†…å­˜åœ¨åŒæ­¥æ—¶ æ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚è¿™é‡Œï¼Œæ ¡éªŒæ–¹å¼å°±æ˜¯é‡‡ç”¨ Hash ç®—æ³•è¿›è¡Œæ ¡éªŒã€‚ FIL_PAGE_LSNï¼ˆ8å­—èŠ‚ï¼‰ï¼šé¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½® æ–‡ä»¶å°¾ï¼š8å­—èŠ‚ï¼Œæ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ å‰ 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µçš„æ ¡éªŒå’Œ ï¼šè¿™ä¸ªéƒ¨åˆ†æ˜¯å’Œ File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”çš„ã€‚ å 4 ä¸ªå­—èŠ‚ä»£è¡¨ é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„æ—¥å¿—åºåˆ—ä½ç½®(LSN) ï¼šè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ä¸ºäº†æ ¡éªŒé¡µçš„å®Œæ•´æ€§çš„ï¼ŒéªŒè¯åŒæ­¥è¿‡ç¨‹æ˜¯å¦å‡ºç°äº†é—®é¢˜ã€‚ äºŒã€ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½• æœ€å¤§æœ€å°è®°å½•ç©ºé—²ç©ºé—´ï¼šä¸ç¡®å®šå¤§å°ï¼Œé¡µä¸­è¿˜æ²¡è¢«ä½¿ç”¨çš„ç©ºé—´ æ²¡æœ‰ç”¨æˆ·è®°å½•çš„ç©ºé—´å°±æ˜¯ç©ºé—²ç©ºé—´ ç”¨æˆ·è®°å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨è¡Œè®°å½•å†…å®¹ æŒ‰ç…§æŒ‡å®šçš„è¡Œæ ¼å¼ä¸€æ¡ä¸€æ¡çš„å­˜å‚¨åœ¨ç”¨æˆ·è®°å½•ä¸­ï¼Œæ„æˆ å•é“¾è¡¨ æœ€å¤§æœ€å°è®°å½•ï¼š26å­—èŠ‚ï¼Œæ˜¯ä¸¤ä¸ªè™šæ‹Ÿè¡Œè®°å½• æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•åˆ†åˆ«å  13 å­—èŠ‚ è¿™ä¸¤ä¸ªæ˜¯ä½œä¸ºæ•°æ®è¡Œåœ¨æ•°æ®é¡µå†…å­˜å‚¨çš„ï¼Œæœ€å°è®°å½•çš„ heap_no ä¸º 0 , æœ€å¤§è®°å½•çš„ heap_no ä¸º 1ï¼Œ2 å¼€å§‹å°±æ˜¯ç”¨æˆ·è®°å½• ä¸‰ã€é¡µç›®å½• é¡µé¢å¤´éƒ¨é¡µç›®å½•ï¼šä¸ç¡®å®šå¤§å°ï¼Œå­˜å‚¨ç”¨æˆ·è®°å½•çš„ç›¸å¯¹ä½ç½®ï¼ˆä½¿ç”¨æ•°ç»„å­˜å‚¨æ¯ç»„æ•°æ®çš„åç§»é‡ï¼Œæ–¹ä¾¿ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾ï¼‰ å°†å½“å‰ç›®å½•é¡µæŒ‡å‘çš„è®°å½•åˆ†ä¸ºå¤šä¸ªç»„ï¼Œæ¯ç»„ä¸­åŒ…æ‹¬æœ€å¤§æœ€å°è®°å½•ä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºå·²åˆ é™¤çš„è®°å½• ç¬¬ä¸€ç»„åªæœ‰ä¸€æ¡è®°å½•ä¸ºæœ€å°è®°å½•ï¼Œå…¶ä½™ä¼šæŒ‰ç…§ 4-8 æ¡è®°å½•å°½é‡å¹³åˆ† é¡µç›®å½•å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼ˆæ¯ä¸ªæ§½ä¸­è®°å½•çš„æ˜¯æ¯ç»„æœ€å¤§çš„ä¸€ä¸ªè®°å½•ï¼‰ é¡µå¤´ï¼š56å­—èŠ‚ï¼Œé¡µçš„çŠ¶æ€ä¿¡æ¯ PAGE_DIRECTIONï¼šæ’å…¥çš„æ–¹å‘ï¼Œå‡å¦‚æ–°æ’å…¥çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å‘å³ï¼Œåä¹‹åˆ™æ˜¯å‘å·¦ï¼Œä¾¿äºä¸‹æ¬¡æ’å…¥ã€‚ PAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­å‡ æ¬¡æ’å…¥çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒInnoDB ä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°ç”¨ PAGE_N_DIRECTION è®°ä¸‹æ¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ”¹å˜äº†çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶é‡æ–°ç»Ÿè®¡ã€‚ InnoDB è¡Œæ ¼å¼ æŸ¥çœ‹é»˜è®¤è¡Œæ ¼å¼ SELECT @@innodb_default_row_format; åˆ›å»ºæŒ‡å®šè¡Œæ ¼å¼çš„è¡¨ CREATE TABLE record_test_table ( col1 VARCHAR(8), col2 VARCHAR(8) NOT NULL, col3 CHAR(8), col4 VARCHAR(8) ) CHARSET = ascii ROW_FORMAT = COMPACT; Compact è¡Œæ ¼å¼\rå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ å­˜å‚¨å¯å˜é•¿åº¦å­—æ®µçš„é•¿åº¦ï¼švarcharã€varbinaryã€textã€blob æŒ‰ç…§å˜é•¿å­—æ®µçš„é¡ºåºå·² 16 è¿›åˆ¶çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š060408 NULL å€¼åˆ—è¡¨ ç”±äºæ•°æ®åœ¨å­˜å‚¨æ—¶æ˜¯éœ€è¦å¯¹é½çš„ï¼Œéœ€è¦å­˜å‚¨è¡Œä¸­ NULL çš„ä½ç½® æŒ‰ç…§å¯ä¸º NULL çš„å­—æ®µçš„é¡ºåºå·² 0 / 1 çš„æ ¼å¼é€†åºå­˜å‚¨ï¼š110 è®°å½•å¤´ä¿¡æ¯ delete_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ 0 / 1ï¼Œé¿å…çœŸå®åˆ é™¤éœ€è¦é‡æ–°æ’åˆ—ï¼Œç»´æŠ¤ä¸€ä¸ªåƒåœ¾é“¾è¡¨ min_rec_maskï¼šè®°å½•è¯¥è®°å½•æ˜¯å¦æ˜¯éå¶å­èŠ‚ç‚¹çš„æœ€å°è®°å½•ï¼Œä¹Ÿå°±æ˜¯ç›®å½•é¡µçš„æœ€å°è®°å½•æ ‡è®°ä¸º 1 record_typeï¼šè®°å½•è¯¥è®°å½•çš„è®°å½•ç±»å‹ï¼Œ0ï¼šæ™®é€šè®°å½•ï¼Œ1ï¼šéå¶å­èŠ‚ç‚¹çš„è®°å½•ï¼Œ2ï¼šæœ€å°è®°å½•ï¼Œ3ï¼šæœ€å¤§è®°å½• heap_noï¼šè®°å½•è¯¥è®°å½•åœ¨æœ¬é¡µä¸­çš„ä½ç½®ï¼Œ0 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ1è¡¨ç¤ºæœ€å¤§è®°å½•ï¼Œ2 3 4 5 â€¦ n_ownedï¼šè®°å½•è¯¥ï¼ˆé¡µç›®å½•ï¼‰ç»„ä¸­æœ‰å¤šå°‘æ¡è®°å½• next_recordï¼šè®°å½•åˆ°ä¸‹ä¸€è®°å½•çš„åœ°å€åç§»é‡ åˆ é™¤æ—¶ï¼šå°†ä¸Šä¸€è®°å½•çš„ next_record æŒ‡å‘ä¸‹ä¸€è®°å½•ï¼Œå°†å½“å‰è®°å½•çš„ next_record è®¾ä¸º 0ï¼ˆåŒæ—¶è°ƒæ•´ delete_maskã€n_owned çš„å€¼ï¼‰ æ·»åŠ æ—¶ï¼šå¦‚æœæ·»åŠ çš„ä¸»é”®å’Œä¹‹å‰åˆ é™¤çš„ä¸»é”®ç›¸åŒï¼Œåˆ™å¤ç”¨ä¹‹å‰çš„å­˜å‚¨ç©ºé—´ çœŸå®æ•°æ® å­˜å‚¨çœŸå®çš„æ•°æ®ä»¥åŠä¸‰ä¸ªéšè—åˆ— åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨éšè—åˆ— Dynamic è¡Œæ ¼å¼ è¡Œæº¢å‡º ç”±äº å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ éœ€è¦å ç”¨ 2 å­—èŠ‚ï¼Œ NULL å€¼åˆ—è¡¨ éœ€è¦å ç”¨ 1 å­—èŠ‚ åœ¨å®šä¹‰ varchar ç±»å‹æ—¶éœ€è¦è€ƒè™‘æœ€å¤§å­—ç¬¦é•¿åº¦ï¼šascii ä¸­ varchar(65533) æ˜¯å¯ä»¥çš„ ç”±äºæ•°æ®é¡µæœ€å¤§ 16KB ä¹Ÿå°±æ˜¯ 16384 å­—èŠ‚ï¼Œå½“è®¾ç½®å­—æ®µé•¿åº¦ä¸º 65533 æ—¶å°±å‘ç”Ÿäº†ã€è¡Œæº¢å‡ºã€‘ æ­¤æ—¶ä¼šä½¿ç”¨ 20 å­—èŠ‚ä½œä¸ºæŒ‡é’ˆæŒ‡å‘å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µé¢â€¦ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼ åœ¨å¤„ç† BLOB è¡Œæº¢å‡ºæ—¶ï¼Œå•ç‹¬å­˜å‚¨è¯¥å­—æ®µçš„æº¢å‡ºé¡µï¼Œç„¶ååœ¨åŸæ•°æ®é¡µåªå­˜å‚¨æº¢å‡ºé¡µçš„åœ°å€ä¸å­˜æ•°æ® Compressed è¡Œæ ¼å¼åœ¨ Dynamic è¡Œæ ¼å¼çš„åŸºç¡€ä¸Šæ·»åŠ äº† zlib å‹ç¼©ç®—æ³•ï¼Œå¯¹äº å¯Œæ–‡æœ¬ å­—æ®µæ•°æ®å¯ä»¥æ›´æœ‰æ•ˆçš„å­˜å‚¨ Redundant è¡Œæ ¼å¼ æ˜¯ MySQL 5.0 ä¹‹å‰çš„é»˜è®¤è¡Œæ ¼å¼ï¼Œä¿ç•™çš„ç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ ä½¿ç”¨ å­—æ®µé•¿åº¦ä¾¿å®œåˆ—è¡¨ å°†æ‰€æœ‰å­—æ®µçš„é•¿åº¦éƒ½é€†åºå­˜å‚¨ï¼Œæ¯”è¾ƒå†—ä½™ è®°å½•å¤´åˆ—è¡¨ Redundant è¡Œæ ¼å¼å¤šäº† n_field å’Œ 1byte_offs_flag è¿™ä¸¤ä¸ªå±æ€§ã€‚æ²¡æœ‰ record_type è¿™ä¸ªå±æ€§ åŒºã€æ®µã€ç¢ç‰‡åŒºã€è¡¨ç©ºé—´åŒºï¼š ä¸€ä¸ªåŒºå¯ä»¥è¿ç»­ 64 ä¸ªé¡µï¼Œæ¯ä¸ªåŒº 1MB ç©ºé—´ ä¸ºäº†å‡å°‘ éšæœºè¯»å– çš„ç£ç›˜å¯»é“å’ŒåŠåœˆæ—‹è½¬æ—¶é—´ï¼Œå°†é¡µå’Œé¡µåšåˆ°é¡ºåºå­˜å‚¨ï¼Œæå‡æ•ˆç‡ æ®µï¼š å°†å­˜æ”¾å¶å­èŠ‚ç‚¹çš„åŒºå’Œå­˜æ”¾éå¶å­èŠ‚ç‚¹çš„åŒºåˆ†å¼€åœ¨ä¸åŒçš„æ®µä¸­å­˜å‚¨ æ®µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œç”±é›¶æ•£çš„é¡µé¢å’Œå®Œæ•´çš„åŒºç»„æˆã€‚å¸¸è§çš„æ®µæœ‰ æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ ç¢ç‰‡åŒºï¼š æ¯ä¸ªè¡¨éƒ½è¦æ‹¥æœ‰ä¸€ä¸ªç´¢å¼•æ®µä¸€ä¸ªæ•°æ®æ®µï¼Œå½“ä¸€ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„æ•°æ®å´ä¹Ÿè¦å ç”¨ 2MB ç©ºé—´ äºæ˜¯å¼•å…¥ç¢ç‰‡åŒºçš„æ¦‚å¿µï¼Œåœ¨ç¢ç‰‡åŒºä¸­å­˜å‚¨ç€ä¸€äº›é›¶æ•£çš„æ•°æ®é¡µå’Œç›®å½•é¡µã€‚ç¢ç‰‡åŒºç›´å±äºè¡¨ å½“æŸä¸ªæ®µå·²ç»å ç”¨äº† 32 ä¸ªç¢ç‰‡åŒºï¼Œåˆ™ä¼šç”³è¯· å®Œæ•´çš„åŒº ä¸ºå•ä½çš„å­˜å‚¨ç©ºé—´ æ­¤æ—¶åŒºå°±å¯ä»¥åˆ†ä¸ºï¼š ç©ºé—²çš„åŒº(free) æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(free_frag) æ²¡æœ‰å‰©ä½™ç©ºé—´çš„ç¢ç‰‡åŒº(full_frag) é™„å±äºæŸä¸ªæ®µçš„åŒº(fseg) è¡¨ç©ºé—´ï¼š æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æœ€é«˜å±‚ï¼Œåˆ†ä¸º ç³»ç»Ÿè¡¨ç©ºé—´ã€ç‹¬ç«‹è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ ç‹¬ç«‹è¡¨ç©ºé—´ï¼šä¾¿äºè¡¨è¿ç§»ï¼Œé»˜è®¤ .ibd å  6 ä¸ªé¡µå¤§å°è‡ªæ‰©å±• ç³»ç»Ÿè¡¨ç©ºé—´ï¼šè¿˜ä¼šè®°å½•ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ•°æ®å­—å…¸ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:9:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#åŒºæ®µç¢ç‰‡åŒºè¡¨ç©ºé—´"},{"categories":null,"content":"\rç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™ æŒ‰ç…§ åŠŸèƒ½é€»è¾‘ åˆ’åˆ†ä¸º æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€å…¨æ–‡ç´¢å¼• æŒ‰ç…§ ç‰©ç†å®ç° åˆ’åˆ†ä¸º èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼• æŒ‰ç…§ ä½œç”¨å­—æ®µä¸ªæ•° åˆ’åˆ†ä¸º å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼• æ™®é€šç´¢å¼•ï¼š æ²¡æœ‰ä»»ä½•çº¦æŸçš„ç´¢å¼•ï¼Œå¯ä»¥åˆ›å»ºåœ¨ä»»ä½•æ•°æ®ç±»å‹ä¸Š å”¯ä¸€ç´¢å¼•ï¼š ä½¿ç”¨ unique å‚æ•°å£°æ˜çš„å­—æ®µè‡ªåŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œæ•°æ®ä¸èƒ½é‡å¤ã€å¯ä»¥ä¸ºç©ºã€å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼• ä¸»é”®ç´¢å¼•ï¼š åœ¨åˆ›å»ºä¸»é”®å­—æ®µæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•æ˜¯ not null + uniqueï¼Œä¸€å¼ è¡¨ä¸­æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼• å•åˆ—ç´¢å¼•ï¼š ä½œç”¨åœ¨ä¸€ä¸ªå­—æ®µä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼• å¤šåˆ—ç´¢å¼•ï¼ˆè”åˆç´¢å¼•ã€ç»„åˆç´¢å¼•ï¼‰ï¼š ä¸ºå¤šä¸ªå­—æ®µç»„åˆåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œéµå¾ª æœ€å·¦å‰ç¼€é›†åˆ å…¨æ–‡ç´¢å¼•ï¼š æ˜¯ æœç´¢å¼•æ“ ä½¿ç”¨çš„ä¸€ç§å…³é”®æŠ€æœ¯ï¼Œç”¨åˆ°äº† åˆ†è¯æŠ€æœ¯ã€‚åˆ†ä¸º è‡ªç„¶è¯­è¨€çš„å…¨æ–‡æ£€ç´¢ å’Œ å¸ƒå°”å…¨æ–‡æ£€ç´¢ åœ¨ 3.23.23 ç‰ˆæœ¬æ”¯æŒï¼Œåœ¨ 5.6.4 å InnoDB æ”¯æŒã€‚ç°ä½¿ç”¨ solrã€ElasticSearch ä¸“ç”¨çš„æœç´¢å¼•æ“æ›¿ä»£ ç©ºé—´ç´¢å¼•ï¼š ç•¥ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™"},{"categories":null,"content":"\rç´¢å¼•çš„åˆ›å»º åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™åˆ›å»ºç´¢å¼• éšå¼çš„åˆ›å»ºç´¢å¼•ï¼šåœ¨åˆ›å»ºä¸»é”®ã€å¤–é”®ã€å”¯ä¸€æ€§çº¦æŸæ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºå¯¹åº”ç´¢å¼• æ˜¾å¼çš„åˆ›å»ºç´¢å¼•ï¼š CREATE TABLE table_name [col_name data_type] [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name [length]) [ASC | DESC] UNIQUE ã€ FULLTEXT å’Œ SPATIAL ä¸ºå¯é€‰å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•å’Œç©ºé—´ç´¢å¼• INDEX ä¸ KEY ä¸ºåŒä¹‰è¯ï¼Œä¸¤è€…çš„ä½œç”¨ç›¸åŒï¼Œç”¨æ¥æŒ‡å®šåˆ›å»ºç´¢å¼• index_name æŒ‡å®šç´¢å¼•çš„åç§°ï¼Œä¸ºå¯é€‰å‚æ•°ï¼Œé»˜è®¤ col_name ä¸ºç´¢å¼•å col_name ä¸ºéœ€è¦åˆ›å»ºç´¢å¼•çš„å­—æ®µåˆ—ï¼Œè¯¥åˆ—å¿…é¡»ä»æ•°æ®è¡¨ä¸­å®šä¹‰çš„å¤šä¸ªåˆ—ä¸­é€‰æ‹© length ä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ï¼Œåªæœ‰å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ‰èƒ½æŒ‡å®šç´¢å¼•é•¿åº¦ ASC æˆ– DESC æŒ‡å®šå‡åºæˆ–è€…é™åºçš„ç´¢å¼•å€¼å­˜å‚¨ æ¡ˆä¾‹ï¼š CREATE TABLE book( book_id INT , book_name VARCHAR(100), AUTHORS VARCHAR(100), info VARCHAR(100) , COMMENT VARCHAR(100), year_publication YEAR, # å£°æ˜æ™®é€šç´¢å¼•ï¼ˆå•ä¾‹ç´¢å¼•ï¼‰ INDEX idx_bname(book_name) # å£°æ˜å”¯ä¸€ç´¢å¼• # UNIQUE INDEX idx_bname(book_name) # å£°æ˜ä¸»é”®ç´¢å¼• # PRIMARY KEY(book_id) # å£°æ˜è”åˆç´¢å¼• # INDEX multi_idx(book_id,book_name,info) # å£°æ˜å…¨æ–‡ç´¢å¼• # FULLTEXT INDEX futxt_idx_info(info) # éœ€è¦ä½¿ç”¨ match + against æŸ¥è¯¢ # SELECT * FROM papers WHERE MATCH(title,content) AGAINST (â€˜æŸ¥è¯¢å­—ç¬¦ä¸²â€™); # å£°æ˜ç©ºé—´ç´¢å¼•ï¼ˆè¦æ±‚å­—æ®µä¸º GEOMETRY ç±»å‹ä¸”éç©ºï¼‰ # SPATIAL INDEX spa_idx_geo(geo) ); ==æŸ¥çœ‹åˆ›å»ºçš„ç´¢å¼•== show create table è¡¨å \\G # æˆ– SHOW INDEX FROM è¡¨å \\G ==ä½¿ç”¨ explain æ€§èƒ½åˆ†æå·¥å…·==ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å¦ç”¨åˆ°äº†ç´¢å¼•ç­‰ä¿¡æ¯ explain sqlè¯­å¥ å•ç‹¬åˆ›å»ºç´¢å¼• ä½¿ç”¨ ALTER TABLE â€¦ ADD è¯­å¥åˆ›å»ºç´¢å¼• ALTER TABLE è¡¨å ADD [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [ç´¢å¼•å] (å­—æ®µå[length],...) [ASC | DESC] ä½¿ç”¨ CREATE INDEX â€¦ ON åˆ›å»ºç´¢å¼• CREATE [UNIQUE | FULLTEXT | SPATIAL] INDEX ç´¢å¼•å ON è¡¨å (å­—æ®µå[length],...) [ASC | DESC] ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•çš„åˆ›å»º"},{"categories":null,"content":"\rç´¢å¼•çš„åˆ é™¤ åˆ é™¤ä¸»é”®ç´¢å¼•ï¼ˆä¿®æ”¹ä¸»é”®ç´¢å¼•è¦å…ˆåˆ é™¤åŸä¸»é”®å†åˆ›å»ºæ–°ä¸»é”®ï¼‰ # éè‡ªå¢é•¿ä¸»é”®æ‰å¯åˆ é™¤ ALTER TABLE è¡¨å drop PRIMARY KEY; ä½¿ç”¨ ALTER TABLE â€¦ DROP INDEX åˆ é™¤ç´¢å¼• ALTER TABLE è¡¨å DROP INDEX ç´¢å¼•å; ä½¿ç”¨ DROP INDEX â€¦ ON è¯­å¥åˆ é™¤ç´¢å¼• DROP INDEX ç´¢å¼•å ON è¡¨å; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•çš„åˆ é™¤"},{"categories":null,"content":"\rMySQL 8 é™åºç´¢å¼•ã€éšè—ç´¢å¼• é™åºç´¢å¼• ä¸¾ä¾‹ï¼šåœ¨åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šå­—æ®µçš„æ’åºæ–¹å¼ CREATE TABLE ts1(a int,b int,index idx_a_b(a,b desc)); # å¯ä»¥çœ‹åˆ°åœ¨æ‰§è¡Œè®¡åˆ’ä¸­æ‰«ææ•°ä»…ä¸º 5, è€Œä¸æ˜¯æ•´è¡¨çš„æ•°æ®é‡ EXPLAIN SELECT * FROM ts1 ORDER BY a,b DESC LIMIT 5; éšè—ç´¢å¼• è®¾ç½®ä¸ºéšè—çš„ç´¢å¼•å°±ä¸ä¼šè¢«ä½¿ç”¨ã€‚è®¾ä¸ºéšè—ç´¢å¼•ä¹‹åå†åˆ é™¤ã€è½¯åˆ é™¤ã€‘ å½“ç´¢å¼•è¢«éšè—æ—¶å…¶å†…å®¹è¿˜ä¼šè·Ÿç€å†…éƒ¨åŒæ­¥æ›´æ–°ï¼Œä¸è¦é•¿æœŸä½¿ç”¨éšè—ç´¢å¼•é™ä½ DML æ“ä½œé€Ÿåº¦ å¯ä»¥ä½¿éšè—çš„ç´¢å¼•æœ‰æ•ˆï¼šset session optimizer_switch=\"use_invisible_indexes=on\"; åœ¨åˆ›å»ºè¡¨æ—¶éšè—ç´¢å¼• CREATE TABLE book7( book_id INT , book_name VARCHAR(100), AUTHORS VARCHAR(100), info VARCHAR(100) , COMMENT VARCHAR(100), year_publication YEAR, #åˆ›å»ºä¸å¯è§çš„ç´¢å¼• INDEX idx_cmt(COMMENT) invisible ); ä¿®æ”¹è¡¨ä¸­ç´¢å¼•æ˜¯å¦å¯è§ ALTER TABLE è¡¨å ALTER INDEX ç´¢å¼•å (INVISIBLE | VISIBLE); #åˆ‡æ¢æˆéšè—ç´¢å¼• ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-8-é™åºç´¢å¼•éšè—ç´¢å¼•"},{"categories":null,"content":"\ré€‚åˆåˆ›å»ºç´¢å¼•çš„ 11 ç§æƒ…å†µ å­—æ®µæœ‰å”¯ä¸€æ€§é™åˆ¶ é˜¿é‡Œå·´å·´è§„å®šä¸šåŠ¡ä¸Šæœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå°±ç®—å­—æ®µæ˜¯ç»„åˆå­—æ®µï¼Œä¹Ÿå¿…é¡»æ·»åŠ å”¯ä¸€æ€§ç´¢å¼• é¢‘ç¹ä½œä¸º where æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µ ç»å¸¸ group by å’Œ order by çš„åˆ— ç”±äºåˆ›å»ºç´¢å¼•ä¹‹åå°±ä¼šä¸ºç´¢å¼•åˆ—æ’åºï¼Œåœ¨è¿›è¡Œ order by åŠ group by æ—¶ä¸å¿…å†æ¬¡æ’åºèŠ‚çœæ—¶é—´ åœ¨åŒæ—¶ä½¿ç”¨ group by å’Œ order by æ—¶ï¼Œè‹¥ åˆ†åˆ«å»ºç«‹ç´¢å¼• ï¼šæŒ‰ç…§æ‰§è¡Œé¡ºåºï¼Œåªä¼šä½¿ç”¨åˆ° group by åçš„ç´¢å¼• åœ¨åŒæ—¶ä½¿ç”¨ group by å’Œ order by æ—¶ï¼Œè‹¥ å»ºç«‹è”åˆç´¢å¼• ï¼šå»ºç«‹ order by å­—æ®µåœ¨å‰ï¼Œgroup by å­—æ®µåœ¨å çš„è”åˆç´¢å¼• åœ¨åŒæ—¶ä½¿ç”¨ group by å’Œ order by æ—¶ï¼Œè‹¥ å»ºç«‹è”åˆç´¢å¼• ï¼šå»ºç«‹ group by å­—æ®µåœ¨å‰ï¼Œorder by å­—æ®µï¼ˆé™åºï¼‰åœ¨å çš„è”åˆç´¢å¼• update å’Œ delete ç§çš„ where å­—æ®µ åœ¨æ›´æ–°æ—¶ä¸ºéç´¢å¼•å­—æ®µæ›´æ–°çš„æ•ˆæœæ›´æ˜æ˜¾ï¼Œå› ä¸ºçœå»äº†ç»´æŠ¤ç´¢å¼•çš„æ—¶é—´ ç»å¸¸ distinct å»é‡çš„å­—æ®µ å­—æ®µæŒ‰ç…§é¡ºåºæ’åºä¹‹åå¯¹å»é‡çš„é€Ÿåº¦ä¹Ÿæœ‰æå‡ join on è¿æ¥æ¡ä»¶ä¸Šçš„å­—æ®µ æ³¨æ„ on æ¡ä»¶è¿æ¥çš„å­—æ®µç±»å‹éœ€è¦ä¸€è‡´ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ ä¸ºç±»å‹å°çš„åˆ—æ·»åŠ ç´¢å¼• åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å°±åº”æ³¨æ„åœ¨æ»¡è¶³å­˜å‚¨æ¡ä»¶ä¸‹ä½¿ç”¨å°½å¯èƒ½å°çš„ç±»å‹ æ•°æ®ç±»å‹çº¦å°é‚£ä¹ˆæ¯ä¸ªæ•°æ®é¡µä¸­å­˜å‚¨çš„å†…å®¹å°±è¶Šå¤šï¼Œä½¿å¾— B+ æ ‘å˜å¾—æ‰å¹³åŠ å¿«ç´¢å¼•æ•ˆç‡ ä½¿ç”¨å­—ç¬¦ä¸²çš„å‰ç¼€åˆ›å»ºç´¢å¼• é¿å…è¿‡é•¿çš„å­—ç¬¦å…¨éƒ¨å­˜å‚¨è‡³ç´¢å¼•å†…å­˜æµªè´¹ç©ºé—´ï¼Œåªå°†å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼• # å‰ç¼€ç´¢å¼• create index ç´¢å¼•å on è¡¨å(å­—æ®µå(n)) é˜¿é‡Œè§„èŒƒå¼ºåˆ¶ä¸º varchar ç±»å‹åˆ›å»ºç´¢å¼•æ—¶ä½¿ç”¨å‰ç¼€ç´¢å¼• # å‰ç¼€é•¿åº¦å…¬å¼ï¼Œå€¼è¶Šæ¥è¿‘äº 1 è¶Šå¥½ count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*) ä½¿ç”¨å‰ç¼€ç´¢å¼•ä¼šå¯¼è‡´ç´¢å¼•æ’åºæ—¶æ— æ³•æ’åºå‡ºçœŸæ­£çš„é¡ºåº åŒºåˆ†åº¦ï¼ˆæ•£åˆ—åº¦ï¼‰é«˜çš„åˆ—é€‚åˆåšç´¢å¼• ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ æœ€å·¦å‰ç¼€åŸåˆ™ åœ¨å¤šä¸ªå­—æ®µéƒ½è¦åˆ›å»ºç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢å¼•ä¼˜äºå•å€¼ç´¢å¼• è”åˆç´¢å¼•ä¸­çš„æ¯ä¸ªç´¢å¼•åˆ—éƒ½å¯ä»¥è¢«å•ç‹¬ä½¿ç”¨ å»ºè®®å•è¡¨ç´¢å¼•ä¸è¦è¶…è¿‡ 6 ä¸ª ç´¢å¼•ä¼šå ç”¨ç©ºé—´ ç´¢å¼•ä¼šå½±å“å¢åˆ æ”¹çš„é€Ÿåº¦ ä¼šä¸ºä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•æ—¶æ·»åŠ è´Ÿæ‹… ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é€‚åˆåˆ›å»ºç´¢å¼•çš„-11-ç§æƒ…å†µ"},{"categories":null,"content":"\rä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„ 7 ç§æƒ…å†µ where ä½¿ç”¨ä¸åˆ°çš„å­—æ®µ åŒ…æ‹¬ group by ã€ order by æ•°æ®é‡å°çš„è¡¨ ä¸è¦æ€é¸¡ç”¨ç‰›åˆ€ï¼Œåœ¨æ•°æ®é‡ä½äº 1000 æ¡çš„æ—¶å€™ä¸éœ€è¦åˆ›å»ºç´¢å¼• æœ‰å¤§é‡é‡å¤æ•°æ®çš„åˆ— é¢‘ç¹æ›´æ–°çš„å­—æ®µ ä¸å»ºè®®ç”¨æ— åºçš„å€¼ä½œä¸ºç´¢å¼• æ¯”å¦‚ èº«ä»½è¯å·ã€UUID ï¼Œåœ¨æ¯”è¾ƒæ—¶éœ€è¦è½¬ä¸º ascii ï¼Œåœ¨æ’å…¥æ—¶å®¹æ˜“äº§ç”Ÿé¡µåˆ†è£‚ åˆ é™¤ä¸å†ä½¿ç”¨æˆ–ä¸å¸¸ä½¿ç”¨çš„ç´¢å¼• ä¸è¦å®šä¹‰å†—ä½™æˆ–é‡å¤çš„ç´¢å¼• å®šä¹‰äº†è”åˆç´¢å¼•ä¸­åŒ…å«çš„åˆ—å°±ä¸è¦å†å•ç‹¬åˆ›å»ºç´¢å¼•äº† ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:10:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„-7-ç§æƒ…å†µ"},{"categories":null,"content":"\ræ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨ æ•°æ®åº“çš„ä¼˜åŒ–æ€è·¯ï¼šS (Show Status) ä»£è¡¨è§‚å¯Ÿï¼ŒA (Action) ä»£è¡¨è¡ŒåŠ¨ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨"},{"categories":null,"content":"\ræŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•° SHOW [GLOBAL|SESSION] STATUS LIKE 'å‚æ•°'; Connectionsï¼šè¿æ¥ MySQL æœåŠ¡å™¨çš„æ¬¡æ•° Uptimeï¼šMySQL æœåŠ¡å™¨çš„ä¸Šçº¿æ—¶é—´ Slow_queriesï¼šæ…¢æŸ¥è¯¢çš„æ¬¡æ•° Innodb_rows_readï¼šSelect æŸ¥è¯¢è¿”å›çš„è¡Œæ•° Innodb_rows_insertedï¼šæ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•° Innodb_rows_updatedï¼šæ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•° Innodb_rows_deletedï¼šæ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•° Com_selectï¼šæŸ¥è¯¢æ“ä½œçš„æ¬¡æ•° Com_insertï¼šæ’å…¥æ“ä½œçš„æ¬¡æ•°ã€‚å¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ Com_updateï¼šæ›´æ–°æ“ä½œ çš„æ¬¡æ•° Com_deleteï¼šåˆ é™¤æ“ä½œçš„æ¬¡æ•° ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½å‚æ•°"},{"categories":null,"content":"\ræŸ¥çœ‹æœ«æ¬¡æŸ¥è¯¢æˆæœ¬ æŸ¥çœ‹æœ€åä¸€æ¬¡æŸ¥è¯¢ç”¨åˆ°çš„é¡µæ•° ä½†æ˜¯è¿™ä¸ªå€¼å¹¶å’ŒæŸ¥è¯¢æ—¶é—´å¹¶ä¸æˆæ­£æ¯”ï¼Œå› ä¸ºé‡‡ç”¨é¡ºåºè¯»å–ï¼ˆé¡ºåº I/Oï¼‰çš„æ–¹å¼å·²ç»å°†é¡µé¢ä¸€æ¬¡æ€§å­˜å‚¨åªç¼“å†²æ± ä¸­äº† show status like 'last_query_cost'; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹æœ«æ¬¡æŸ¥è¯¢æˆæœ¬"},{"categories":null,"content":"\ræŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿— slow_query_log æ˜¯æ—¥å¿—çš„ä¸€ç§ï¼Œç”¨äºè®°å½• å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ çš„ SQL æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•° æŸ¥çœ‹æ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰ show variables like '%slow_query_log%'; å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— set global slow_query_log = 'ON'; æŸ¥çœ‹å“åº”æ—¶é—´é˜ˆå€¼ show variables like '%long_query_time%'; è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ set global long_query_time = 1; # è®¾ç½® global å¯¹å½“å‰ session è¿æ¥æ— æ•ˆ, åº”ç»§ç»­è®¾ç½® set long_query_time = 1; ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ï¼ˆç¼–è¾‘ my.cnf åé‡å¯ MySQLï¼‰ [mysqld] # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—çš„å¼€å…³ slow_query_log = ON # æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•å’Œæ–‡ä»¶åä¿¡æ¯ slow_query_log_file = /var/lib/mysql/atguigu-slow.1og # è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜€å€¼ä¸º3ç§’, è¶…å‡ºæ­¤è®¾å®šå€¼çš„ SQL å³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿— long_query_time = 3 log_output = FILE æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆlong_query_timeï¼‰å’Œ æ‰«æè¿‡çš„æœ€å°‘è®°å½•é‡ï¼ˆmin_examined_row_limitï¼‰å…±åŒç»„æˆåˆ¤åˆ«æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ é»˜è®¤çš„ min_examined_row_limit å€¼ä¸º 0ï¼Œå³ï¼šå°±ç®—ä¸€æ¡è®°å½•éƒ½æ²¡è¢«æ‰«æè¿‡ï¼Œä¹Ÿä¼šè¢«åˆ¤åˆ«ä¸ºæ…¢æŸ¥è¯¢ æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow MySQL æä¾›çš„æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š -a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS -s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº c: è®¿é—®æ¬¡æ•° l: é”å®šæ—¶é—´ r: è¿”å›è®°å½• t: æŸ¥è¯¢æ—¶é—´ al:å¹³å‡é”å®šæ—¶é—´ ar:å¹³å‡è¿”å›è®°å½•æ•° at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰ ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•° -t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ® -g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ å½“å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶å­˜åœ¨å¤åˆæ¡ä»¶çš„æ…¢æŸ¥è¯¢æ—¶ï¼Œåœ¨ /var/lib/mysql ç›®å½•ä¸­å‡ºç° ç”¨æˆ·å-slow.log çš„æ—¥å¿—æ–‡ä»¶ ä½¿ç”¨ mysqldumpslow -s t -t 5 æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼Œè¿”å›å‰ 5 æ¡æ…¢æŸ¥è¯¢æ•°æ® å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— ä¸´æ—¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— SET GLOBAL slow_query_log=off; systemctl restart mysqld.service ä¿®æ”¹ my.cnf é…ç½®æ–‡ä»¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— [mysqld] # slow_query_log = off ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—-slow_query_log"},{"categories":null,"content":"\ræŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿— slow_query_log æ˜¯æ—¥å¿—çš„ä¸€ç§ï¼Œç”¨äºè®°å½• å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ çš„ SQL æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•° æŸ¥çœ‹æ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰ show variables like '%slow_query_log%'; å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— set global slow_query_log = 'ON'; æŸ¥çœ‹å“åº”æ—¶é—´é˜ˆå€¼ show variables like '%long_query_time%'; è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ set global long_query_time = 1; # è®¾ç½® global å¯¹å½“å‰ session è¿æ¥æ— æ•ˆ, åº”ç»§ç»­è®¾ç½® set long_query_time = 1; ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ï¼ˆç¼–è¾‘ my.cnf åé‡å¯ MySQLï¼‰ [mysqld] # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—çš„å¼€å…³ slow_query_log = ON # æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•å’Œæ–‡ä»¶åä¿¡æ¯ slow_query_log_file = /var/lib/mysql/atguigu-slow.1og # è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜€å€¼ä¸º3ç§’, è¶…å‡ºæ­¤è®¾å®šå€¼çš„ SQL å³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿— long_query_time = 3 log_output = FILE æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆlong_query_timeï¼‰å’Œ æ‰«æè¿‡çš„æœ€å°‘è®°å½•é‡ï¼ˆmin_examined_row_limitï¼‰å…±åŒç»„æˆåˆ¤åˆ«æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ é»˜è®¤çš„ min_examined_row_limit å€¼ä¸º 0ï¼Œå³ï¼šå°±ç®—ä¸€æ¡è®°å½•éƒ½æ²¡è¢«æ‰«æè¿‡ï¼Œä¹Ÿä¼šè¢«åˆ¤åˆ«ä¸ºæ…¢æŸ¥è¯¢ æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow MySQL æä¾›çš„æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š -a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS -s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº c: è®¿é—®æ¬¡æ•° l: é”å®šæ—¶é—´ r: è¿”å›è®°å½• t: æŸ¥è¯¢æ—¶é—´ al:å¹³å‡é”å®šæ—¶é—´ ar:å¹³å‡è¿”å›è®°å½•æ•° at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰ ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•° -t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ® -g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ å½“å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶å­˜åœ¨å¤åˆæ¡ä»¶çš„æ…¢æŸ¥è¯¢æ—¶ï¼Œåœ¨ /var/lib/mysql ç›®å½•ä¸­å‡ºç° ç”¨æˆ·å-slow.log çš„æ—¥å¿—æ–‡ä»¶ ä½¿ç”¨ mysqldumpslow -s t -t 5 æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼Œè¿”å›å‰ 5 æ¡æ…¢æŸ¥è¯¢æ•°æ® å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— ä¸´æ—¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— SET GLOBAL slow_query_log=off; systemctl restart mysqld.service ä¿®æ”¹ my.cnf é…ç½®æ–‡ä»¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— [mysqld] # slow_query_log = off ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•°"},{"categories":null,"content":"\ræŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿— slow_query_log æ˜¯æ—¥å¿—çš„ä¸€ç§ï¼Œç”¨äºè®°å½• å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ çš„ SQL æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•° æŸ¥çœ‹æ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰ show variables like '%slow_query_log%'; å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— set global slow_query_log = 'ON'; æŸ¥çœ‹å“åº”æ—¶é—´é˜ˆå€¼ show variables like '%long_query_time%'; è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ set global long_query_time = 1; # è®¾ç½® global å¯¹å½“å‰ session è¿æ¥æ— æ•ˆ, åº”ç»§ç»­è®¾ç½® set long_query_time = 1; ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ï¼ˆç¼–è¾‘ my.cnf åé‡å¯ MySQLï¼‰ [mysqld] # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—çš„å¼€å…³ slow_query_log = ON # æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•å’Œæ–‡ä»¶åä¿¡æ¯ slow_query_log_file = /var/lib/mysql/atguigu-slow.1og # è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜€å€¼ä¸º3ç§’, è¶…å‡ºæ­¤è®¾å®šå€¼çš„ SQL å³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿— long_query_time = 3 log_output = FILE æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆlong_query_timeï¼‰å’Œ æ‰«æè¿‡çš„æœ€å°‘è®°å½•é‡ï¼ˆmin_examined_row_limitï¼‰å…±åŒç»„æˆåˆ¤åˆ«æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ é»˜è®¤çš„ min_examined_row_limit å€¼ä¸º 0ï¼Œå³ï¼šå°±ç®—ä¸€æ¡è®°å½•éƒ½æ²¡è¢«æ‰«æè¿‡ï¼Œä¹Ÿä¼šè¢«åˆ¤åˆ«ä¸ºæ…¢æŸ¥è¯¢ æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow MySQL æä¾›çš„æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š -a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS -s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº c: è®¿é—®æ¬¡æ•° l: é”å®šæ—¶é—´ r: è¿”å›è®°å½• t: æŸ¥è¯¢æ—¶é—´ al:å¹³å‡é”å®šæ—¶é—´ ar:å¹³å‡è¿”å›è®°å½•æ•° at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰ ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•° -t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ® -g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ å½“å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶å­˜åœ¨å¤åˆæ¡ä»¶çš„æ…¢æŸ¥è¯¢æ—¶ï¼Œåœ¨ /var/lib/mysql ç›®å½•ä¸­å‡ºç° ç”¨æˆ·å-slow.log çš„æ—¥å¿—æ–‡ä»¶ ä½¿ç”¨ mysqldumpslow -s t -t 5 æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼Œè¿”å›å‰ 5 æ¡æ…¢æŸ¥è¯¢æ•°æ® å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— ä¸´æ—¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— SET GLOBAL slow_query_log=off; systemctl restart mysqld.service ä¿®æ”¹ my.cnf é…ç½®æ–‡ä»¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— [mysqld] # slow_query_log = off ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·-mysqldumpslow"},{"categories":null,"content":"\ræŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿— slow_query_log æ˜¯æ—¥å¿—çš„ä¸€ç§ï¼Œç”¨äºè®°å½• å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼ çš„ SQL æ…¢æŸ¥è¯¢æ—¥å¿—å‚æ•° æŸ¥çœ‹æ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤ä¸å¯ç”¨ï¼‰ show variables like '%slow_query_log%'; å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— set global slow_query_log = 'ON'; æŸ¥çœ‹å“åº”æ—¶é—´é˜ˆå€¼ show variables like '%long_query_time%'; è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ set global long_query_time = 1; # è®¾ç½® global å¯¹å½“å‰ session è¿æ¥æ— æ•ˆ, åº”ç»§ç»­è®¾ç½® set long_query_time = 1; ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½®å“åº”æ—¶é—´é˜ˆå€¼ï¼ˆç¼–è¾‘ my.cnf åé‡å¯ MySQLï¼‰ [mysqld] # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—çš„å¼€å…³ slow_query_log = ON # æ…¢æŸ¥è¯¢æ—¥å¿—çš„ç›®å½•å’Œæ–‡ä»¶åä¿¡æ¯ slow_query_log_file = /var/lib/mysql/atguigu-slow.1og # è®¾ç½®æ…¢æŸ¥è¯¢çš„é˜€å€¼ä¸º3ç§’, è¶…å‡ºæ­¤è®¾å®šå€¼çš„ SQL å³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿— long_query_time = 3 log_output = FILE æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆlong_query_timeï¼‰å’Œ æ‰«æè¿‡çš„æœ€å°‘è®°å½•é‡ï¼ˆmin_examined_row_limitï¼‰å…±åŒç»„æˆåˆ¤åˆ«æ˜¯å¦æ…¢æŸ¥è¯¢çš„æ¡ä»¶ é»˜è®¤çš„ min_examined_row_limit å€¼ä¸º 0ï¼Œå³ï¼šå°±ç®—ä¸€æ¡è®°å½•éƒ½æ²¡è¢«æ‰«æè¿‡ï¼Œä¹Ÿä¼šè¢«åˆ¤åˆ«ä¸ºæ…¢æŸ¥è¯¢ æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow MySQL æä¾›çš„æ—¥å¿—åˆ†æå·¥å…· mysqldumpslow å…·ä½“å‚æ•°å¦‚ä¸‹ï¼š -a: ä¸å°†æ•°å­—æŠ½è±¡æˆNï¼Œå­—ç¬¦ä¸²æŠ½è±¡æˆS -s: æ˜¯è¡¨ç¤ºæŒ‰ç…§ä½•ç§æ–¹å¼æ’åº c: è®¿é—®æ¬¡æ•° l: é”å®šæ—¶é—´ r: è¿”å›è®°å½• t: æŸ¥è¯¢æ—¶é—´ al:å¹³å‡é”å®šæ—¶é—´ ar:å¹³å‡è¿”å›è®°å½•æ•° at:å¹³å‡æŸ¥è¯¢æ—¶é—´ ï¼ˆé»˜è®¤æ–¹å¼ï¼‰ ac:å¹³å‡æŸ¥è¯¢æ¬¡æ•° -t: å³ä¸ºè¿”å›å‰é¢å¤šå°‘æ¡çš„æ•°æ® -g: åè¾¹æ­é…ä¸€ä¸ªæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ å½“å¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶å­˜åœ¨å¤åˆæ¡ä»¶çš„æ…¢æŸ¥è¯¢æ—¶ï¼Œåœ¨ /var/lib/mysql ç›®å½•ä¸­å‡ºç° ç”¨æˆ·å-slow.log çš„æ—¥å¿—æ–‡ä»¶ ä½¿ç”¨ mysqldumpslow -s t -t 5 æŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºï¼Œè¿”å›å‰ 5 æ¡æ…¢æŸ¥è¯¢æ•°æ® å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— ä¸´æ—¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— SET GLOBAL slow_query_log=off; systemctl restart mysqld.service ä¿®æ”¹ my.cnf é…ç½®æ–‡ä»¶å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿— [mysqld] # slow_query_log = off ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…³é—­æ…¢æŸ¥è¯¢æ—¥å¿—"},{"categories":null,"content":"\ræŸ¥çœ‹ SQL æ‰§è¡Œæˆæœ¬ profile è§ MySQL 8 æ‰§è¡Œæµç¨‹ profile çš„ä½¿ç”¨ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹-sql-æ‰§è¡Œæˆæœ¬-profile"},{"categories":null,"content":"\ræŸ¥çœ‹åˆ†ææŸ¥è¯¢è¯­å¥ explain explain åŒ descibe æ˜¯åˆ†ææŸ¥è¯¢çš„è¯­å¥ï¼ŒæŸ¥çœ‹ä¼˜åŒ–å™¨çš„æ‰§è¡Œè®¡åˆ’ å¯ä»¥çœ‹åˆ°ï¼šè¡¨çš„è¯»å–é¡ºåºã€æ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹ã€å“ªäº›ç´¢å¼•å¯ä»¥è¢«ä½¿ç”¨ã€å“ªäº›ç´¢å¼•å®é™…è¢«ä½¿ç”¨ã€è¡¨ä¹‹é—´çš„ä½¿ç”¨ã€æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ æŸ¥è¯¢åˆ†æè¯­å¥çš„ä½¿ç”¨ EXPLAIN SELECT 'SQLè¯­å¥' #æˆ–è€… DESCRIBE SELECT 'SQLè¯­å¥' explain è¾“å‡ºçš„å„ä¸ªåˆ—è¯´æ˜ åˆ—å æè¿° id åœ¨ä¸€ä¸ªå¤§çš„æŸ¥è¯¢è¯­å¥ä¸­æ¯ä¸ª SELECT å…³é”®å­—éƒ½å¯¹åº”ä¸€ä¸ª å”¯ä¸€çš„ id select_type SELECT å…³é”®å­—å¯¹åº”çš„é‚£ä¸ªæŸ¥è¯¢çš„ç±»å‹ table è¡¨å partitions åŒ¹é…çš„åˆ†åŒºä¿¡æ¯ type é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³• possible_keys å¯èƒ½ç”¨åˆ°çš„ç´¢å¼• key å®é™…ä¸Šä½¿ç”¨çš„ç´¢å¼• key_len å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦ ref å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ rows é¢„ä¼°çš„éœ€è¦è¯»å–çš„è®°å½•æ¡æ•° filtered æŸä¸ªè¡¨ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯” Extra ä¸€äº›é¢å¤–çš„ä¿¡æ¯ table åˆ— è¡¨åï¼ŒæŸ¥è¯¢çš„æ¯ä¸€è¡Œè®°å½•éƒ½å¯¹åº”ç€ä¸€ä¸ªå•è¡¨ id åˆ— æ¯ä¸€ä¸ª select å…³é”®å­—å¯¹åº”ç€ä¸€ä¸ª idï¼Œç¬¬ä¸€ä¸ªçš„ä¸ºé©±åŠ¨è¡¨ï¼Œç¬¬äºŒä¸ªçš„ä¸ºè¢«é©±åŠ¨è¡¨ ä¼˜åŒ–å™¨å°†ä¸¤æ¬¡æŸ¥è¯¢ä¼˜åŒ–ä¸ºä¸€ä¸ªå¤šè¡¨è¿æ¥çš„æŸ¥è¯¢ï¼Œæ­¤æ—¶ä¸¤ä¸ª select å…³é”®å­—åªä¼šæœ‰ä¸€ä¸ª id åœ¨ä½¿ç”¨ union å…³é”®å­—è¿æ¥ä¸¤æ¬¡æŸ¥è¯¢æ—¶ï¼Œä¼šè¿›è¡Œå»é‡æ“ä½œï¼Œæ­¤æ—¶ä¼šå‡ºç°ä¸´æ—¶è¡¨ï¼ˆä½†æ˜¯ union all æ²¡æœ‰å»é‡ï¼Œè¿˜æ˜¯ä¸¤æ¡è®°å½•ï¼‰ select åˆ— å½“å‰æŸ¥è¯¢åœ¨æ•´ä¸ªæŸ¥è¯¢ä¸­æ‰®æ¼”çš„è§’è‰² åç§° æè¿° SIMPLE ä¸åŒ…å«å­æŸ¥è¯¢å’Œ union å…³é”®å­—çš„éƒ½æ˜¯ simple ç®€å•çš„æŸ¥è¯¢ PRIMARY å¯¹äºåŒ…å«å­æŸ¥è¯¢æˆ– union å…³é”®å­—çš„æœ€å¤–å±‚çš„æŸ¥è¯¢ UNION ä½¿ç”¨ union å…³é”®å­—æ—¶è¢«è¿æ¥çš„æŸ¥è¯¢ UNION RESULT ä½¿ç”¨ union å…³é”®å­—ç”Ÿæˆçš„ä¸´æ—¶è¡¨ SUBQUERY å½“æŸ¥è¯¢å³ä¸èƒ½è¢«ä¼˜åŒ–ä¸º semi-join åˆä¸æ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼Œæ­¤æ—¶çš„å­æŸ¥è¯¢ DEPENDENT SUBQUERY å½“æŸ¥è¯¢ä¸èƒ½è¢«ä¼˜åŒ–ä¸º semi-join ä¸”æ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ä¸­ç”¨åˆ°å¤–éƒ¨è¡¨ï¼‰ï¼Œæ­¤æ—¶çš„å­æŸ¥è¯¢ DEPENDENT UNION å½“æŸ¥è¯¢ä¸èƒ½è¢«ä¼˜åŒ–ä¸º semi-join ä¸”ä½¿ç”¨åˆ°äº† unionï¼ˆå­æŸ¥è¯¢ä¸­ç”¨åˆ°å¤–éƒ¨è¡¨ï¼‰ï¼Œæ­¤æ—¶çš„ union å­æŸ¥è¯¢ DERIVED æ´¾ç”Ÿè¡¨ï¼Œåœ¨ç”¨åˆ° from å­æŸ¥è¯¢æ—¶ä½¿ç”¨åˆ°çš„ç”±å­æŸ¥è¯¢ä¸­è¡¨æ´¾ç”Ÿå‡ºçš„æŸ¥è¯¢ç»“æœ MATERIALIZED ç‰©åŒ–è¡¨ï¼Œåœ¨ç”¨åˆ° in å­æŸ¥è¯¢æ—¶åªéœ€è¦å–å‡ ä¸ªå¸¸é‡çš„æŸ¥è¯¢ç»“æœ UNCACHEABLE SUBQUERY ä¸å¸¸ç”¨ UNCACHEABLE UNION ä¸å¸¸ç”¨ partitions åˆ— åˆ†åŒºä¿¡æ¯ï¼Œç•¥ å½“æŸ¥è¯¢çš„è¡¨ä¸ºåˆ†åŒºè¡¨æ—¶æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯ type åˆ— æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„è®¿é—®æ–¹æ³• system å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•å¹¶ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ ç»Ÿè®¡æ•°æ® æ˜¯ç²¾ç¡®çš„å¦‚ MyISAMã€Memory const å½“å¯¹å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ç´¢è¿™ç§å¸¸æ•°è¿›è¡Œ ç­‰å€¼åŒ¹é… æ—¶ eq_ref å½“è¢«é©±åŠ¨è¡¨é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•è¿›è¡Œ ç­‰å€¼åŒ¹é… æ—¶ï¼Œè¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹æ³•æ˜¯ eq_ref ref å½“ä½¿ç”¨çš„æ˜¯æ™®é€šçš„äºŒçº§ç´¢å¼•ä¸ å¸¸é‡ ç›´æ¥è¿›è¡Œ ç­‰å€¼åŒ¹é… æ—¶ fulltext å…¨æ–‡æ£€ç´¢æ—¶ ref_or_null å½“ä½¿ç”¨çš„æ˜¯æ™®é€šçš„äºŒçº§ç´¢å¼•ä¸ å¸¸é‡ ç›´æ¥è¿›è¡ŒåŒ¹é…ï¼Œæ¡ä»¶ä¸­æœ‰ OR xx IS NULL æ—¶ index_merge å½“ä½¿ç”¨å¤šä¸ªç´¢å¼•åˆå¹¶æŸ¥è¯¢æ—¶ unique_subquery å½“æŸ¥è¯¢ä¼˜åŒ–å™¨å°† in çš„å­æŸ¥è¯¢ä¼˜åŒ–æˆ exits æŸ¥è¯¢æ—¶ï¼ˆå­æŸ¥è¯¢çš„è¿æ¥æ¡ä»¶å¯ä»¥ä½¿è¯­å¥è½¬æ¢ä¸ºè¿æ¥æŸ¥è¯¢æ—¶ï¼‰ index_subquery ç±»ä¼¼äº unique_subquery range å½“è¯­å¥çš„æ¡ä»¶ä¸­ç”¨åˆ° in æˆ–æœ‰æ˜ç¡®çš„ èŒƒå›´åŒºé—´ æ—¶ index å½“ä½¿ç”¨åˆ° ç´¢å¼•è¦†ç›– ä½†éœ€è¦æ‰«æå…¨éƒ¨ç´¢å¼•è®°å½•æ—¶ï¼ˆä¸ç¬¦åˆè”åˆç´¢å¼• æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œæ­¤æ—¶éœ€è¦æ‰«ææ•´ä¸ªç´¢å¼•ä½†ä¸éœ€è¦å›è¡¨ï¼‰ ALL å…¨è¡¨æ‰«æ possible_keys åˆ— å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼• key åˆ— å®é™…ç”¨åˆ°çš„ç´¢å¼• key_len åˆ— å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•é•¿åº¦å­—èŠ‚æ•°ã€‚é’ˆå¯¹äº è”åˆç´¢å¼•ï¼Œå€¼è¶Šå¤§è¯æ˜è¶Šå……åˆ†åˆ©ç”¨åˆ°ç´¢å¼• key2 ä¸º int ç±»å‹å  4 ä¸ªå­—èŠ‚ï¼Œä½† key2 å¹¶ä¸æ˜¯éç©ºå­—æ®µï¼Œæ‰€ä»¥ 4 + 1 = 5 key1 ä¸º varchar(100) ç±»å‹ï¼Œä½† key1 æœ‰å¯èƒ½ä¸ºç©ºï¼Œè¿˜éœ€è¦ä¸¤ä¸ªå­—èŠ‚è®°å½•å˜é•¿ç±»å‹çš„å®é™…é•¿åº¦ï¼Œæ‰€ä»¥ 3 * 100 + 1 + 2 = 303 ref åˆ— å½“ç´¢å¼•åˆ—ä¸ºç­‰å€¼è¿æ¥æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯ rows åˆ— é¢„ä¼°çš„éœ€è¦è¯»å–çš„æ¡ç›®æ•°ï¼Œè¶Šå°‘è¶Šå¥½ filtered åˆ— ç»è¿‡æœç´¢æ¡ä»¶è¿‡æ»¤åå‰©ä½™è®°å½•æ¡æ•°çš„ç™¾åˆ†æ¯”ï¼Œè¶Šå¤§è¶Šå¥½ åœ¨è¿æ¥æŸ¥è¯¢ä¸­é©±åŠ¨è¡¨ éœ€è¦è¯»å–çš„æ¡ç›® * è¿‡æ»¤åå‰©ä½™è®°å½•çš„ç™¾åˆ†æ¯” å°±æ˜¯è¢«é©±åŠ¨è¡¨çš„æ‰§è¡Œæ¬¡æ•°ï¼š9895 * 10% â‰ˆ 989 æ¬¡ Extra åˆ— é€šè¿‡è¿™äº›é¢å¤–çš„ä¿¡æ¯å¯ä»¥ æ›´å‡†ç¡®çš„ç†è§£ MySQL åˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥ No tables used æ²¡æœ‰ from æ¡ä»¶æ—¶ Impossible WHERE ä¸å¯èƒ½çš„è¿‡æ»¤æ¡ä»¶ Using where å½“ä½¿ç”¨å…¨è¡¨æ‰«æå¹¶æŒ‡å®šäº† where æ¡ä»¶æ—¶ No matching min/max row æ²¡æœ‰åŒ¹é…çš„æ•°æ® Using index ä½¿ç”¨åˆ°äº† è¦†ç›–ç´¢å¼• Using index condition ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼Œæœ‰ç´¢å¼•åˆ—ä½†æ˜¯ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ­¤æ—¶ä¼šæ ¹æ® â€˜%aâ€™ çš„æ¡ä»¶è¿›è¡Œå›è¡¨ Using join buffer (hash join) é©±åŠ¨è¡¨ä¸èƒ½åˆ©ç”¨ç´¢å¼•æ—¶ï¼ŒMySQL ä¸€èˆ¬ä¼šåˆ†é…ä¸€ä¸ªåå« join buffer çš„å†…å­˜å—æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œä¹Ÿå°±æ˜¯ åŸºäºå—çš„åµŒå¥—å¾ªç¯ç®—æ³• Not exists ä¸å­˜åœ¨çš„ï¼Œå½“ä½¿ç”¨å·¦å¤–è¿æ¥æ—¶ï¼Œå³è¡¨çš„ s2 ä¸»é”®ä¸å¯èƒ½ä¸º NULL Using union(idx_key1,idx_key3); Using where ç”¨åˆ°äº†åˆå¹¶ Zero limit å½“ limit å€¼ä¸º 0 æ—¶ Using filesort ğŸ™‚å¯¹ç»“æœé›† order by æ—¶ä½¿ç”¨åˆ°äº†ç´¢å¼• æˆ– â˜¹æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œéœ€è¦åœ¨å†…å­˜ä¸­æˆ–ç£ç›˜ä¸­è¿›è¡Œæ’åº Using temporary ç”¨åˆ°äº†å†…éƒ¨ä¸´æ—¶è¡¨ï¼Œåº”å°½é‡è§„é¿ EXPLAIN ä¸è€ƒè™‘å„ç§ Cache EXPLAIN ä¸èƒ½æ˜¾ç¤º MySQL åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ EXPLAIN ä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µ éƒ¨åˆ†ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼ æ›´æ”¹ explain çš„è¾“å‡ºæ ¼å¼ EXPLAIN FORMAT=xxx SELECT .... # JSON æ ¼å¼, TREE æ ¼å¼, å¯è§†åŒ–è¾“å‡ºï¼šä½¿ç”¨ MySQL æä¾›çš„ workbench å·¥å…· æŸ¥çœ‹æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼˜åŒ–åçš„è¯­å¥ # åœ¨æ‰§è¡Œ explain è¯­å¥å SHOW WARNINGS\\G ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹åˆ†ææŸ¥è¯¢è¯­å¥-explain"},{"categories":null,"content":"\ræŸ¥çœ‹ä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’ trace å¼€å¯è·Ÿè¸ªåŠŸèƒ½ # è®¾ç½®å¼€å¯è·Ÿè¸ªåŠŸèƒ½ï¼Œé…ç½®æ ¼å¼ä¸º json SET optimizer_trace=\"enabled=on\",end_markers_in_json=on; # è®¾ç½® trace èƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜ set optimizer_trace_max_mem_size=1000000; æŸ¥çœ‹è¿½è¸ªçš„ç›¸å…³ä¿¡æ¯ select * from information_schema.optimizer_trace \\G ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:6","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹ä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’-trace"},{"categories":null,"content":"\ræŸ¥çœ‹ç›‘æ§åˆ†æè§†å›¾ sys schema ç´¢å¼•ç›¸å…³ #1. æŸ¥è¯¢å†—ä½™ç´¢å¼• select * from sys.schema_redundant_indexes; #2. æŸ¥è¯¢æœªä½¿ç”¨è¿‡çš„ç´¢å¼• select * from sys.schema_unused_indexes; #3. æŸ¥è¯¢ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µ select index_name,rows_selected,rows_inserted,rows_updated,rows_deleted from sys.schema_index_statistics where table_schema='dbname'; è¡¨ç›¸å…³ # 1. æŸ¥è¯¢è¡¨çš„è®¿é—®é‡ select table_schema,table_name,sum(io_read_requests+io_write_requests) as io from sys.schema_table_statistics group by table_schema,table_name order by io desc; # 2. æŸ¥è¯¢å ç”¨bufferpoolè¾ƒå¤šçš„è¡¨ select object_schema,object_name,allocated,data from sys.innodb_buffer_stats_by_table order by allocated limit 10; # 3. æŸ¥çœ‹è¡¨çš„å…¨è¡¨æ‰«ææƒ…å†µ select * from sys.statements_with_full_table_scans where db='dbname'; è¯­å¥ç›¸å…³ #1. ç›‘æ§SQLæ‰§è¡Œçš„é¢‘ç‡ select db,exec_count,query from sys.statement_analysis order by exec_count desc; #2. ç›‘æ§ä½¿ç”¨äº†æ’åºçš„SQL select db,exec_count,first_seen,last_seen,query from sys.statements_with_sorting limit 1; #3. ç›‘æ§ä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–è€…ç£ç›˜ä¸´æ—¶è¡¨çš„SQL select db,exec_count,tmp_tables,tmp_disk_tables,query from sys.statement_analysis where tmp_tables\u003e0 or tmp_disk_tables \u003e0 order by (tmp_tables+tmp_disk_tables) desc; IO ç›¸å…³ #1. æŸ¥çœ‹æ¶ˆè€—ç£ç›˜IOçš„æ–‡ä»¶ select file,avg_read,avg_write,avg_read+avg_write as avg_io from sys.io_global_by_file_by_bytes order by avg_read limit 10; Innodb ç›¸å…³ #1. è¡Œé”é˜»å¡æƒ…å†µ select * from sys.innodb_lock_waits; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:11:7","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æŸ¥çœ‹ç›‘æ§åˆ†æè§†å›¾-sys-schema"},{"categories":null,"content":"\rç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ– SQL ä¼˜åŒ–å¤§è‡´åˆ†ä¸º ç‰©ç†æŸ¥è¯¢ä¼˜åŒ– å’Œ é€»è¾‘æŸ¥è¯¢ä¼˜åŒ– ä¸¤å¤§å— ç‰©ç†æŸ¥è¯¢ä¼˜åŒ–ï¼š æ•°æ®å¤ªå¤š â€”â€” åˆ†åº“åˆ†è¡¨ æœåŠ¡å™¨è°ƒèŠ‚ç¼“å­˜ã€çº¿ç¨‹æ•°ç­‰ â€”â€” è°ƒæ•´ my.cnf é€»è¾‘æŸ¥è¯¢ä¼˜åŒ–ï¼š ç´¢å¼•å®ç°ã€æ²¡æœ‰å……åˆ†åˆ©ç”¨åˆ°ç´¢å¼• â€”â€” ç´¢å¼•å»ºç«‹ è®¾è®¡ç¼ºé™·ã€JOIN å¤ªå¤š â€”â€” SQL ä¼˜åŒ– ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–"},{"categories":null,"content":"\rç´¢å¼•å¤±æ•ˆçš„æ¡ˆä¾‹ å…¨å€¼åŒ¹é…ï¼šé’ˆå¯¹æ²¡æœ‰ç´¢å¼•çš„åˆ—è¿›è¡Œæ¡ä»¶æŸ¥è¯¢ æœ€ä½³å·¦å‰ç¼€æ³•åˆ™ï¼šå½“ä½¿ç”¨è”åˆç´¢å¼•ç­‰å€¼æ¡ä»¶æ—¶æœ€å·¦ä¾§çš„å­—æ®µä¼˜å…ˆï¼Œå¯ä»¥ä¸æŒ‰é¡ºåºï¼Œä½† ä¸èƒ½è·¨å­—æ®µ ç°æœ‰è”åˆç´¢å¼• age, classId, name å­—æ®µï¼ŒæŸ¥è¯¢ä¸ºæŒ‰ç…§ age, name çš„æ¡ä»¶ï¼Œæ­¤æ—¶åªæœ‰ age ç´¢å¼•ç”Ÿæ•ˆï¼Œname ç´¢å¼•æœªç”Ÿæ•ˆ ä¸»é”®æ’å…¥é¡ºåºï¼š æ’å…¥çš„ä¸»é”®ä¸æ˜¯ä¾æ¬¡å¢å¤§çš„è¯ï¼Œä¸»é”®ç´¢å¼•éœ€è¦é‡æ–°ç»´æŠ¤ç”šè‡³é¡µé¢åˆ†è£‚ï¼Œé€ æˆæ€§èƒ½æŸè€— è®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ (è‡ªåŠ¨æˆ–æ‰‹åŠ¨)ï¼šå½“ where æ¡ä»¶ä¸­ä½¿ç”¨åˆ° å‡½æ•° \\ è®¡ç®— \\ ç±»å‹è½¬æ¢ åˆ™ä¸ä¼šä½¿ç”¨ç´¢å¼• ç”¨åˆ°å‡½æ•°æ—¶ ç”¨åˆ°è®¡ç®—æ—¶ ç”¨åˆ°ç±»å‹è½¬æ¢æ—¶ èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—ç´¢å¼•å¤±æ•ˆï¼šå½“ä½¿ç”¨è”åˆç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œå…¶ä¸­ä¸€é¡¹ä½¿ç”¨çš„æ˜¯èŒƒå›´æ¡ä»¶ï¼Œå…¶å³ä¾§çš„ç´¢å¼•å¤±æ•ˆ ä¸ç­‰äº ( != æˆ– \u003c\u003e ) ç´¢å¼•å¤±æ•ˆï¼šB+ æ ‘æ— æ³•æ ¹æ®ä¸ç­‰äºæ¥å¿«é€Ÿå®šä½ is null âœ”ï¼Œis not null âŒ ï¼šis null å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œis not null æ— æ³•ä½¿ç”¨ç´¢å¼• like ä»¥é€šé…ç¬¦ % å¼€å¤´ï¼šlike â€˜%xxxâ€™ ç´¢å¼•å¤±æ•ˆ OR å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—ï¼šOR çš„å‰åå­˜åœ¨éç´¢å¼•çš„åˆ—å°±ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå°±ç®— ä½¿ç”¨äº†ä¸€ä¸ªç´¢å¼•å¦ä¸€ä¾§è¿˜éœ€è¦å…¨è¡¨æ‰«æ å­—ç¬¦é›†ä¸ç»Ÿä¸€ï¼šå½“ä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œç´¢å¼•å¤±æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•å¤±æ•ˆçš„æ¡ˆä¾‹"},{"categories":null,"content":"\rå…³è”æŸ¥è¯¢çš„ä¼˜åŒ– å¤–è¿æ¥ï¼šæŸ¥è¯¢å‡ºé©±åŠ¨è¡¨ä»¥åŠå¯¹åº”çš„è¢«é©±åŠ¨è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œè¢«é©±åŠ¨è¡¨ä¸å­˜åœ¨æ•°æ®æ—¶è‡ªåŠ¨è¡¥å…… null é’ˆå¯¹äºå·¦å¤–è¿æ¥ï¼Œä¸ºå³è¡¨ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰æ·»åŠ ç´¢å¼•å³å¯é¿å…å…¨è¡¨æ‰«æ å†…è¿æ¥ï¼šæŸ¥è¯¢å‡ºä¸¤ä¸ªè¡¨åŒå¤åˆæ¡ä»¶çš„å­—æ®µ æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ï¼Œå°†æ‹¥æœ‰ç´¢å¼•çš„è¡¨ä½œä¸º è¢«é©±åŠ¨è¡¨ JOIN è¯­å¥åŸç† ä½¿ç”¨ JOIN è¿æ¥å¤šä¸ªè¡¨ï¼Œå®é™…ä¸Šå°±æ˜¯å„ä¸ªè¡¨ä¹‹é—´çš„æ•°æ®å¾ªç¯åŒ¹é…ï¼Œå°±æ˜¯ã€åµŒå¥—å¾ªç¯ã€‘ç®—æ³• é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨ åœ¨ EXPLAIN çš„ç»“æœä¸­ï¼Œä¸Šæ–¹çš„æ˜¯é©±åŠ¨è¡¨ï¼Œä¸‹æ–¹çš„æ˜¯è¢«é©±åŠ¨è¡¨ å¯¹äºå¤–è¿æ¥å’Œå†…è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ éƒ½ç”±æŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®š å½“ä¸¤ä¸ªè¡¨éƒ½æœ‰ç´¢å¼•æˆ–éƒ½æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨ åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆIndex Nested-Loop Joinï¼‰ é©±åŠ¨è¡¨æ ¹æ®ç´¢å¼•å‘è¢«é©±åŠ¨è¡¨åŒ¹é…æ•°æ®ï¼Œä¸éœ€è¦æ‰«æ t1 è¡¨ï¼ˆå†…è¡¨ï¼‰ æ ¹æ®ç´¢å¼•è¯»å–åŒ¹é…çš„ t2 è¡¨æ•°æ®ï¼Œä¸éœ€è¦å…¨è¡¨æ‰«æ å¦‚æœ t2 è¡¨ä¸ºäºŒçº§ç´¢å¼•åˆ™éœ€è¦å›è¡¨ï¼Œå› t2 è¡¨çš„ç´¢å¼•åŒ¹é…æ¬¡æ•°å³å¯ å—åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆBlock Nested-Loop Joinï¼‰ å°†é©±åŠ¨è¡¨æ•°æ®åˆ†ä¸ºå‡ å—ï¼Œå¤šæ¬¡å‘è¢«é©±åŠ¨è¡¨åŒ¹é… æ ¹æ®ç¼“å†²åŒºï¼ˆjoin_buffer ï¼‰çš„å¤§å°å°† t1 è¡¨åˆ†ä¸ºå¤šå— ä¸è¦å°†è¿‡å¤šçš„é©±åŠ¨è¡¨æ— ç”¨å­—æ®µï¼Œè¿™æ ·ä¼šå ç”¨ JOIN_BUFFER å¯¼è‡´æ¯æ¬¡ç¼“å†²åŒºçš„æ¡ç›®æ•°å˜å°‘ è°ƒèŠ‚ join_buffer å¤§å°ï¼š # æŸ¥çœ‹ç¼“å†²åŒºå¤§å° é»˜è®¤å¼€å¯ 256k show variables like '%join_buffer%'; # 32 ä½ç³»ç»Ÿæœ€å¤šå¯ä»¥è®¾ç½®ä¸º 4G ã€64 ä½ç³»ç»Ÿå¯ä»¥è®¾ç½® 4G ä»¥ä¸Š æ•´ä½“æ•ˆç‡ï¼šINLJ \u003e BNLJ \u003e SNLJ æ°¸è¿œä½¿ç”¨ å°çš„ç»“æœé›† é©±åŠ¨ å¤§çš„ç»“æœé›†ï¼ˆç»“æœé›† = è¡¨è¡Œæ•° * æ¯è¡Œå¤§å°ï¼‰ ä¸ºè¢«é©±åŠ¨è¡¨æ·»åŠ ç´¢å¼• å¢å¤§ join_buffer å¤§å° å‡å°‘é©±åŠ¨è¡¨çš„ä¸å¿…è¦å­—æ®µå‚ä¸æŸ¥è¯¢ MySQL 8 çš„ Hash join MySQL 8 å°† Hash join æ›¿ä»£äº† BNLJ Hash join æ˜¯ å¤§æ•°æ®æ•£åˆ—é›† çš„å¸¸ç”¨æ–¹å¼ï¼Œä¼˜åŒ–å™¨å°†ç›¸å¯¹è¾ƒå°çš„è¡¨åˆ©ç”¨ join key åœ¨å†…å­˜ä¸­å»ºç«‹ æ•£åˆ—è¡¨ ä¾æ®æ•£åˆ—è¡¨ç›´æ¥è¿›è¡Œè¿æ¥ï¼Œæ•ˆç‡é«˜ã€‚ä½†ç¬¬ä¸€æ¬¡æŸ¥è¯¢éœ€è¦å»ºç«‹å“ˆå¸Œè¡¨å ç”¨å¤§é‡å†…å­˜ï¼Œç¬¬ä¸€æ¬¡çš„ç»“æœè¿”å›æ…¢ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…³è”æŸ¥è¯¢çš„ä¼˜åŒ–"},{"categories":null,"content":"\rå…³è”æŸ¥è¯¢çš„ä¼˜åŒ– å¤–è¿æ¥ï¼šæŸ¥è¯¢å‡ºé©±åŠ¨è¡¨ä»¥åŠå¯¹åº”çš„è¢«é©±åŠ¨è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œè¢«é©±åŠ¨è¡¨ä¸å­˜åœ¨æ•°æ®æ—¶è‡ªåŠ¨è¡¥å…… null é’ˆå¯¹äºå·¦å¤–è¿æ¥ï¼Œä¸ºå³è¡¨ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰æ·»åŠ ç´¢å¼•å³å¯é¿å…å…¨è¡¨æ‰«æ å†…è¿æ¥ï¼šæŸ¥è¯¢å‡ºä¸¤ä¸ªè¡¨åŒå¤åˆæ¡ä»¶çš„å­—æ®µ æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ï¼Œå°†æ‹¥æœ‰ç´¢å¼•çš„è¡¨ä½œä¸º è¢«é©±åŠ¨è¡¨ JOIN è¯­å¥åŸç† ä½¿ç”¨ JOIN è¿æ¥å¤šä¸ªè¡¨ï¼Œå®é™…ä¸Šå°±æ˜¯å„ä¸ªè¡¨ä¹‹é—´çš„æ•°æ®å¾ªç¯åŒ¹é…ï¼Œå°±æ˜¯ã€åµŒå¥—å¾ªç¯ã€‘ç®—æ³• é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨ åœ¨ EXPLAIN çš„ç»“æœä¸­ï¼Œä¸Šæ–¹çš„æ˜¯é©±åŠ¨è¡¨ï¼Œä¸‹æ–¹çš„æ˜¯è¢«é©±åŠ¨è¡¨ å¯¹äºå¤–è¿æ¥å’Œå†…è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ éƒ½ç”±æŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®š å½“ä¸¤ä¸ªè¡¨éƒ½æœ‰ç´¢å¼•æˆ–éƒ½æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨ åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆIndex Nested-Loop Joinï¼‰ é©±åŠ¨è¡¨æ ¹æ®ç´¢å¼•å‘è¢«é©±åŠ¨è¡¨åŒ¹é…æ•°æ®ï¼Œä¸éœ€è¦æ‰«æ t1 è¡¨ï¼ˆå†…è¡¨ï¼‰ æ ¹æ®ç´¢å¼•è¯»å–åŒ¹é…çš„ t2 è¡¨æ•°æ®ï¼Œä¸éœ€è¦å…¨è¡¨æ‰«æ å¦‚æœ t2 è¡¨ä¸ºäºŒçº§ç´¢å¼•åˆ™éœ€è¦å›è¡¨ï¼Œå› t2 è¡¨çš„ç´¢å¼•åŒ¹é…æ¬¡æ•°å³å¯ å—åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆBlock Nested-Loop Joinï¼‰ å°†é©±åŠ¨è¡¨æ•°æ®åˆ†ä¸ºå‡ å—ï¼Œå¤šæ¬¡å‘è¢«é©±åŠ¨è¡¨åŒ¹é… æ ¹æ®ç¼“å†²åŒºï¼ˆjoin_buffer ï¼‰çš„å¤§å°å°† t1 è¡¨åˆ†ä¸ºå¤šå— ä¸è¦å°†è¿‡å¤šçš„é©±åŠ¨è¡¨æ— ç”¨å­—æ®µï¼Œè¿™æ ·ä¼šå ç”¨ JOIN_BUFFER å¯¼è‡´æ¯æ¬¡ç¼“å†²åŒºçš„æ¡ç›®æ•°å˜å°‘ è°ƒèŠ‚ join_buffer å¤§å°ï¼š # æŸ¥çœ‹ç¼“å†²åŒºå¤§å° é»˜è®¤å¼€å¯ 256k show variables like '%join_buffer%'; # 32 ä½ç³»ç»Ÿæœ€å¤šå¯ä»¥è®¾ç½®ä¸º 4G ã€64 ä½ç³»ç»Ÿå¯ä»¥è®¾ç½® 4G ä»¥ä¸Š æ•´ä½“æ•ˆç‡ï¼šINLJ \u003e BNLJ \u003e SNLJ æ°¸è¿œä½¿ç”¨ å°çš„ç»“æœé›† é©±åŠ¨ å¤§çš„ç»“æœé›†ï¼ˆç»“æœé›† = è¡¨è¡Œæ•° * æ¯è¡Œå¤§å°ï¼‰ ä¸ºè¢«é©±åŠ¨è¡¨æ·»åŠ ç´¢å¼• å¢å¤§ join_buffer å¤§å° å‡å°‘é©±åŠ¨è¡¨çš„ä¸å¿…è¦å­—æ®µå‚ä¸æŸ¥è¯¢ MySQL 8 çš„ Hash join MySQL 8 å°† Hash join æ›¿ä»£äº† BNLJ Hash join æ˜¯ å¤§æ•°æ®æ•£åˆ—é›† çš„å¸¸ç”¨æ–¹å¼ï¼Œä¼˜åŒ–å™¨å°†ç›¸å¯¹è¾ƒå°çš„è¡¨åˆ©ç”¨ join key åœ¨å†…å­˜ä¸­å»ºç«‹ æ•£åˆ—è¡¨ ä¾æ®æ•£åˆ—è¡¨ç›´æ¥è¿›è¡Œè¿æ¥ï¼Œæ•ˆç‡é«˜ã€‚ä½†ç¬¬ä¸€æ¬¡æŸ¥è¯¢éœ€è¦å»ºç«‹å“ˆå¸Œè¡¨å ç”¨å¤§é‡å†…å­˜ï¼Œç¬¬ä¸€æ¬¡çš„ç»“æœè¿”å›æ…¢ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#join-è¯­å¥åŸç†"},{"categories":null,"content":"\rå…³è”æŸ¥è¯¢çš„ä¼˜åŒ– å¤–è¿æ¥ï¼šæŸ¥è¯¢å‡ºé©±åŠ¨è¡¨ä»¥åŠå¯¹åº”çš„è¢«é©±åŠ¨è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œè¢«é©±åŠ¨è¡¨ä¸å­˜åœ¨æ•°æ®æ—¶è‡ªåŠ¨è¡¥å…… null é’ˆå¯¹äºå·¦å¤–è¿æ¥ï¼Œä¸ºå³è¡¨ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰æ·»åŠ ç´¢å¼•å³å¯é¿å…å…¨è¡¨æ‰«æ å†…è¿æ¥ï¼šæŸ¥è¯¢å‡ºä¸¤ä¸ªè¡¨åŒå¤åˆæ¡ä»¶çš„å­—æ®µ æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ï¼Œå°†æ‹¥æœ‰ç´¢å¼•çš„è¡¨ä½œä¸º è¢«é©±åŠ¨è¡¨ JOIN è¯­å¥åŸç† ä½¿ç”¨ JOIN è¿æ¥å¤šä¸ªè¡¨ï¼Œå®é™…ä¸Šå°±æ˜¯å„ä¸ªè¡¨ä¹‹é—´çš„æ•°æ®å¾ªç¯åŒ¹é…ï¼Œå°±æ˜¯ã€åµŒå¥—å¾ªç¯ã€‘ç®—æ³• é©±åŠ¨è¡¨ä¸è¢«é©±åŠ¨è¡¨ åœ¨ EXPLAIN çš„ç»“æœä¸­ï¼Œä¸Šæ–¹çš„æ˜¯é©±åŠ¨è¡¨ï¼Œä¸‹æ–¹çš„æ˜¯è¢«é©±åŠ¨è¡¨ å¯¹äºå¤–è¿æ¥å’Œå†…è¿æ¥æ¥è¯´ï¼Œé©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ éƒ½ç”±æŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®š å½“ä¸¤ä¸ªè¡¨éƒ½æœ‰ç´¢å¼•æˆ–éƒ½æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨ åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆIndex Nested-Loop Joinï¼‰ é©±åŠ¨è¡¨æ ¹æ®ç´¢å¼•å‘è¢«é©±åŠ¨è¡¨åŒ¹é…æ•°æ®ï¼Œä¸éœ€è¦æ‰«æ t1 è¡¨ï¼ˆå†…è¡¨ï¼‰ æ ¹æ®ç´¢å¼•è¯»å–åŒ¹é…çš„ t2 è¡¨æ•°æ®ï¼Œä¸éœ€è¦å…¨è¡¨æ‰«æ å¦‚æœ t2 è¡¨ä¸ºäºŒçº§ç´¢å¼•åˆ™éœ€è¦å›è¡¨ï¼Œå› t2 è¡¨çš„ç´¢å¼•åŒ¹é…æ¬¡æ•°å³å¯ å—åµŒå¥—å¾ªç¯ç´¢å¼•ï¼ˆBlock Nested-Loop Joinï¼‰ å°†é©±åŠ¨è¡¨æ•°æ®åˆ†ä¸ºå‡ å—ï¼Œå¤šæ¬¡å‘è¢«é©±åŠ¨è¡¨åŒ¹é… æ ¹æ®ç¼“å†²åŒºï¼ˆjoin_buffer ï¼‰çš„å¤§å°å°† t1 è¡¨åˆ†ä¸ºå¤šå— ä¸è¦å°†è¿‡å¤šçš„é©±åŠ¨è¡¨æ— ç”¨å­—æ®µï¼Œè¿™æ ·ä¼šå ç”¨ JOIN_BUFFER å¯¼è‡´æ¯æ¬¡ç¼“å†²åŒºçš„æ¡ç›®æ•°å˜å°‘ è°ƒèŠ‚ join_buffer å¤§å°ï¼š # æŸ¥çœ‹ç¼“å†²åŒºå¤§å° é»˜è®¤å¼€å¯ 256k show variables like '%join_buffer%'; # 32 ä½ç³»ç»Ÿæœ€å¤šå¯ä»¥è®¾ç½®ä¸º 4G ã€64 ä½ç³»ç»Ÿå¯ä»¥è®¾ç½® 4G ä»¥ä¸Š æ•´ä½“æ•ˆç‡ï¼šINLJ \u003e BNLJ \u003e SNLJ æ°¸è¿œä½¿ç”¨ å°çš„ç»“æœé›† é©±åŠ¨ å¤§çš„ç»“æœé›†ï¼ˆç»“æœé›† = è¡¨è¡Œæ•° * æ¯è¡Œå¤§å°ï¼‰ ä¸ºè¢«é©±åŠ¨è¡¨æ·»åŠ ç´¢å¼• å¢å¤§ join_buffer å¤§å° å‡å°‘é©±åŠ¨è¡¨çš„ä¸å¿…è¦å­—æ®µå‚ä¸æŸ¥è¯¢ MySQL 8 çš„ Hash join MySQL 8 å°† Hash join æ›¿ä»£äº† BNLJ Hash join æ˜¯ å¤§æ•°æ®æ•£åˆ—é›† çš„å¸¸ç”¨æ–¹å¼ï¼Œä¼˜åŒ–å™¨å°†ç›¸å¯¹è¾ƒå°çš„è¡¨åˆ©ç”¨ join key åœ¨å†…å­˜ä¸­å»ºç«‹ æ•£åˆ—è¡¨ ä¾æ®æ•£åˆ—è¡¨ç›´æ¥è¿›è¡Œè¿æ¥ï¼Œæ•ˆç‡é«˜ã€‚ä½†ç¬¬ä¸€æ¬¡æŸ¥è¯¢éœ€è¦å»ºç«‹å“ˆå¸Œè¡¨å ç”¨å¤§é‡å†…å­˜ï¼Œç¬¬ä¸€æ¬¡çš„ç»“æœè¿”å›æ…¢ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-8-çš„-hash-join"},{"categories":null,"content":"\rå­æŸ¥è¯¢ä¼˜åŒ– å­æŸ¥è¯¢æ˜¯ MySQL 4.1 å¼€å§‹æ”¯æŒçš„åŠŸèƒ½ï¼Œå…¶ æ•ˆç‡ä¸é«˜ æ‰§è¡Œå­æŸ¥è¯¢æ—¶éœ€è¦ä¸ºå†…éƒ¨æŸ¥è¯¢ å»ºç«‹ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œåœ¨æŸ¥è¯¢ç»“æŸåè¿˜è¦ æ’¤é”€è¿™ä¸ªä¸´æ—¶è¡¨ï¼Œé€ æˆ CPU å’Œ IO çš„æ¶ˆè€— å­æŸ¥è¯¢ç»“æœé›†å­˜å‚¨çš„ä¸´æ—¶è¡¨ ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½ä½ å­æŸ¥è¯¢çš„ ç»“æœé›†è¶Šå¤§ å¯¹æŸ¥è¯¢æ•ˆç‡çš„å½±å“è¶Šå¤§ ç»“è®ºï¼šå°½é‡ä¸è¦ä½¿ç”¨ NOT IN æˆ–è€… NOT EXISTSï¼Œç”¨ LEFT JOIN xxx ON xx WHERE xx IS NULL æ›¿ä»£ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­æŸ¥è¯¢ä¼˜åŒ–"},{"categories":null,"content":"\ræ’åºä¼˜åŒ– åœ¨ SQL è¯­å¥ä¸­æ¨èä¸º WHERE å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼• åœ¨ WHERE ä¸­ä½¿ç”¨ç´¢å¼•å¯ä»¥é¿å…å…¨è¡¨æ‰«æ åœ¨ ORDER BY ä¸­ä½¿ç”¨ç´¢å¼•å¯ä»¥é¿å… File Sort æ’åº å¦‚æœ WHERE å’Œ ORDER BY åé¢çš„åˆ—ä¸ç›¸åŒï¼Œæ¨èä½¿ç”¨è”åˆç´¢å¼•ï¼ˆå…ˆ WHERE å ORDER BY å­—æ®µï¼‰ ã€ç´¢å¼•å¤±æ•ˆã€‘åœ¨ ORDER BY åé¢ä¸ LIMIT æ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶ä¸ä½¿ç”¨ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼‰ ã€ç´¢å¼•å¤±æ•ˆã€‘å¤åˆæœ€å·¦å‰ç¼€åŸåˆ™ä½†æœ‰å­—æ®µé™åºæ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶ä¸ä½¿ç”¨ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼‰ ã€ç´¢å¼•ç”Ÿæ•ˆã€‘WHERE æ¡ä»¶ä¸å¤åˆæœ€å·¦å‰ç¼€åŸåˆ™ä½† ORDER BY æ¡ä»¶å…·æœ‰ LIMIT æ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶å…ˆä½¿ç”¨ ORDER BY ç´¢å¼•æ’åºå WHERE æ•ˆç‡æ›´é«˜ï¼‰ FileSort ç®—æ³• å‡ºç° FileSort å¹¶ä¸æ„å‘³ç€æ•ˆç‡æ¯”ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä½ å¦‚æœ WHERE æ¡ä»¶å°±å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®ï¼Œå³ä½¿ ORDER BY æ¡ä»¶æ‹¥æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¹Ÿæœªå¿…ä¼šä½¿ç”¨ã€åä¹‹äº¦ç„¶ã€‘ ã€åŒè·¯æ’åºã€‘ï¼šåœ¨ MySQL 4.1 å‰ä½¿ç”¨ï¼Œå¯¹äº ORDER BY çš„åˆ—å…ˆè¿›è¡Œæ’åºï¼Œå†äºŒæ¬¡æ ¹æ® ORDER BY çš„é¡ºåºæŸ¥æ‰¾è¡¨ä¸­å…¶å®ƒå­—æ®µçš„å®Œæ•´æ•°æ®ï¼ˆä¸¤æ¬¡ IOï¼‰ ã€å•è·¯æ’åºã€‘ï¼šå…ˆè¯»å–æ‰€æœ‰åˆ—ï¼Œæ ¹æ® ORDER BY æ¡ä»¶åœ¨ buffer è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼ˆåªéœ€è¦ä¾æ¬¡é¡ºåº IOï¼‰ ç”±äºä½¿ç”¨çš„æ˜¯ å•è·¯æ’åº åº”å°è¯•æé«˜ sort_buffer_size å°è¯•æé«˜ max_length_for_sort_dataï¼Œå¦‚æœå­—æ®µçš„é•¿åº¦å¤§äºè¿™ä¸ªå˜é‡çš„å€¼ï¼Œä¼šé‡‡ç”¨åŒè·¯æ’åº Order by æ—¶select * æ˜¯ä¸€ä¸ªå¤§å¿Œï¼Œæœ‰å¯èƒ½ä½¿å­—æ®µé•¿åº¦è¶…è¿‡ max_length_for_sort_dataï¼Œæœ€å¥½åª Query éœ€è¦çš„å­—æ®µã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ’åºä¼˜åŒ–"},{"categories":null,"content":"\ræ’åºä¼˜åŒ– åœ¨ SQL è¯­å¥ä¸­æ¨èä¸º WHERE å’Œ ORDER BY å­å¥ä¸­ä½¿ç”¨ç´¢å¼• åœ¨ WHERE ä¸­ä½¿ç”¨ç´¢å¼•å¯ä»¥é¿å…å…¨è¡¨æ‰«æ åœ¨ ORDER BY ä¸­ä½¿ç”¨ç´¢å¼•å¯ä»¥é¿å… File Sort æ’åº å¦‚æœ WHERE å’Œ ORDER BY åé¢çš„åˆ—ä¸ç›¸åŒï¼Œæ¨èä½¿ç”¨è”åˆç´¢å¼•ï¼ˆå…ˆ WHERE å ORDER BY å­—æ®µï¼‰ ã€ç´¢å¼•å¤±æ•ˆã€‘åœ¨ ORDER BY åé¢ä¸ LIMIT æ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶ä¸ä½¿ç”¨ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼‰ ã€ç´¢å¼•å¤±æ•ˆã€‘å¤åˆæœ€å·¦å‰ç¼€åŸåˆ™ä½†æœ‰å­—æ®µé™åºæ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶ä¸ä½¿ç”¨ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼‰ ã€ç´¢å¼•ç”Ÿæ•ˆã€‘WHERE æ¡ä»¶ä¸å¤åˆæœ€å·¦å‰ç¼€åŸåˆ™ä½† ORDER BY æ¡ä»¶å…·æœ‰ LIMIT æ—¶ï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨è§‰å¾— æ•°æ®é‡å° æ—¶å…ˆä½¿ç”¨ ORDER BY ç´¢å¼•æ’åºå WHERE æ•ˆç‡æ›´é«˜ï¼‰ FileSort ç®—æ³• å‡ºç° FileSort å¹¶ä¸æ„å‘³ç€æ•ˆç‡æ¯”ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä½ å¦‚æœ WHERE æ¡ä»¶å°±å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®ï¼Œå³ä½¿ ORDER BY æ¡ä»¶æ‹¥æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¹Ÿæœªå¿…ä¼šä½¿ç”¨ã€åä¹‹äº¦ç„¶ã€‘ ã€åŒè·¯æ’åºã€‘ï¼šåœ¨ MySQL 4.1 å‰ä½¿ç”¨ï¼Œå¯¹äº ORDER BY çš„åˆ—å…ˆè¿›è¡Œæ’åºï¼Œå†äºŒæ¬¡æ ¹æ® ORDER BY çš„é¡ºåºæŸ¥æ‰¾è¡¨ä¸­å…¶å®ƒå­—æ®µçš„å®Œæ•´æ•°æ®ï¼ˆä¸¤æ¬¡ IOï¼‰ ã€å•è·¯æ’åºã€‘ï¼šå…ˆè¯»å–æ‰€æœ‰åˆ—ï¼Œæ ¹æ® ORDER BY æ¡ä»¶åœ¨ buffer è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼ˆåªéœ€è¦ä¾æ¬¡é¡ºåº IOï¼‰ ç”±äºä½¿ç”¨çš„æ˜¯ å•è·¯æ’åº åº”å°è¯•æé«˜ sort_buffer_size å°è¯•æé«˜ max_length_for_sort_dataï¼Œå¦‚æœå­—æ®µçš„é•¿åº¦å¤§äºè¿™ä¸ªå˜é‡çš„å€¼ï¼Œä¼šé‡‡ç”¨åŒè·¯æ’åº Order by æ—¶select * æ˜¯ä¸€ä¸ªå¤§å¿Œï¼Œæœ‰å¯èƒ½ä½¿å­—æ®µé•¿åº¦è¶…è¿‡ max_length_for_sort_dataï¼Œæœ€å¥½åª Query éœ€è¦çš„å­—æ®µã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#filesort-ç®—æ³•"},{"categories":null,"content":"\rGROUP BY ä¼˜åŒ– GROUP BY çš„ç´¢å¼•ä½¿ç”¨åŸç†åŒ ORDER BY ï¼ŒGROUP BY ä¼šå…ˆæ’åºååˆ†ç»„ æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—æ—¶ä¹Ÿå°è¯•æé«˜ sort_buffer_size max_length_for_sort_data WHERE çš„æ•ˆç‡é«˜äº HAVING èƒ½ä½¿ç”¨ WHERE å°±ä¸è¦ä½¿ç”¨ HAVING ä½¿ç”¨äº† ORDER BYã€GROUP BYã€DISTINCT çš„è¯­å¥ï¼ŒWHERE æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„æ¡æ•°ä¸è¦è¶…è¿‡ 1000 æ¡ï¼Œå¦åˆ™ SQL ä¼šå¾ˆæ…¢ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#group-by-ä¼˜åŒ–"},{"categories":null,"content":"\rä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢ å½“å‡ºç° limit 2000000, 10 è¿™ç§æƒ…å†µæ—¶ explain select * from student limit 2000000, 10; # å¯ä»¥ä½¿ç”¨å…¶å®ƒç´¢å¼•åˆ—å°† limit è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ EXPLAIN SELECT * FROM student WHERE id \u003e 2000000 LIMIT 10; # åœ¨ç´¢å¼•ä¸Šå®ç° limit æŸ¥è¯¢ï¼Œç„¶åæ ¹æ®ä¸»é”®è¿æ¥å›è¡¨æŸ¥è¯¢å…¶ä»–åˆ—ã€æ¨èã€‘ EXPLAIN SELECT * FROM student t,(SELECT id FROM student ORDER BY id LIMIT 2000000,10) a WHERE t.id = a.id; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:6","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"},{"categories":null,"content":"\rä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼• è¦†ç›–ï¼šæŒ‡æŸ¥è¯¢ä½¿ç”¨åˆ°çš„ç´¢å¼•å­—æ®µä»¥åŠä¸»é”®å­—æ®µè¦†ç›–äº†è¦æŸ¥è¯¢çš„å­—æ®µ å°±æ˜¯è¯´å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ª B+ æ ‘ä¸­æŸ¥è¯¢åˆ°æƒ³è¦çš„å­—æ®µï¼Œè€Œä¸ç”¨å›è¡¨æŸ¥è¯¢å…¶å®ƒ ç´¢å¼•ä¸­æ²¡æœ‰ çš„å­—æ®µ ä¸€ä¸ªç´¢å¼•åŒ…å«äº†æ»¡è¶³æŸ¥è¯¢ç»“æœçš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼• åœ¨ä¸€äº›ç´¢å¼•å¤±æ•ˆçš„æ¡ˆä¾‹ä¸­ï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•å¹¶ä¸ä¸€å®šä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ è¦†ç›–ç´¢å¼•çš„ä¼˜ç‚¹ï¼š é¿å… Innodb è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ï¼ˆå›è¡¨ï¼‰ å¯ä»¥æŠŠ éšæœº IO å˜æˆ é¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡ è¦†ç›–ç´¢å¼•çš„ç¼ºç‚¹ï¼š ç´¢å¼•å­—æ®µçš„ç»´æŠ¤ æ€»æ˜¯æœ‰ä»£ä»·çš„ã€‚å› æ­¤ï¼Œåœ¨å»ºç«‹å†—ä½™ç´¢å¼•æ¥æ”¯æŒè¦†ç›–ç´¢å¼•æ—¶å°±éœ€è¦æƒè¡¡è€ƒè™‘äº†ã€‚è¿™æ˜¯ä¸šåŠ¡ DBAï¼Œæˆ–è€…ç§°ä¸ºä¸šåŠ¡æ•°æ®æ¶æ„å¸ˆçš„å·¥ä½œã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:7","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼•"},{"categories":null,"content":"\rå­—ç¬¦ä¸²çš„ç´¢å¼• å¯¹å­—ç¬¦ä¸²çš„ç´¢å¼•ä¼˜åŒ–ä¸»è¦æ˜¯ä½¿ç”¨ å‰ç¼€ç´¢å¼• ä¾‹å¦‚å¯¹é‚®ç®±å·è¿›è¡Œæ£€ç´¢ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬ ç»“è®ºï¼š ä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†ï¼Œè¿™ä¹Ÿæ˜¯ä½ åœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨å‰ç¼€ç´¢å¼•æ—¶éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:8","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å­—ç¬¦ä¸²çš„ç´¢å¼•"},{"categories":null,"content":"\rç´¢å¼•ä¸‹æ¨ ICP Index Condition Pushdown (ICP) æ˜¯ MySQL 5.6 ä¸­æ–°ç‰¹æ€§ æ˜¯ä¸€ç§ åœ¨å­˜å‚¨å¼•æ“å±‚ ä½¿ç”¨ç´¢å¼• è¿‡æ»¤æ•°æ® çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ ICP å¯ä»¥å‡å°‘å­˜å‚¨å¼•æ“è®¿é—®åŸºè¡¨çš„æ¬¡æ•°ä»¥åŠ MySQL æœåŠ¡å™¨è®¿é—®å­˜å‚¨å¼•æ“çš„æ¬¡æ•° åœ¨è¿™æ¬¡æŸ¥è¯¢ä¸­ lastname like '%å¼ %' çš„æ¡ä»¶ç†åº”ä½¿æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œç”±æŸ¥è¯¢å¼•æ“æŸ¥è¯¢å‡ºå¤åˆ zipcode = '000001' çš„æ•°æ®åå†ç”±æœåŠ¡å±‚ä¾æ¬¡å›è¡¨ ä½†æ˜¯ç”±äºä½¿ç”¨åˆ°äº† ICP ç´¢å¼•ä¸‹æ¨ï¼Œåœ¨å­˜å‚¨å¼•æ“ä¸­å°±ç›´æ¥è¿‡æ»¤å‡º zipcode å’Œ lastname çš„æ•°æ®ï¼Œå‡å°‘å›è¡¨ä»¥åŠä¼ é€’åˆ°æœåŠ¡å±‚çš„æˆæœ¬ # æ‰“å¼€ç´¢å¼•ä¸‹æ¨ ã€é»˜è®¤å¼€å¯ã€‘ SET optimizer_switch = 'index_condition_pushdown=on'; # å…³é—­ç´¢å¼•ä¸‹æ¨ SET optimizer_switch = 'index_condition_pushdown=off'; åœ¨ type ä¸º range ã€ ref ã€ eq_ref æˆ–è€… ref_or_null æ—¶å¯ä½¿ç”¨ ICP ä»…å¯¹äºŒçº§ç´¢å¼•ï¼ˆéœ€è¦å›è¡¨ï¼‰æ—¶æœ‰æ•ˆï¼Œåœ¨ç”¨åˆ°è¦†ç›–ç´¢å¼•ï¼ˆä¸éœ€è¦å›è¡¨ï¼‰æ—¶æ— æ•ˆ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:9","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ç´¢å¼•ä¸‹æ¨-icp"},{"categories":null,"content":"\rå…¶å®ƒä¼˜åŒ–ç­–ç•¥ EXISTS å’Œ IN çš„åŒºåˆ† existsï¼šæ˜¯å¦å­˜åœ¨ï¼Œä¼šç›´æ¥è¿”å›å¸ƒå°”ç±»å‹ SELECT * FROM A WHERE cc IN (SELECT cc FROM B) # ã€ Bè¡¨å° æ—¶æ¨èã€‘ SELECT * FROM A WHERE EXISTS (SELECT cc FROM B WHERE B.cc = A.cc) # ã€ Aè¡¨å° æ—¶æ¨èã€‘ COUNT(*) çš„æ•ˆç‡ å½“ä½¿ç”¨ InnoDB æ—¶ï¼šCOUNT(*) å’Œ COUNT(1) éƒ½éœ€è¦å¯¹æ‰€æœ‰ç»“æœè¿›è¡Œ countï¼Œæ•ˆç‡ä¸º O(n) å½“ä½¿ç”¨ MyISAM æ—¶ï¼šç»Ÿè®¡æ•°æ®çš„è¡Œæ•°ç”± meta ä¿¡æ¯è®°å½•è®°å½•æ•° row_count ï¼Œæ•ˆç‡ä¸º O(1) å…¶ä¸€è‡´æ€§ç”± è¡¨çº§é” ä¿è¯ SELECT * çš„æ•ˆç‡ åœ¨è§£ææ—¶éœ€è¦å°† * è½¬åŒ–ä¸ºå…·ä½“çš„å­—æ®µï¼Œä¼šå¤§å¤§æµªè´¹æ—¶é—´ æ— æ³•ä½¿ç”¨ è¦†ç›–ç´¢å¼• LIMIT 1 çš„æ•ˆç‡ é’ˆå¯¹ä¼šå…¨è¡¨æ‰«æçš„æŸ¥è¯¢ï¼Œä½¿ç”¨ LIMIT 1 å½“æŸ¥è¯¢åˆ°ä¸€æ¡æ•°æ®å°±ä¸ä¼šç»§ç»­æ‰«æäº†ï¼Œä¼šæé«˜æ•ˆç‡ ä½†å½“å·²ç»å¯¹å­—æ®µå»ºç«‹äº†å”¯ä¸€ç´¢å¼•æ—¶ï¼Œå°±ä¸éœ€è¦ LIMI 1 äº† å¤šä½¿ç”¨ commit é‡Šæ”¾ç”¨äºæ¢å¤æ•°æ®æ¶ˆæ¯çš„ç©ºé—´ é‡Šæ”¾è·å¾—çš„é” é‡Šæ”¾æ—¥å¿—æ–‡ä»¶çš„ç©ºé—´ å‡å°‘ä»¥ä¸Šçš„ç®¡ç†æˆæœ¬ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:10","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…¶å®ƒä¼˜åŒ–ç­–ç•¥"},{"categories":null,"content":"\ræ·˜å®çš„æ•°æ®åº“è®¾è®¡ æ·˜å®ä½¿ç”¨è‡ªå¢é•¿ä¸»é”®å˜›ï¼Ÿ ç­”ï¼šæ²¡æœ‰ï¼ è‡ªå¢é•¿ä¸»é”®çš„é—®é¢˜ å¯é æ€§ä¸é«˜ï¼šMySQL 8 ä¹‹å‰ç‰ˆæœ¬å­˜åœ¨ ID å›æº¯é—®é¢˜ å®‰å…¨æ€§ä¸é«˜ï¼šå¾ˆå®¹æ˜“è¢«çŒœåˆ° ID å€¼å’Œæ•°æ®é‡ç­‰ä¿¡æ¯ æ€§èƒ½å·®ï¼šéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡ç«¯ç”Ÿæˆ äº¤äº’å¤šï¼šéœ€è¦ last_insert_id() æŸ¥è¯¢åˆšæ’å…¥çš„è‡ªå¢å€¼ å±€éƒ¨å”¯ä¸€æ€§ï¼šåœ¨è‡ªèº«è¡¨æ˜¯å”¯ä¸€çš„ï¼Œä½†åœ¨åˆ†å¸ƒå¼ä¸­æ— æ³•ç¡®å®šå”¯ä¸€æ€§ ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®ï¼Ÿ ä½¿ç”¨ä¼šå‘˜å¡å·ä½œä¸ºä¸»é”® å½“ä¼šå‘˜å¡æ›´æ¢ä¸»äººæ—¶ï¼Œå…¶ä¹‹å‰å…³è”çš„ä¸šåŠ¡æ•°æ®å°±æ— æ³•ç¡®å®šä¸»äººäº† ä½¿ç”¨èº«ä»½è¯å·ä½œä¸ºä¸»é”® å­˜åœ¨è¢«å›æ”¶ï¼Œé‡å¤å€¼ï¼Œä¸ªäººéšç§çš„é—®é¢˜ ä½¿ç”¨ UUID åšä¸»é”®ï¼Ÿ UUID çš„ç‰¹ç‚¹ï¼šå…¨å±€å”¯ä¸€ï¼Œå ç”¨36å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·® åœ¨ MySQL 8 ä¸­å¯ä»¥ä½¿ç”¨ uuid_to_bin(UUID(), true) ç”Ÿæˆ è°ƒæ¢äº†æ—¶é—´é«˜ä½ä½ çš„ æœ‰åºå•è°ƒé€’å¢ 16ä½ UUID ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:11","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ·˜å®çš„æ•°æ®åº“è®¾è®¡"},{"categories":null,"content":"\ræ·˜å®çš„æ•°æ®åº“è®¾è®¡ æ·˜å®ä½¿ç”¨è‡ªå¢é•¿ä¸»é”®å˜›ï¼Ÿ ç­”ï¼šæ²¡æœ‰ï¼ è‡ªå¢é•¿ä¸»é”®çš„é—®é¢˜ å¯é æ€§ä¸é«˜ï¼šMySQL 8 ä¹‹å‰ç‰ˆæœ¬å­˜åœ¨ ID å›æº¯é—®é¢˜ å®‰å…¨æ€§ä¸é«˜ï¼šå¾ˆå®¹æ˜“è¢«çŒœåˆ° ID å€¼å’Œæ•°æ®é‡ç­‰ä¿¡æ¯ æ€§èƒ½å·®ï¼šéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡ç«¯ç”Ÿæˆ äº¤äº’å¤šï¼šéœ€è¦ last_insert_id() æŸ¥è¯¢åˆšæ’å…¥çš„è‡ªå¢å€¼ å±€éƒ¨å”¯ä¸€æ€§ï¼šåœ¨è‡ªèº«è¡¨æ˜¯å”¯ä¸€çš„ï¼Œä½†åœ¨åˆ†å¸ƒå¼ä¸­æ— æ³•ç¡®å®šå”¯ä¸€æ€§ ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®ï¼Ÿ ä½¿ç”¨ä¼šå‘˜å¡å·ä½œä¸ºä¸»é”® å½“ä¼šå‘˜å¡æ›´æ¢ä¸»äººæ—¶ï¼Œå…¶ä¹‹å‰å…³è”çš„ä¸šåŠ¡æ•°æ®å°±æ— æ³•ç¡®å®šä¸»äººäº† ä½¿ç”¨èº«ä»½è¯å·ä½œä¸ºä¸»é”® å­˜åœ¨è¢«å›æ”¶ï¼Œé‡å¤å€¼ï¼Œä¸ªäººéšç§çš„é—®é¢˜ ä½¿ç”¨ UUID åšä¸»é”®ï¼Ÿ UUID çš„ç‰¹ç‚¹ï¼šå…¨å±€å”¯ä¸€ï¼Œå ç”¨36å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·® åœ¨ MySQL 8 ä¸­å¯ä»¥ä½¿ç”¨ uuid_to_bin(UUID(), true) ç”Ÿæˆ è°ƒæ¢äº†æ—¶é—´é«˜ä½ä½ çš„ æœ‰åºå•è°ƒé€’å¢ 16ä½ UUID ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:11","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è‡ªå¢é•¿ä¸»é”®çš„é—®é¢˜"},{"categories":null,"content":"\ræ·˜å®çš„æ•°æ®åº“è®¾è®¡ æ·˜å®ä½¿ç”¨è‡ªå¢é•¿ä¸»é”®å˜›ï¼Ÿ ç­”ï¼šæ²¡æœ‰ï¼ è‡ªå¢é•¿ä¸»é”®çš„é—®é¢˜ å¯é æ€§ä¸é«˜ï¼šMySQL 8 ä¹‹å‰ç‰ˆæœ¬å­˜åœ¨ ID å›æº¯é—®é¢˜ å®‰å…¨æ€§ä¸é«˜ï¼šå¾ˆå®¹æ˜“è¢«çŒœåˆ° ID å€¼å’Œæ•°æ®é‡ç­‰ä¿¡æ¯ æ€§èƒ½å·®ï¼šéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡ç«¯ç”Ÿæˆ äº¤äº’å¤šï¼šéœ€è¦ last_insert_id() æŸ¥è¯¢åˆšæ’å…¥çš„è‡ªå¢å€¼ å±€éƒ¨å”¯ä¸€æ€§ï¼šåœ¨è‡ªèº«è¡¨æ˜¯å”¯ä¸€çš„ï¼Œä½†åœ¨åˆ†å¸ƒå¼ä¸­æ— æ³•ç¡®å®šå”¯ä¸€æ€§ ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®ï¼Ÿ ä½¿ç”¨ä¼šå‘˜å¡å·ä½œä¸ºä¸»é”® å½“ä¼šå‘˜å¡æ›´æ¢ä¸»äººæ—¶ï¼Œå…¶ä¹‹å‰å…³è”çš„ä¸šåŠ¡æ•°æ®å°±æ— æ³•ç¡®å®šä¸»äººäº† ä½¿ç”¨èº«ä»½è¯å·ä½œä¸ºä¸»é”® å­˜åœ¨è¢«å›æ”¶ï¼Œé‡å¤å€¼ï¼Œä¸ªäººéšç§çš„é—®é¢˜ ä½¿ç”¨ UUID åšä¸»é”®ï¼Ÿ UUID çš„ç‰¹ç‚¹ï¼šå…¨å±€å”¯ä¸€ï¼Œå ç”¨36å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·® åœ¨ MySQL 8 ä¸­å¯ä»¥ä½¿ç”¨ uuid_to_bin(UUID(), true) ç”Ÿæˆ è°ƒæ¢äº†æ—¶é—´é«˜ä½ä½ çš„ æœ‰åºå•è°ƒé€’å¢ 16ä½ UUID ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:11","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®"},{"categories":null,"content":"\ræ·˜å®çš„æ•°æ®åº“è®¾è®¡ æ·˜å®ä½¿ç”¨è‡ªå¢é•¿ä¸»é”®å˜›ï¼Ÿ ç­”ï¼šæ²¡æœ‰ï¼ è‡ªå¢é•¿ä¸»é”®çš„é—®é¢˜ å¯é æ€§ä¸é«˜ï¼šMySQL 8 ä¹‹å‰ç‰ˆæœ¬å­˜åœ¨ ID å›æº¯é—®é¢˜ å®‰å…¨æ€§ä¸é«˜ï¼šå¾ˆå®¹æ˜“è¢«çŒœåˆ° ID å€¼å’Œæ•°æ®é‡ç­‰ä¿¡æ¯ æ€§èƒ½å·®ï¼šéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡ç«¯ç”Ÿæˆ äº¤äº’å¤šï¼šéœ€è¦ last_insert_id() æŸ¥è¯¢åˆšæ’å…¥çš„è‡ªå¢å€¼ å±€éƒ¨å”¯ä¸€æ€§ï¼šåœ¨è‡ªèº«è¡¨æ˜¯å”¯ä¸€çš„ï¼Œä½†åœ¨åˆ†å¸ƒå¼ä¸­æ— æ³•ç¡®å®šå”¯ä¸€æ€§ ä½¿ç”¨ä¸šåŠ¡å­—æ®µä½œä¸ºä¸»é”®ï¼Ÿ ä½¿ç”¨ä¼šå‘˜å¡å·ä½œä¸ºä¸»é”® å½“ä¼šå‘˜å¡æ›´æ¢ä¸»äººæ—¶ï¼Œå…¶ä¹‹å‰å…³è”çš„ä¸šåŠ¡æ•°æ®å°±æ— æ³•ç¡®å®šä¸»äººäº† ä½¿ç”¨èº«ä»½è¯å·ä½œä¸ºä¸»é”® å­˜åœ¨è¢«å›æ”¶ï¼Œé‡å¤å€¼ï¼Œä¸ªäººéšç§çš„é—®é¢˜ ä½¿ç”¨ UUID åšä¸»é”®ï¼Ÿ UUID çš„ç‰¹ç‚¹ï¼šå…¨å±€å”¯ä¸€ï¼Œå ç”¨36å­—èŠ‚ï¼Œæ•°æ®æ— åºï¼Œæ’å…¥æ€§èƒ½å·® åœ¨ MySQL 8 ä¸­å¯ä»¥ä½¿ç”¨ uuid_to_bin(UUID(), true) ç”Ÿæˆ è°ƒæ¢äº†æ—¶é—´é«˜ä½ä½ çš„ æœ‰åºå•è°ƒé€’å¢ 16ä½ UUID ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:12:11","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä½¿ç”¨-uuid-åšä¸»é”®"},{"categories":null,"content":"\ræ•°æ®åº“çš„è®¾è®¡è§„èŒƒ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:13:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ"},{"categories":null,"content":"\rå…­å¤§èŒƒå¼ å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå…³äºæ•°æ®è¡¨è®¾è®¡çš„åŸºæœ¬åŸåˆ™ã€è§„åˆ™çš„çº§åˆ«å°±ç§°ä¸ºèŒƒå¼ é”®ï¼š è¶…é”®ï¼šèƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›† å€™é€‰é”®ï¼šä¸åŒ…æ‹¬å¤šä½™çš„å±æ€§çš„è¶…é”® ä¸»é”®ï¼šç”¨æˆ·å¯ä»¥ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»é”® å¤–é”®ï¼šA è¡¨ä¸­çš„æŸå±æ€§é›†ä¸æ˜¯ A çš„ä¸»é”®ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªæ•°æ®è¡¨ B çš„ä¸»é”®ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§é›†å°±æ˜¯ B çš„å¤–é”® ä¸»å±æ€§ï¼šåŒ…å«å†ä»»ä¸€å€™é€‰é”®ä¸­çš„å±æ€§ éä¸»å±æ€§ï¼šä¸åŒ…å«å†ä»»ä½•ä¸€ä¸ªå€™é€‰é”®ä¸­çš„å±æ€§ ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ ä»»ä½•ä¸€å¼ è¡¨éƒ½åº”è¯¥æœ‰ä¸»é”®ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå­—æ®µåŸå­æ€§ä¸å¯å†åˆ† ç¬¬äºŒèŒƒå¼ ï¼ˆ2NFï¼‰ å»ºç«‹åœ¨ç¬¬ä¸€èŒƒå¼åŸºç¡€ä¹‹ä¸Šï¼Œæ‰€æœ‰éä¸»é”®å­—æ®µ å®Œå…¨ä¾èµ– ä¸»é”®ï¼Œä¸èƒ½äº§ç”Ÿ éƒ¨åˆ†ä¾èµ– è¿åç¬¬äºŒèŒƒå¼å®¹æ˜“é€ æˆï¼šæ•°æ®å†—ä½™ã€å¢åˆ æ”¹çš„å¼‚å¸¸ ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ å»ºç«‹åœ¨ç¬¬äºŒèŒƒå¼åŸºç¡€ä¹‹ä¸Šï¼Œæ‰€æœ‰éä¸»é”®å­—æ®µ ç›´æ¥ä¾èµ– ä¸»é”®ï¼Œä¸èƒ½äº§ç”Ÿ ä¼ é€’ä¾èµ– ä¸‰èŒƒå¼çš„ä¼˜ç‚¹: æ¶ˆé™¤äº†æ•°æ®åº“ä¸­çš„æ•°æ®å†—ä½™ï¼Œåœ¨æ€§èƒ½ã€æ‰©å±•æ€§ã€æ•°æ®å®Œæ•´æ€§æ–¹é¢åšåˆ°äº†æœ€å¥½çš„å¹³è¡¡ ä¸‰èŒƒå¼çš„ç¼ºç‚¹ï¼š ä¼šé™ä½æŸ¥è¯¢çš„æ•ˆç‡ï¼Œè¿›è¡ŒæŸ¥è¯¢æ—¶éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆç­‰ å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰ åœ¨ç¬¬ä¸‰èŒƒå¼ä¸Šçš„æ”¹è¿›ï¼Œä¸€ä¸ªè¡¨ä¸­åªæœ‰ä¸€ä¸ªå€™é€‰é”®ï¼Œå…¶å®ƒéƒ½æ˜¯å•å±æ€§æ—¶ ç¬¬å››èŒƒå¼ (4NFï¼‰ ç¬¬å››èŒƒå¼çš„æ¦‚å¿µ å³åœ¨å·´æ–¯-ç§‘å¾·èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤éå¹³å‡¡å’Œéå‡½æ•°ä¾èµ–çš„å¤šå€¼ä¼ é€’ï¼ˆæ¶ˆé™¤åŒä¸€å¼ è¡¨ä¸­çš„å¤šå¯¹å¤šå…³ç³»ï¼‰ åœ¨èŒå·¥è¡¨ä¸­ï¼Œä¸€ä¸ªèŒå·¥ç¼–å·å¯ä»¥æœ‰å¤šä¸ªå­©å­ï¼Œä¸€ä¸ªèŒå·¥ç¼–å·å¯ä»¥æœ‰å¤šä¸ªè¯¾ç¨‹ å­˜åœ¨å¤šå€¼ä¾èµ–ï¼Œåº”æ‹†åˆ†æˆ èŒå·¥è¡¨ï¼ˆèŒå·¥ç¼–å·ï¼ŒèŒå·¥é€‰ä¿®è¯¾ç¨‹ï¼‰ å’Œ èŒå·¥è¡¨ï¼ˆèŒå·¥ç¼–å·ï¼ŒèŒå·¥å­©å­å§“åï¼‰ ç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼Œåˆç§°å®Œç¾ èŒƒå¼ï¼‰ åŸŸé”®èŒƒå¼ åœ¨ç¬¬å››èŒƒå¼åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤ä¸æ˜¯ç”±å€™é€‰é”®æ‰€è•´å«çš„è¿æ¥ä¾èµ– ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:13:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…­å¤§èŒƒå¼"},{"categories":null,"content":"\råèŒƒå¼åŒ– ä¸ºé¿å…å®Œå…¨æ»¡è¶³ä¸‰èŒƒå¼è€Œé€ æˆçš„æ•ˆç‡é™ä½ï¼Œå¢åŠ ä¸€äº›å†—ä½™æ¥æé«˜æ•°æ®åº“æ€§èƒ½ æ¡ˆä¾‹ï¼š ç»å¸¸åœ¨æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æ—¶éœ€è¦çœ‹åˆ°éƒ¨é—¨åï¼Œå¦‚æœå°†éƒ¨é—¨åå­˜å‚¨åœ¨å‘˜å·¥è¡¨ä¸­å°±é¿å…æ¯æ¬¡éƒ½è¿›è¡Œè¿æ¥æ“ä½œäº† select å‘˜å·¥_id,éƒ¨é—¨_name from å‘˜å·¥è¡¨ e join éƒ¨é—¨è¡¨ d on e.å‘˜å·¥_id = d.éƒ¨é—¨_id; åèŒƒå¼åŒ–çš„æ–°é—®é¢˜ï¼š å­˜å‚¨ ç©ºé—´å˜å¤§ äº† ä¸€ä¸ªè¡¨ä¸­å­—æ®µåšäº†ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªè¡¨ä¸­å†—ä½™çš„å­—æ®µä¹Ÿéœ€è¦åšåŒæ­¥ä¿®æ”¹ï¼Œå¦åˆ™ æ•°æ®ä¸ä¸€è‡´ è‹¥é‡‡ç”¨å­˜å‚¨è¿‡ç¨‹æ¥æ”¯æŒæ•°æ®çš„æ›´æ–°ã€åˆ é™¤ç­‰é¢å¤–æ“ä½œï¼Œå¦‚æœæ›´æ–°é¢‘ç¹ï¼Œä¼šéå¸¸ æ¶ˆè€—ç³»ç»Ÿèµ„æº åœ¨ æ•°æ®é‡å° çš„æƒ…å†µä¸‹ï¼ŒåèŒƒå¼ä¸èƒ½ä½“ç°æ€§èƒ½çš„ä¼˜åŠ¿ï¼Œå¯èƒ½è¿˜ä¼šè®©æ•°æ®åº“çš„è®¾è®¡æ›´åŠ  å¤æ‚ å½“å†—ä½™ä¿¡æ¯æœ‰ä»·å€¼æˆ–è€…èƒ½ å¤§å¹…åº¦æé«˜æŸ¥è¯¢æ•ˆç‡ çš„æ—¶å€™ï¼Œå†é‡‡å–åèŒƒå¼çš„ä¼˜åŒ– è¿™ä¸ªå†—ä½™å­—æ®µï¼Œéœ€è¦ç»å¸¸æŸ¥è¯¢ä¸ç»å¸¸ä¿®æ”¹ è¿™ä¸ªå†—ä½™å­—æ®µï¼Œåœ¨æŸ¥è¯¢æ—¶ä¸å¯æˆ–ç¼º åœ¨è®°å½•å†å² å¿«ç…§ ã€å†å²æ•°æ®æ—¶ä½¿ç”¨ åœ¨è®°å½• æ•°æ®ä»“åº“ æ•°æ®æ—¶ä½¿ç”¨ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:13:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#åèŒƒå¼åŒ–"},{"categories":null,"content":"\râ€œä¸‰å°‘ä¸€å¤šâ€ æ•°æ®è¡¨çš„ä¸ªæ•°è¶Šå°‘è¶Šå¥½ æ•°æ®è¡¨ä¸­çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½ æ•°æ®è¡¨ä¸­è”åˆä¸»é”®çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½ ä½¿ç”¨ä¸»é”®å’Œå¤–é”®è¶Šå¤šè¶Šå¥½ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:13:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸‰å°‘ä¸€å¤š"},{"categories":null,"content":"\rSQL ç¼–å†™å…³äºåº“ ã€å¼ºåˆ¶ã€‘åº“çš„åç§°å¿…é¡»æ§åˆ¶åœ¨ 32 ä¸ªå­—ç¬¦ä»¥å†…ï¼Œåªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®®ä»¥è‹±æ–‡å­—æ¯å¼€å¤´ã€‚ ã€å¼ºåˆ¶ã€‘åº“åä¸­è‹±æ–‡ä¸€å¾‹å°å†™ ï¼Œä¸åŒå•è¯é‡‡ç”¨ ä¸‹åˆ’çº¿ åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚ ã€å¼ºåˆ¶ã€‘åº“çš„åç§°æ ¼å¼ï¼šä¸šåŠ¡ç³»ç»Ÿåç§°_å­ç³»ç»Ÿåã€‚ ã€å¼ºåˆ¶ã€‘åº“åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚ type, order ç­‰ï¼‰ã€‚ ã€å¼ºåˆ¶ã€‘åˆ›å»ºæ•°æ®åº“æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šå­—ç¬¦é›† ï¼Œå¹¶ä¸”å­—ç¬¦é›†åªèƒ½æ˜¯ utf8 æˆ–è€… utf8mb4ã€‚ åˆ›å»ºæ•°æ®åº“SQLä¸¾ä¾‹ï¼šCREATE DATABASE crm_fund DEFAULT CHARACTER SET 'utf8' ; ã€å»ºè®®ã€‘å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·ï¼Œéµå¾ª æƒé™æœ€å°åŸåˆ™ ä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ª DB ä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“ã€‚ç¨‹åºä½¿ç”¨çš„è´¦å·åŸåˆ™ä¸Šä¸å‡†æœ‰ drop æƒé™ ã€‚ ã€å»ºè®®ã€‘ä¸´æ—¶åº“ä»¥ tmp_ ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼› å¤‡ä»½åº“ä»¥ bak_ ä¸ºå‰ç¼€ï¼Œå¹¶ä»¥æ—¥æœŸä¸ºåç¼€ã€‚ å…³äºè¡¨ã€åˆ— ã€å¼ºåˆ¶ã€‘è¡¨å’Œåˆ—çš„åç§°å¿…é¡»æ§åˆ¶åœ¨ 32 ä¸ªå­—ç¬¦ä»¥å†…ï¼Œè¡¨ååªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå»ºè®®ä»¥è‹±æ–‡å­—æ¯å¼€å¤´ ã€‚ ã€å¼ºåˆ¶ã€‘ è¡¨åã€åˆ—åä¸€å¾‹å°å†™ ï¼Œä¸åŒå•è¯é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚é¡»è§åçŸ¥æ„ã€‚ ã€å¼ºåˆ¶ã€‘è¡¨åè¦æ±‚æœ‰æ¨¡å—åå¼ºç›¸å…³ï¼ŒåŒä¸€æ¨¡å—çš„è¡¨åå°½é‡ä½¿ç”¨ ç»Ÿä¸€å‰ç¼€ ã€‚æ¯”å¦‚ï¼šcrm_fund_item ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šå­—ç¬¦é›† ä¸º utf8 æˆ– utf8mb4ã€‚ ã€å¼ºåˆ¶ã€‘è¡¨åã€åˆ—åç¦æ­¢ä½¿ç”¨å…³é”®å­—ï¼ˆå¦‚ type, order ç­‰ï¼‰ã€‚ ã€å¼ºåˆ¶ã€‘åˆ›å»ºè¡¨æ—¶å¿…é¡» æ˜¾å¼æŒ‡å®šè¡¨å­˜å‚¨å¼•æ“ ç±»å‹ã€‚å¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€å¾‹ä¸º InnoDBã€‚ ã€å¼ºåˆ¶ã€‘å»ºè¡¨å¿…é¡»æœ‰ commentã€‚ ã€å¼ºåˆ¶ã€‘å­—æ®µå‘½ååº”å°½å¯èƒ½ä½¿ç”¨è¡¨è¾¾å®é™…å«ä¹‰çš„è‹±æ–‡å•è¯æˆ– ç¼©å†™ ã€‚å¦‚ï¼šå…¬å¸ IDï¼Œä¸è¦ä½¿ç”¨ corporation_id, è€Œç”¨ corp_id å³å¯ã€‚ ã€å¼ºåˆ¶ã€‘å¸ƒå°”å€¼ç±»å‹çš„å­—æ®µå‘½åä¸º is_ æè¿° ã€‚å¦‚ member è¡¨ä¸Šè¡¨ç¤ºæ˜¯å¦ä¸º enabled çš„ä¼šå‘˜çš„å­—æ®µå‘½ åä¸º is_enabledã€‚ ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ®é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼ŒçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢é•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éšæœº IO æ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIO æ“ä½œå¾ˆè€—æ—¶ã€‚é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚ ã€å»ºè®®ã€‘å»ºè¡¨æ—¶å…³äºä¸»é”®ï¼š è¡¨å¿…é¡»æœ‰ä¸»é”® (1) å¼ºåˆ¶è¦æ±‚ä¸»é”®ä¸º idï¼Œç±»å‹ä¸º int æˆ– bigintï¼Œä¸”ä¸º auto_increment å»ºè®®ä½¿ç”¨ unsigned æ— ç¬¦å·å‹ã€‚ (2) æ ‡è¯†è¡¨é‡Œæ¯ä¸€è¡Œä¸»ä½“çš„å­—æ®µä¸è¦è®¾ä¸ºä¸»é”®ï¼Œå»ºè®® è®¾ä¸ºå…¶ä»–å­—æ®µå¦‚ user_idï¼Œorder_id ç­‰ï¼Œå¹¶å»ºç«‹ unique key ç´¢å¼•ã€‚å› ä¸ºå¦‚æœè®¾ä¸ºä¸»é”®ä¸”ä¸»é”®å€¼ä¸ºéšæœºæ’å…¥ï¼Œåˆ™ä¼šå¯¼è‡´ innodb å†…éƒ¨é¡µåˆ†è£‚å’Œå¤§é‡éšæœº I/Oï¼Œæ€§èƒ½ä¸‹é™ã€‚ ã€å»ºè®®ã€‘æ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ï¼‰å¿…é¡»æœ‰è¡Œæ•°æ®çš„ åˆ›å»ºæ—¶é—´å­—æ®µ ï¼ˆcreate_timeï¼‰å’Œ æœ€åæ›´æ–°æ—¶é—´å­—æ®µ ï¼ˆupdate_timeï¼‰ï¼Œä¾¿äºæŸ¥é—®é¢˜ã€‚ ã€å»ºè®®ã€‘è¡¨ä¸­æ‰€æœ‰å­—æ®µå°½é‡éƒ½æ˜¯ NOT NULL å±æ€§ï¼Œä¸šåŠ¡å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰ DEFAULT å€¼ ã€‚ å› ä¸ºä½¿ç”¨ NULL å€¼ä¼šå­˜åœ¨æ¯ä¸€è¡Œéƒ½ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€æ•°æ®è¿ç§»å®¹æ˜“å‡ºé”™ã€èšåˆå‡½æ•°è®¡ç®—ç»“æœåå·®ç­‰é—® é¢˜ã€‚ ã€å»ºè®®ã€‘æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„ åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ã€‚ ã€å»ºè®®ã€‘ä¸­é—´è¡¨ï¼ˆæˆ–ä¸´æ—¶è¡¨ï¼‰ç”¨äºä¿ç•™ä¸­é—´ç»“æœé›†ï¼Œåç§°ä»¥ tmp_ å¼€å¤´ã€‚ å¤‡ä»½è¡¨ç”¨äºå¤‡ä»½æˆ–æŠ“å–æºè¡¨å¿«ç…§ï¼Œåç§°ä»¥ bak_ å¼€å¤´ã€‚ä¸­é—´è¡¨å’Œå¤‡ä»½è¡¨å®šæœŸæ¸…ç†ã€‚ ã€å»ºè®®ã€‘åˆ›å»ºè¡¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…·ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¡¨ã€å­—æ®µç›¸å…³çš„çº¦å®šéƒ½èƒ½è®¾ç½®ä¸Šã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆå°‘è‡ªå·±å†™ DDL è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å¯è§†åŒ–å·¥å…·æ¥åˆ›å»ºå’Œæ“ä½œæ•°æ®åº“å’Œæ•°æ®è¡¨ã€‚å¯è§†åŒ–å·¥å…·é™¤äº†æ–¹ä¾¿ï¼Œè¿˜èƒ½ç›´æ¥å¸®æˆ‘ä»¬å°†æ•°æ®åº“çš„ç»“æ„å®šä¹‰è½¬åŒ–æˆ SQL è¯­è¨€ï¼Œæ–¹ä¾¿æ•°æ®åº“å’Œæ•°æ®è¡¨ç»“æ„ çš„å¯¼å‡ºå’Œå¯¼å…¥ã€‚ å…³äºç´¢å¼• ã€å¼ºåˆ¶ã€‘InnoDB è¡¨å¿…é¡»ä¸»é”®ä¸º id int/bigint auto_incrementï¼Œä¸”ä¸»é”®å€¼ ç¦æ­¢è¢«æ›´æ–° ã€‚ ã€å¼ºåˆ¶ã€‘InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“è¡¨ï¼Œç´¢å¼•ç±»å‹å¿…é¡»ä¸º BTREE ã€‚ ã€å»ºè®®ã€‘ä¸»é”®çš„åç§°ä»¥ pk_ å¼€å¤´ï¼Œå”¯ä¸€é”®ä»¥ uni_ æˆ– uk_ å¼€å¤´ï¼Œæ™®é€šç´¢å¼•ä»¥ idx_ å¼€å¤´ï¼Œä¸€å¾‹ ä½¿ç”¨å°å†™æ ¼å¼ï¼Œä»¥å­—æ®µçš„åç§°æˆ–ç¼©å†™ä½œä¸ºåç¼€ã€‚ ã€å»ºè®®ã€‘å¤šå•è¯ç»„æˆçš„ columnnameï¼Œå–å‰å‡ ä¸ªå•è¯é¦–å­—æ¯ï¼ŒåŠ æœ«å•è¯ç»„æˆ column_nameã€‚å¦‚: sample è¡¨ member_id ä¸Šçš„ç´¢å¼•ï¼šidx_sample_midã€‚ ã€å»ºè®®ã€‘å•ä¸ªè¡¨ä¸Šçš„ç´¢å¼•ä¸ªæ•° ä¸èƒ½è¶…è¿‡ 6 ä¸ª ã€‚ ã€å»ºè®®ã€‘åœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œå¤šè€ƒè™‘å»ºç«‹ è”åˆç´¢å¼• ï¼Œå¹¶æŠŠåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µæ”¾åœ¨æœ€å‰é¢ã€‚ ã€å»ºè®®ã€‘åœ¨å¤šè¡¨ JOIN çš„SQLé‡Œï¼Œä¿è¯è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œè¿™æ · JOIN æ‰§è¡Œæ•ˆç‡æœ€é«˜ã€‚ ã€å»ºè®®ã€‘å»ºè¡¨æˆ–åŠ ç´¢å¼•æ—¶ï¼Œä¿è¯è¡¨é‡Œäº’ç›¸ä¸å­˜åœ¨ å†—ä½™ç´¢å¼• ã€‚ æ¯”å¦‚ï¼šå¦‚æœè¡¨é‡Œå·²ç»å­˜åœ¨ key(a,b)ï¼Œ åˆ™ key(a) ä¸ºå†—ä½™ç´¢å¼•ï¼Œéœ€è¦åˆ é™¤ã€‚ SQLç¼–å†™ ã€å¼ºåˆ¶ã€‘ç¨‹åºç«¯ SELECT è¯­å¥å¿…é¡»æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œç¦æ­¢å†™æˆ *ã€‚ ã€å»ºè®®ã€‘ç¨‹åºç«¯ insert è¯­å¥æŒ‡å®šå…·ä½“å­—æ®µåç§°ï¼Œä¸è¦å†™æˆ INSERT INTO t1 VALUES(â€¦)ã€‚ ã€å»ºè®®ã€‘é™¤é™æ€è¡¨æˆ–å°è¡¨ï¼ˆ100è¡Œä»¥å†…ï¼‰ï¼ŒDML è¯­å¥å¿…é¡»æœ‰ WHERE æ¡ä»¶ï¼Œä¸”ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚ ã€å»ºè®®ã€‘INSERT INTOâ€¦VALUES(XX),(XX),(XX).. è¿™é‡Œ XX çš„å€¼ä¸è¦è¶…è¿‡ 5000 ä¸ªã€‚ å€¼è¿‡å¤šè™½ç„¶ä¸Šçº¿å¾ˆå¿«ï¼Œä½†ä¼šå¼•èµ·ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚ ã€å»ºè®®ã€‘SELECT è¯­å¥ä¸è¦ä½¿ç”¨ UNIONï¼Œæ¨èä½¿ç”¨ UNION ALL ï¼Œå¹¶ä¸” UNION å­å¥ä¸ªæ•°é™åˆ¶åœ¨ 5 ä¸ªä»¥å†…ã€‚ ã€å»ºè®®ã€‘çº¿ä¸Šç¯å¢ƒï¼Œå¤šè¡¨ JOIN ä¸è¦è¶…è¿‡ 5 ä¸ªè¡¨ã€‚ ã€å»ºè®®ã€‘å‡å°‘ä½¿ç”¨ ORDER BYï¼Œå’Œä¸šåŠ¡æ²Ÿé€šèƒ½ä¸æ’åºå°±ä¸æ’åºï¼Œæˆ–å°†æ’åºæ”¾åˆ°ç¨‹åºç«¯å»åšã€‚ORDER BYã€GROUP BYã€DISTINCT è¿™äº›è¯­å¥è¾ƒä¸ºè€—è´¹ CPUï¼Œæ•°æ®åº“çš„ CPU èµ„æºæ˜¯æå…¶å®è´µçš„ã€‚ ã€å»ºè®®ã€‘åŒ…å«äº† ORDER BYã€GROUP BYã€DISTINCT è¿™äº›æŸ¥è¯¢çš„è¯­å¥ï¼ŒWHERE æ¡ä»¶è¿‡æ»¤å‡ºæ¥çš„ç»“æœé›†è¯·ä¿æŒåœ¨ 1000 è¡Œä»¥å†…ï¼Œå¦åˆ™ SQL ä¼šå¾ˆæ…¢ã€‚ ã€å»ºè®®ã€‘å¯¹å•è¡¨çš„å¤šæ¬¡ alter æ“ä½œå¿…é¡»åˆå¹¶ä¸ºä¸€æ¬¡å¯¹äºè¶…è¿‡100Wè¡Œçš„å¤§è¡¨è¿›è¡Œ alter tableï¼Œå¿…é¡»ç»è¿‡ DBA å®¡æ ¸ï¼Œå¹¶åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼Œå¤šä¸ª alter éœ€æ•´åˆåœ¨ä¸€èµ·ã€‚ å› ä¸º alter table ä¼šäº§ç”Ÿ è¡¨é” ï¼ŒæœŸé—´é˜»å¡å¯¹äºè¯¥è¡¨çš„æ‰€æœ‰å†™å…¥ï¼Œå¯¹äºä¸šåŠ¡å¯èƒ½ä¼šäº§ç”Ÿæå¤§å½±å“ã€‚ ã€å»ºè®®ã€‘æ‰¹é‡æ“ä½œæ•°æ®æ—¶ï¼Œéœ€è¦æ§åˆ¶äº‹åŠ¡å¤„ç†é—´éš”æ—¶é—´ï¼Œè¿›è¡Œå¿…è¦çš„ sleepã€‚ ã€å»ºè®®ã€‘äº‹åŠ¡é‡ŒåŒ…å« SQL ä¸è¶…è¿‡5ä¸ªã€‚ å› ä¸ºè¿‡é•¿çš„äº‹åŠ¡ä¼šå¯¼è‡´é”æ•°æ®è¾ƒä¹…ï¼ŒMySQL å†…éƒ¨ç¼“å­˜ã€è¿æ¥æ¶ˆè€—è¿‡å¤šç­‰é—®é¢˜ã€‚ ã€å»ºè®®ã€‘äº‹åŠ¡é‡Œæ›´æ–°è¯­å¥å°½é‡åŸºäºä¸»é”®æˆ– UNIQUE KEYï¼Œå¦‚ UPDATEâ€¦ WHERE id=XX; å¦åˆ™ä¼šäº§ç”Ÿé—´éš™é”ï¼Œå†…éƒ¨æ‰©å¤§é”å®šèŒƒå›´ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œäº§ç”Ÿæ­»é”ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:13:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#sql-ç¼–å†™"},{"categories":null,"content":"\ræ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“å…¶å®ƒè°ƒä¼˜ç­–ç•¥"},{"categories":null,"content":"\ræ•°æ®åº“è°ƒä¼˜çš„æªæ–½ é€‰æ‹©åˆé€‚çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ Oracleã€SQL Server å•è¡¨å­˜å‚¨ä¸Šäº¿æ¡æ•°æ®ä¹Ÿæ²¡é—®é¢˜ MySQL å¼€æºå…è´¹ ä¼˜åŒ–è¡¨çš„è®¾è®¡ éµå¾ªç¬¬ä¸‰èŒƒå¼ / å·´æ–¯èŒƒå¼ ä½¿ç”¨åèŒƒå¼åŒ– ç©ºé—´æ¢æ—¶é—´ è¡¨æ•°æ®ç±»å‹çš„é€‰æ‹© ä¼˜åŒ–é€»è¾‘æŸ¥è¯¢ é€»è¾‘æŸ¥è¯¢ä¼˜åŒ– SQL æŸ¥è¯¢é‡å†™ï¼šå­æŸ¥è¯¢ä¼˜åŒ–ã€ç­‰ä»·è°“è¯é‡å†™ã€è§†å›¾é‡å†™ã€æ¡ä»¶ç®€åŒ–ã€è¿æ¥æ¶ˆé™¤ã€åµŒå¥—è¿æ¥æ¶ˆé™¤ç­‰ å°è¡¨é©±åŠ¨å¤§è¡¨ã€ä¸åœ¨ WHERE è¯­å¥ä¸­ä½¿ç”¨å‡½æ•°ç­‰ ç‰©ç†æŸ¥è¯¢ä¼˜åŒ– ä½¿ç”¨ç´¢å¼• â€¦â€¦ ä½¿ç”¨ Redis æˆ– Memcached ä½œç¼“å­˜ Redis æ”¯æŒæŒä¹…åŒ–ï¼Œæ”¯æŒ Key-Valueã€Listã€Setã€Hash ç­‰æ•°æ®ç»“æ„ Memcached ä¸æ”¯æŒæŒä¹…åŒ–ï¼Œä»…æ”¯æŒ Key-Value æ•°æ®ç±»å‹ åº“çº§ä¼˜åŒ– é‡‡ç”¨ä¸»ä»æ¶æ„ è¯»å†™åˆ†ç¦» ä¸€ä¸»ä¸€ä»æ¨¡å¼ï¼šä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼Œä»æœºè´Ÿè´£è¯»è¯·æ±‚ åŒä¸»åŒä»æ¨¡å¼ï¼šä¸»ä»å¤åˆ¶ æ•°æ®åˆ†ç‰‡ åˆ†åº“ï¼šæ ¹æ®æ¨¡å—å°†è¡¨æ”¾åœ¨ä¸åŒä¸»æœºä¸­ åˆ†è¡¨ å‚ç›´åˆ†è¡¨ï¼šå†·çƒ­æ•°æ®åˆ’åˆ† æ°´å¹³åˆ†è¡¨ï¼šæŒ‰ç…§å–æ¨¡ã€èŒƒå›´çº¦å®šã€æ—¥æœŸç­‰æ–¹å¼åˆ’åˆ† ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“è°ƒä¼˜çš„æªæ–½"},{"categories":null,"content":"\rä¼˜åŒ– MySQL æœåŠ¡å™¨ ä¼˜åŒ–æœåŠ¡å™¨ç¡¬ä»¶ é…ç½®è¾ƒå¤§çš„å†…å­˜ é…ç½®é«˜é€Ÿçš„ç£ç›˜ç³»ç»Ÿ åˆç†åˆ†å¸ƒç£ç›˜ I/O é…å¤‡å¤šå¤„ç†å™¨ ä¼˜åŒ– MySQL å‚æ•° é…ç½® my.cnf é…ç½®æ–‡ä»¶ innodb_buffer_pool_sizeï¼šç¼“å†²åŒºå¤§å°ï¼Œé…ç½®è¡¨å’Œç´¢å¼•çš„æœ€å¤§ç¼“å­˜ key_buffer_sizeï¼šç´¢å¼•ç¼“å†²åŒºå¤§å°ï¼Œå¯¹äºå†…å­˜åœ¨ 4GB å·¦å³ çš„æœåŠ¡å™¨è¯¥å‚æ•°å¯è®¾ç½®ä¸º 256M æˆ– 384M table_cacheï¼šåŒæ—¶æ‰“å¼€è¡¨çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 2402ï¼Œè°ƒåˆ° 512-1024 æœ€ä½³ query_cache_sizeï¼šæŸ¥è¯¢ç¼“å†²åŒºçš„å¤§å° query_cache_typeï¼šæœ‰ 3 ä¸ªå€¼ï¼š0 ä»£è¡¨å…³é—­æŸ¥è¯¢ç¼“å­˜ OFF, 1 ä»£è¡¨å¼€å¯ ON , 2 (DEMAND) æŒ‰éœ€ä½¿ç”¨ sort_buffer_sizeï¼šéœ€è¦è¿›è¡Œæ’åºçš„çº¿ç¨‹åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°ï¼Œå¯æé«˜ ORDER BY æˆ– GROUP BY æ“ä½œçš„é€Ÿåº¦ï¼Œå¯¹äºå†…å­˜åœ¨ 4GB å·¦å³çš„æœåŠ¡å™¨æ¨èè®¾ç½®ä¸º 6-8M join_buffer_size = 8Mï¼šè”åˆæŸ¥è¯¢æ“ä½œæ‰€èƒ½ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å°ï¼Œå’Œ sort_buffer_size ä¸€æ ·æ¯ä¸ªçº¿ç¨‹ç‹¬äº« read_buffer_size ï¼šæ¯ä¸ªçº¿ç¨‹è¿ç»­æ‰«ææ—¶ä¸ºæ‰«æçš„æ¯ä¸ªè¡¨åˆ†é…çš„ç¼“å†²åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œé»˜è®¤ä¸º 64Kï¼Œå¯ä»¥è®¾ç½®ä¸º 4M innodb_flush_log_at_trx_commitï¼šä½•æ—¶å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶ 0ï¼šæ¯ç§’ä¸€æ¬¡ 1ï¼šæäº¤äº‹åŠ¡æ—¶ 2ï¼šæäº¤äº‹åŠ¡æ—¶å†™å…¥æ—¥å¿—ï¼Œæ¯ç§’åˆ·ç›˜ innodb_log_buffer_sizeï¼šäº‹åŠ¡æ—¥å¿—æ‰€ä½¿ç”¨çš„ç¼“å†²åŒº max_connectionsï¼šå…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ 151ï¼Œæ€§èƒ½å¥½å¯æ”¯æŒ 500-1000 back_logï¼šæ§åˆ¶ MySQL ç›‘å¬ TCP ç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å°ï¼Œ5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜ è®¤å€¼ä¸º 50 ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º (max_connections / 5)ï¼Œ å¯¹äº Linux ç³»ç»Ÿæ¨èè®¾ç½®ä¸ºå°äº 512 çš„æ•´æ•°ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡ 900 thread_cache_sizeï¼šçº¿ç¨‹æ± ç¼“å­˜çº¿ç¨‹æ•°é‡çš„å¤§å°ï¼Œé»˜è®¤ä¸º 60ï¼Œå¯ä»¥è®¾ç½®ä¸º 120 wait_timeoutï¼šä¸€ä¸ªè¯·æ±‚çš„æœ€å¤§è¿æ¥æ—¶é—´ï¼Œ4GB å·¦å³å†…å­˜å¯ä»¥è®¾ç½®ä¸º 5-10 interactive_timeoutï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å…³é—­è¿æ¥å‰ç­‰å¾…è¡ŒåŠ¨çš„ç§’æ•° ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¼˜åŒ–-mysql-æœåŠ¡å™¨"},{"categories":null,"content":"\rä¼˜åŒ–æ•°æ®åº“ç»“æ„ æ‹†åˆ†è¡¨ï¼ˆå†·çƒ­æ•°æ®åˆ†ç¦»ï¼‰ å‡å°‘ç£ç›˜ I/Oï¼Œä¿è¯æ•°æ®å‘½ä¸­ç‡ æœ‰æ•ˆåˆ©ç”¨ç¼“å­˜ï¼Œé¿å…è¯»å…¥æ— ç”¨å†·æ•°æ® å¢åŠ ä¸­é—´è¡¨ å°†ç»å¸¸è¿›è¡Œè”åˆæŸ¥è¯¢çš„æ•°æ®ç»Ÿä¸€å­˜æ”¾åœ¨ä¸­é—´è¡¨ä¸­ å°†åŸæ¥çš„è”åˆæŸ¥è¯¢æ”¹ä¸ºå¯¹ä¸­é—´è¡¨çš„æŸ¥è¯¢æé«˜æ•ˆç‡ ä½¿ç”¨ insert into ... select ... çš„æ–¹å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§ å¢åŠ å†—ä½™å­—æ®µ åŒåèŒƒå¼åŒ– ä¼˜åŒ–æ•°æ®ç±»å‹ ä¼˜å…ˆé€‰æ‹©å¤åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹ å¯¹äºæ•´å½¢ç±»å‹ ä¼˜å…ˆ INT ç±»å‹ï¼Œå¯¹äºå¹´é¾„å¯ä»¥é€‰ç”¨ unsigned tinyint å­˜å‚¨èŒƒå›´ä¸º 0 - 255 èƒ½ç”¨å­—ç¬¦ç±»å‹ä¹Ÿèƒ½ç”¨æ•´æ•°ç±»å‹çš„ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨æ•´æ•°ç±»å‹ é¿å…ä½¿ç”¨ TEXTã€BLOB è¿™æ ·çš„å¤§æ•°æ®ç±»å‹ å†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒè¿™ç§ç±»å‹ï¼Œåªèƒ½ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨ å¯¹äºè¿™ç§æ•°æ®è¿˜éœ€è¦äºŒæ¬¡æŸ¥è¯¢ï¼Œæ€§èƒ½å¾ˆå·® å¯ä»¥å°†è¿™ç±»å­—æ®µå­˜å‚¨åœ¨å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ é¿å…ä½¿ç”¨ ENUM ç±»å‹ ä¿®æ”¹æšä¸¾ç±»å‹éœ€è¦ ALTER è¯­å¥ï¼ŒORDER BY æ•ˆç‡ä½ æ¨èä½¿ç”¨ TINYINT æ›¿ä»£æšä¸¾ç±»å‹ ä½¿ç”¨ TIMESTAMP å­˜å‚¨æ—¶é—´ å¯ä»¥å­˜å‚¨ 1970-01-01 00:00:00 - 2038-1-19 11:14:07ï¼Œå­˜å‚¨ 2147483647 ç§’ï¼Œç›¸å½“äº INT ç±»å‹å  4 å­—èŠ‚ ç”¨ DECIMAL ä»£æ›¿ FLOAT å’Œ DOUBLE å› ä¸º DECIMAL ä¸ä¼šä¸¢å¤±ç²¾åº¦ ä¼˜åŒ–æ’å…¥é€Ÿåº¦ MyISAM å¼•æ“çš„è¡¨ ç¦ç”¨ç´¢å¼• ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥ ä½¿ç”¨æ‰¹é‡æ’å…¥ ä½¿ç”¨ LOAD DATA INFILE æ‰¹é‡å¯¼å…¥ InnoDB å¼•æ“çš„è¡¨ ç¦ç”¨å”¯ä¸€æ€§æ£€æŸ¥ ç¦ç”¨å¤–é”®æ£€æŸ¥ ç¦ç”¨è‡ªåŠ¨æäº¤ ä½¿ç”¨éç©ºçº¦æŸ å°½é‡ä½¿ç”¨ NOT NULL çº¦æŸ IS NOT NULL ä¼šä½¿ç´¢å¼•å¤±æ•ˆ éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨æ˜¯å¦ä¸º NULL åˆ†æã€æ£€æŸ¥ã€ä¼˜åŒ–è¡¨ åˆ†æè¡¨ï¼šåˆ†æå…³é”®å­—çš„åˆ†å¸ƒ ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name[,tbl_name]â€¦ åˆ†æè¡¨çš„è¿‡ç¨‹ä¸­ä¼šä¸ºè¡¨æ·»åŠ  åªè¯»é”ï¼ŒæœŸé—´æ— æ³•æ›´æ–°å’Œæ’å…¥æ•°æ® ANALYZE TABLE åˆ†æåçš„ç»Ÿè®¡ç»“æœä¼šååº”åˆ° show index from xxx ä¸­ cardinality çš„å€¼ï¼Œè¯¥å€¼ç»Ÿè®¡äº†è¡¨ä¸­æŸä¸€é”®æ‰€åœ¨çš„åˆ—ä¸é‡å¤çš„å€¼çš„ä¸ªæ•°ã€‚è¯¥å€¼è¶Šæ¥è¿‘è¡¨ä¸­çš„æ€»è¡Œæ•°ï¼Œåˆ™åœ¨è¡¨è¿æ¥æŸ¥è¯¢æˆ–è€…ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œå°±è¶Šä¼˜å…ˆè¢«ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ æ£€æŸ¥è¡¨ï¼šæ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨é”™è¯¯ CHECK TABLE tbl_name [, tbl_name] ... [option] ... option = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED} æ£€æŸ¥è¡¨çš„è¿‡ç¨‹ä¸­ä¼šä¸ºè¡¨æ·»åŠ  åªè¯»é”ï¼ŒæœŸé—´æ— æ³•æ›´æ–°å’Œæ’å…¥æ•°æ® æ‰§è¡Œç»“æœæœ€åä¸€è¡Œæœ‰ä¸€ä¸ªçŠ¶æ€çš„ Msg_type å€¼ï¼ŒMsg_text é€šå¸¸ä¸º OKã€‚ å¦‚æœå¾—åˆ°çš„ä¸æ˜¯ OKï¼Œé€šå¸¸è¦å¯¹å…¶è¿›è¡Œä¿®å¤ ä¼˜åŒ–è¡¨ï¼šæ¶ˆé™¤åˆ é™¤æˆ–æ›´æ–°é€ æˆçš„ç©ºé—´æµªè´¹ é’ˆå¯¹äº VARCHARã€TEXTã€BLOB ç±»å‹è¿›è¡Œç¢ç‰‡æ•´ç† OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... ä¼˜åŒ–è¡¨çš„è¿‡ç¨‹ä¸­ä¼šä¸ºè¡¨æ·»åŠ  åªè¯»é”ï¼ŒæœŸé—´æ— æ³•æ›´æ–°å’Œæ’å…¥æ•°æ® åœ¨MyISAMä¸­ï¼Œæ˜¯å…ˆåˆ†æè¿™å¼ è¡¨ï¼Œç„¶åä¼šæ•´ç†ç›¸å…³çš„ MySQL datafileï¼Œä¹‹åå›æ”¶æœªä½¿ç”¨çš„ç©ºé—´ï¼› åœ¨InnoDB ä¸­ï¼Œå›æ”¶ç©ºé—´æ˜¯ç®€å•é€šè¿‡ Alter table è¿›è¡Œæ•´ç†ç©ºé—´ã€‚åœ¨ä¼˜åŒ–æœŸé—´ï¼ŒMySQL ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œä¼˜åŒ–å®Œæˆä¹‹åä¼šåˆ é™¤åŸå§‹è¡¨ï¼Œç„¶åä¼šå°†ä¸´æ—¶è¡¨ rename æˆä¸ºåŸå§‹è¡¨ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¼˜åŒ–æ•°æ®åº“ç»“æ„"},{"categories":null,"content":"\rå¤§è¡¨ä¼˜åŒ– é™å®šæŸ¥è¯¢çš„èŒƒå›´ ä¸è¦ä½¿ç”¨ä¸åŠ æ¡ä»¶çš„æŸ¥è¯¢ è¯»å†™åˆ†ç¦» ä¸€ä¸»ä¸€ä»æ¨¡å¼ åŒä¸»åŒä»æ¨¡å¼ å‚ç›´æ‹†åˆ† å½“æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§ä»¥ä¸Šæ—¶ï¼Œé‡‡ç”¨åˆ†åº“åˆ†è¡¨ é‡‡ç”¨ å‚ç›´åˆ†åº“ çš„æ–¹å¼ï¼Œå°†å…³è”çš„æ•°æ®è¡¨åˆ’åˆ†åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ é‡‡ç”¨ å‚ç›´åˆ†è¡¨ çš„æ–¹å¼ï¼ŒæŒ‰ç…§å†·çƒ­æ•°æ®å°†ä¸€å¼ æ•°æ®è¡¨æ‹†åˆ†æˆå¤šå¼ æ•°æ®è¡¨ æ°´å¹³æ‹†åˆ† æŒ‰ç…§å–æ¨¡ã€èŒƒå›´çº¦å®šã€æ—¥æœŸç­‰æ–¹å¼åˆ’åˆ†ã€‚ åœ¨ã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹ä¸­æ¨èå°½é‡ä¸è¦è¿›è¡Œå¯¹æ•°æ®è¿›è¡Œ åˆ†ç‰‡ å› ä¸ºä¼šå¢åŠ  é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´ çš„å¤æ‚åº¦ å®¢æˆ·ç«¯ä»£ç†ï¼šåˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨ jar åŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£… JDBC å±‚æ¥å®ç°ã€‚ ã€æ¨èã€‘ å½“å½“ç½‘çš„ Sharding-JDBC ã€é˜¿é‡Œçš„TDDLæ˜¯ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°ã€‚ ä¸­é—´ä»¶ä»£ç†ï¼šåœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ã€‚ Mycat ã€360 çš„ Atlasã€ç½‘æ˜“çš„ DDB ç­‰ç­‰éƒ½æ˜¯è¿™ç§æ¶æ„çš„å®ç°ã€‚ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¤§è¡¨ä¼˜åŒ–"},{"categories":null,"content":"\rå…¶å®ƒè°ƒä¼˜ç­–ç•¥ æœåŠ¡å™¨è¯­å¥è¶…æ—¶å¤„ç† è®¾ç½®æœåŠ¡å™¨è¯­å¥è¶…æ—¶çš„é™åˆ¶ï¼Œå½“ä¸­æ–­çš„æ‰§è¡Œè¯­å¥è¶…è¿‡è®¾ç½®çš„æ¯«ç§’æ•°åï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢æŸ¥è¯¢å½±å“ä¸å¤§çš„äº‹åŠ¡æˆ–è¿æ¥ï¼Œç„¶åå°†é”™è¯¯æŠ¥ç»™å®¢æˆ·ç«¯ SET GLOBAL MAX_EXECUTION_TIME=2000; SET SESSION MAX_EXECUTION_TIME=2000; #æŒ‡å®šè¯¥ä¼šè¯ä¸­SELECTè¯­å¥çš„è¶…æ—¶æ—¶é—´ åˆ›å»ºå…¨å±€é€šç”¨è¡¨ç©ºé—´ ä½¿ç”¨é€šç”¨è¡¨ç©ºé—´å¯ä»¥èŠ‚çº¦å…ƒæ•°æ®æ–¹é¢çš„å†…å­˜ ä½¿ç”¨ MySQL 8 çš„éšè—ç´¢å¼• å½“ä¸€ä¸ªç´¢å¼•è¢«è®¾ç½®æˆ invisible æ—¶ï¼Œå®ƒå°†ä¸ä¼šè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨ä½¿ç”¨ã€‚ å½“ä¸€ä¸ªç´¢å¼•è¢«éšè—åæ•°æ®åº“æ€§èƒ½ä¸å—å½±å“ï¼Œè¿™ä¸ªç´¢å¼•å°±å¯ä»¥è¢«åˆ é™¤äº† ç´¢å¼•ä¸è¦é•¿æœŸéšè—ï¼Œå› ä¸ºåœ¨æ·»åŠ æ•°æ®æ—¶è¿˜è¦ç»´æŠ¤éšè—çš„ç´¢å¼• ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:14:5","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…¶å®ƒè°ƒä¼˜ç­–ç•¥"},{"categories":null,"content":"\räº‹åŠ¡åŸºç¡€çŸ¥è¯†","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡åŸºç¡€çŸ¥è¯†"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯äº‹åŠ¡ äº‹åŠ¡ï¼šæ˜¯ä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒï¼Œä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§çŠ¶æ€ äº‹åŠ¡çš„å¤„ç†åŸåˆ™ï¼šæ˜¯ ä¸€ä¸ªå·¥ä½œå•å…ƒ ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸè¦ä¹ˆåŒæ—¶å¤±è´¥ åªæœ‰ InnoDB å­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ äº‹åŠ¡çš„ ACID ç‰¹æ€§ åŸå­æ€§ï¼ˆatomicityï¼‰ æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸæäº¤ï¼ˆcommitï¼‰è¦ä¹ˆåŒæ—¶å¤±è´¥å›æ»šï¼ˆrollbackï¼‰ ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä»ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ å˜æ¢åˆ°å¦å¤–ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ è¿™ç§çŠ¶æ€æ˜¯ è¯­ä¹‰ä¸Š çš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ï¼Œè·Ÿå…·ä½“çš„ä¸šåŠ¡æœ‰å…³ éš”ç¦»å‹ï¼ˆisolationï¼‰ ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œå’Œä½¿ç”¨çš„æ•°æ®å¯¹ å¹¶å‘ çš„å…¶å®ƒäº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ äº’ä¸å¹²æ‰° é€šè¿‡ é” æ¥ä¿éšœéš”ç¦»æ€§ æŒä¹…æ€§ï¼ˆdurabilityï¼‰ äº‹åŠ¡ä¸€æ—¦æäº¤äº†ï¼Œå®ƒå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯ æ°¸ä¹…æ€§ çš„äº† é€šè¿‡ äº‹åŠ¡æ—¥å¿— æ¥ä¿éšœæŒä¹…æ€§ äº‹åŠ¡çš„çŠ¶æ€ æ´»åŠ¨çš„ï¼ˆactiveï¼‰ï¼šæŒ‡äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰ï¼šäº‹åŠ¡å·²ç»åœ¨å†…å­˜ä¸­æ‰§è¡Œå®Œæ¯•ä½†æ˜¯ è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ä¸­ å¤±è´¥çš„ï¼ˆfailedï¼‰ï¼šæ•°æ®åº“åœ¨ æ´»åŠ¨çš„ / éƒ¨åˆ†æäº¤çš„ è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯ æ— æ³•ç»§ç»­æ‰§è¡Œ ä¸­æ­¢çš„ï¼ˆabortedï¼‰ï¼šåœ¨ å¤±è´¥çš„ çŠ¶æ€ä¹‹åï¼Œå°†æ•°æ® å›æ»š åå°±æ˜¯ä¸­æ­¢çš„çŠ¶æ€ æäº¤çš„ï¼ˆcommittedï¼‰ï¼šå°†éƒ¨åˆ†æäº¤çš„å†…å®¹éƒ½ å·²ç»åŒæ­¥åˆ°ç£ç›˜ä¸Š äº‹åŠ¡çš„åˆ†ç±» æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactionsï¼‰ï¼šæ™®é€šçš„äº‹åŠ¡å°±æ˜¯æ‰å¹³äº‹åŠ¡ å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactions with Savepointsï¼‰ï¼šä½¿ç”¨ä¸Š savepoint çš„æ‰å¹³äº‹åŠ¡ é“¾äº‹åŠ¡ï¼ˆChained Transactionsï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¤„ç†ç»“æŸä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ åµŒå¥—äº‹åŠ¡ï¼ˆNested Transactionsï¼‰ï¼šä¸€ä¸ªå¤§çš„äº‹åŠ¡ä¸­å¯ä»¥åµŒå¥—å­äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDistributed Transactionsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¯èƒ½åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸­ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä»€ä¹ˆæ˜¯äº‹åŠ¡"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯äº‹åŠ¡ äº‹åŠ¡ï¼šæ˜¯ä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒï¼Œä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§çŠ¶æ€ äº‹åŠ¡çš„å¤„ç†åŸåˆ™ï¼šæ˜¯ ä¸€ä¸ªå·¥ä½œå•å…ƒ ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸè¦ä¹ˆåŒæ—¶å¤±è´¥ åªæœ‰ InnoDB å­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ äº‹åŠ¡çš„ ACID ç‰¹æ€§ åŸå­æ€§ï¼ˆatomicityï¼‰ æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸæäº¤ï¼ˆcommitï¼‰è¦ä¹ˆåŒæ—¶å¤±è´¥å›æ»šï¼ˆrollbackï¼‰ ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä»ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ å˜æ¢åˆ°å¦å¤–ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ è¿™ç§çŠ¶æ€æ˜¯ è¯­ä¹‰ä¸Š çš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ï¼Œè·Ÿå…·ä½“çš„ä¸šåŠ¡æœ‰å…³ éš”ç¦»å‹ï¼ˆisolationï¼‰ ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œå’Œä½¿ç”¨çš„æ•°æ®å¯¹ å¹¶å‘ çš„å…¶å®ƒäº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ äº’ä¸å¹²æ‰° é€šè¿‡ é” æ¥ä¿éšœéš”ç¦»æ€§ æŒä¹…æ€§ï¼ˆdurabilityï¼‰ äº‹åŠ¡ä¸€æ—¦æäº¤äº†ï¼Œå®ƒå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯ æ°¸ä¹…æ€§ çš„äº† é€šè¿‡ äº‹åŠ¡æ—¥å¿— æ¥ä¿éšœæŒä¹…æ€§ äº‹åŠ¡çš„çŠ¶æ€ æ´»åŠ¨çš„ï¼ˆactiveï¼‰ï¼šæŒ‡äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰ï¼šäº‹åŠ¡å·²ç»åœ¨å†…å­˜ä¸­æ‰§è¡Œå®Œæ¯•ä½†æ˜¯ è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ä¸­ å¤±è´¥çš„ï¼ˆfailedï¼‰ï¼šæ•°æ®åº“åœ¨ æ´»åŠ¨çš„ / éƒ¨åˆ†æäº¤çš„ è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯ æ— æ³•ç»§ç»­æ‰§è¡Œ ä¸­æ­¢çš„ï¼ˆabortedï¼‰ï¼šåœ¨ å¤±è´¥çš„ çŠ¶æ€ä¹‹åï¼Œå°†æ•°æ® å›æ»š åå°±æ˜¯ä¸­æ­¢çš„çŠ¶æ€ æäº¤çš„ï¼ˆcommittedï¼‰ï¼šå°†éƒ¨åˆ†æäº¤çš„å†…å®¹éƒ½ å·²ç»åŒæ­¥åˆ°ç£ç›˜ä¸Š äº‹åŠ¡çš„åˆ†ç±» æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactionsï¼‰ï¼šæ™®é€šçš„äº‹åŠ¡å°±æ˜¯æ‰å¹³äº‹åŠ¡ å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactions with Savepointsï¼‰ï¼šä½¿ç”¨ä¸Š savepoint çš„æ‰å¹³äº‹åŠ¡ é“¾äº‹åŠ¡ï¼ˆChained Transactionsï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¤„ç†ç»“æŸä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ åµŒå¥—äº‹åŠ¡ï¼ˆNested Transactionsï¼‰ï¼šä¸€ä¸ªå¤§çš„äº‹åŠ¡ä¸­å¯ä»¥åµŒå¥—å­äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDistributed Transactionsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¯èƒ½åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸­ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„-acid-ç‰¹æ€§"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯äº‹åŠ¡ äº‹åŠ¡ï¼šæ˜¯ä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒï¼Œä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§çŠ¶æ€ äº‹åŠ¡çš„å¤„ç†åŸåˆ™ï¼šæ˜¯ ä¸€ä¸ªå·¥ä½œå•å…ƒ ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸè¦ä¹ˆåŒæ—¶å¤±è´¥ åªæœ‰ InnoDB å­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ äº‹åŠ¡çš„ ACID ç‰¹æ€§ åŸå­æ€§ï¼ˆatomicityï¼‰ æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸæäº¤ï¼ˆcommitï¼‰è¦ä¹ˆåŒæ—¶å¤±è´¥å›æ»šï¼ˆrollbackï¼‰ ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä»ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ å˜æ¢åˆ°å¦å¤–ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ è¿™ç§çŠ¶æ€æ˜¯ è¯­ä¹‰ä¸Š çš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ï¼Œè·Ÿå…·ä½“çš„ä¸šåŠ¡æœ‰å…³ éš”ç¦»å‹ï¼ˆisolationï¼‰ ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œå’Œä½¿ç”¨çš„æ•°æ®å¯¹ å¹¶å‘ çš„å…¶å®ƒäº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ äº’ä¸å¹²æ‰° é€šè¿‡ é” æ¥ä¿éšœéš”ç¦»æ€§ æŒä¹…æ€§ï¼ˆdurabilityï¼‰ äº‹åŠ¡ä¸€æ—¦æäº¤äº†ï¼Œå®ƒå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯ æ°¸ä¹…æ€§ çš„äº† é€šè¿‡ äº‹åŠ¡æ—¥å¿— æ¥ä¿éšœæŒä¹…æ€§ äº‹åŠ¡çš„çŠ¶æ€ æ´»åŠ¨çš„ï¼ˆactiveï¼‰ï¼šæŒ‡äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰ï¼šäº‹åŠ¡å·²ç»åœ¨å†…å­˜ä¸­æ‰§è¡Œå®Œæ¯•ä½†æ˜¯ è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ä¸­ å¤±è´¥çš„ï¼ˆfailedï¼‰ï¼šæ•°æ®åº“åœ¨ æ´»åŠ¨çš„ / éƒ¨åˆ†æäº¤çš„ è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯ æ— æ³•ç»§ç»­æ‰§è¡Œ ä¸­æ­¢çš„ï¼ˆabortedï¼‰ï¼šåœ¨ å¤±è´¥çš„ çŠ¶æ€ä¹‹åï¼Œå°†æ•°æ® å›æ»š åå°±æ˜¯ä¸­æ­¢çš„çŠ¶æ€ æäº¤çš„ï¼ˆcommittedï¼‰ï¼šå°†éƒ¨åˆ†æäº¤çš„å†…å®¹éƒ½ å·²ç»åŒæ­¥åˆ°ç£ç›˜ä¸Š äº‹åŠ¡çš„åˆ†ç±» æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactionsï¼‰ï¼šæ™®é€šçš„äº‹åŠ¡å°±æ˜¯æ‰å¹³äº‹åŠ¡ å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactions with Savepointsï¼‰ï¼šä½¿ç”¨ä¸Š savepoint çš„æ‰å¹³äº‹åŠ¡ é“¾äº‹åŠ¡ï¼ˆChained Transactionsï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¤„ç†ç»“æŸä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ åµŒå¥—äº‹åŠ¡ï¼ˆNested Transactionsï¼‰ï¼šä¸€ä¸ªå¤§çš„äº‹åŠ¡ä¸­å¯ä»¥åµŒå¥—å­äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDistributed Transactionsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¯èƒ½åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸­ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„çŠ¶æ€"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯äº‹åŠ¡ äº‹åŠ¡ï¼šæ˜¯ä¸€ç»„é€»è¾‘æ“ä½œå•å…ƒï¼Œä½¿æ•°æ®ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§çŠ¶æ€ äº‹åŠ¡çš„å¤„ç†åŸåˆ™ï¼šæ˜¯ ä¸€ä¸ªå·¥ä½œå•å…ƒ ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå¤šä¸ªæ“ä½œæ—¶ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸè¦ä¹ˆåŒæ—¶å¤±è´¥ åªæœ‰ InnoDB å­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ äº‹åŠ¡çš„ ACID ç‰¹æ€§ åŸå­æ€§ï¼ˆatomicityï¼‰ æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸæäº¤ï¼ˆcommitï¼‰è¦ä¹ˆåŒæ—¶å¤±è´¥å›æ»šï¼ˆrollbackï¼‰ ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä»ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ å˜æ¢åˆ°å¦å¤–ä¸€ä¸ª åˆæ³•æ€§çŠ¶æ€ è¿™ç§çŠ¶æ€æ˜¯ è¯­ä¹‰ä¸Š çš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ï¼Œè·Ÿå…·ä½“çš„ä¸šåŠ¡æœ‰å…³ éš”ç¦»å‹ï¼ˆisolationï¼‰ ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œå’Œä½¿ç”¨çš„æ•°æ®å¯¹ å¹¶å‘ çš„å…¶å®ƒäº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ äº’ä¸å¹²æ‰° é€šè¿‡ é” æ¥ä¿éšœéš”ç¦»æ€§ æŒä¹…æ€§ï¼ˆdurabilityï¼‰ äº‹åŠ¡ä¸€æ—¦æäº¤äº†ï¼Œå®ƒå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯ æ°¸ä¹…æ€§ çš„äº† é€šè¿‡ äº‹åŠ¡æ—¥å¿— æ¥ä¿éšœæŒä¹…æ€§ äº‹åŠ¡çš„çŠ¶æ€ æ´»åŠ¨çš„ï¼ˆactiveï¼‰ï¼šæŒ‡äº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰ï¼šäº‹åŠ¡å·²ç»åœ¨å†…å­˜ä¸­æ‰§è¡Œå®Œæ¯•ä½†æ˜¯ è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ä¸­ å¤±è´¥çš„ï¼ˆfailedï¼‰ï¼šæ•°æ®åº“åœ¨ æ´»åŠ¨çš„ / éƒ¨åˆ†æäº¤çš„ è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯ æ— æ³•ç»§ç»­æ‰§è¡Œ ä¸­æ­¢çš„ï¼ˆabortedï¼‰ï¼šåœ¨ å¤±è´¥çš„ çŠ¶æ€ä¹‹åï¼Œå°†æ•°æ® å›æ»š åå°±æ˜¯ä¸­æ­¢çš„çŠ¶æ€ æäº¤çš„ï¼ˆcommittedï¼‰ï¼šå°†éƒ¨åˆ†æäº¤çš„å†…å®¹éƒ½ å·²ç»åŒæ­¥åˆ°ç£ç›˜ä¸Š äº‹åŠ¡çš„åˆ†ç±» æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactionsï¼‰ï¼šæ™®é€šçš„äº‹åŠ¡å°±æ˜¯æ‰å¹³äº‹åŠ¡ å¸¦æœ‰ä¿å­˜ç‚¹çš„æ‰å¹³äº‹åŠ¡ï¼ˆFlat Transactions with Savepointsï¼‰ï¼šä½¿ç”¨ä¸Š savepoint çš„æ‰å¹³äº‹åŠ¡ é“¾äº‹åŠ¡ï¼ˆChained Transactionsï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¤„ç†ç»“æŸä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ åµŒå¥—äº‹åŠ¡ï¼ˆNested Transactionsï¼‰ï¼šä¸€ä¸ªå¤§çš„äº‹åŠ¡ä¸­å¯ä»¥åµŒå¥—å­äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆDistributed Transactionsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¯èƒ½åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸­ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„åˆ†ç±»"},{"categories":null,"content":"\räº‹åŠ¡çš„ä½¿ç”¨\ræ˜¾å¼äº‹åŠ¡ å¼€å¯äº‹åŠ¡ BEGIN; #æˆ–è€… START TRANSACTION; ä½¿ç”¨ START TRANSACTION åé¢å¯ä»¥è·Ÿä¿®é¥°ç¬¦ READ ONLYï¼šåªè¯»äº‹åŠ¡ï¼Œåªèƒ½æŸ¥è¯¢ä¸èƒ½å¢åˆ æ”¹ READ WRITEï¼šè¯»å†™äº‹åŠ¡ï¼Œå¯è¯»å¯åˆ æ”¹ã€é»˜è®¤ã€‘ WITH CONSISTENT SNAPSHOTï¼šä¸€è‡´æ€§è¯»ï¼ˆå¯ä¸ READ ONLY / READ WRITE æ­é…ä½¿ç”¨ï¼‰ # æäº¤äº‹åŠ¡ COMMIT; # å›æ»šäº‹åŠ¡ ROLLBACK; # å°†äº‹åŠ¡å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ ROLLBACK TO [SAVEPOINT] éšå¼äº‹åŠ¡ é»˜è®¤ autocommit ä¸ºå¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œçš„ DML è¯­å¥å³åˆ»æäº¤ å½“æ‰§è¡Œ start transaction æˆ– begin åˆ™ autocommit è‡ªåŠ¨å…³é—­ éšå¼æäº¤çš„æƒ…å†µ æ‰§è¡Œæ•°æ®å®šä¹‰ DDL è¯­è¨€æ—¶ï¼Œcreateã€alterã€drop ç­‰è¯­å¥æ—¶ã€DDL æ“ä½œä¸å— autocommit å½±å“ã€‘ éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹ mysql æ•°æ®åº“ä¸­çš„è¡¨ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit åˆå¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit è®¾ç½®äº† autocommit = on æ—¶ ä½¿ç”¨ LOCK TABLES ã€ UNLOCK TABLES ç­‰å…³äºé”å®šçš„è¯­å¥ load data å¾€æ•°æ®åº“æ‰¹é‡å¯¼å…¥æ•°æ®æ—¶ æ‰§è¡Œå…³äº MySQL å¤åˆ¶çš„è¯­å¥æ—¶ å…¶å®ƒçš„ä¸€äº›è¯­å¥ @@completion_type è®¾ç½®æ‰§è¡Œäº‹åŠ¡åçš„æ“ä½œ @@completion_type = 0 æ—¶ï¼Œåœ¨ commit ä¹‹åè¿˜éœ€å†æ¬¡å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ã€é»˜è®¤ã€‘ @@completion_type = 1 æ—¶ï¼Œå¼€å¯é“¾å¼äº‹åŠ¡ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œç›¸å½“äº COMMIT AND CHAIN @@completion_type = 2 æ—¶ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨ä¸æœåŠ¡å™¨æ–­è¿ï¼Œç›¸å½“äº COMMIT AND RELEASE ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„ä½¿ç”¨"},{"categories":null,"content":"\räº‹åŠ¡çš„ä½¿ç”¨\ræ˜¾å¼äº‹åŠ¡ å¼€å¯äº‹åŠ¡ BEGIN; #æˆ–è€… START TRANSACTION; ä½¿ç”¨ START TRANSACTION åé¢å¯ä»¥è·Ÿä¿®é¥°ç¬¦ READ ONLYï¼šåªè¯»äº‹åŠ¡ï¼Œåªèƒ½æŸ¥è¯¢ä¸èƒ½å¢åˆ æ”¹ READ WRITEï¼šè¯»å†™äº‹åŠ¡ï¼Œå¯è¯»å¯åˆ æ”¹ã€é»˜è®¤ã€‘ WITH CONSISTENT SNAPSHOTï¼šä¸€è‡´æ€§è¯»ï¼ˆå¯ä¸ READ ONLY / READ WRITE æ­é…ä½¿ç”¨ï¼‰ # æäº¤äº‹åŠ¡ COMMIT; # å›æ»šäº‹åŠ¡ ROLLBACK; # å°†äº‹åŠ¡å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ ROLLBACK TO [SAVEPOINT] éšå¼äº‹åŠ¡ é»˜è®¤ autocommit ä¸ºå¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œçš„ DML è¯­å¥å³åˆ»æäº¤ å½“æ‰§è¡Œ start transaction æˆ– begin åˆ™ autocommit è‡ªåŠ¨å…³é—­ éšå¼æäº¤çš„æƒ…å†µ æ‰§è¡Œæ•°æ®å®šä¹‰ DDL è¯­è¨€æ—¶ï¼Œcreateã€alterã€drop ç­‰è¯­å¥æ—¶ã€DDL æ“ä½œä¸å— autocommit å½±å“ã€‘ éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹ mysql æ•°æ®åº“ä¸­çš„è¡¨ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit åˆå¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit è®¾ç½®äº† autocommit = on æ—¶ ä½¿ç”¨ LOCK TABLES ã€ UNLOCK TABLES ç­‰å…³äºé”å®šçš„è¯­å¥ load data å¾€æ•°æ®åº“æ‰¹é‡å¯¼å…¥æ•°æ®æ—¶ æ‰§è¡Œå…³äº MySQL å¤åˆ¶çš„è¯­å¥æ—¶ å…¶å®ƒçš„ä¸€äº›è¯­å¥ @@completion_type è®¾ç½®æ‰§è¡Œäº‹åŠ¡åçš„æ“ä½œ @@completion_type = 0 æ—¶ï¼Œåœ¨ commit ä¹‹åè¿˜éœ€å†æ¬¡å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ã€é»˜è®¤ã€‘ @@completion_type = 1 æ—¶ï¼Œå¼€å¯é“¾å¼äº‹åŠ¡ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œç›¸å½“äº COMMIT AND CHAIN @@completion_type = 2 æ—¶ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨ä¸æœåŠ¡å™¨æ–­è¿ï¼Œç›¸å½“äº COMMIT AND RELEASE ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ˜¾å¼äº‹åŠ¡"},{"categories":null,"content":"\räº‹åŠ¡çš„ä½¿ç”¨\ræ˜¾å¼äº‹åŠ¡ å¼€å¯äº‹åŠ¡ BEGIN; #æˆ–è€… START TRANSACTION; ä½¿ç”¨ START TRANSACTION åé¢å¯ä»¥è·Ÿä¿®é¥°ç¬¦ READ ONLYï¼šåªè¯»äº‹åŠ¡ï¼Œåªèƒ½æŸ¥è¯¢ä¸èƒ½å¢åˆ æ”¹ READ WRITEï¼šè¯»å†™äº‹åŠ¡ï¼Œå¯è¯»å¯åˆ æ”¹ã€é»˜è®¤ã€‘ WITH CONSISTENT SNAPSHOTï¼šä¸€è‡´æ€§è¯»ï¼ˆå¯ä¸ READ ONLY / READ WRITE æ­é…ä½¿ç”¨ï¼‰ # æäº¤äº‹åŠ¡ COMMIT; # å›æ»šäº‹åŠ¡ ROLLBACK; # å°†äº‹åŠ¡å›æ»šåˆ°æŸä¸ªä¿å­˜ç‚¹ ROLLBACK TO [SAVEPOINT] éšå¼äº‹åŠ¡ é»˜è®¤ autocommit ä¸ºå¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œçš„ DML è¯­å¥å³åˆ»æäº¤ å½“æ‰§è¡Œ start transaction æˆ– begin åˆ™ autocommit è‡ªåŠ¨å…³é—­ éšå¼æäº¤çš„æƒ…å†µ æ‰§è¡Œæ•°æ®å®šä¹‰ DDL è¯­è¨€æ—¶ï¼Œcreateã€alterã€drop ç­‰è¯­å¥æ—¶ã€DDL æ“ä½œä¸å— autocommit å½±å“ã€‘ éšå¼ä½¿ç”¨æˆ–ä¿®æ”¹ mysql æ•°æ®åº“ä¸­çš„è¡¨ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit åˆå¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡æ—¶ å½“ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰ commit è®¾ç½®äº† autocommit = on æ—¶ ä½¿ç”¨ LOCK TABLES ã€ UNLOCK TABLES ç­‰å…³äºé”å®šçš„è¯­å¥ load data å¾€æ•°æ®åº“æ‰¹é‡å¯¼å…¥æ•°æ®æ—¶ æ‰§è¡Œå…³äº MySQL å¤åˆ¶çš„è¯­å¥æ—¶ å…¶å®ƒçš„ä¸€äº›è¯­å¥ @@completion_type è®¾ç½®æ‰§è¡Œäº‹åŠ¡åçš„æ“ä½œ @@completion_type = 0 æ—¶ï¼Œåœ¨ commit ä¹‹åè¿˜éœ€å†æ¬¡å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ã€é»˜è®¤ã€‘ @@completion_type = 1 æ—¶ï¼Œå¼€å¯é“¾å¼äº‹åŠ¡ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨å¼€å¯ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œç›¸å½“äº COMMIT AND CHAIN @@completion_type = 2 æ—¶ï¼Œåœ¨ commit ä¹‹åä¼šè‡ªåŠ¨ä¸æœåŠ¡å™¨æ–­è¿ï¼Œç›¸å½“äº COMMIT AND RELEASE ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#éšå¼äº‹åŠ¡"},{"categories":null,"content":"\räº‹åŠ¡çš„éš”ç¦»çº§åˆ«\ræ•°æ®çš„å¹¶å‘é—®é¢˜ è„å†™ï¼ˆ Dirty Write ï¼‰ äº‹åŠ¡ A ä¿®æ”¹äº†æœªæäº¤çš„äº‹åŠ¡ B çš„ä¿®æ”¹è¿‡çš„æ•°æ® A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒA commit ä¹‹å B åˆ rollback äº†ï¼Œå¯¼è‡´ A æäº¤çš„å†…å®¹ä¸¢å¤± è„è¯»ï¼ˆ Dirty Read ï¼‰ äº‹åŠ¡ A è¯»å–äº†å·²ç»è¢« äº‹åŠ¡ B æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µ A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å°†æ•°æ®ä¿®æ”¹ä¹‹åæ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ A è¯»å–åˆ°äº† B æœªæäº¤çš„æ•°æ®ã€è„è¯»ã€‘ï¼Œæ­¤æ—¶ B å›æ»š â€¦ ä¸å¯é‡å¤è¯»ï¼ˆ Non-Repeatable Read ï¼‰ äº‹åŠ¡ A è¯»å– äº†ä¸€ä¸ªå­—æ®µï¼Œç„¶åäº‹åŠ¡ B æ›´æ–°äº†è¯¥å­—æ®µã€‚ ä¹‹å A å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µï¼Œ å€¼å°±ä¸åŒäº† A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶ B å°±ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ A æ¯æ¬¡è¯»åˆ°çš„å†…å®¹éƒ½ä¸ä¸€è‡´ å¹»è¯»ï¼ˆ Phantom ï¼‰ äº‹åŠ¡ A ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶åäº‹åŠ¡ B åœ¨è¯¥è¡¨ä¸­æ’å…¥ä¸€äº›æ–°çš„è¡Œã€‚ ä¹‹åï¼Œå¦‚æœäº‹åŠ¡ A å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œ A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶è¯»åˆ°äº† B ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„å€¼ï¼ŒA å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ · ä¸¥é‡æ€§ï¼š è„å†™ \u003e è„è¯» \u003e ä¸å¯é‡å¤è¯» \u003e å¹»è¯» äº‹åŠ¡çš„éš”ç¦»çº§åˆ« READ UNCOMMITTED ï¼šè¯»æœªæäº¤ åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ ä¸èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» READ COMMITTED ï¼šè¯»å·²æäº¤ ã€Oracle é»˜è®¤ã€‘ ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚åœ¨ A äº‹åŠ¡æäº¤ä¹‹åï¼ŒB äº‹åŠ¡ä¸­å³å¯çœ‹åˆ°æ”¹å˜ å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ REPEATABLE READ ï¼šå¯é‡å¤è¯» ã€MySQL é»˜è®¤ã€‘ äº‹åŠ¡ A åœ¨è¯»åˆ°ä¸€æ¡æ•°æ®ä¹‹åï¼Œæ­¤æ—¶äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œé‚£ä¹ˆäº‹åŠ¡ A å†è¯»è¯¥æ•°æ®ï¼Œè¯»åˆ°çš„è¿˜æ˜¯åŸæ¥çš„å†…å®¹ å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ SERIALIZABLE ï¼šä¸²è¡ŒåŒ–è¯» ç¡®ä¿äº‹åŠ¡å¯ä»¥ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–ç›¸åŒçš„è¡Œã€‚åœ¨è¿™ä¸ªäº‹åŠ¡æŒç»­æœŸé—´ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œ æ‰€æœ‰çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥é¿å…ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯» äº‹åŠ¡çš„ä½¿ç”¨ æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« SELECT @@transaction_isolation; è®¾ç½®éš”ç¦»çº§åˆ« SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL éš”ç¦»çº§åˆ«; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ UNCOMMITTED \u003e READ COMMITTED \u003e REPEATABLE READ \u003e SERIALIZABLE SET [GLOBAL|SESSION] TRANSACTION_ISOLATION = 'éš”ç¦»çº§åˆ«' #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ-UNCOMMITTED \u003e READ-COMMITTED \u003e REPEATABLE-READ \u003e SERIALIZABLE è®¾ç½® global çš„éš”ç¦»çº§åˆ«å¯¹å½“å‰ session æ— æ•ˆ è®¾ç½® session çš„éš”ç¦»çº§åˆ«ï¼šå¯ä»¥åœ¨å·²ç»å¼€å¯çš„äº‹åŠ¡ä¸­é—´æ‰§è¡Œï¼Œä½†ä¸ä¼šå½±å“å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"},{"categories":null,"content":"\räº‹åŠ¡çš„éš”ç¦»çº§åˆ«\ræ•°æ®çš„å¹¶å‘é—®é¢˜ è„å†™ï¼ˆ Dirty Write ï¼‰ äº‹åŠ¡ A ä¿®æ”¹äº†æœªæäº¤çš„äº‹åŠ¡ B çš„ä¿®æ”¹è¿‡çš„æ•°æ® A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒA commit ä¹‹å B åˆ rollback äº†ï¼Œå¯¼è‡´ A æäº¤çš„å†…å®¹ä¸¢å¤± è„è¯»ï¼ˆ Dirty Read ï¼‰ äº‹åŠ¡ A è¯»å–äº†å·²ç»è¢« äº‹åŠ¡ B æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µ A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å°†æ•°æ®ä¿®æ”¹ä¹‹åæ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ A è¯»å–åˆ°äº† B æœªæäº¤çš„æ•°æ®ã€è„è¯»ã€‘ï¼Œæ­¤æ—¶ B å›æ»š â€¦ ä¸å¯é‡å¤è¯»ï¼ˆ Non-Repeatable Read ï¼‰ äº‹åŠ¡ A è¯»å– äº†ä¸€ä¸ªå­—æ®µï¼Œç„¶åäº‹åŠ¡ B æ›´æ–°äº†è¯¥å­—æ®µã€‚ ä¹‹å A å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µï¼Œ å€¼å°±ä¸åŒäº† A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶ B å°±ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ A æ¯æ¬¡è¯»åˆ°çš„å†…å®¹éƒ½ä¸ä¸€è‡´ å¹»è¯»ï¼ˆ Phantom ï¼‰ äº‹åŠ¡ A ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶åäº‹åŠ¡ B åœ¨è¯¥è¡¨ä¸­æ’å…¥ä¸€äº›æ–°çš„è¡Œã€‚ ä¹‹åï¼Œå¦‚æœäº‹åŠ¡ A å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œ A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶è¯»åˆ°äº† B ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„å€¼ï¼ŒA å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ · ä¸¥é‡æ€§ï¼š è„å†™ \u003e è„è¯» \u003e ä¸å¯é‡å¤è¯» \u003e å¹»è¯» äº‹åŠ¡çš„éš”ç¦»çº§åˆ« READ UNCOMMITTED ï¼šè¯»æœªæäº¤ åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ ä¸èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» READ COMMITTED ï¼šè¯»å·²æäº¤ ã€Oracle é»˜è®¤ã€‘ ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚åœ¨ A äº‹åŠ¡æäº¤ä¹‹åï¼ŒB äº‹åŠ¡ä¸­å³å¯çœ‹åˆ°æ”¹å˜ å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ REPEATABLE READ ï¼šå¯é‡å¤è¯» ã€MySQL é»˜è®¤ã€‘ äº‹åŠ¡ A åœ¨è¯»åˆ°ä¸€æ¡æ•°æ®ä¹‹åï¼Œæ­¤æ—¶äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œé‚£ä¹ˆäº‹åŠ¡ A å†è¯»è¯¥æ•°æ®ï¼Œè¯»åˆ°çš„è¿˜æ˜¯åŸæ¥çš„å†…å®¹ å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ SERIALIZABLE ï¼šä¸²è¡ŒåŒ–è¯» ç¡®ä¿äº‹åŠ¡å¯ä»¥ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–ç›¸åŒçš„è¡Œã€‚åœ¨è¿™ä¸ªäº‹åŠ¡æŒç»­æœŸé—´ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œ æ‰€æœ‰çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥é¿å…ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯» äº‹åŠ¡çš„ä½¿ç”¨ æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« SELECT @@transaction_isolation; è®¾ç½®éš”ç¦»çº§åˆ« SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL éš”ç¦»çº§åˆ«; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ UNCOMMITTED \u003e READ COMMITTED \u003e REPEATABLE READ \u003e SERIALIZABLE SET [GLOBAL|SESSION] TRANSACTION_ISOLATION = 'éš”ç¦»çº§åˆ«' #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ-UNCOMMITTED \u003e READ-COMMITTED \u003e REPEATABLE-READ \u003e SERIALIZABLE è®¾ç½® global çš„éš”ç¦»çº§åˆ«å¯¹å½“å‰ session æ— æ•ˆ è®¾ç½® session çš„éš”ç¦»çº§åˆ«ï¼šå¯ä»¥åœ¨å·²ç»å¼€å¯çš„äº‹åŠ¡ä¸­é—´æ‰§è¡Œï¼Œä½†ä¸ä¼šå½±å“å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®çš„å¹¶å‘é—®é¢˜"},{"categories":null,"content":"\räº‹åŠ¡çš„éš”ç¦»çº§åˆ«\ræ•°æ®çš„å¹¶å‘é—®é¢˜ è„å†™ï¼ˆ Dirty Write ï¼‰ äº‹åŠ¡ A ä¿®æ”¹äº†æœªæäº¤çš„äº‹åŠ¡ B çš„ä¿®æ”¹è¿‡çš„æ•°æ® A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒA commit ä¹‹å B åˆ rollback äº†ï¼Œå¯¼è‡´ A æäº¤çš„å†…å®¹ä¸¢å¤± è„è¯»ï¼ˆ Dirty Read ï¼‰ äº‹åŠ¡ A è¯»å–äº†å·²ç»è¢« äº‹åŠ¡ B æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µ A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å°†æ•°æ®ä¿®æ”¹ä¹‹åæ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ A è¯»å–åˆ°äº† B æœªæäº¤çš„æ•°æ®ã€è„è¯»ã€‘ï¼Œæ­¤æ—¶ B å›æ»š â€¦ ä¸å¯é‡å¤è¯»ï¼ˆ Non-Repeatable Read ï¼‰ äº‹åŠ¡ A è¯»å– äº†ä¸€ä¸ªå­—æ®µï¼Œç„¶åäº‹åŠ¡ B æ›´æ–°äº†è¯¥å­—æ®µã€‚ ä¹‹å A å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µï¼Œ å€¼å°±ä¸åŒäº† A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶ B å°±ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ A æ¯æ¬¡è¯»åˆ°çš„å†…å®¹éƒ½ä¸ä¸€è‡´ å¹»è¯»ï¼ˆ Phantom ï¼‰ äº‹åŠ¡ A ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶åäº‹åŠ¡ B åœ¨è¯¥è¡¨ä¸­æ’å…¥ä¸€äº›æ–°çš„è¡Œã€‚ ä¹‹åï¼Œå¦‚æœäº‹åŠ¡ A å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œ A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶è¯»åˆ°äº† B ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„å€¼ï¼ŒA å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ · ä¸¥é‡æ€§ï¼š è„å†™ \u003e è„è¯» \u003e ä¸å¯é‡å¤è¯» \u003e å¹»è¯» äº‹åŠ¡çš„éš”ç¦»çº§åˆ« READ UNCOMMITTED ï¼šè¯»æœªæäº¤ åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ ä¸èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» READ COMMITTED ï¼šè¯»å·²æäº¤ ã€Oracle é»˜è®¤ã€‘ ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚åœ¨ A äº‹åŠ¡æäº¤ä¹‹åï¼ŒB äº‹åŠ¡ä¸­å³å¯çœ‹åˆ°æ”¹å˜ å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ REPEATABLE READ ï¼šå¯é‡å¤è¯» ã€MySQL é»˜è®¤ã€‘ äº‹åŠ¡ A åœ¨è¯»åˆ°ä¸€æ¡æ•°æ®ä¹‹åï¼Œæ­¤æ—¶äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œé‚£ä¹ˆäº‹åŠ¡ A å†è¯»è¯¥æ•°æ®ï¼Œè¯»åˆ°çš„è¿˜æ˜¯åŸæ¥çš„å†…å®¹ å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ SERIALIZABLE ï¼šä¸²è¡ŒåŒ–è¯» ç¡®ä¿äº‹åŠ¡å¯ä»¥ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–ç›¸åŒçš„è¡Œã€‚åœ¨è¿™ä¸ªäº‹åŠ¡æŒç»­æœŸé—´ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œ æ‰€æœ‰çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥é¿å…ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯» äº‹åŠ¡çš„ä½¿ç”¨ æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« SELECT @@transaction_isolation; è®¾ç½®éš”ç¦»çº§åˆ« SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL éš”ç¦»çº§åˆ«; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ UNCOMMITTED \u003e READ COMMITTED \u003e REPEATABLE READ \u003e SERIALIZABLE SET [GLOBAL|SESSION] TRANSACTION_ISOLATION = 'éš”ç¦»çº§åˆ«' #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ-UNCOMMITTED \u003e READ-COMMITTED \u003e REPEATABLE-READ \u003e SERIALIZABLE è®¾ç½® global çš„éš”ç¦»çº§åˆ«å¯¹å½“å‰ session æ— æ•ˆ è®¾ç½® session çš„éš”ç¦»çº§åˆ«ï¼šå¯ä»¥åœ¨å·²ç»å¼€å¯çš„äº‹åŠ¡ä¸­é—´æ‰§è¡Œï¼Œä½†ä¸ä¼šå½±å“å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«-1"},{"categories":null,"content":"\räº‹åŠ¡çš„éš”ç¦»çº§åˆ«\ræ•°æ®çš„å¹¶å‘é—®é¢˜ è„å†™ï¼ˆ Dirty Write ï¼‰ äº‹åŠ¡ A ä¿®æ”¹äº†æœªæäº¤çš„äº‹åŠ¡ B çš„ä¿®æ”¹è¿‡çš„æ•°æ® A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒA commit ä¹‹å B åˆ rollback äº†ï¼Œå¯¼è‡´ A æäº¤çš„å†…å®¹ä¸¢å¤± è„è¯»ï¼ˆ Dirty Read ï¼‰ äº‹åŠ¡ A è¯»å–äº†å·²ç»è¢« äº‹åŠ¡ B æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µ A B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å°†æ•°æ®ä¿®æ”¹ä¹‹åæ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ A è¯»å–åˆ°äº† B æœªæäº¤çš„æ•°æ®ã€è„è¯»ã€‘ï¼Œæ­¤æ—¶ B å›æ»š â€¦ ä¸å¯é‡å¤è¯»ï¼ˆ Non-Repeatable Read ï¼‰ äº‹åŠ¡ A è¯»å– äº†ä¸€ä¸ªå­—æ®µï¼Œç„¶åäº‹åŠ¡ B æ›´æ–°äº†è¯¥å­—æ®µã€‚ ä¹‹å A å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µï¼Œ å€¼å°±ä¸åŒäº† A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶ B å°±ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ A æ¯æ¬¡è¯»åˆ°çš„å†…å®¹éƒ½ä¸ä¸€è‡´ å¹»è¯»ï¼ˆ Phantom ï¼‰ äº‹åŠ¡ A ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µ, ç„¶åäº‹åŠ¡ B åœ¨è¯¥è¡¨ä¸­æ’å…¥ä¸€äº›æ–°çš„è¡Œã€‚ ä¹‹åï¼Œå¦‚æœäº‹åŠ¡ A å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨, å°±ä¼šå¤šå‡ºå‡ è¡Œ A å¼€å¯äº‹åŠ¡ä¹‹ååœ¨æœªæäº¤æ—¶è¯»åˆ°äº† B ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„å€¼ï¼ŒA å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ · ä¸¥é‡æ€§ï¼š è„å†™ \u003e è„è¯» \u003e ä¸å¯é‡å¤è¯» \u003e å¹»è¯» äº‹åŠ¡çš„éš”ç¦»çº§åˆ« READ UNCOMMITTED ï¼šè¯»æœªæäº¤ åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ ä¸èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» READ COMMITTED ï¼šè¯»å·²æäº¤ ã€Oracle é»˜è®¤ã€‘ ä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚åœ¨ A äº‹åŠ¡æäº¤ä¹‹åï¼ŒB äº‹åŠ¡ä¸­å³å¯çœ‹åˆ°æ”¹å˜ å¯ä»¥é¿å…è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ REPEATABLE READ ï¼šå¯é‡å¤è¯» ã€MySQL é»˜è®¤ã€‘ äº‹åŠ¡ A åœ¨è¯»åˆ°ä¸€æ¡æ•°æ®ä¹‹åï¼Œæ­¤æ—¶äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ï¼Œé‚£ä¹ˆäº‹åŠ¡ A å†è¯»è¯¥æ•°æ®ï¼Œè¯»åˆ°çš„è¿˜æ˜¯åŸæ¥çš„å†…å®¹ å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»é—®é¢˜ä»ç„¶å­˜åœ¨ SERIALIZABLE ï¼šä¸²è¡ŒåŒ–è¯» ç¡®ä¿äº‹åŠ¡å¯ä»¥ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–ç›¸åŒçš„è¡Œã€‚åœ¨è¿™ä¸ªäº‹åŠ¡æŒç»­æœŸé—´ï¼Œç¦æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œ æ‰€æœ‰çš„å¹¶å‘é—®é¢˜éƒ½å¯ä»¥é¿å…ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚èƒ½é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯» äº‹åŠ¡çš„ä½¿ç”¨ æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« SELECT @@transaction_isolation; è®¾ç½®éš”ç¦»çº§åˆ« SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL éš”ç¦»çº§åˆ«; #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ UNCOMMITTED \u003e READ COMMITTED \u003e REPEATABLE READ \u003e SERIALIZABLE SET [GLOBAL|SESSION] TRANSACTION_ISOLATION = 'éš”ç¦»çº§åˆ«' #å…¶ä¸­ï¼Œéš”ç¦»çº§åˆ«æ ¼å¼ï¼š \u003e READ-UNCOMMITTED \u003e READ-COMMITTED \u003e REPEATABLE-READ \u003e SERIALIZABLE è®¾ç½® global çš„éš”ç¦»çº§åˆ«å¯¹å½“å‰ session æ— æ•ˆ è®¾ç½® session çš„éš”ç¦»çº§åˆ«ï¼šå¯ä»¥åœ¨å·²ç»å¼€å¯çš„äº‹åŠ¡ä¸­é—´æ‰§è¡Œï¼Œä½†ä¸ä¼šå½±å“å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:15:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#äº‹åŠ¡çš„ä½¿ç”¨-1"},{"categories":null,"content":"\rMySQL äº‹åŠ¡æ—¥å¿— äº‹åŠ¡çš„éš”ç¦»å‹ï¼ˆisolationï¼‰ç”± é”æœºåˆ¶ å®ç° äº‹åŠ¡çš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…æ€§ ç”± redoã€undo æ—¥å¿— å®ç° REDO LOG é‡åšæ—¥å¿— æä¾›å†å†™å…¥æ“ä½œã€æ¢å¤æäº¤äº‹åŠ¡çš„é¡µæ“ä½œï¼Œç”¨äºä¿è¯ æŒä¹…æ€§ è®°å½• ç‰©ç†çº§åˆ« ä¸Šçš„é¡µä¿®æ”¹æ“ä½œï¼Œæ¯”å¦‚å† xx é¡µå· xx åç§»é‡å†™å…¥äº† xx æ•°æ® UNDO LOG å›æ»šæ—¥å¿— å›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œç”¨äºä¿è¯ åŸå­æ€§ã€ä¸€è‡´æ€§ ç”¨äº äº‹åŠ¡çš„å›æ»š å’Œ ä¸€è‡´æ€§éé”å®šè¯» è®°å½• é€»è¾‘æ“ä½œ çš„æ—¥å¿—ï¼Œæ¯”å¦‚å¯¹æŸä¸€è¡Œè¿›è¡Œäº† insert æ“ä½œï¼Œåˆ™è®°å½•ç›¸åçš„ delete æ“ä½œ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:16:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mysql-äº‹åŠ¡æ—¥å¿—"},{"categories":null,"content":"\rredo æ—¥å¿— å¯¹æ•°æ®çš„å˜æ›´éƒ½è¦å…ˆæ›´æ–°å†…å­˜ä¸­çš„ ç¼“å†²æ±  ï¼Œç„¶åä»¥ä¸€å®šçš„é¢‘ç‡å°†è¿™äº› è„é¡µ åˆ·æ–°åˆ°ç£ç›˜ä¸­ å½“å†…å­˜ä¸­çš„æ•°æ®æ›´æ”¹å®Œæˆä½†è¿˜æœªåˆ·ç›˜æ—¶ç³»ç»Ÿå®•æœºï¼Œæ­¤æ—¶å†…å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œå°±è¦é  redo æ—¥å¿—æ¥ä¿è¯æŒä¹…æ€§ redo æ—¥å¿—ä¹Ÿè¦å‘ç£ç›˜å†™å…¥æ•°æ®ï¼Œåˆ·ç›˜ä¹Ÿæ˜¯å‘ç£ç›˜å†™å…¥æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨æ—¥å¿—å‘¢ï¼Ÿ æ—¥å¿—çš„å†™å…¥é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œåˆ·ç›˜éœ€è¦å°†ä¸€æ•´ä¸ªé¡µ 16K çš„æ•°æ®å…¨éƒ¨åˆ·å…¥ï¼ˆç»“åˆä¼˜ç‚¹ï¼‰ ä¼˜ç‚¹ï¼š é™ä½äº†åˆ·ç›˜çš„é¢‘ç‡ å ç”¨ç©ºé—´å° ä½¿ç”¨é¡ºåº I/Oï¼Œæ•ˆç‡æ¯”éšæœº I/O å¿« äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œredo æ—¥å¿—ä¸æ–­è®°å½• redo æ—¥å¿—çš„ç»„æˆï¼š é‡åšæ—¥å¿—çš„ç¼“å†²ï¼ˆredo log bufferï¼‰ï¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ˜“ä¸¢å¤± æœ€å¤§å€¼æ˜¯ 4096Mï¼Œæœ€å°å€¼ä¸º1M é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆredo log fileï¼‰ï¼šä¿å­˜åœ¨ç¡¬ç›˜ä¸­ï¼Œæ˜¯æŒä¹…çš„ redo æ—¥å¿—çš„æ‰§è¡Œæµç¨‹ï¼š ==**Write-Ahead Log (é¢„å…ˆæ—¥å¿—æŒä¹…åŒ–) **==ï¼šåœ¨æŒä¹…åŒ–ä¸€ä¸ªæ•°æ®é¡µä¹‹å‰ï¼Œå…ˆå°†å†…å­˜ä¸­ç›¸åº”çš„æ—¥å¿—é¡µæŒä¹…åŒ– æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ ï¼ˆpage cacheï¼‰ï¼šç”±æ“ä½œç³»ç»Ÿæä¾›çš„ç¼“å­˜æœºåˆ¶ï¼Œåœ¨æ•°æ®åˆ·æ–°åˆ°ç£ç›˜å‰å…ˆè¿›ç¼“å­˜åŠ å¿«åˆ·æ–°æ•ˆç‡ innodb_flush_log_at_trx_commit å‚æ•°ï¼Œè®¾ç½® redo æ•°æ®ä» redo log buffer åˆ·æ–°åˆ° redo log file çš„ç­–ç•¥ 0 ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œï¼ˆç³»ç»Ÿé»˜è®¤ master thread æ¯éš” 1s è¿›è¡Œä¸€æ¬¡é‡åšæ—¥å¿—çš„åŒæ­¥ï¼‰ 1 ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡ŒåŒæ­¥ï¼Œåˆ·ç›˜æ“ä½œã€é»˜è®¤å€¼ã€‘ 2 ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠ redo log buffer å†…å®¹å†™å…¥ page cache ç”±ç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ å¼€å¯ 3W æ¡äº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´æƒ…å†µï¼Œå½“è®¾ç½®ä¸º 2 ç¡®å®å¯æé«˜æ•ˆç‡ï¼Œä½†ä¸§å¤±äº†äº‹åŠ¡ ACID ç‰¹æ€§ å†™å…¥ redo log buffer æ¯ä¸ªè¯­å¥åŒ…å«è‹¥å¹²ä¸ª mtrï¼ˆMini-Transactionï¼‰æ¯ä¸ª mtr åŒ…å«è‹¥å¹²ä¸ª redo æ—¥å¿— åœ¨å¹¶å‘çš„å†™å…¥ redo log buffer æ—¶ï¼Œmtr_t1_x å’Œ mtr_t2_x ä¼šäº¤æ›¿çš„ä¾æ¬¡å†™å…¥ æ¯ä¸ª log block å ç”¨ 512 å­—èŠ‚ï¼Œåˆšå¥½æ˜¯æœºæ¢°ç¡¬ç›˜ä¸€ä¸ªæ‰‡åŒºçš„å¤§å° å†™å…¥ redo log file innodb_log_group_home_dir ï¼šæŒ‡å®š redo log æ–‡ä»¶ç»„æ‰€åœ¨çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º ./ innodb_log_files_in_groupï¼šæŒ‡æ˜ redo log file çš„ä¸ªæ•°ï¼Œé»˜è®¤ 2 æœ€å¤§ 100 innodb_log_file_sizeï¼šå•ä¸ª redo log æ–‡ä»¶è®¾ç½®å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 48M æœ€å¤§å€¼ä¸º 512Gï¼ˆä¸ªæ•° * å¤§å° çš„å€¼ï¼‰ æ—¥å¿—æ–‡ä»¶ç»„ï¼š æ—¥å¿—æ–‡ä»¶ç»„ç±»ä¼¼äºå¾ªç¯é“¾è¡¨çš„ç»“æ„ å½“å‰è®°å½•çš„ä½ç½® æ²¡æœ‰èµ¶ä¸Š å½“å‰æ“¦é™¤çš„ä½ç½®æ—¶ï¼Œå‰æ–¹çš„è®°å½•éƒ½æ˜¯è¦†ç›–å†™å…¥çš„ã€‚å½“å‰è®°å½•çš„ä½ç½® å·²ç»èµ¶ä¸Š å½“å‰æ“¦é™¤çš„ä½ç½®æ—¶ï¼ŒMySQL å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•æ¨è¿›ä¸€ä¸‹ write position è¡¨ç¤ºå½“å‰è®°å½•çš„ä½ç½® checkpoint è¡¨ç¤ºå½“å‰è¦æ“¦é™¤çš„ä½ç½® ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:16:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#redo-æ—¥å¿—"},{"categories":null,"content":"\rundo æ—¥å¿— ä¸ºä¿è¯äº‹åŠ¡åŸå­æ€§ï¼Œåœ¨äº‹åŠ¡ä¸­ æ›´æ–°æ•°æ® çš„ å‰ç½®æ“ä½œ æ˜¯è¦ å…ˆå†™å…¥ä¸€ä¸ª undo log å½“æ‰§è¡Œäº‹åŠ¡çš„ä¸­é€”å‡ºç° æ„å¤–æƒ…å†µ éœ€è¦å°†äº‹åŠ¡ å›æ»šï¼Œæ­¤æ—¶å°±éœ€è¦ undo æ—¥å¿— å½“ æ’å…¥äº†ä¸€æ¡è®°å½• æ—¶ï¼Œä¼šè®°å½•è¿™æ¡è®°å½•çš„ ä¸»é”®å€¼ï¼Œå›æ»šæ—¶æ ¹æ®ä¸»é”®å€¼ åˆ é™¤ å³å¯ å½“ åˆ é™¤äº†ä¸€æ¡è®°å½• æ—¶ï¼Œä¼šè®°å½•è¿™æ¡è®°å½•çš„ å…¨éƒ¨æ•°æ®ï¼Œå›æ»šæ—¶å†å°†è¿™äº›æ•°æ® æ’å…¥ å³å¯ å½“ ä¿®æ”¹äº†ä¸€æ¡è®°å½• æ—¶ï¼Œä¼šè®°å½•ä¿®æ”¹å‰çš„ æ—§å€¼ï¼Œå›æ»šæ—¶æ‰§è¡Œç›¸åçš„ æ›´æ–° å³å¯ ä½œç”¨ï¼š å›æ»šæ•°æ®ï¼šå›æ»šæ•°æ®å¹¶éæ˜¯ç‰©ç†å›æ»šï¼Œåªä¼šå°†æ•°æ® é€»è¾‘æ¢å¤ åˆ°åŸå…ˆçš„æ ·å­ã€‚æ¯”å¦‚ï¼Œinsert æ“ä½œå¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„æ•°æ®é¡µï¼Œæ­¤æ—¶å›æ»šå¹¶ä¸ä¼šå°†æ­¤æ•°æ®é¡µåˆ é™¤ï¼Œè€Œæ˜¯å°†æ­¤æ•°æ®é¡µä¸Šçš„è¿™æ¡è®°å½•è¡Œæ ‡è®° delete è€Œå·² MVCCï¼šInnoDB ä¸­ å¤šç‰ˆæœ¬å¹¶å‘å¼€å§‹æ˜¯ç”± undo æ—¥å¿—æ§åˆ¶çš„ã€‚å½“ç”¨æˆ·è¯»å–ä¸€æ¡è®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•å·²ç»è¢«å…¶å®ƒäº‹åŠ¡å ç”¨ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥é€šè¿‡ undo æ—¥å¿—è¯»å–ä¹‹å‰çš„è¡Œç‰ˆæœ¬ä¿¡æ¯ å­˜å‚¨ç»“æ„ undo log é‡‡ç”¨ å›æ»šæ®µ(rollback segment) ç®¡ç† ã€‚æ¯ä¸ªå›æ»šæ®µè®°å½•äº† 1024 ä¸ª undo log segment (1024 æ¬¡æ“ä½œ) åœ¨ InnoDB 1.1 ä¹‹å‰åªæ”¯æŒä¸€ä¸ªå›æ»šæ®µ (åªæ”¯æŒ 1024 ä¸ªå¹¶å‘) åœ¨ InnoDB 1.1 å¼€å§‹æ”¯æŒ 128 ä¸ªå›æ»šæ®µ (æ”¯æŒ 128 * 1024 ä¸ªå¹¶å‘) ä» InnoDB 1.2 å¼€å§‹è¿™äº›å›æ»šæ®µä¸ä»…é™äºå­˜å‚¨åœ¨ ibdata (å…±äº«è¡¨ç©ºé—´) ä¸­äº† å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªå›æ»šæ®µ (å½“å‰è¿™ä¸ªå›æ»šæ®µåœ¨åŒä¸€æ—¶åˆ»å¯èƒ½æœåŠ¡å¤šä¸ªäº‹åŠ¡) å½“æ•°æ®ä¿®æ”¹æ—¶ï¼ŒåŸå§‹çš„æ•°æ®ä¼šå¤åˆ¶åˆ°å›æ»šæ®µä¸­ã€‚äº‹åŠ¡ä¼šä¸æ–­å¡«å……ç›˜åŒºï¼Œå½“å‰ç›˜åŒºä¸å¤Ÿç”¨æ—¶ï¼Œä¼šæ‰©å±•æ–°çš„ç›˜åŒº å›æ»šæ®µå­˜åœ¨ undo è¡¨ç©ºé—´ä¸­ï¼Œæ•°æ®åº“å¯ä»¥å­˜åœ¨å¤šä¸ª undo è¡¨ç©ºé—´ (æœ€å°‘ 2 ä¸ª)ï¼Œä½†åŒä¸€æ—¶é—´åªèƒ½ä½¿ç”¨ä¸€ä¸ª è¡¨ç©ºé—´ \u003e æ®µ \u003e åŒº \u003e é¡µ \u003e è¡Œ undo é¡µçš„é‡ç”¨ï¼šæ¯ä¸€ä¸ªäº‹åŠ¡éƒ½è¦ç”³è¯·ä¸€ä¸ª 16KB çš„ undo é¡µçš„è¯éå¸¸æµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ undo log åœ¨ commit ä¹‹åä¼šå…ˆå­˜åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå¦‚æœ undo é¡µå°äº 3/4 çš„è¯åˆ™é‡ç”¨ å›æ»šæ®µä¸­æ•°æ®åˆ†ç±»ï¼š æœªæäº¤çš„å›æ»šæ•°æ®(uncommitted undo information) ä¸èƒ½è¢«è¦†ç›– å·²ç»æäº¤ä½†æœªè¿‡æœŸçš„å›æ»šæ•°æ®(committed undo information) å¯ä»¥è¢«è¦†ç›– äº‹åŠ¡å·²ç»æäº¤å¹¶è¿‡æœŸçš„æ•°æ®(expired undo information) ä¼˜å…ˆè¢«è¦†ç›– äº‹åŠ¡æäº¤ä¹‹åä¸èƒ½ç«‹åˆ»åˆ é™¤ undo logã€é¡µï¼Œå› ä¸ºå¯èƒ½è¿˜æœ‰å…¶å®ƒçº¿ç¨‹éœ€è¦ä½¿ç”¨ï¼Œç”±ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹åˆ¤æ–­ é“¾ ä¸­çš„ undo log ä»¥åŠæ‰€åœ¨é¡µ æ˜¯å¦å¯ä»¥åˆ é™¤ undo çš„åˆ†ç±»ï¼š insert undo logï¼šinsert æ“ä½œçš„è®°å½•å¯¹å…¶å®ƒçº¿ç¨‹ä¸å¯è§ï¼Œåœ¨äº‹åŠ¡æäº¤åå¯ç›´æ¥åˆ é™¤ update undo logï¼šupdate å’Œ delete çš„ undo log éœ€è¦æä¾› MVCC æœºåˆ¶ï¼Œä¸èƒ½è¢«ç›´æ¥åˆ é™¤ bin log ä¸»è¦ç”¨äºå®ç°åˆ†å¸ƒå¼ä¸­çš„ä¸»ä»å¤åˆ¶ è¯¦ç»†è¿‡ç¨‹ï¼š è¡Œæ ¼å¼ä¸­éšè—çš„åˆ— å½“æ’å…¥äº†ä¸€æ¡æ•°æ®æ—¶ å¯¹è¿™æ¡æ•°æ®æ‰§è¡Œ update æ—¶ å½“ä¿®æ”¹è¿™æ¡æ•°æ®çš„ä¸»é”®å€¼æ—¶ å›æ»šæ—¶ï¼š æ ‡è®°åˆ é™¤æ–°çš„æ•°æ®è¡Œï¼Œä¿®æ”¹åŸæ•°æ®è¡Œçš„ deletemark = 0 æ ¹æ® undo æ—¥å¿—æ¢å¤æ›´æ–°çš„æ•°æ® æ ‡è®°åˆ é™¤æ•°æ®è¡Œ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:16:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#undo-æ—¥å¿—"},{"categories":null,"content":"\ré” äº‹åŠ¡çš„éš”ç¦»æ€§ç”±é”æœºåˆ¶å®ç° T1 å’Œ T2 äº‹åŠ¡å¹¶å‘æ“ä½œï¼ŒT1 è·å–åˆ°äº†é”ï¼ŒT2 è¿›å…¥ç­‰å¾…çŠ¶æ€ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é”"},{"categories":null,"content":"\rå¹¶å‘é—®é¢˜çš„è§£å†³ å¯¹ è¯»æ“ä½œ é‡‡ç”¨ MVCCã€å¯¹ å†™æ“ä½œ åŠ é” MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) å°±æ˜¯ç”Ÿæˆä¸€ä¸ª ReadView æ‰¾åˆ°å¤åˆæ¡ä»¶çš„è®°å½•ç‰ˆæœ¬ åœ¨ è¯»å·²æäº¤ READ COMMITTED ä¸­ï¼Œäº‹åŠ¡çš„æ¯æ¬¡ SELECT éƒ½ç”Ÿæˆä¸€ä¸ª ReadViewï¼ŒReadView æœ¬èº«å°±ä¿è¯äº† äº‹åŠ¡åªèƒ½è¯»åˆ°å·²æäº¤äº‹åŠ¡æ‰€åšçš„æ›´æ”¹ åœ¨ å¯é‡å¤è¯» REPEATABLE READ ä¸­ï¼Œäº‹åŠ¡ä¸­åªæœ‰ç¬¬ä¸€æ¬¡ SELECT æ‰ä¼šç”Ÿæˆ ReadViewï¼Œä¹‹åçš„ SELECT éƒ½ å¤ç”¨ è¿™ä¸ª ReadView è¯»å†™æ“ä½œ éƒ½åŠ é” å¯¹è¯»å’Œå†™æ“ä½œéƒ½åŠ é”ï¼Œæ•ˆç‡è¾ƒä½ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨ MVCC æ¥è§£å†³è¯»å†™æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µ ä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨åŠ é”çš„æ–¹å¼æ‰§è¡Œ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¹¶å‘é—®é¢˜çš„è§£å†³"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é”çš„åˆ†ç±»"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¯»æ“ä½œ"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å†™æ“ä½œ"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¡¨çº§é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¡¨çº§åˆ«çš„-s-é”å’Œ-x-é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ„å‘é”intention-lock"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è‡ªå¢é”auto-inc-é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…ƒæ•°æ®é”mdlé”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é¡µçº§é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è¡Œé”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#è®°å½•é”record-locks"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é—´æ­‡é”gap-locks"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸´é”®é”next-key-locks"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ’å…¥æ„å‘é”insert-intention-locks"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ‚²è§‚é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¹è§‚é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ˜¾å¼é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#éšå¼é”"},{"categories":null,"content":"\ré”çš„åˆ†ç±»\rä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ† è¯»é” ï¼šä¹Ÿç§°ä¸º å…±äº«é” ï¼ˆShared Lockï¼‰ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚ é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚ å†™é” ï¼šä¹Ÿç§°ä¸º æ’ä»–é” ï¼ˆExclusive Lockï¼‰ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚ å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚ è¯»æ“ä½œï¼š æ·»åŠ  S å…±äº« é” SELECT ... LOCK IN SHARE MODE # æˆ– SELECT ... FOR SHARE æ·»åŠ  X æ’å®ƒ é” SELECT ... FOR UPDATE åœ¨ MySQL 5.7 ä¸­ï¼Œåœ¨æ·»åŠ æ’ä»–é”æ—¶å¦‚æœè·å–ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° innodb_lock_wait_timeout è¶…æ—¶ åœ¨ MySQL 8 ä¸­ï¼Œåœ¨æ·»åŠ å…±äº«é”æˆ–æ’å®ƒé”æ—¶ï¼Œå¯ä»¥æ·»åŠ  NOWAIT æˆ– SKIP LOCKED (è¿”å›æœªè¢«é”å®šçš„è¡Œ) è·³è¿‡é”ç­‰å¾… / é”å®š å†™æ“ä½œï¼š DELETE æ“ä½œï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œæ‰§è¡Œ delete mark æ“ä½œ UPDATE æ“ä½œï¼š æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æ²¡å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé”ï¼Œåœ¨åŸä½ç½®è¿›è¡Œæ›´æ”¹ æœªä¿®æ”¹ ä¸»é”®å€¼ ä¸” ä¿®æ”¹åçš„å­˜å‚¨ç©ºé—´ æœ‰å˜åŒ–ï¼šå…ˆå®šä½ B+ æ ‘ä¸­è¿™æ¡è®°å½•çš„ä½ç½®ï¼Œæ·»åŠ  Xé” å½»åº•åˆ é™¤è¯¥è®°å½• (ç§»å…¥åƒåœ¾é“¾è¡¨) ï¼Œé€šè¿‡ INSERT çš„ éšå¼é” ä¿æŠ¤æ’å…¥ä¸€æ¡æ–°è®°å½• ä¿®æ”¹äº† ä¸»é”®å€¼ï¼šç›¸å½“äºåœ¨åŸè®°å½•ä¸Šè¿›è¡Œ DELETE æ“ä½œåè¿›è¡Œ INSERT æ“ä½œ INSERT æ“ä½œï¼šæ’å…¥æ•°æ®æ—¶ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡ éšå¼é” ä¿è¯æ’å…¥æ“ä½œåœ¨æäº¤å‰ä¸è¢«åˆ«çš„äº‹åŠ¡è®¿é—® ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ† é”ç²’åº¦ï¼šå½“é”çš„èŒƒå›´è¶Šå°åˆ™å¹¶å‘åº¦è¶Šé«˜ï¼Œä½†ç®¡ç†é”éœ€è¦æ¶ˆè€—çš„èµ„æºå°±è¶Šå¤šï¼Œå› æ­¤éœ€è¦åœ¨ å¹¶å‘å“åº” å’Œ ç³»ç»Ÿæ€§èƒ½ ä¸¤æ–¹é¢è¿›è¡Œå¹³è¡¡ MyISAM åªæ”¯æŒè¡¨é”ä¸æ”¯æŒè¡Œé”ï¼ŒInnoDB è¡¨é”è¡Œé”éƒ½æ”¯æŒ è¡¨çº§é”ï¼š\râ‘ è¡¨çº§åˆ«çš„ S é”å’Œ X é” å¯¹è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ—¶ InnoDB éƒ½ä¼šä½¿ç”¨è¡Œé”è€Œä¸æ˜¯è¡¨é”ï¼Œä½†æ˜¯åœ¨ä¸€äº› DDL è¯­å¥æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è¡¨é” (å…ƒæ•°æ®é”) åœ¨ autocommit=0ï¼Œinnodb_table_locks = 1 æ—¶æ‰‹åŠ¨è·å–è¡¨é”ï¼š LOCK TABLES t READ # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ S é” LOCK TABLES t WRITE # InnoDB å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ X é” UNLOCK TABLES; # è§£é™¤è¡¨é” â‘¡æ„å‘é”ï¼ˆintention lockï¼‰ InnoDB å…è®¸ è¡Œçº§é” å’Œ è¡¨çº§é” å¹¶å­˜ï¼Œæ„å‘é” æ˜¯ä¸€ç§ è¡¨é” æ„å‘é”ï¼š å½“æˆ‘ä»¬æƒ³è¦å‘è¡¨æ·»åŠ è¡¨çº§é”ï¼Œä½†è¡¨ä¸­å·²ç»å­˜åœ¨è¡Œçº§é”æ—¶åˆ™æ— æ³•æ·»åŠ  é‚£ä¹ˆå¦‚ä½•çŸ¥é“è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¡Œçº§é”å‘¢ï¼Ÿä¸€æ¡æ¡éå†å—ï¼Ÿ ç”±æ­¤å¼•å…¥æ„å‘é”ï¼Œåœ¨è¡¨ä¸­æ·»åŠ è¡Œçº§é”æ—¶å‘ å¤§ä¸€çº§çš„ç©ºé—´ åŒæ—¶æ·»åŠ ä¸€ä¸ª ( å¯¹åº”çš„ S/X ) æ„å‘é” è¿™æ˜¯å†æƒ³è¦æ·»åŠ è¡¨çº§é”åªéœ€è¦æŸ¥çœ‹æœ‰æ²¡æœ‰æ„å‘é”å­˜åœ¨å³å¯ æ„å‘å…±äº«é”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  å…±äº«é”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚ SELECT column FROM table ... LOCK IN SHARE MODE; æ„å‘æ’å®ƒé”ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ  æ’å®ƒé”ï¼ˆSé”ï¼‰ -- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ SELECT column FROM table ... FOR UPDATE; æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥ æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† è¡Œé”å’Œè¡¨é”å…±å­˜ ä¸” æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§ çš„è¦æ±‚ â‘¢è‡ªå¢é”ï¼ˆAUTO-INC é”ï¼‰ æ’å…¥æ•°æ®çš„æ¨¡å¼ ç®€å•çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values .. , .. é¢„å…ˆç¡®å®šæ’å…¥çš„è¡Œæ•° æ‰¹é‡çš„æ’å…¥ï¼šä½¿ç”¨ isnert into ... select ... äº‹å…ˆä¸çŸ¥é“æ’å…¥çš„è¡Œæ•° æ··åˆæ¨¡å¼çš„æ’å…¥ï¼šä½¿ç”¨ insert into ... values(1,'a'),(NULL,'b') åªæŒ‡å®šäº†éƒ¨åˆ†ä¸»é”®æ—¶ åœ¨å‘å«æœ‰ auto_increment ä¸»é”®çš„è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦è·å– è‡ªå¢é” ä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”æ—¶ï¼Œå…¶å®ƒæ’å…¥è¯­å¥éƒ½è¦è¢«é˜»å¡ å½“æˆ‘ä»¬å‘æœ‰ auto_increment çš„ä¸»é”®æ’å…¥å€¼çš„æ—¶å€™ï¼Œæ¯æ¡è¯­å¥éƒ½è¦ç«äº‰è¡¨çº§é”å¯¼è‡´æ•ˆç‡ä½ä¸‹ innodb_autoinc_lock_mode = 0 ( â€œä¼ ç»Ÿâ€ é”å®šæ¨¡å¼ ) æ¯ä¸ªäº‹åŠ¡éƒ½è¦äº‰æŠ¢è¡¨çº§é”ï¼Œå¹¶å‘èƒ½åŠ›å·® innodb_autoinc_lock_mode = 1 ( â€œè¿ç»­â€ é”å®šæ¨¡å¼ )ã€MySQL 5.7 å‰ é»˜è®¤ã€‘å¯¹äºç®€å•çš„æ’å…¥ä¼šå…ˆè·å– è½»é‡é” mutex é¿å…è¡¨çº§ AUTO-INC é” innodb_autoinc_lock_mode = 2 ( â€œäº¤é”™â€ é”å®šæ¨¡å¼ )ã€MySQL 8.0 é»˜è®¤ã€‘å¯ä»¥ä¿è¯è‡ªåŠ¨é€’å¢å¾—å€¼æ˜¯ å”¯ä¸€ ä¸” å•è°ƒé€’å¢ çš„ï¼Œä½†æ˜¯ æ··åˆ æˆ– æ‰¹é‡ æ’å…¥æ—¶ç”Ÿæˆçš„å€¼å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œåœ¨ä½¿ç”¨ BIN LOG å®ç°ä¸»ä»å¤åˆ¶æ—¶æ˜¯ä¸å®‰å…¨çš„ â‘£å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ åœ¨ MySQL 5.5 å¼•å…¥äº† meta data lockï¼Œç®€ç§° MDL é” å½“å¯¹ä¸€ä¸ªè¡¨åš å¢åˆ æ”¹æŸ¥ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é” å½“è¦å¯¹è¡¨åš ç»“æ„å˜æ›´ æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é” é¡µçº§é”ï¼š é¡µé”ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼šå¼€é”€ã€ç²’åº¦ã€å¹¶å‘ é¡µé”ä¹Ÿä¼šå‡ºç°æ­»é” é”ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“æŸä¸ªå±‚çº§çš„é”æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ é”å‡çº§ è¡Œé”ï¼š\râ‘ è®°å½•é”ï¼ˆRecord Locksï¼‰ å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿ å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä½† ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ï¼› å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„ X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ ä¸å¯ä»¥ ç»§ç»­è·å–è¯¥è®°å½•çš„ S å‹è®°å½•é”ï¼Œä¹Ÿ ä¸å¯ä»¥ ç»§ç»­è·å– X å‹è®°å½•é”ã€‚ â‘¡é—´æ­‡é”ï¼ˆGap Locksï¼‰ å¹»è¯»é—®é¢˜ï¼šå½“å‰äº‹åŠ¡è¯»å–äº† ä¸€ä¸ªèŒƒå›´çš„è®°å½•ï¼Œè¿™æ—¶å¦å¤–çš„äº‹åŠ¡æ’å…¥äº†æ–°è®°å½•ï¼Œæ­¤æ—¶å½“å‰äº‹åŠ¡å†æ¬¡è¯»å–è®°å½•æ—¶å‘ç°äº†æ–°è®°å½•ï¼ˆä½†ç¬¬ä¸€æ¬¡è¯»å–æ—¶è¿˜ä¸å­˜åœ¨è¿™æ¡è®°å½•ï¼Œæ— æ³•ä¸º å¹»å½±è®°å½• åŠ é”ï¼‰ é—´æ­‡é”ï¼šä¸º id ä¸º 8 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œæ„å‘³ç€ ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨ id å€¼ä¸º 8 çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½• ä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ç»†èŠ‚ï¼š ä¸º id ä¸º 5 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œç”±äº 5 å¤„äº 3 - 8 ä¹‹é—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„é—´éš™é”å’Œä¸º 8 æ·»åŠ é—´éš™é”ä¸€æ · ä¸º id ä¸º 20 çš„è®°å½•æ·»åŠ é—´éš™é”ï¼Œå¯¹ 15 - 20 æœ‰æ•ˆï¼Œå¯¹ 20 åˆ° +âˆ åŒæ ·æœ‰æ•ˆ å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¸º 8 æ·»åŠ é—´éš™é”åï¼Œåˆéƒ½æƒ³ insert 3 - 8 ä¹‹é—´çš„æ•°æ®ï¼Œè¿™æ ·ä¼šæŠ¥ Deadlock é”™è¯¯ è¿™æ˜¯ç”±äº A äº‹åŠ¡æ§åˆ¶ç€ B äº‹åŠ¡çš„é˜»å¡ï¼ŒB äº‹åŠ¡æ§åˆ¶ç€ A äº‹åŠ¡çš„é˜»å¡ï¼Œå½“ AB åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€æ—¶å°±ä¼šå‡ºç° æ­»é” â‘¢ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰ å½“æˆ‘ä»¬åˆæƒ³ä½¿ç”¨é—´éš™é”é”ä½å¼€åŒºé—´ (3, 8) åˆæƒ³åŒæ—¶ä¸º 8 æ·»åŠ è¡Œé” (3, 8]ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸´é”®é” begin; select * from student where id \u003c=8 and id \u003e 3 for update; â‘£æ’å…¥æ„å‘é”ï¼ˆInsert Intention Locksï¼‰ é’ˆå¯¹äºè¢«é—´éš™é”é˜»å¡çš„æ’å…¥æ“ä½œï¼Œä¼šç”Ÿæˆæ’å…¥æ„å‘é” æ’å…¥æ„å‘é”æ˜¯åœ¨æ’å…¥ä¸€æ¡è®°å½•è¡Œå‰ï¼Œç”± INSERT æ“ä½œäº§ç”Ÿçš„ä¸€ç§é—´éš™é”ï¼Œè´Ÿè´£é˜»å¡ç»“æŸçš„æ’å…¥æ“ä½œçš„ç»§ç»­æ‰§è¡Œ äº‹å®ä¸Šæ’å…¥æ„å‘é”å¹¶ä¸ä¼šé˜»æ­¢åˆ«çš„äº‹åŠ¡ç»§ç»­è·å–è¯¥è®°å½•ä¸Šä»»ä½•ç±»å‹çš„é” ä»å¯¹å¾…é”çš„æ€åº¦ä¸Šåˆ’åˆ†\ræ‚²è§‚é” æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Š é”ï¼Œ é˜»å¡ å…¶å®ƒçº¿ç¨‹ SELECT ... FOR UPDATE æ­¤è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ æ‰€æœ‰æ‰«æåˆ°çš„è¡Œ éƒ½ä¼šè¢«é”ä¸Šï¼Œåœ¨ä½¿ç”¨æ‚²è§‚é”æ—¶è¦ç¡®ä¿è¯­å¥ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æï¼Œå¦åˆ™ä¼šåŠ è¡¨é” ä¹è§‚é” ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºå®ç° é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡ Java çš„ java.util.concurrent.atomic åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é” ç‰ˆæœ¬å·æœºåˆ¶ ä¸ºè¡¨æ·»åŠ ç‰ˆæœ¬å·å­—æ®µï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™è·å– version å­—æ®µï¼Œåœ¨æ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ä¼šæ‰§è¡Œ version + 1 æ“ä½œï¼Œæ­¤æ—¶å…¶å®ƒäº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œåˆ™ä¸ä¼šæˆåŠŸ UPDATE ... SET version = version + 1 WHERE version = version æ—¶é—´æˆ³æœºåˆ¶ å’Œç‰ˆæœ¬å·ç±»ä¼¼ï¼Œé€šè¿‡æ¯”å¯¹å½“å‰æ›´æ–° å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å­—æ®µå€¼ å’Œ æ›´æ–°å‰çš„æ—¶é—´æˆ³å­—æ®µå€¼ æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬å†²çª å½“é‡‡ç”¨ è¯»å†™åˆ†ç¦»ã€ä¸»ä»å¤åˆ¶ æ¶æ„æ—¶ï¼Œç”±äºä¸¤ä¸ªæ•°æ®åº“çš„åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå¯¼è‡´ç‰ˆæœ¬ä¼šä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å¼ºåˆ¶è¯»å– master çš„æ•°æ®è§£å†³ å½“åŒä¸€æ•°æ®éœ€è¦é¢‘ç¹çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨åº“å­˜ä½œä¸ºä¹è§‚é”çš„å®ç°å­—æ®µï¼ŒUPDATE ... WHERE åº“å­˜æ•°é‡ - è´­ä¹°æ•°é‡ \u003e 0 è§£å†³è¶…å–é—®é¢˜ ä»åŠ é”çš„æ–¹å¼ä¸Šåˆ’åˆ†\ræ˜¾å¼é” æ˜¾å¼çš„ä½¿ç”¨äº†åŠ é”çš„è¯­å¥ï¼šlock in share mode for update éšå¼é” ä¸€èˆ¬æƒ…å†µä¸‹ æ’å…¥ ä¸€æ¡æ•°æ®æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œä½†æ˜¯éœ€è¦æ·»åŠ  éšå¼é” å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ åœ¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œç¢°åˆ°äº†å½“å‰äº‹åŠ¡çš„æ’å…¥æ“ä½œæ—¶ï¼Œæ‰ä¼šè§¦å‘éšå¼é”é˜»å¡è‡ªå·±ï¼ˆå»¶è¿ŸåŠ é”ï¼‰ å…¨å±€é” è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼Œé˜»å¡å…¶å®ƒ DML DDL æ“ä½œï¼Œåº”ç”¨åœºæ™¯ï¼šå…¨åº“é€»è¾‘å¤‡ä»½ Flush tables with read lock ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…¨å±€é”"},{"categories":null,"content":"\ré”çš„å†…å­˜ç»“æ„ å¹¶ä¸æ˜¯æ¯è¡Œæ•°æ®éƒ½ç‹¬ç«‹ç”Ÿæˆä¸€ä¸ªé”ç»“æ„ï¼Œå¤åˆæ¡ä»¶çš„è®°å½•ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªé”ç»“æ„ä¸­ åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡ŒåŠ é”æ“ä½œ è¢«åŠ é”çš„è®°å½•åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­ åŠ é”çš„ç±»å‹ä¸€è‡´ ç­‰å¾…çŠ¶æ€ä¸€è‡´ é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯ è®°å½•å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„é” æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œå¦‚ äº‹åŠ¡ id ç­‰ ç´¢å¼•ä¿¡æ¯ å¯¹äº è¡Œé” ï¼Œè®°å½•åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆ è¡¨é”ï¼è¡Œé”ä¿¡æ¯ è¡¨é”ï¼š è®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚ è¡Œé”ï¼š Space ID ï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´ Page Number ï¼šè®°å½•æ‰€åœ¨é¡µå· n_bits ï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒçš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œé”ç»“æ„çš„æœ«å°¾æ”¾ç½®äº† ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ª n_bits å±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½ã€‚n_bits çš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•åä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„ type_mode é”çš„æ¨¡å¼ï¼ˆ lock_mode ï¼‰ LOCK_ISï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ IS é” LOCK_IXï¼ˆåè¿›åˆ¶çš„ 1 ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ IX é” LOCK_S ï¼ˆåè¿›åˆ¶çš„ 2 ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯ S é” LOCK_X ï¼ˆåè¿›åˆ¶çš„ 3 ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯ X é” LOCK_AUTO_INC ï¼ˆåè¿›åˆ¶çš„ 4 ï¼‰ï¼šè¡¨ç¤º AUTO-INC é” åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ LOCK_ISï¼ŒLOCK_IXï¼ŒLOCK_AUTO_INC éƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_S å’Œ LOCK_X æ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”çš„æ¨¡å¼ã€‚ é”çš„ç±»å‹ï¼ˆ lock_type ï¼‰ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ LOCK_TABLE ï¼ˆåè¿›åˆ¶çš„ 16 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬ 5 ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é” LOCK_REC ï¼ˆåè¿›åˆ¶çš„ 32 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬ 6 ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é” è¡Œé”çš„å…·ä½“ç±»å‹ï¼ˆ rec_lock_type ï¼‰ åªæœ‰åœ¨ lock_type çš„å€¼ä¸º LOCK_REC æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šçš„ç±»å‹ï¼š LOCK_ORDINARY ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤º next-key é” LOCK_GAP ï¼ˆåè¿›åˆ¶çš„ 512 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬ 10 ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤º gap é” LOCK_REC_NOT_GAP ï¼ˆåè¿›åˆ¶çš„ 1024 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬ 11 ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤ºæ­£ç»è®°å½•é” LOCK_INSERT_INTENTION ï¼ˆåè¿›åˆ¶çš„ 2048 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚ â€¦ â€¦ LOCK_WAIT ï¼ˆåè¿›åˆ¶çš„ 256 ï¼‰ ï¼š å½“ ç¬¬ 9 ä¸ªæ¯”ç‰¹ä½ç½® ä¸º 1 æ—¶ï¼Œè¡¨ç¤º is_waiting ä¸º true ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤º is_waiting ä¸º false ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸ å…¶ä»–ä¿¡æ¯ ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§ é”ç»“æ„ è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ ä¸€å †æ¯”ç‰¹ä½ å¯¹äºè¡Œé”æ¥è¯´ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„ n_bits å±æ€§è¡¨ç¤ºçš„ã€‚InnoDB æ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨ è®°å½•å¤´ä¿¡æ¯ ä¸­éƒ½åŒ…å«ä¸€ä¸ª heap_no å±æ€§ï¼Œä¼ªè®°å½• Infimum çš„ heap_no å€¼ä¸º 0 ï¼Œ Supremum çš„ heap_no å€¼ä¸º 1 ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ heap_no å€¼å°±å¢ 1ã€‚ é”ç»“æ„æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª heap_no ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„åˆ°é¡µå†…çš„ä¸€æ¡è®°å½• ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é”çš„å†…å­˜ç»“æ„"},{"categories":null,"content":"\ré”ç›‘æ§ æŸ¥çœ‹é”çš„ç›‘æ§æƒ…å†µ show status like 'innodb_row_lock%'; æŸ¥çœ‹é”çš„è¯¦ç»†ç›‘æ§æ•°æ® # MySQL 5.7 åªèƒ½çœ‹åˆ°æ­£åœ¨é˜»å¡çš„äº‹åŠ¡çš„ä¿¡æ¯, MySQL 8 å¯ä»¥çœ‹åˆ°æ‰€æœ‰äº‹åŠ¡ä¿¡æ¯ SELECT * FROM information_schema.INNODB_TRX\\G; ## æŸ¥çœ‹æ‰€æœ‰é”çš„ä¿¡æ¯ # MySQL 5.7 ä¸­ SELECT * FROM information_schema.INNODB_LOCKS\\G; # MySQL 8 ä¸­ SELECT * FROM performance_schema.data_locks\\G; ## æŸ¥çœ‹ç­‰å¾…ä¸­çš„é”çš„ä¿¡æ¯ # MySQL 5.7 ä¸­ SELECT * FROM information_schema.INNODB_LOCK_WAITS\\G; # MySQL 8 ä¸­ SELECT * FROM performance_schema.data_lock_waits\\G; ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:17:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#é”ç›‘æ§"},{"categories":null,"content":"\rå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"},{"categories":null,"content":"\rMVCC MVCC å³ å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ ï¼ˆMultiversion Concurrency Controlï¼‰ è§£å†³ è¯»-å†™ / å†™-è¯» å¹¶ä¸‹æƒ…å†µä¸‹çš„ è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» é—®é¢˜ MVCC ä¸­çš„ è¯» / å†™ ä¸å†²çªï¼Œé’ˆå¯¹äº å†™ é‡‡ç”¨åŠ é”çš„æ–¹å¼ï¼Œé’ˆå¯¹äº è¯» é‡‡ç”¨ ReadView ç®¡ç†è®°å½•ç‰ˆæœ¬çš„æ–¹å¼è§£å†³ å¿«ç…§è¯» å¿«ç…§è¯»åˆå« ä¸€è‡´æ€§è¯» ï¼Œè¯»å–çš„æ—¶å¿«ç…§æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ è¯»ã€‘ ä¸åŠ é”çš„ç®€å•çš„ SELECT è¯­å¥å°±æ˜¯å¿«ç…§è¯» ç”±äºæ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå¿«ç…§è¯» è¯»åˆ°çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ç‰ˆæœ¬ å¿«ç…§è¯» çš„å‰æï¼šä¸æ˜¯ä¸²è¡Œçš„éš”ç¦»çº§åˆ«ï¼Œå¦åˆ™ä¼šé€€åŒ–æˆå½“å‰è¯» å½“å‰è¯» å½“å‰è¯» è¯»çš„æ˜¯æœ€æ–°ç‰ˆæœ¬æœ€æ–°æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ å†™ã€‘ åŠ äº†é”çš„ SELECT å’Œ DML æ“ä½œéƒ½æ˜¯å½“å‰è¯» ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mvcc"},{"categories":null,"content":"\rMVCC MVCC å³ å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ ï¼ˆMultiversion Concurrency Controlï¼‰ è§£å†³ è¯»-å†™ / å†™-è¯» å¹¶ä¸‹æƒ…å†µä¸‹çš„ è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» é—®é¢˜ MVCC ä¸­çš„ è¯» / å†™ ä¸å†²çªï¼Œé’ˆå¯¹äº å†™ é‡‡ç”¨åŠ é”çš„æ–¹å¼ï¼Œé’ˆå¯¹äº è¯» é‡‡ç”¨ ReadView ç®¡ç†è®°å½•ç‰ˆæœ¬çš„æ–¹å¼è§£å†³ å¿«ç…§è¯» å¿«ç…§è¯»åˆå« ä¸€è‡´æ€§è¯» ï¼Œè¯»å–çš„æ—¶å¿«ç…§æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ è¯»ã€‘ ä¸åŠ é”çš„ç®€å•çš„ SELECT è¯­å¥å°±æ˜¯å¿«ç…§è¯» ç”±äºæ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå¿«ç…§è¯» è¯»åˆ°çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ç‰ˆæœ¬ å¿«ç…§è¯» çš„å‰æï¼šä¸æ˜¯ä¸²è¡Œçš„éš”ç¦»çº§åˆ«ï¼Œå¦åˆ™ä¼šé€€åŒ–æˆå½“å‰è¯» å½“å‰è¯» å½“å‰è¯» è¯»çš„æ˜¯æœ€æ–°ç‰ˆæœ¬æœ€æ–°æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ å†™ã€‘ åŠ äº†é”çš„ SELECT å’Œ DML æ“ä½œéƒ½æ˜¯å½“å‰è¯» ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¿«ç…§è¯»"},{"categories":null,"content":"\rMVCC MVCC å³ å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ ï¼ˆMultiversion Concurrency Controlï¼‰ è§£å†³ è¯»-å†™ / å†™-è¯» å¹¶ä¸‹æƒ…å†µä¸‹çš„ è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» é—®é¢˜ MVCC ä¸­çš„ è¯» / å†™ ä¸å†²çªï¼Œé’ˆå¯¹äº å†™ é‡‡ç”¨åŠ é”çš„æ–¹å¼ï¼Œé’ˆå¯¹äº è¯» é‡‡ç”¨ ReadView ç®¡ç†è®°å½•ç‰ˆæœ¬çš„æ–¹å¼è§£å†³ å¿«ç…§è¯» å¿«ç…§è¯»åˆå« ä¸€è‡´æ€§è¯» ï¼Œè¯»å–çš„æ—¶å¿«ç…§æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ è¯»ã€‘ ä¸åŠ é”çš„ç®€å•çš„ SELECT è¯­å¥å°±æ˜¯å¿«ç…§è¯» ç”±äºæ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå¿«ç…§è¯» è¯»åˆ°çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ç‰ˆæœ¬ å¿«ç…§è¯» çš„å‰æï¼šä¸æ˜¯ä¸²è¡Œçš„éš”ç¦»çº§åˆ«ï¼Œå¦åˆ™ä¼šé€€åŒ–æˆå½“å‰è¯» å½“å‰è¯» å½“å‰è¯» è¯»çš„æ˜¯æœ€æ–°ç‰ˆæœ¬æœ€æ–°æ•°æ®ã€è§£å†³ è¯»/å†™ é—®é¢˜ä¸­çš„ å†™ã€‘ åŠ äº†é”çš„ SELECT å’Œ DML æ“ä½œéƒ½æ˜¯å½“å‰è¯» ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:1","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å½“å‰è¯»"},{"categories":null,"content":"\rReadView ç”±äº MVCC çš„å­˜åœ¨ï¼Œå¯é‡å¤è¯» éš”ç¦»çº§åˆ«è¿˜è§£å†³äº† å¹»è¯» é—®é¢˜ MVCC çš„å®ç°ä¾èµ–äºï¼šéšè—å­—æ®µã€Undo Logã€Read View ç”± éšè—å­—æ®µ çš„ DB_ROLL_PTR æŒ‡å‘çš„ undo log ç‰ˆæœ¬é“¾ trx_idï¼šæ­¤æ¬¡ä¿®æ”¹çš„äº‹åŠ¡ ID rol_pointerï¼šæŒ‡å‘ä¸Šä¸€æ¬¡ä¿®æ”¹çš„ undo æ—¥å¿— Read View å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨ MVCC æœºåˆ¶è¿›è¡Œå¿«ç…§è¯»æ“ä½œæ—¶äº§ç”Ÿçš„è¯»è§†å›¾ creator_trx_id åˆ›å»ºè¿™ä¸ª Read View çš„äº‹åŠ¡ ID äº‹åŠ¡ IDï¼šSELECT æ“ä½œçš„äº‹åŠ¡ ID ä¸º 0ï¼ŒINSERTã€DELETEã€UPDATE æ“ä½œçš„äº‹åŠ¡ ID æ˜¯é€’å¢çš„ trx_ids è¡¨ç¤ºåœ¨ç”Ÿæˆ ReadView æ—¶å½“å‰ç³»ç»Ÿä¸­ æ´»è·ƒï¼ˆå¯åŠ¨ä½†æœªæäº¤çš„äº‹åŠ¡ï¼‰ çš„è¯»å†™äº‹åŠ¡çš„ äº‹åŠ¡ ID åˆ—è¡¨ up_limit_id æ´»è·ƒçš„äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯æœ€æ—© begin ä¸”æ²¡æäº¤çš„äº‹åŠ¡ low_limit_id ç³»ç»Ÿæœ€å¤§çš„äº‹åŠ¡ ID å€¼ + 1ï¼ˆä¸ºä¸‹ä¸€ä¸ªäº‹åŠ¡åˆ†é…çš„ ID å€¼ï¼‰ï¼Œæ³¨æ„å¹¶ä¸æ˜¯æ­£åœ¨æ´»è·ƒçš„äº‹åŠ¡ID Read View çš„è§„åˆ™ï¼Œåˆ¤æ–­è®°å½•çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼ä¸ ReadView ä¸­çš„ creator_trx_id ç›¸åŒ ã€å¯ä»¥è®¿é—®ã€‘ å°±æ˜¯è¯´å½“å‰äº‹åŠ¡æ­£åœ¨è®¿é—®è¢«è‡ªå·±ä¿®æ”¹è¿‡çš„æ•°æ® å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼ å°äº ReadView ä¸­çš„ up_limit_id å€¼ã€å¯ä»¥è®¿é—®ã€‘ å°±æ˜¯è¯´å½“å‰æ­£åœ¨è®¿é—®çš„å¹¶ä¸æ˜¯æ´»è·ƒçš„äº‹åŠ¡æ˜¯å·²ç»æäº¤è¿‡çš„ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼ å¤§äºæˆ–ç­‰äº ReadView ä¸­çš„ low_limit_id å€¼ã€ä¸èƒ½è®¿é—®ã€‘ å°±æ˜¯è¯´å½“å‰æ­£åœ¨è®¿é—®çš„æ˜¯åæ¥äº‹åŠ¡ä¿®æ”¹çš„ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„ trx_id å±æ€§å€¼åœ¨ ReadView çš„ up_limit_id å’Œ low_limit_id ä¹‹é—´ å¦‚æœ trx_id åœ¨ trx_ids åˆ—è¡¨ä¸­ï¼Œå°±æ˜¯è¯´è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤ã€ä¸èƒ½è®¿é—®ã€‘ å¦‚æœ trx_id ä¸åœ¨ trx_ids åˆ—è¡¨ä¸­ï¼Œå°±æ˜¯è¯´è¿™ä¸ªäº‹åŠ¡å·²ç»æäº¤ã€å¯ä»¥è®¿é—®ã€‘ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:2","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#readview"},{"categories":null,"content":"\rMVCC æ‰§è¡Œæµç¨‹ é¦–å…ˆè·å–äº‹åŠ¡è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ ID è·å– ReadView æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åä¸ ReadView ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒ å¦‚æœä¸ç¬¦åˆ ReadView è§„åˆ™ï¼Œå°±éœ€è¦ä» Undo Log ä¸­è·å–å†å²å¿«ç…§ æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®ï¼ˆæ‰¾åˆ°æœ€å å·²ç»æäº¤çš„äº‹åŠ¡æäº¤çš„ è®°å½•ï¼‰ åœ¨éš”ç¦»çº§åˆ«ä¸º è¯»å·²æäº¤ æ—¶ï¼Œæ¯è¯»å–ä¸€æ¬¡å°±è·å–ä¸€ä¸ª Read View å½“éš”ç¦»çº§åˆ«ä¸º å¯é‡å¤è¯» çš„ï¼Œåªåœ¨äº‹åŠ¡å¼€å¯æ—¶è·å–ä¸€ä¸ª Read View ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:3","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#mvcc-æ‰§è¡Œæµç¨‹"},{"categories":null,"content":"\rå¹»è¯»çš„è§£å†³ InnoDB å¼•æ“çš„ å¯é‡å¤è¯» éš”ç¦»çº§åˆ«ä¸‹é€šè¿‡ MVCC è§£å†³äº†å¹»è¯»é—®é¢˜ ç”±äºå¯é‡å¤è¯»çš„ Read View åªåœ¨äº‹åŠ¡å¼€å¯æ—¶è·å–ï¼Œæ ¹æ® Read View çš„äº‹åŠ¡ç‰ˆæœ¬å·æ¯”è¾ƒè§„åˆ™ å¯ä»¥å®ç°ï¼šåæ¥äº‹åŠ¡æäº¤çš„æ•°æ®ä¸èƒ½è®¿é—®ã€æœªæäº¤äº‹åŠ¡çš„æ•°æ®ä¸èƒ½è®¿é—®ï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ ","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:18:4","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å¹»è¯»çš„è§£å†³"},{"categories":null,"content":"\rå…¶å®ƒæ•°æ®åº“æ—¥å¿—","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:19:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#å…¶å®ƒæ•°æ®åº“æ—¥å¿—"},{"categories":null,"content":"\rä¸»ä»å¤åˆ¶","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:20:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#ä¸»ä»å¤åˆ¶"},{"categories":null,"content":"\ræ•°æ®åº“å¤‡ä»½ä¸æ¢å¤","date":"2022-08-22","objectID":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/:21:0","series":null,"tags":null,"title":"MySQLè‡ªå­¦ç¬”è®°è¿›é˜¶mdç‰ˆ","uri":"/mysql%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0%E8%BF%9B%E9%98%B6md%E7%89%88/#æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤"},{"categories":null,"content":"\rVue-Router å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® ç¬”è®°æ‘˜è‡ª è¡¨ä¸¥è‚ƒ ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#vue-router"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ Vue è·¯ç”± æ˜¯ä¸€ä¸ª Vue çš„åº“ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªå•é¡µåº”ç”¨ æŒ‡å¯¼ç½‘é¡µå±‚çº§ã€å®šä½èµ„æº é¿å…åç«¯é€šä¿¡æ•´é¡µåˆ·æ–°ï¼Œåšåˆ°ä¸ä¸¢å¤±çŠ¶æ€ã€ä¸ä¸¢å¤±æ•°æ® ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä»€ä¹ˆæ˜¯-vue-è·¯ç”±"},{"categories":null,"content":"\rä½¿ç”¨ Vue-Router å¯¼å…¥ Vue å’Œ Vue-Router çš„ js æ–‡ä»¶ \u003cscript src=\"vue.js\"\u003e\u003c/script\u003e \u003cscript src=\"vue-router..js\"\u003e\u003c/script\u003e å®šä¹‰è·¯ç”± js æ–‡ä»¶ var routes = [ { path:'/', component:{ template:` \u003cdiv\u003e \u003ch1\u003eé¦–é¡µ\u003c/h1\u003e \u003c/div\u003e ` } }, { path:'/about', component:{ template:` \u003cdiv\u003e \u003ch1\u003eå…³äº\u003c/h1\u003e \u003c/div\u003e ` } } ]; // è¿™æ˜¯ Vue-Router æš´éœ²å‡ºæ¥çš„æ„é€ å™¨ var router = new VueRouter({ routes: routes }); // åˆ›å»º Vue å¯¹è±¡,æŒ‡å®š router è·¯ç”± new Vue({ el:'#app', router: router }); è®¾å®šè·¯ç”±é“¾æ¥åŠæ˜¾ç¤º \u003cdiv id=\"app\"\u003e \u003cdiv\u003e \u003c!-- æŒ‡å®šå¯¹åº”çš„è·¯ç”±åœ°å€ --\u003e \u003crouter-link to=\"/\"\u003eé¦–é¡µ\u003c/router-link\u003e \u003crouter-link to=\"/about\"\u003eå…³äº\u003c/router-link\u003e \u003c/div\u003e \u003cdiv\u003e \u003c!-- è·¯ç”±æ˜¾ç¤ºçš„åœ°æ–¹ --\u003e \u003crouter-view\u003e\u003c/router-view\u003e \u003c/div\u003e \u003c/div\u003e ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä½¿ç”¨-vue-router"},{"categories":null,"content":"\rä¼ å‚ ä¼ é€’å‚æ•° \u003crouter-link to=\"/user/ç‹æ¢“è‰¯\"\u003eç‹æ¢“è‰¯\u003c/router-link\u003e \u003crouter-link to=\"/user/æ²ˆæ–Œ\"\u003eæ²ˆæ–Œ\u003c/router-link\u003e è·å–å‚æ•° { // è®¾ç½®å½¢å‚ name path:'/user/:name', component:{ template:` \u003cdiv\u003e \u003c!-- è·å– resulté£æ ¼ ä¼ é€’çš„å‚æ•° --\u003e \u003ch1\u003eå…³äº ç”¨æˆ·: {{$route.params.name}}\u003c/h1\u003e \u003c!-- è·å– ?age=18\u0026b=1 ä¼ é€’çš„å‚æ•°: http://localhost/web/user/å¼ ä¸‰?age=18 --\u003e \u003ch1\u003eå…³äº ç”¨æˆ·: {{$route.query.age}}\u003c/h1\u003e \u003c/div\u003e ` } } ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä¼ å‚"},{"categories":null,"content":"\rå­è·¯ç”± åœ¨çˆ¶çº§è·¯æ˜¾ç¤ºç•Œé¢ç”±ä¸­æ·»åŠ å­è·¯ç”±æ˜¾ç¤ºç•Œé¢ // è®¾ç½®å½¢å‚ name path:'/user/:name', component:{ template:` \u003cdiv\u003e \u003c!-- å­è·¯ç”±æ–¹å¼1 --\u003e \u003c!--\u003crouter-link to=\"more\" append\u003e more \u003c/router-link\u003e--\u003e \u003c!--\u003crouter-view\u003e\u003c/router-view\u003e--\u003e \u003c!-- å­è·¯ç”±æ–¹å¼2 ã€æ¨èã€‘ --\u003e \u003crouter-link :to=\"'/user/' + $route.params.name + '/more'\"\u003e more \u003c/router-link\u003e \u003crouter-view\u003e\u003c/router-view\u003e \u003c/div\u003e ` }, children:[ { path:'more', component:{ template:` \u003cdiv\u003e ç”¨æˆ· {{$route.params.name}} çš„æ›´å¤šä¿¡æ¯ \u003c/div\u003e ` } } ] ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å­è·¯ç”±"},{"categories":null,"content":"\rä¼ å‚ , { // è®¾ç½®å½¢å‚ name path:'/user/:name', name:'user', //ä¸ºè·¯ç”±æŒ‡å®šåå­— component:{ template:` \u003cdiv\u003e \u003c/div\u003e ` } } /*======================================================*/ // åˆ›å»º Vue å¯¹è±¡,æŒ‡å®š router è·¯ç”± new Vue({ el:'#app', router: router, methods:{ surf:function(){ this.router.push({ name:\"user\", // åŒ ä¸ºè·¯ç”±æŒ‡å®šçš„åå­— params:{ name:'æ²ˆæ–Œ' } }) } } }); ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä¼ å‚-1"},{"categories":null,"content":"\rå‘½åè§†å›¾ å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª \u003crouter-view\u003e \u003crouter-view name=\"sidebar\"\u003e\u003c/router-view\u003e \u003crouter-view name=\"content\"\u003e\u003c/router-view\u003e /*========================================================*/ , { path:'/about', component:{ sidebar:{ template:` \u003cdiv\u003e \u003ch1\u003esidebar\u003c/h1\u003e \u003c/div\u003e ` }, content:{ template:` \u003cdiv\u003e \u003ch1\u003econtent\u003c/h1\u003e \u003c/div\u003e ` } } } ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å‘½åè§†å›¾"},{"categories":null,"content":"\rå¯¼èˆªé’©å­ ç”¨æ¥æ§åˆ¶è®¿é—®æƒé™ ç•¥ ","date":"2022-05-19","objectID":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"VueRouterè‡ªå­¦ç¬”è®°","uri":"/vuerouter%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å¯¼èˆªé’©å­"},{"categories":null,"content":"\ræ ¡å›­æ™ºæ…§åå‹¤ç®¡ç†ç³»ç»Ÿ å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ å¼ ç®¬æ™—ã€åˆ˜å˜‰å® ä¸€ä¸ªç®€æ˜“çš„æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿï¼Œå­¦ä¹ ã€ç»ƒä¹ çš„é¡¹ç›®ç¬”è®° ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ ¡å›­æ™ºæ…§åå‹¤ç®¡ç†ç³»ç»Ÿ"},{"categories":null,"content":"\ré¡¹ç›®æŠ€æœ¯æ ˆ å‰ç«¯ Vue Vue-router Element-ui axios åç«¯ SpringMVC Mybatis Shiro æ•°æ®åº“ï¼šMySQLã€Redis ç‰ˆæœ¬ç®¡ç†ï¼šgit é¡¹ç›®ç®¡ç†ï¼šMaven ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é¡¹ç›®æŠ€æœ¯æ ˆ"},{"categories":null,"content":"\rVue ç¯å¢ƒçš„é…ç½® å®‰è£… Vue-cli ç¯å¢ƒ é“¾æ¥ï¼šVue å®˜ç½‘çš„ Vue Cli å®‰è£…æ•™ç¨‹ å…ˆå®‰è£… node.js ç¯å¢ƒï¼Œåœ¨å®‰è£…æ—¶ä¼šè‡ªåŠ¨é…ç½® node å’Œ npm å…¨å±€å˜é‡ é“¾æ¥ï¼šnode.js å®˜ç½‘ ä½¿ç”¨ node -v npm -v å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ åœ¨æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ cmd å‘½ä»¤è¡Œæ‰§è¡Œ vue ui å‘½ä»¤å¼€å§‹åˆ›å»º vue é¡¹ç›® ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-ç¯å¢ƒçš„é…ç½®"},{"categories":null,"content":"\rVue é¡¹ç›®ç¯å¢ƒä»‹ç» ä½¿ç”¨ idea æ‰“å¼€åˆšåˆšåˆ›å»ºçš„ vue é¡¹ç›® node_modulesï¼šnpm åŠ è½½çš„é¡¹ç›®ä¾èµ–æ¨¡å—ï¼Œ å­˜æ”¾é¡¹ç›®çš„æ‰€æœ‰ä¾èµ– publicï¼šä¸€äº›å…¬å…±çš„å†…å®¹ srcï¼šé¡¹ç›®çš„æºç ï¼Œå­˜æ”¾å¼€å‘è€…å†™çš„ä»£ç  assetsï¼šå­˜æ”¾å›¾ç‰‡ componentsï¼šå­˜æ”¾ç»„ä»¶æ–‡ä»¶ï¼ˆä¸€äº›å¯å¤ç”¨ï¼Œéç‹¬ç«‹çš„é¡µé¢ï¼‰ routerï¼š å­˜æ”¾äº†è·¯ç”±çš„ js æ–‡ä»¶ï¼Œindex.js storeï¼šå®ç°å…¨å±€å­˜å‚¨ viewsï¼šå­˜æ”¾ç•Œé¢ App.vueï¼šé¡¹ç›®å…¥å£æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ª Vue ç»„ä»¶ï¼Œä¹Ÿæ˜¯é¡¹ç›®çš„ç¬¬ä¸€ä¸ª Vue ç»„ä»¶ main.jsï¼šæ ¸å¿ƒæ–‡ä»¶ï¼Œç›¸å½“äº Javaä¸­çš„ main æ–¹æ³•ï¼Œæ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£ js .xxxxï¼šé…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬gité…ç½®å’Œè¯­æ³•é…ç½®ç­‰ package.jsonï¼šé¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼ŒåŒ…æ‹¬å¼€å‘æ—¶ä¾èµ–å’Œå‘å¸ƒæ—¶ä¾èµ– README.mdï¼šè¯´æ˜æ–‡æ¡£ åœ¨ idea ä¸­æ·»åŠ  npm çš„è¿è¡Œé…ç½®å¹¶è®¾ç½® Script ä¸º serve å³å¯è®© idea ä¸€é”®å¯åŠ¨ vue é¡¹ç›® ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-é¡¹ç›®ç¯å¢ƒä»‹ç»"},{"categories":null,"content":"\relement-ui ç¯å¢ƒå®‰è£… åœ¨ vue é¡¹ç›®ä¸‹ æ‰§è¡Œå‘½ä»¤ npm i element-ui -S å®‰è£…æˆåŠŸååœ¨ package.json ä¸­å¯ä»¥çœ‹åˆ°ç›¸åº”è®°å½• åœ¨ main.js ä¸­å¯¼å…¥ elememt-ui import ElementUI from 'element-ui'; import 'element-ui/lib/theme-chalk/index.css'; Vue.use(ElementUI); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#element-ui-ç¯å¢ƒå®‰è£…"},{"categories":null,"content":"\raxios ç¯å¢ƒå®‰è£… åœ¨ vue é¡¹ç›®ä¸‹ æ‰§è¡Œå‘½ä»¤ npm install axios -S å®‰è£…æˆåŠŸååœ¨ package.json ä¸­å¯ä»¥çœ‹åˆ°ç›¸åº”è®°å½• åœ¨ main.js ä¸­å¯¼å…¥ axios import axios from 'axios'; Vue.prototype.$axios = axios ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#axios-ç¯å¢ƒå®‰è£…"},{"categories":null,"content":"\råç«¯ Vue è·¨åŸŸé—®é¢˜è§£å†³ åœ¨ spring çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  \u003c!-- å…è®¸æ‰€æœ‰è¯·æ±‚é€šè¿‡, è§£å†³ vue è·¨åŸŸé—®é¢˜ --\u003e \u003cmvc:cors\u003e \u003cmvc:mapping path=\"/**\" allowed-origin-patterns=\"*\" allowed-methods=\"POST,GET,OPTIONS,DELETE,PUT,PATCH\" allowed-headers=\"Content-Type,Access-Control-Allow-Headers,Authorization,X-Requested-With\" allow-credentials=\"true\"/\u003e \u003c/mvc:cors\u003e ä¹Ÿå¯ä»¥ä½¿ç”¨ç²¾ç®€å†™æ³• \u003cmvc:cors\u003e \u003cmvc:mapping path=\"/**\" /\u003e \u003c/mvc:cors\u003e ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯-vue-è·¨åŸŸé—®é¢˜è§£å†³"},{"categories":null,"content":"\råç«¯ Shiro é…ç½® åœ¨ config åŒ…ä¸‹åˆ›å»ºé…ç½®ç±» @Configuration public class ShiroConfig { //1.åˆ›å»º ShiroFilter è´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ //å°† name è®¾ä¸ºä¸ web.xml ä¸­ filter-name ä¸€è‡´, è®©è¿‡æ»¤å™¨è‡ªåŠ¨æ‰¾åˆ°è¿™ä¸ª bean @Bean(name = \"shiroFilter\") public ShiroFilterFactoryBean getShiroFilterFactoryBean(DefaultWebSecurityManager defaultWebSecurityManager){ //åˆ›å»ºè¿‡æ»¤å·¥å‚å®ä¾‹, è®¾ç½®é»˜è®¤å®‰å…¨ç®¡ç†å™¨ ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean(); shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager); Map\u003cString, String\u003e map = new HashMap\u003c\u003e(); //é…ç½®ç³»ç»Ÿçš„å—é™èµ„æº: æ‰€æœ‰è¯·æ±‚ map.put(\"/test2.do\", \"authc\"); // authc ä»£è¡¨èµ„æºéœ€è¦è®¤è¯å’Œæˆæƒ //é…ç½®ç³»ç»Ÿçš„å…¬å…±èµ„æº map.put(\"/test1.do\", \"anon\"); shiroFilterFactoryBean.setFilterChainDefinitionMap(map); //è®¾ç½®è¢«æ‹¦æˆªæ—¶è·³è½¬çš„åœ°å€ shiroFilterFactoryBean.setLoginUrl(\"/login.do\"); return shiroFilterFactoryBean; } //2.åˆ›å»ºå®‰å…¨ç®¡ç†å™¨ @Bean public DefaultWebSecurityManager getDefaultWebSecurityManager(Realm realm){ DefaultWebSecurityManager defaultWebSecurityManager = new DefaultWebSecurityManager(); defaultWebSecurityManager.setRealm(realm); return defaultWebSecurityManager; } //3.åˆ›å»ºè‡ªå®šä¹‰ Realm @Bean public Realm getRealm(){ return new CustomerRealm(); } } åœ¨ shiro.realms åŒ…ä¸‹åˆ›å»º Realm å®ç°ç±» public class CustomerRealm extends AuthorizingRealm { //éªŒè¯æ˜¯å¦ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ token @Override public boolean supports(AuthenticationToken token) { return token instanceof JwtToken; } //æˆæƒ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principal) { return null; } //è®¤è¯ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { return null; } } åœ¨ web.xml ä¸­é…ç½®å¯ç”¨ Shiro è¿‡æ»¤å™¨ \u003c!-- shiroè¿‡è™‘å™¨ï¼ŒDelegatingFilterProxyé€šè¿‡ä»£ç†æ¨¡å¼ å…³è”springå®¹å™¨ä¸­çš„beanå’Œfilter --\u003e \u003cfilter\u003e \u003cfilter-name\u003eshiroFilter\u003c/filter-name\u003e \u003cfilter-class\u003eorg.springframework.web.filter.DelegatingFilterProxy\u003c/filter-class\u003e \u003c!-- è®¾ç½®trueç”±servletå®¹å™¨æ§åˆ¶filterçš„ç”Ÿå‘½å‘¨æœŸ --\u003e \u003cinit-param\u003e \u003cparam-name\u003etargetFilterLifecycle\u003c/param-name\u003e \u003cparam-value\u003etrue\u003c/param-value\u003e \u003c/init-param\u003e \u003c!-- è®¾ç½®springå®¹å™¨filterçš„bean idï¼Œå¦‚æœä¸è®¾ç½®åˆ™æ‰¾ä¸filter-nameä¸€è‡´çš„bean--\u003e \u003c!-- \u003cinit-param\u003e--\u003e \u003c!-- \u003cparam-name\u003etargetBeanName\u003c/param-name\u003e--\u003e \u003c!-- \u003cparam-value\u003eshiroFilter\u003c/param-value\u003e--\u003e \u003c!-- \u003c/init-param\u003e--\u003e \u003c/filter\u003e \u003cfilter-mapping\u003e \u003cfilter-name\u003eshiroFilter\u003c/filter-name\u003e \u003curl-pattern\u003e/*\u003c/url-pattern\u003e \u003c/filter-mapping\u003e ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯-shiro-é…ç½®"},{"categories":null,"content":"\rShiro è®¤è¯é…ç½® æ¥æ”¶ token è§£æ token éªŒè¯ç”¨æˆ·åå¯†ç ï¼šè¯¦è§ åç«¯ md5 é…ç½® @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { //å‘ä¸‹è½¬å‹ token ä¸ºè‡ªå®šä¹‰ token ç±»å‹ JwtToken jwtToken = (JwtToken) token; //è·å– token å®ä¾‹ä¸­çš„ token ä¿¡æ¯ String jwt = (String) jwtToken.getPrincipal(); //ä½¿ç”¨å·¥å…·ç±»è§£æ token Claims claims = JwtUtil.parseJWT(jwt); //è·å–è§£æåçš„ç”¨æˆ·å String username = claims.getId(); User user = userService.getUserByUsername(username); if (user == null){ return null; } return new SimpleAuthenticationInfo( username, //ç”¨æˆ·å user.getPassword(), //å¯†ç  ByteSource.Util.bytes(user.getSalt()), //ç› this.getName()); } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#shiro-è®¤è¯é…ç½®"},{"categories":null,"content":"\rShiro æˆæƒé…ç½® åœ¨ com.djtu.config ä¸‹çš„ ShiroConfig é…ç½®ç±»ä¸­æ·»åŠ æ³¨è§£é©±åŠ¨ // å¼€å¯ @RequiresRolesã€@RequiresPermissions æ³¨è§£ä»£ç† @Bean public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() { DefaultAdvisorAutoProxyCreator app = new DefaultAdvisorAutoProxyCreator(); app.setProxyTargetClass(true); return app; } @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) { AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor(); authorizationAttributeSourceAdvisor.setSecurityManager(securityManager); return authorizationAttributeSourceAdvisor; } è·å–å½“å‰ç”¨æˆ·è§’è‰²ä¿¡æ¯ è·å–å½“å‰ç”¨æˆ·æƒé™ä¿¡æ¯ è®¾ç½®æˆæƒä¿¡æ¯ //æˆæƒ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principal) { //è¿™é‡Œåªæœ‰åœ¨ç™»å½•ä¹‹åæ‰ä¼šæ‰§è¡Œ String username = (String) principal.iterator().next(); Set\u003cString\u003e roles = roleService.getRoleByUsername(username); Set\u003cString\u003e permissions = permissionService.getPermissionByUsername(username); SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.addRoles(roles); info.addStringPermissions(permissions); return info; } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:2","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#shiro-æˆæƒé…ç½®"},{"categories":null,"content":"\rShiro æˆæƒæ— æ•ˆé—®é¢˜ é—®é¢˜ï¼š åœ¨å‰åç«¯åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œäº§ç”Ÿè·¨åŸŸé—®é¢˜ cookie æ— æ³•å­˜å‚¨åˆ°æµè§ˆå™¨ä¸­ï¼Œå¯¼è‡´ Shiro æ— æ³•è®¤å®šå¤šæ¬¡è®¿é—®æ˜¯å¦éƒ½æ˜¯å‡ºè‡ªäºåŒä¸€ä¸ªç”¨æˆ· æ‰€ä»¥åœ¨æœ‰æˆæƒæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•è¿è¡Œæ—¶ï¼ŒæŠ›å‡º UnauthenticatedException æœªç™»å½•å¼‚å¸¸ è§£å†³ï¼š åŠ å…¥ Shiro çš„ Session ç®¡ç†å™¨ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½å¸¦ä¸Šä¸€ä¸ªè¯†åˆ«èº«ä»½ä¿¡æ¯çš„å€¼ï¼šSessionId æ¯æ¬¡è¯·æ±‚éƒ½ä¼šç»è¿‡ Session ç®¡ç†å™¨å¹¶åˆ¤æ–­ SessionId çš„å€¼æ˜¯å¦ä¸ºå·²ç™»å½•ç”¨æˆ·åï¼Œå†è¿›å…¥æˆæƒéªŒè¯æ–¹æ³•æ‰§è¡Œæˆæƒ åœ¨ com.djtu.shiro.session.ShiroSession ä¸‹åˆ›å»º ShiroSession ç±» /** * ç›®çš„: shiro çš„ session ç®¡ç† * è‡ªå®šä¹‰sessionè§„åˆ™ï¼Œå®ç°å‰ååˆ†ç¦»ï¼Œåœ¨è·¨åŸŸç­‰æƒ…å†µä¸‹ä½¿ç”¨token æ–¹å¼è¿›è¡Œç™»å½•éªŒè¯æ‰éœ€è¦ï¼Œå¦åˆ™æ²¡å¿…é¡»ä½¿ç”¨æœ¬ç±»ã€‚ * shiroé»˜è®¤ä½¿ç”¨ ServletContainerSessionManager æ¥åš session ç®¡ç†ï¼Œå®ƒæ˜¯ä¾èµ–äºæµè§ˆå™¨çš„ cookie æ¥ç»´æŠ¤ session çš„, * è°ƒç”¨ storeSessionId æ–¹æ³•ä¿å­˜sessionId åˆ° cookieä¸­ * ä¸ºäº†æ”¯æŒæ— çŠ¶æ€ä¼šè¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»§æ‰¿ DefaultWebSessionManager * è‡ªå®šä¹‰ç”ŸæˆsessionId åˆ™è¦å®ç° SessionIdGenerator * */ public class ShiroSession extends DefaultWebSessionManager { /** * å®šä¹‰çš„è¯·æ±‚å¤´ä¸­ä½¿ç”¨çš„æ ‡è®°keyï¼Œç”¨æ¥ä¼ é€’ token */ private static final String AUTH_TOKEN = \"authToken\"; private static final String REFERENCED_SESSION_ID_SOURCE = \"Stateless request\"; public ShiroSession() { super(); //è®¾ç½® shiro session å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤ä¸º30åˆ†é’Ÿï¼Œè¿™é‡Œç°åœ¨è®¾ç½®ä¸º15åˆ†é’Ÿ setGlobalSessionTimeout(MILLIS_PER_MINUTE * 15); } /** * è·å–sessionIdï¼ŒåŸæœ¬æ˜¯æ ¹æ®sessionKeyæ¥è·å–ä¸€ä¸ªsessionId * é‡å†™çš„éƒ¨åˆ†å¤šäº†ä¸€ä¸ªæŠŠè·å–åˆ°çš„tokenè®¾ç½®åˆ°requestçš„éƒ¨åˆ†ã€‚è¿™æ˜¯å› ä¸ºappè°ƒç”¨ç™»é™†æ¥å£çš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰tokençš„ï¼Œç™»é™†æˆåŠŸåï¼Œäº§ç”Ÿäº†token,æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°requestä¸­ï¼Œè¿”å›ç»“ * æœç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼ŒæŠŠå®ƒä»requestä¸­å–å‡ºæ¥ï¼Œå¹¶ä¸”ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å¸¦ç€è¿™ä¸ªtokenè¿‡æ¥ï¼Œå°±ç›¸å½“äºæ˜¯æµè§ˆå™¨çš„cookieçš„ä½œç”¨ï¼Œä¹Ÿå°±èƒ½ç»´æŠ¤ä¼šè¯äº† * @param request ServletRequest * @param response ServletResponse * @return Serializable */ @Override protected Serializable getSessionId(ServletRequest request, ServletResponse response) { //è·å–è¯·æ±‚å¤´ä¸­çš„ AUTH_TOKEN çš„å€¼ï¼Œå¦‚æœè¯·æ±‚å¤´ä¸­æœ‰ AUTH_TOKEN åˆ™å…¶å€¼ä¸ºsessionIdã€‚shiroå°±æ˜¯é€šè¿‡sessionId æ¥æ§åˆ¶çš„ String sessionId = WebUtils.toHttp(request).getHeader(AUTH_TOKEN); if (StringUtils.isEmpty(sessionId)){ //å¦‚æœæ²¡æœ‰æºå¸¦idå‚æ•°åˆ™æŒ‰ç…§çˆ¶ç±»çš„æ–¹å¼åœ¨cookieè¿›è¡Œè·å–sessionId return super.getSessionId(request, response); } else { //è¯·æ±‚å¤´ä¸­å¦‚æœæœ‰ authToken, åˆ™å…¶å€¼ä¸ºsessionId request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_SOURCE, REFERENCED_SESSION_ID_SOURCE); //sessionId request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID, sessionId); request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_IS_VALID, Boolean.TRUE); return sessionId; } } } åœ¨ Shiro é…ç½®ç±»ä¸­æ·»åŠ  SessionManager çš„ Bean // å¿…é¡»ä½¿ç”¨sessionç®¡ç†å™¨ï¼Œæ‰èƒ½å¤Ÿè§£å†³å‰åç«¯åˆ†ç¦»shiroçš„subjectæœªè®¤è¯çš„é—®é¢˜ @Bean public SessionManager sessionManager(){ //å°†æˆ‘ä»¬ç»§æ‰¿åé‡å†™çš„shiro session æ³¨å†Œ ShiroSession shiroSession = new ShiroSession(); //å¦‚æœåç»­è€ƒè™‘å¤štomcatéƒ¨ç½²åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨shiro-rediså¼€æºæ’ä»¶æ¥åšsession çš„æ§åˆ¶ï¼Œæˆ–è€…nginx çš„è´Ÿè½½å‡è¡¡ shiroSession.setSessionDAO(new EnterpriseCacheSessionDAO()); return shiroSession; } åœ¨ SecurityManager çš„ Bean æ–¹æ³•ä¸­ä¸ºå®‰å…¨ç®¡ç†å™¨æ·»åŠ  SessionManager securityManager.setSessionManager(sessionManager); åœ¨æ§åˆ¶å±‚ç™»å½•æ–¹æ³•ä¸­è·å–å½“å‰è®¤è¯ç”¨æˆ· SessionId å¹¶ä¼ ç»™å‰ç«¯ String sessionId = (String) subject.getSession().getId(); resultMap.put(\"sessionId\", sessionId); åœ¨å‰ç«¯æ¥æ”¶åˆ° sessionId åå°†å…¶å­˜å‚¨åœ¨ localStorage ä¸­ localStorage.setItem(\"sessionId\", resp.data.data.sessionId); //å‘å…¨å±€å­˜å‚¨ä¸­ä¸­å­˜å€¼ åœ¨ Vue çš„ axios.js æ–‡ä»¶ä¸­æ·»åŠ  axios çš„å‰ç½®æ‹¦æˆªï¼Œè®©é™¤ç™»å½•ä»¥å¤–çš„è¯·æ±‚åœ¨è¯·æ±‚å¤´ä¸Šéƒ½åŠ ä¸Š sessionId //å‰ç½®æ‹¦æˆª axios.interceptors.request.use( config =\u003e { // ç»™æ¯ä¸ªè¯·æ±‚éƒ½åŠ ä¸Š authToken è¯·æ±‚å¤´ if (config.url !== '/user/login.do') { config.headers.authToken = localStorage.getItem('sessionId'); } return config; }, error =\u003e { return Promise.reject(error); } ); è§£å†³åŠ äº† authToken çš„è¯·æ±‚å¤´çš„è¯·æ±‚å‡ºç°çš„è·¨åŸŸé—®é¢˜ åœ¨è·¨åŸŸé…ç½®æ–‡ä»¶ä¸­æ·»åŠ  authToken åˆ° allowed-headers \u003c!-- å…è®¸æ‰€æœ‰è¯·æ±‚é€šè¿‡, è§£å†³ vue è·¨åŸŸé—®é¢˜ --\u003e \u003cmvc:cors\u003e \u003cmvc:mapping path=\"/**\" allowed-origin-patterns=\"*\" allowed-methods=\"POST,GET,OPTIONS,DELETE,PUT,PATCH\" allowed-headers=\"Content-Type,Access-Control-Allow-Headers,Authorization,X-Requested-With,authToken\" allow-credentials=\"true\"/\u003e \u003c/mvc:cors\u003e ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:3","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#shiro-æˆæƒæ— æ•ˆé—®é¢˜"},{"categories":null,"content":"\råç«¯ JWT é…ç½® åœ¨ com.djtu.utils ä¸‹åˆ›å»º JwtUtil ç±»ï¼Œç”¨äº jwt åŠ å¯†ã€è§£å¯†ã€éªŒè¯ jwt æ˜¯å¦è¿‡æœŸ public class JwtUtil { //åŠ å¯† public static String createJWT(String username, String issuer, String subject, long ttlMillis) { //The JWT signature algorithm we will be using to sign the token SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256; long nowMillis = System.currentTimeMillis(); Date now = new Date(nowMillis); //We will sign our JWT with our ApiKey secret byte[] apiKeySecretBytes = DatatypeConverter.parseBase64Binary(\"1sf12sds21ie1inecs078j\"); Key signingKey = new SecretKeySpec(apiKeySecretBytes, signatureAlgorithm.getJcaName()); //Let's set the JWT Claims JwtBuilder builder = Jwts.builder().setId(username) .setIssuedAt(now) .setSubject(subject) .setIssuer(issuer) .signWith(signatureAlgorithm, signingKey); //if it has been specified, let's add the expiration if (ttlMillis \u003e= 0) { long expMillis = nowMillis + ttlMillis; Date exp = new Date(expMillis); builder.setExpiration(exp); } //Builds the JWT and serializes it to a compact, URL-safe string return builder.compact(); } //è§£å¯† public static Claims parseJWT(String jwt) { //This line will throw an exception if // it is not a signed JWS (as expected) try { Claims claims = Jwts.parser() .setSigningKey(DatatypeConverter.parseBase64Binary(\"1sf12sds21ie1inecs078j\")) .parseClaimsJws(jwt) .getBody(); return claims; }catch (ExpiredJwtException e){ return null; } // System.out.println(\"ID: \" + claims.getId()); // System.out.println(\"Subject: \" + claims.getSubject()); // System.out.println(\"Issuer: \" + claims.getIssuer()); // System.out.println(\"Expiration: \" + claims.getExpiration()); } // åˆ¤æ–­æ˜¯å¦è¿‡æœŸ public static boolean isTokenExpired(Date expiration) { return expiration.before(new Date()); } } åœ¨ com.djtu.token ä¸‹åˆ›å»º JwtToken ç±»ï¼Œé‡Œé¢åŒ…è£…äº†åŠ å¯†åçš„ token å­—ç¬¦ä¸²ã€å¯†ç ã€ç­‰ package com.djtu.token; import com.djtu.utils.JwtUtil; import lombok.Data; import org.apache.shiro.authc.HostAuthenticationToken; import org.apache.shiro.authc.RememberMeAuthenticationToken; import org.springframework.stereotype.Component; import java.util.Arrays; /** * è‡ªå®šä¹‰ token ç±», ä½¿ç”¨ jwt ä¼ æ¥çš„ token è¿›è¡Œèº«ä»½éªŒè¯ * å…·ä½“å®ç°ä»¿ç…§äº† UsernamePasswordToken ç±» */ @Data @Component public class JwtToken implements HostAuthenticationToken, RememberMeAuthenticationToken { private String token; private char[] password; private boolean rememberMe; private String host; @Override public Object getPrincipal() { return token; } @Override public Object getCredentials() { return password; } public JwtToken() { this.rememberMe = false; } public JwtToken(String token) { this.token = token; } public JwtToken(String token, char[] password) { this(token, (char[])password, false, (String)null); } public JwtToken(String token, String password) { this(token, (char[])(password != null ? password.toCharArray() : null), false, (String)null); } public JwtToken(String token, char[] password, String host) { this(token, password, false, host); } public JwtToken(String token, String password, String host) { this(token, password != null ? password.toCharArray() : null, false, host); } public JwtToken(String token, char[] password, boolean rememberMe) { this(token, (char[])password, rememberMe, (String)null); } public JwtToken(String token, String password, boolean rememberMe) { this(token, (char[])(password != null ? password.toCharArray() : null), rememberMe, (String)null); } public JwtToken(String token, char[] password, boolean rememberMe, String host) { this.rememberMe = false; this.token = token; this.password = password; this.rememberMe = rememberMe; this.host = host; } public JwtToken(String username, String password, boolean rememberMe, String host) { this(username, password != null ? password.toCharArray() : null, rememberMe, host); } // @Override // public String toString() { // StringBuilder sb = new StringBuilder(); // sb.append(this.getClass().getName()); // sb.append(\" - \"); // sb.append(JwtUtil.parseJWT(this.token).getId()); // sb.append(\", rememberMe=\").append(this.rememberMe); // if (this.h","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯-jwt-é…ç½®"},{"categories":null,"content":"\råç«¯ md5 é…ç½® åœ¨ com.djtu.shiro.matchers ä¸‹åˆ›å»º MyHashedCredentialsMatcher ç±» public class MyHashedCredentialsMatcher extends HashedCredentialsMatcher { @Override public boolean doCredentialsMatch(AuthenticationToken token, AuthenticationInfo info) { //å¦‚æœæ²¡æœ‰ token , é‚£å°±æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æˆ–è€…è®¿é—®çš„æ˜¯ç™»é™†é¡µé¢, ç›´æ¥æ”¾è¡Œ if (((JwtToken) token).getPassword() == null){ return true; } //å¦‚æœæœ‰ token é‚£å°±æ˜¯æœ‰èº«ä»½, è¿›è¡ŒéªŒè¯ md5 çš„å¯†ç ... return super.doCredentialsMatch(token, info); } } åœ¨ com.djtu.config ä¸‹çš„ ShiroConfig é…ç½®ç±»ä¸­ä¸º Realm è®¾ç½®è‡ªå®šä¹‰çš„å¯†ç éªŒè¯å™¨ï¼Œå¹¶æŒ‡å®šåŠ å¯†æ–¹å¼æ•£åˆ—æ¬¡æ•° @Configuration public class ShiroConfig { //1.åˆ›å»º ShiroFilter è´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ //å°† name è®¾ä¸ºä¸ web.xml ä¸­ filter-name ä¸€è‡´, è®©è¿‡æ»¤å™¨è‡ªåŠ¨æ‰¾åˆ°è¿™ä¸ª bean //...... //2.åˆ›å»ºå®‰å…¨ç®¡ç†å™¨ @Bean public DefaultWebSecurityManager getDefaultWebSecurityManager(Realm realm){ //å‘ä¸‹è½¬å‹ realm è¿™æ ·æ‰å¯ä»¥è®¾ç½®å¯†ç éªŒè¯å™¨ CustomerRealm customerRealm = (CustomerRealm) realm; //è®¾ç½®å¯†ç éªŒè¯å™¨ //1. åˆ›å»º Shiro æä¾›çš„ CredentialsMatcher å¯†ç éªŒè¯å™¨ MyHashedCredentialsMatcher matcher = new MyHashedCredentialsMatcher(); //2. è®¾ç½®å…¶åŠ å¯†æ–¹å¼ matcher.setHashAlgorithmName(\"md5\"); //3. è®¾ç½®æ•£åˆ—æ¬¡æ•° matcher.setHashIterations(1024); //4. ä¸ºè‡ªå®šä¹‰çš„ Realm è®¾ç½® CredentialsMatcher customerRealm.setCredentialsMatcher(matcher); DefaultWebSecurityManager defaultWebSecurityManager = new DefaultWebSecurityManager(); defaultWebSecurityManager.setRealm(customerRealm); return defaultWebSecurityManager; } //3.åˆ›å»ºè‡ªå®šä¹‰ Realm @Bean public Realm getRealm(){ return new CustomerRealm(); } @Bean public JwtFilter getJwtFilter(){ return new JwtFilter(); } } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯-md5-é…ç½®"},{"categories":null,"content":"\råç«¯å…¨å±€å¼‚å¸¸ç±» @RestControllerAdvice æ³¨è§£å®ç° å…¨å±€æ‹¦æˆªå¼‚å¸¸ å¹¶ ç»Ÿä¸€å¤„ç† @ExceptionHandler æ‹¦æˆªå¼‚å¸¸è¿›å…¥æŒ‡å®šæ–¹æ³• åœ¨ com.djtu.exception ä¸‹åˆ›å»º GlobalException ç±» @Slf4j //lombok æä¾›çš„æ—¥å¿—è¾“å‡º @RestControllerAdvice public class GlobalException { @ExceptionHandler(value = UnauthorizedException.class) public Result handler(UnauthorizedException e){ log.error(\"è¿è¡Œæ—¶å¼‚å¸¸----------------{}\" + e.getMessage()); return new Result().setCode(401).setMessage(\"æ— æƒé™è®¿é—®\"); } @ExceptionHandler(value = ExpiredCredentialsException.class) public Result handler(ExpiredCredentialsException e) { log.error(\"è¿è¡Œæ—¶å¼‚å¸¸----------------{}\", e.getMessage()); return new Result().setCode(401).setMessage(\"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•\"); } @ExceptionHandler(value = UnauthenticatedException.class) public Result handler(UnauthenticatedException e) { log.error(\"è¿è¡Œæ—¶å¼‚å¸¸----------------{}\", e.getMessage()); return new Result().setCode(401).setMessage(\"æœªç™»å½•\"); } } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:10:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯å…¨å±€å¼‚å¸¸ç±»"},{"categories":null,"content":"\rMybatis çš„ç¼“å­˜é—®é¢˜ åœ¨ Mabitas çš„é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç¼“å­˜ \u003csetting name=\"cacheEnabled\" value=\"true\"/\u003e åœ¨æ¯ä¸ª mapper ä¸­éƒ½æ·»åŠ æ ‡ç­¾ \u003ccache/\u003e æ­¤æ—¶å‡ºç°é—®é¢˜ï¼šError serializing object. Cause: java.io.NotSerializableException: com.djtu.XXX...... é—®é¢˜å¤§æ„ä¸º Mabatis ç¼“å­˜çš„å®ä½“ç±»ä¸å¯åºåˆ—åŒ– è§£å†³ï¼šä¸ºæ‰€æœ‰åŠ äº†ç¼“å­˜çš„mapperå¯¹åº”çš„å®ä½“ç±»éƒ½å®ç° Serializable æ¥å£ï¼Œå®ç°å¯åºåˆ—åŒ– ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ï¼Ÿ å› ä¸º \u003ccache/\u003e é»˜è®¤ readOnly = false å¦‚æœå¼€å¯ readOnly åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚ å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å°±æä¾›äº†å¯è§‚çš„æ€§èƒ½æå‡ã€‚ è€Œå¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ã€‚ é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ã€‚ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:11:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#mybatis-çš„ç¼“å­˜é—®é¢˜"},{"categories":null,"content":"\rå¼€å¯ Shiro ç¼“å­˜ ç”±äºç”¨æˆ·çš„æƒé™ä¿¡æ¯æ˜¯ä¸€ä¸ªç»å¸¸è¯»å–ä½†ä¸ç»å¸¸ä¿®æ”¹çš„æ•°æ®ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨éœ€è¦æˆæƒçš„æ–¹æ³•æ—¶éƒ½è¦è¯»ä¸€éæ•°æ®åº“ï¼Œæ‰€ä»¥å°†è¿™éƒ¨åˆ†æˆæƒæ•°æ®å­˜å‚¨åœ¨å†…å­˜æˆ–è€…ç¼“å­˜æœåŠ¡å™¨ä¸­æå‡æŸ¥è¯¢é€Ÿåº¦ å¯¼å…¥ä¾èµ– \u003c!-- shiro-ehcache --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.shiro\u003c/groupId\u003e \u003cartifactId\u003eshiro-ehcache\u003c/artifactId\u003e \u003cversion\u003e1.9.0\u003c/version\u003e \u003c/dependency\u003e åœ¨ Shiro é…ç½®ç±»ä¸­æ·»åŠ  //4. å¼€å¯EHç¼“å­˜ realm.setCacheManager(new EhCacheManager()); realm.setCachingEnabled(true); realm.setAuthenticationCachingEnabled(true); realm.setAuthenticationCacheName(\"authenticationCache\"); realm.setAuthorizationCachingEnabled(true); realm.setAuthorizationCacheName(\"authorizationCache\"); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:12:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¼€å¯-shiro-ç¼“å­˜"},{"categories":null,"content":"\råç«¯æ–‡ä»¶æ¥æ”¶ åœ¨æ¥å£çš„å½¢å‚ä¸­æ·»åŠ  MultipartFile file ç”¨äºè§£ææ–‡ä»¶ @RequestMapping(\"/uploadAvatar.do\") @ResponseBody public Result uploadAvatar(MultipartFile file){ System.out.println(file); return null; } åœ¨ web.xml ä¸­ä¸º servlet æ ‡ç­¾æ·»åŠ  multipart-config é…ç½®ï¼Œå¦åˆ™æŠ¥é”™ java.lang.IllegalStateException: ç”±äºæ²¡æœ‰æä¾›multi-parté…ç½®ï¼Œæ— æ³•å¤„ç†parts \u003cmultipart-config\u003e \u003cmax-file-size\u003e20848820\u003c/max-file-size\u003e \u003cmax-request-size\u003e418018841\u003c/max-request-size\u003e \u003cfile-size-threshold\u003e1048576\u003c/file-size-threshold\u003e \u003c/multipart-config\u003e ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:13:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åç«¯æ–‡ä»¶æ¥æ”¶"},{"categories":null,"content":"\rTomcat åœ¨ linux ä¸­å†™å…¥æ–‡ä»¶æƒé™ä¸è¶³ linux ä¸Šéƒ¨ç½²çš„ Tomcat åœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼Œé»˜è®¤æƒé™æ˜¯ 640 åªèƒ½è®©æ‰€æœ‰è€…è¯»å–å’Œå†™å…¥ ä¿®æ”¹ Tomcat çš„ bin ä¸­ catalina.sh æ–‡ä»¶ç¬¬ 290 è¡Œå·¦å³ #UMASK=â€œ0027â€ æ”¹ä¸º #UMASK=â€œ0000â€ å³å¯è§£å†³ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:14:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#tomcat-åœ¨-linux-ä¸­å†™å…¥æ–‡ä»¶æƒé™ä¸è¶³"},{"categories":null,"content":"\rå…³äºMySQLçš„GROUP BYæŠ¥é”™è§£å†³æ–¹æ¡ˆ åŸå› ï¼šMySQL5.7ç‰ˆæœ¬ä¹‹åä½¿ç”¨Group byè¯­å¥æ—¶æŠ¥é”™ï¼Œgroup by è¿èƒŒäº†sql_mode=only_full_group_byã€‚å› ä¸ºmysqlç‰ˆæœ¬5.7ä¹‹åé»˜è®¤çš„æ¨¡å¼æ˜¯ONLY_FULL_GROUP_BYã€‚æ‹’ç»é€‰æ‹©åˆ—è¡¨ã€HAVING æ¡ä»¶æˆ– ORDER BY åˆ—è¡¨å¼•ç”¨éèšåˆåˆ—çš„æŸ¥è¯¢ï¼Œè¿™äº›åˆ—æ—¢ä¸åœ¨ GROUP BY å­å¥ä¸­å‘½åï¼Œä¹Ÿä¸åœ¨åŠŸèƒ½ä¸Šä¾èµ–äºï¼ˆå”¯ä¸€ç¡®å®šçš„ï¼‰GROUP BY åˆ—ã€‚ è§£å†³ï¼š 1ã€å…ˆä½¿ç”¨SQLæŸ¥è¯¢sql_mode select @@global.sql_mode 2ã€é‡æ–°è®¾ç½®sql_modeï¼Œåˆ é™¤ONLY_FULL_GROUP_BY set @@global.sql_mode ='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:15:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…³äºmysqlçš„group-byæŠ¥é”™è§£å†³æ–¹æ¡ˆ"},{"categories":null,"content":"\rPOIå’ŒeasyExcelèµ„æ–™æ¥æºäºï¼šhttps://www.bilibili.com/video/BV1Ua4y1x7BK?spm_id_from=333.999.0.0 ç¬”è®°è®°å½•è€…ï¼š@LittleHanï¼šhttps://gitee.com/LittleHanQAQ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#poiå’Œeasyexcel"},{"categories":null,"content":"\rä¸€ã€å¸¸ç”¨åœºæ™¯ å°†ç”¨æˆ·ä¿¡æ¯å¯¼å‡ºä¸ºexcelè¡¨æ ¼(å¯¼å‡ºæ•°æ®â€¦) å°†Execlè¡¨ä¸­çš„ä¿¡æ¯å½•å…¥åˆ°ç½‘ç«™æ•°æ®åº“ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä¸€å¸¸ç”¨åœºæ™¯"},{"categories":null,"content":"\räºŒã€POIåŸºæœ¬åŠŸèƒ½ HSSF-æä¾›è¯»å†™Microsoft Execlæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ 03å¹´ç‰ˆæœ¬çš„xls XSSF-æä¾›è¯»å†™Microsoft Execl OOXMLæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ 07å¹´ä»¥åç‰ˆæœ¬åœ°xlsx HWPF-æä¾›è¯»å†™Microsoft Wordæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ HSLF-æä¾›è¯»å†™Microsoft PowerPointæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ HDGF-æä¾›è¯»å†™Microsoft Visioæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:2","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#äºŒpoiåŸºæœ¬åŠŸèƒ½"},{"categories":null,"content":"\rä¸‰ã€JAVAè§£æExcelå·¥å…·EasyExcel(é˜¿é‡Œå·´å·´) easyExcel å®˜ç½‘ç½‘å€ï¼šhttps://github.com/alibaba/easyexcel easyExcel å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.yuque.com/easyexcel/doc/easyexecl Apache POIå®˜ç½‘ï¼šhttps://poi.apache.org/ javaè§£æã€ç”ŸæˆExcelæ¯”è¾ƒæœ‰åçš„æ¡†æ¶æœ‰Apache poiã€jxlï¼Œä½†ä»–ä»¬éƒ½å­˜åœ¨ä¸¥é‡é—®é¢˜éå¸¸çš„æ¶ˆè€—å†…å­˜ï¼ŒEsayExcel ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºï¼Œè®©ä½¿ç”¨è€…æ›´åŠ ç®€å•æ–¹ä¾¿ ã€‚ POIä¸easyExcelå¯¹æ¯”ï¼š ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:3","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä¸‰javaè§£æexcelå·¥å…·easyexcelé˜¿é‡Œå·´å·´"},{"categories":null,"content":"\rå››ã€POIå†™å…¥æ•°æ® å¯¼å…¥ç›¸å…³ä¾èµ– \u003c!--å¯¼å…¥ä¾èµ–--\u003e \u003cdependencies\u003e \u003c!--xLs(03)--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.poi\u003c/groupId\u003e \u003cartifactId\u003epoi\u003c/artifactId\u003e \u003cversion\u003e3.9\u003c/version\u003e \u003c/dependency\u003e \u003c!--xLsx(07)--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.poi\u003c/groupId\u003e \u003cartifactId\u003epoi-ooxml\u003c/artifactId\u003e\u003cversion\u003e3.9\u003c/version\u003e \u003c/dependency\u003e \u003c!--æ—¥æœŸæ ¼å¼åŒ–å·¥å…·--\u003e \u003cdependency\u003e \u003cgroupId\u003ejoda-time\u003c/groupId\u003e \u003cartifactId\u003ejoda-time\u003c/artifactId\u003e \u003cversion\u003e2.10.1\u003c/version\u003e \u003c/dependency\u003e éœ€è¦æ³¨æ„:2003ç‰ˆæœ¬å’Œ2007ç‰ˆæœ¬å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼03æœ€å¤šåªç”¨65535è¡Œï¼ Excelä¸­çš„å‡ ä¸ªå¯¹è±¡ å·¥ä½œç°¿ï¼š å·¥ä½œè¡¨ï¼š è¡Œï¼š åˆ—ï¼š //1.åˆ›å»ºå·¥ä½œç°¿ Workbookä¸ºä¸€ä¸ªæ¥å£ Workbook workbook=new HSSFWorkbook(); //2.åˆ›å»ºå·¥ä½œè¡¨ Sheet sheet=workbook.createSheet(\"è¡¨åå­—\"); //3.åˆ›å»ºä¸€ä¸ªè¡Œ Row row1=sheet.createRow(0); //4.åˆ›å»ºä¸€ä¸ªå•å…ƒæ ¼ Cell cell1=row1.createCell(0); cell1.setCellValue(\"å§“å\"); Row row2=sheet.createRow(1); Cell cell2=row1.createCell(0); cell2.setCellValue(\"å¼ ä¸‰\"); //ç”Ÿæˆä¸€å¼ è¡¨ï¼ˆIOæµï¼‰ String path=\"E:\\\\\"; FileOutputStream fileOutputStream=new FileOutputStream(path+\"å­¦ç”Ÿè¡¨.xls\"); workbook.write(fileOutputStream); fileOutputStream.close(); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:4","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å››poiå†™å…¥æ•°æ®"},{"categories":null,"content":"\räº”ã€å¤§é‡æ•°æ®çš„å†™å…¥ å¤§æ–‡ä»¶å†™HSSF ç¼ºç‚¹ï¼šæœ€å¤šåªèƒ½å¤„ç†65536è¡Œï¼Œå¦åˆ™å›æŠ›å‡ºå¼‚å¸¸ã€‚ java.lang.IllegalArugmentException:Invalid row number(65536) outside allowable range(0..65535) ä¼˜ç‚¹ï¼šè¿‡ç¨‹ä¸­å†™å…¥ç¼“å­˜ï¼Œä¸æ“ä½œç£ç›˜ï¼Œæœ€åä¸€æ¬¡æ€§å†™å…¥ç£ç›˜ï¼Œé€Ÿåº¦å¿«ã€‚ å¤§æ–‡ä»¶å†™XSSF ç¼ºç‚¹ï¼šå†™æ•°æ®æ—¶é€Ÿåº¦éå¸¸ æ…¢ï¼Œéå¸¸è€—å†…å­˜ï¼Œä¹Ÿä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œå¦‚100ä¸‡æ¡ ä¼˜ç‚¹ï¼šå¯ä»¥å†™è¾ƒå¤§çš„æ•°æ®é‡ï¼Œå¦‚20ä¸‡æ¡ å¤§æ–‡ä»¶å†™SXSSF ä¼˜ç‚¹ï¼šå¯ä»¥å†™éå¸¸å¤§çš„æ•°æ®é‡ï¼Œå¦‚100ä¸‡æ¡ç”šè‡³æ›´å¤šæ¡ï¼Œå†™æ•°æ®é€Ÿåº¦å¿«ï¼Œå ç”¨æ›´å°‘çš„å†…å­˜ æ³¨æ„ï¼š è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶ï¼Œéœ€è¦æ¸…ç†ä¸´æ—¶æ–‡ä»¶ é»˜è®¤ç”±100æ¡è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœè¶…è¿‡è¿™æ•°é‡ï¼Œåˆ™æœ€å‰é¢çš„æ•°æ®è¢«å†™å…¥ä¸´æ—¶æ–‡ä»¶ å¦‚æœå‘è‡ªå®šä¹‰å†…å­˜ä¸­æ•°æ®çš„æ•°é‡ï¼Œå¯ä»¥ä½¿ç”¨new SXXSSFWorkbook(æ•°é‡) æ¸…é™¤ä¸´æ—¶æ–‡ä»¶æ–¹æ³•ï¼š ((SXSSFWorkbook)workbook).dispose(); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:5","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#äº”å¤§é‡æ•°æ®çš„å†™å…¥"},{"categories":null,"content":"\rå…­ã€POIè¯»å–æ•°æ® //1.è·å–æ–‡ä»¶æµ FileInputStream inputStream=new FileInputStream(path+\"å­¦ç”Ÿ.xlsx\"); //2.åˆ›å»ºå·¥ä½œç°¿ Workbook workbook=new HSSFWorkbook(inputStream); //3.è·å–å·¥ä½œè¡¨ Sheet sheet=workbook.getSheetAt(0); //è·å–è¡Œ Row row=sheet.getRow(0); //è·å–åˆ—(ç»“åˆè¡Œå°±æ˜¯ä¸€ä¸ªå•å…ƒæ ¼[0,0]) Cell cell=row.getCell(0); cell.getStringCellValue(); æ³¨æ„ï¼šè·å–å€¼çš„ç±»å‹ Rowç±»é‡Œçš„getPhysicalNunberOfCells()æ–¹æ³•è·å–æŒ‡å®šè¡Œæœ‰å¤šå°‘åˆ— Sheetç±»é‡Œçš„getPhysicalNumberOfRows()æ–¹æ³•è·å–è¡¨é‡Œæœ‰å¤šå°‘è¡Œ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:6","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…­poiè¯»å–æ•°æ®"},{"categories":null,"content":"\rä¸ƒã€Easy Excelçš„ä½¿ç”¨ https://github.com/alibaba/easyexcel å¯¼å…¥ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003eeasyexcel\u003c/artifactId\u003e \u003cversion\u003e3.0.5\u003c/version\u003e \u003c/dependency\u003e æ³¨æ„ï¼šè¯¥ä¾èµ–å·²ç»å¼•ç”¨äº†xLs(03)å’ŒxLsx(07ï¼‰,åŒæ—¶éœ€è¦lombokä¾èµ– ä¸‰æ­¥èµ°ï¼š å®ä½“ç±» @Data public class DemoData{ @ExcepProperty(\"å­—ç¬¦ä¸²æ ‡é¢˜\") private String str; /** * å¿½ç•¥è¿™ä¸ªå­—æ®µ */ @ExcelIgnore private String ignore; } å¦‚æœæŸ¥åˆ°çš„æ•°æ®å·²ç»æ—¶listå°è£…å¥½äº†ï¼Œå¯ä»¥çœç•¥æ­¤æ­¥éª¤ private List\u003cDownloadData\u003e data() { List\u003cDownloadData\u003e list = ListUtils.newArrayList(); for (int i = 0; i \u003c 10; i++) { DownloadData data = new DownloadData(); data.setString(\"å­—ç¬¦ä¸²\" + 0); data.setDate(new Date()); data.setDoubleData(0.56); list.add(data); } return list; } å†™Excel String fileName = TestFileUtil.getPath() + \"write\" + System.currentTimeMillis() + \".xlsx\"; // è¿™é‡Œ éœ€è¦æŒ‡å®šå†™ç”¨å“ªä¸ªclasså»è¯»ï¼Œç„¶åå†™åˆ°ç¬¬ä¸€ä¸ªsheetï¼Œåå­—ä¸ºæ¨¡æ¿ ç„¶åæ–‡ä»¶æµä¼šè‡ªåŠ¨å…³é—­ // å¦‚æœè¿™é‡Œæƒ³ä½¿ç”¨03 åˆ™ ä¼ å…¥excelTypeå‚æ•°å³å¯ EasyExcel.write(fileName, DemoData.class).sheet(\"æ¨¡æ¿\").doWrite(data()); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:7","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä¸ƒeasy-excelçš„ä½¿ç”¨"},{"categories":null,"content":"\rå…«ã€é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ é‡åˆ°çš„é—®é¢˜1ï¼šåœ¨webä¸­ï¼Œæˆ‘ä»¬å‰ç«¯é€šè¿‡ajaxå‘é€å¯¼å‡ºExcelè¯·æ±‚ï¼Œå½“å“åº”åˆ°æµè§ˆå™¨æ˜¯äºŒè¿›åˆ¶ç ï¼Œå¹¶ä¸ä¼šè§¦å‘ä¸‹è½½excelã€‚ è§£å†³æ–¹æ¡ˆï¼šæˆ‘ä»¬å¯ä»¥é‡‡ç”¨formè¡¨å•æ–¹å¼/è¶…é“¾æ¥æ–¹å¼ï¼Œè€Œä¸æ˜¯ajaxæ–¹å¼å‘èµ·è¯·æ±‚ã€‚ é‡åˆ°çš„é—®é¢˜2ï¼šæ ¹æ®rowå¯¹è±¡è·å–cellçš„å€¼æ–¹æ³•row.getCell( num)ï¼Œè¿”å›å€¼å¹¶ä¸æ˜¯Stringç±»å‹è€Œæ˜¯Cellç±»å‹ï¼Œé€šè¿‡row.getCell( num).getStringCellValue()è·å–å€¼ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:8","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…«é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ"},{"categories":null,"content":"\rå‰ç«¯ Vue ä¸­çš„ JWT å­˜å‚¨ åœ¨ src/store ä¸‹çš„ index.js æ–‡ä»¶ä¹¦å†™å†…å®¹ï¼Œåœ¨ stateã€ localStorage ä¸­å­˜å‚¨ tokenã€userInfo å®ç°å…¨å±€å‚¨å­˜ import Vue from 'vue' import Vuex from 'vuex' Vue.use(Vuex) export default new Vuex.Store({ state: { token:localStorage.getItem(\"token\"), //å°†stateä¸­çš„tokenè®¾ä¸ºlocalStorageä¸­çš„tokenå€¼ userInfo:JSON.parse(localStorage.getItem(\"userInfo\")) //å°†stateä¸­çš„userInfoè®¾ä¸ºlocalStorageä¸­çš„userInfoå€¼ }, getters: { getUser: state =\u003e { //è·å– state ä¸­çš„ userInfo return state.userInfo; }, getToken: state =\u003e { //è·å– state ä¸­çš„ token if (state.token == null) { //æ˜¯ç¬¬ä¸€æ¬¡ç™»å½• return ''; } return state.token; } }, mutations: { SET_TOKEN:(state, token)=\u003e{ //è®¾ç½® state ä¸­çš„ token state.token = token; localStorage.setItem(\"token\", token); }, SET_USERINFO:(state, userInfo)=\u003e{ //è®¾ç½® state ä¸­çš„ userInfo state.userInfo = userInfo; localStorage.setItem(\"userInfo\", userInfo); }, REMOVE_INFO:(state)=\u003e{ //åˆ é™¤ state å’Œ localStorage ä¸­çš„ token å’Œ userInfo state.token = ''; state.userInfo = {}; localStorage.setItem(\"token\", ''); localStorage.setItem(\"userInfo\", JSON.stringify('')); } }, actions: { }, modules: { } }) ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:17:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰ç«¯-vue-ä¸­çš„-jwt-å­˜å‚¨"},{"categories":null,"content":"\rå‰ç«¯ Vue åˆ›å»ºæ–°é¡µé¢æµç¨‹ åœ¨ src/views ä¸‹åˆ›å»º vue é¡µé¢æ–‡ä»¶, å¹¶è®¾ç½® name \u003ctemplate\u003e \u003c!--æ‹·è´ é¥¿äº†ä¹ˆ ä¸­çš„ ç»„ä»¶ä»£ç --\u003e \u003c/template\u003e \u003cscript\u003e export default { name: \"login\", \u003c!--æ‹·è´ é¥¿äº†ä¹ˆ ä¸­çš„ data å’Œ methods--\u003e } \u003c/script\u003e \u003cstyle scoped\u003e /*æ‹·è´é¥¿äº†ä¹ˆä¸­çš„å†…å®¹*/ \u003c/style\u003e åœ¨ src/router ä¸‹çš„ index.js ä¸­å¡«å†™è·¯ç”±ä¿¡æ¯ import Vue from 'vue' import VueRouter from 'vue-router' import test from \"@/views/test\"; import login from \"@/views/login\"; //å¯¼å…¥ /views/ ä¸‹çš„å¯¹åº”æ–‡ä»¶ Vue.use(VueRouter) const routes = [ { path:\"/\", name:\"test\", component:test }, { //æ·»åŠ ä¸€ä¸ªæ–°çš„è·¯ç”±åœ°å€ path:\"/login\", //è®¾ç½®è®¿é—®åœ°å€ name:\"login\", component: login //åœ¨è¿™é‡Œè®¾ç½® import å¯¼å…¥çš„å¯¹åº”æ–‡ä»¶ } ] è®¾ç½®è·¯ç”±ç­‰ç­‰â€¦ç•¥ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:18:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰ç«¯-vue-åˆ›å»ºæ–°é¡µé¢æµç¨‹"},{"categories":null,"content":"\rå‰ç«¯ Vue çš„è¯·æ±‚æ‹¦æˆªé…ç½® é…ç½®åŸºç¡€é“¾æ¥ åœ¨ src ä¸‹åˆ›å»º axios.js import axios from \"axios\"; //é…ç½® axios æ¯ä¸ªé“¾æ¥çš„å…¬å…±å­—ç¬¦ axios.defaults.baseURL = \"http://localhost:8080/logisticsProject\"; åœ¨ main.js ä¸­å¯¼å…¥åˆšåˆšåˆ›å»ºå¥½çš„æ–‡ä»¶ import \"./axios\" åœ¨ src / axios.js é…ç½®å‰ç½®æ‹¦æˆªå’Œåç½®æ‹¦æˆªï¼ŒåŠŸèƒ½å¢å¼ºã€æ²¡æœ‰è¿‡æ»¤åŠŸèƒ½ã€‘ //å‰ç½®æ‹¦æˆª axios.interceptors.request.use(config =\u003e { return config; //ä¸è¿›è¡Œå‰ç½®æ‹¦æˆª }) //åç½®æ‹¦æˆª: æ ¹æ®åç«¯ç»™å‰ç«¯çš„çŠ¶æ€ç è¿›è¡Œæ‹¦æˆª, è¿™æ ·åœ¨å…¶ä»–é¡µé¢å°±åªéœ€è¦å¤„ç† 200 çŠ¶æ€ç çš„æƒ…å†µäº† axios.interceptors.response.use(resp =\u003e{ let res = resp.data; if (res.code == 200){ // 200 æˆåŠŸ ä¸æ‹¦æˆª return resp; }else if(res.code == 401){ // 401 å¤±è´¥ æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯, è·³è½¬è‡³ ç™»å½•é¡µé¢ ElementUI.Message.error(res.message, {duration:3*1000}); router.push(\"/login\"); return Promise.reject(res.message); }else { // å¤±è´¥ æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯ ElementUI.Message.error(res.message, {duration:3*1000}); return Promise.reject(res.message); } }) ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:19:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰ç«¯-vue-çš„è¯·æ±‚æ‹¦æˆªé…ç½®"},{"categories":null,"content":"\rå‰åç«¯åˆ†ç¦» cookie é—®é¢˜ é—®é¢˜ï¼šå‰åç«¯åˆ†ç¦»ä¹‹åï¼Œåç«¯çš„ cookie æ— æ³•å­˜å‚¨åˆ°å‰ç«¯æµè§ˆå™¨ä¸­ è¿™æ˜¯ä¸€ä¸ªè·¨åŸŸé—®é¢˜ åœ¨åç«¯è·¨åŸŸé…ç½®ä¸­æ·»åŠ  mapping å±æ€§ï¼Œå…è®¸æ¥å— cookie allow-credentials=\"true\" åœ¨å‰ç«¯ axios çš„é…ç½®ä¸­æ·»åŠ é»˜è®¤é…ç½®ï¼Œå…è®¸æ¯æ¬¡è¯·æ±‚å¸¦ä¸Š cookie axios.defaults.withCredentials = true; 2022-04-30 ï¼šè¿™æ ·å¹¶ä¸èƒ½è§£å†³ Cookie é—®é¢˜ï¼ŒCookie é—®é¢˜ä¼¼ä¹ä¸èƒ½è½»æ˜“çš„è§£å†³ï¼Œå°±ç®—è¿™ä¹ˆè®¾ç½®äº†ä¹Ÿæ— æ³•å­˜å‚¨ Cookie ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:20:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰åç«¯åˆ†ç¦»-cookie-é—®é¢˜"},{"categories":null,"content":"\rå‰åç«¯ä¼ å‚æ€è·¯ ç”¨æˆ·è¿›å…¥ä¸»é¡µé¢æ—¶ å‘åç«¯å‘é€è¯·æ±‚ï¼Œè·å–è¯¥ç”¨æˆ·æ‹¥æœ‰çš„åŠŸèƒ½åˆ—è¡¨ï¼ˆçˆ¶èœå•ã€å­èœå•ï¼‰ï¼Œå¹¶å°†å…¶éå†åœ¨åŠŸèƒ½èœå•ä¸Š å‘åç«¯å‘é€è¯·æ±‚ï¼Œè·å–è¯¥ç”¨æˆ·æ‹¥æœ‰çš„åŠŸèƒ½åˆ—è¡¨çš„ç›®æ ‡åœ°å€ï¼ˆâ€œ/user/dormâ€ï¼‰ç»‘å®šåˆ°æŒ‰é’® :to=\"xxx\" ä¸Šï¼Œç‚¹å‡»å¯¹åº”æŒ‰é’® mian æ å°±æ˜¾ç¤ºå¯¹åº”é¡µé¢ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:21:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å‰åç«¯ä¼ å‚æ€è·¯"},{"categories":null,"content":"\rVue el-dropdown-item æ ‡ç­¾æ— æ³•è§¦å‘äº‹ä»¶ ä½¿ç”¨ @click.native æ›¿æ¢ @click å³å¯ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:22:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-el-dropdown-item-æ ‡ç­¾æ— æ³•è§¦å‘äº‹ä»¶"},{"categories":null,"content":"\rVue å¦‚ä½•è·³è½¬é¡µé¢å’Œåˆ·æ–°é¡µé¢ this.$router.go(0) åˆ·æ–°é¡µé¢ this.$router.replace(\"/login\") è·³è½¬é¡µé¢ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:23:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-å¦‚ä½•è·³è½¬é¡µé¢å’Œåˆ·æ–°é¡µé¢"},{"categories":null,"content":"\rVue è¡¨å• data çš„è§„åˆ™éªŒè¯ ä»€ä¹ˆæ˜¯ rules ? æ˜¯å¯¹ data æ•°æ®çš„éªŒè¯ï¼Œname ä¸è¡¨å•ä¸­ prop çš„å€¼å¯¹åº”ï¼Ÿ typeï¼šç±»å‹ requiredï¼šæ˜¯å¦å¿…é€‰é¡¹ï¼ˆæ­¤æ æ˜¯å¦ä¸ºç©ºï¼‰ messageï¼šæŠ¥é”™ä¿¡æ¯ triggerï¼šè§¦å‘æ–¹å¼ blur ï¼šå¤±å»ç„¦ç‚¹æ—¶è¿›è¡ŒéªŒè¯ï¼ˆå¯¹ input è¾“å…¥æ¡†çš„éªŒè¯ï¼‰ change ï¼šå½“å€¼å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡ŒéªŒè¯ï¼ˆä¸‹æ‹‰æ¡†selectï¼Œæ—¥æœŸé€‰æ‹©æ¡†date-pickerï¼Œå¤é€‰æ¡†checkboxï¼Œå•é€‰æ¡†radioï¼‰ min / maxï¼šæœ€å° / æœ€å¤§ é•¿åº¦ name:[ {type: 'string', required: true, message: \"åç§°å¿…å¡«\", trigger: 'blur'}, {min: 3, max: 30, message: \"åç§°é•¿åº¦ä¸èƒ½è¶…è¿‡30ä½\"} ] åœ¨ form æ ‡ç­¾ä¸­æŒ‡å®š :rules åœ¨ data ä¸­æ·»åŠ  rules ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:24:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-è¡¨å•-data-çš„è§„åˆ™éªŒè¯"},{"categories":null,"content":"\rVue å¦‚ä½•åŠ¨æ€ç”Ÿæˆè¡¨å• rules èµ·å› ï¼šåœ¨ data ä¸­å†™ this.xxx æ— æ•ˆ è§£å†³ï¼šåœ¨é¡µé¢åŠ è½½çš„å›è°ƒæ–¹æ³• mounted / created ä¸­åŠ è½½ rules ä¸­çš„å†…å®¹ // åŠ è½½æ¥¼å®‡åˆ—è¡¨å€¼ this.$axios.post(\"/building/getDormBuildingValueList.do\") .then(resp=\u003e{ // è®¾ç½®æ¥¼å®‡ rules éªŒè¯æšä¸¾ var rulesEnum = []; for (let temp in resp.data.data) { rulesEnum.push(resp.data.data[temp].value); } var t = {type:'enum', enum: rulesEnum, message: 'æ¥¼å®‡å¿…é¡»ä¸ºæ¥¼å®‡åˆ—è¡¨ä¸­çš„å€¼'}; this.rules.building.push(t); }, err=\u003e{ console.log(err); }) ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:25:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-å¦‚ä½•åŠ¨æ€ç”Ÿæˆè¡¨å•-rules"},{"categories":null,"content":"\rVue çš„è·¯ç”±æ‹¦æˆª ä¸ƒå¤©å…ç™»å½•çš„å®ç° å¦‚æœæœ‰ä¸ƒå¤©å…ç™»å½•éœ€æ±‚ï¼Œåç«¯åœ¨ç™»å½•è¿”å›ç»“æœä¸­ä»–æ·»åŠ æ ‡è®°å’Œæ—¶é—´æˆ³ long timeStamp = System.currentTimeMillis()+1000*60*60*24*7; //è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 7 å¤© if (!rememberMe) { timeStamp = System.currentTimeMillis()+1000*60*30; //å¦‚æœæ²¡é€‰ä¸ƒå¤©å…ç™»å½•çš„è¯, è¿‡æœŸæ—¶é—´ä¸º 30 åˆ†é’Ÿ } resultMap.put(\"rememberMe\", rememberMe); //ä¼ é€’æ˜¯å¦ä¸ƒå¤©å…ç™»å½•çš„æ ‡è®° resultMap.put(\"timestamp\", timeStamp); //ä¼ é€’è¿‡æœŸæ—¶é—´æˆ³ åœ¨å‰ç«¯çš„ main.js ä¸­æ·»åŠ è·¯ç”±çš„ brforeEach æ–¹æ³• /** * æ¯æ¬¡è·¯ç”±å‰éƒ½éªŒè¯ localStorage æ˜¯å¦è¿‡æœŸ */ router.beforeEach((to, from, next)=\u003e { var rememberMe = store.getters.getRememberMe; var timeStamp = store.getters.getTimeStamp; var nowTimeStamp = new Date().getTime(); if (to.fullPath === '/login' || to.fullPath === '/register') { //å¦‚æœè®¿é—®çš„æ˜¯ ç™»å½• / æ³¨å†Œ é¡µé¢åˆ™ æ”¾è¡Œ next(); } else if (rememberMe == null) { // localStorage ä¸ºç©º ElementUI.Message.error('æ‚¨å·²é€€å‡ºç™»å½•, è¯·é‡æ–°ç™»å½•', {duration:3*1000}); next(\"/login\"); } else { var addTime = 0; if (rememberMe) { //å‹¾é€‰äº† 7 å¤©å…ç™»å½• addTime = 1000 * 60 * 60 * 24 * 7; } else { //æœªå‹¾é€‰ 7 å¤©å…ç™»å½•æ—¶ addTime = 1000 * 60 * 30; } if (nowTimeStamp \u003c timeStamp) { // æœªè¿‡æœŸ store.commit(\"SET_TIME_STAMP\", nowTimeStamp + addTime); next(); } else { //å·²è¿‡æœŸ store.commit(\"REMOVE_INFO\"); ElementUI.Message.error('å…ç™»å½•æ—¶é—´å·²è¿‡æˆ–é•¿æ—¶é—´æœªæ“ä½œ, è¯·é‡æ–°ç™»å½•', {duration:3*1000}); next(\"/login\"); } } }); ä¸ºç™»å½•ç•Œé¢æ·»åŠ æ—¶é—´æˆ³éªŒè¯ created() { if (this.$store.getters.getTimeStamp \u003e 0){ //é¡µé¢æ‰“å¼€æ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦ç™»å½• this.$router.replace(\"/index\"); this.$notify({ title: 'æˆåŠŸ', message: 'é€šè¿‡å…ç™»å½•éªŒè¯, è¿›å…¥ä¸»é¡µ', type: 'success' }); } } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:26:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-çš„è·¯ç”±æ‹¦æˆª"},{"categories":null,"content":"\rVue æ‰“åŒ…å‘å¸ƒ è®¾ç½® Vue çš„ base è·¯å¾„ï¼ˆç½‘ç«™åï¼‰ï¼Œåœ¨ router çš„ index.js ä¸­ä¿®æ”¹ base å†…å®¹ const router = new VueRouter({ mode: 'history', // base: process.env.BASE_URL, base: 'DJTULogistics', routes }) npm run build æ‰“åŒ… Vue é¡¹ç›®åˆ° dist ç›®å½• å¤åˆ¶åˆ° nginx æˆ– tomcat ä¸Šéƒ¨ç½² ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:27:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-æ‰“åŒ…å‘å¸ƒ"},{"categories":null,"content":"\rVue çš„æ·±æµ…æ‹·è´ Vue ä¸­é»˜è®¤çš„ = èµ‹å€¼ä¸ºæµ…æ‹·è´ï¼Œæ‹·è´å¯¹è±¡çš„å†…å­˜åœ°å€ æ·±æ‹·è´æ–¹æ³•ï¼šç”± JSON åŒ…è£…åœ¨è§£æ æ·±æ‹·è´æ•°æ® = JSON.parse(JSON.stringify(åŸæ•°æ®)); ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:28:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-çš„æ·±æµ…æ‹·è´"},{"categories":null,"content":"\rVue ä¸ä½¿ç”¨ axios çš„æ—¶å€™å¦‚ä½•ä¿®æ”¹ headers é—®é¢˜æ¥æºï¼šæ­¤é¡¹ç›®æ˜¯æŒ‰ç…§æ¯æ¬¡è¯·æ±‚è¯·æ±‚å¤´ä¸­çš„è‡ªå®šä¹‰å‚æ•° authToken æ¥è¯†åˆ«æ­¤æ¬¡è¯·æ±‚çš„ç”¨æˆ·æ˜¯å¦æœ‰ session å½“ä½¿ç”¨ axios æ—¶ï¼Œåœ¨ axios çš„å‰ç½®æ‹¦æˆªä¸­æ·»åŠ äº† authToken çš„ headers è¯·æ±‚å¤´ï¼Œä½†æ˜¯åœ¨ Vue å…¶ä»– action è¯·æ±‚ä¸­æ— æ•ˆ è§£å†³æ–¹æ³•: åœ¨ Vue çš„ action æ ‡ç­¾åŠ ä¸Š :headers=\"{authToken: this.$store.getters.getSessionId}\" ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:29:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-ä¸ä½¿ç”¨-axios-çš„æ—¶å€™å¦‚ä½•ä¿®æ”¹-headers"},{"categories":null,"content":"\rVue watch çš„ä½¿ç”¨ watch å¯ä»¥åšåˆ°åœ¨æŒ‡å®šå€¼å‘ç”Ÿæ”¹å˜åï¼Œæ‰§è¡Œå›è°ƒæ–¹æ³• watch å†™åœ¨ data åŒçº§ watch: { '$route.params.floor'(newValue, oldValue) { alert(newValue + \", \" + oldValue); } } ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:30:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#vue-watch-çš„ä½¿ç”¨"},{"categories":null,"content":"\rGitee issues çš„æ ‡ç­¾ æ ‡ç­¾è§£é‡Šï¼š Bug - é”™è¯¯ Duplicate - é‡å¤ Enhancement - åŠ å¼ºï¼Œæ”¹å–„ Feature - åŠŸèƒ½ Invalid - éæ³• Question - é—®é¢˜ WontFix - ä¸èƒ½ä¿®å¤ ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:31:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#gitee-issues-çš„æ ‡ç­¾"},{"categories":null,"content":"\rç§’æ€ç›¸å…³çŸ¥è¯†","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:0","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ç§’æ€ç›¸å…³çŸ¥è¯†"},{"categories":null,"content":"\rvalidation ä¸ºæé«˜ç¨‹åºå®‰å…¨æ€§ã€å¥å£®åº¦ï¼Œå¯¹ HTTP è¯·æ±‚æ•°æ®çš„æ ¡éªŒéœ€è¦åœ¨æœåŠ¡ç«¯å†æ¬¡æ ¡éªŒ validation å®ç°ç”¨æ³¨è§£è§£å†³ä»£ç ä¸­å¤§é‡æ•°æ®æ ¡éªŒè€Œå¸¦æ¥çš„å†—ä½™ SpringMVC ä½¿ç”¨çš„æ˜¯ Hibernate Validator å®ç°çš„ JSR-303 æ ¡éªŒè§„èŒƒ ä½¿ç”¨æ–¹å¼ï¼š å¯¼å…¥ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003eorg.hibernate\u003c/groupId\u003e \u003cartifactId\u003ehibernate-validator\u003c/artifactId\u003e \u003cversion\u003e5.4.3.Final\u003c/version\u003e \u003c/dependency\u003e åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  æ•°æ®æ ¡éªŒå™¨ \u003c!--æ ¡æ•°æ ¡éªŒ--\u003e \u003cbean id=\"validator\" class=\"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean\"\u003e \u003cproperty name=\"providerClass\" value=\"org.hibernate.validator.HibernateValidator\"/\u003e \u003c!-- å¦‚æœä¸åŠ é»˜è®¤åˆ° ä½¿ç”¨classpathä¸‹çš„ValidationMessages.properties --\u003e \u003cproperty name=\"validationMessageSource\" ref=\"messageSource\"/\u003e \u003c/bean\u003e \u003c!-- å›½é™…åŒ–çš„æ¶ˆæ¯èµ„æºæ–‡ä»¶ï¼ˆæœ¬ç³»ç»Ÿä¸­ä¸»è¦ç”¨äºæ˜¾ç¤º/é”™è¯¯æ¶ˆæ¯å®šåˆ¶ï¼‰ --\u003e \u003cbean id=\"messageSource\" class=\"org.springframework.context.support.ReloadableResourceBundleMessageSource\"\u003e \u003cproperty name=\"basenames\"\u003e \u003clist\u003e \u003c!-- åœ¨webç¯å¢ƒä¸­ä¸€å®šè¦å®šä½åˆ°classpath å¦åˆ™é»˜è®¤åˆ°å½“å‰webåº”ç”¨ä¸‹æ‰¾--\u003e \u003cvalue\u003eclasspath:messages\u003c/value\u003e \u003c/list\u003e \u003c/property\u003e \u003cproperty name=\"useCodeAsDefaultMessage\" value=\"false\"/\u003e \u003cproperty name=\"defaultEncoding\" value=\"UTF-8\"/\u003e \u003cproperty name=\"cacheSeconds\" value=\"60\"/\u003e \u003c/bean\u003e \u003c!--æ·»åŠ æ•°æ®æ ¡éªŒå™¨--\u003e \u003cmvc:annotation-driven validator=\"validator\"/\u003e åœ¨ resources ä¸­åˆ›å»º messages.properties, é…ç½®é”™è¯¯æ¶ˆæ¯æç¤º username.null=ç”¨æˆ·ä¸èƒ½ä¸ºç©º password.illegal=å¯†ç å¿…é¡»ä¸º5åˆ°20ä¹‹é—´çš„å¤§å°å†™å­—ç¬¦ age.illegal=å¹´é¾„å¿…é¡»åœ¨18åˆ°60ä¹‹é—´ã€‚ å¸¸ç”¨æ ¡éªŒæ³¨è§£ @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @AssertFalse è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false @Min(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Max(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @DecimalMax(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Size(max=, min=) è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Digits (integer, fraction) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Past è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Future è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Pattern(regex=,flag=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ Hibernate Validator é™„åŠ çš„ constraint @NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº 0 @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€ @Length(min=,max=) è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @NotEmpty è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º @Range(min=,max=,message=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†… åœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹é…ç½® @Valid åœ¨ @Valid ä¿®é¥°çš„ç±»ä¸­æ·»åŠ ç›¸å…³æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£ åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ³¨è§£ç±»ï¼Œé…ç½®æ ¡éªŒè§„åˆ™ã€è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™ @Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER}) @Retention(RetentionPolicy.RUNTIME) @Documented @Constraint( // æ ¡éªŒè§„åˆ™ validatedBy = {IsIdentValidator.class} ) public @interface IsIdent { // è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™: å¿…å¡«é¡¹ boolean required() default true; // é”™è¯¯æç¤ºä¿¡æ¯ String message() default \"{javax.validation.constraints.NotNull.message}\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; } åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ ¡éªŒè§„åˆ™ç±»ï¼Œè®¾ç½®æ³›å‹ä¸ºè‡ªå®šä¹‰çš„æ³¨è§£ public class IsIdentValidator implements ConstraintValidator\u003cIsIdent, String\u003e { private boolean required = false; @Override public void initialize(IsIdent isIdent) { boolean required = isIdent.required(); } @Override public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) { if (required) { return ValidatorUtil.isIdent(s); }else { if (StringUtils.isEmpty(s)){ return true; }else { return ValidatorUtil.isIdent(s); } } } } åœ¨ utils åŒ…ä¸‹åˆ›å»º ValidatorUtil å·¥å…·ç±» public class ValidatorUtil { private static final Pattern ident_pattern = Pattern.compile(\"å­¦ç”Ÿ|å¯¼å‘˜|ç®¡ç†å‘˜\"); public static boolean isIdent(String ident){ if (StringUtils.isEmpty(ident)){ return false; } Matcher matcher = ident_pattern.matcher(ident); return matcher.matches(); } } å¼‚å¸¸å¤„ç† å¼‚å¸¸å¤„ç†ç±»æ•è· MethodArgumentNotValidException è·å–å®šä¹‰çš„å¼‚å¸¸æç¤ºä¿¡æ¯: e.getBindingResult().getAllErrors().get(0).getDefaultMessage() ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#validation"},{"categories":null,"content":"\rvalidation ä¸ºæé«˜ç¨‹åºå®‰å…¨æ€§ã€å¥å£®åº¦ï¼Œå¯¹ HTTP è¯·æ±‚æ•°æ®çš„æ ¡éªŒéœ€è¦åœ¨æœåŠ¡ç«¯å†æ¬¡æ ¡éªŒ validation å®ç°ç”¨æ³¨è§£è§£å†³ä»£ç ä¸­å¤§é‡æ•°æ®æ ¡éªŒè€Œå¸¦æ¥çš„å†—ä½™ SpringMVC ä½¿ç”¨çš„æ˜¯ Hibernate Validator å®ç°çš„ JSR-303 æ ¡éªŒè§„èŒƒ ä½¿ç”¨æ–¹å¼ï¼š å¯¼å…¥ä¾èµ– org.hibernate hibernate-validator 5.4.3.Final åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  æ•°æ®æ ¡éªŒå™¨ classpath:messages åœ¨ resources ä¸­åˆ›å»º messages.properties, é…ç½®é”™è¯¯æ¶ˆæ¯æç¤º username.null=ç”¨æˆ·ä¸èƒ½ä¸ºç©º password.illegal=å¯†ç å¿…é¡»ä¸º5åˆ°20ä¹‹é—´çš„å¤§å°å†™å­—ç¬¦ age.illegal=å¹´é¾„å¿…é¡»åœ¨18åˆ°60ä¹‹é—´ã€‚ å¸¸ç”¨æ ¡éªŒæ³¨è§£ @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @AssertFalse è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false @Min(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Max(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @DecimalMax(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Size(max=, min=) è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Digits (integer, fraction) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Past è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Future è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Pattern(regex=,flag=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ Hibernate Validator é™„åŠ çš„ constraint @NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº 0 @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€ @Length(min=,max=) è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @NotEmpty è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º @Range(min=,max=,message=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†… åœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹é…ç½® @Valid åœ¨ @Valid ä¿®é¥°çš„ç±»ä¸­æ·»åŠ ç›¸å…³æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£ åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ³¨è§£ç±»ï¼Œé…ç½®æ ¡éªŒè§„åˆ™ã€è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™ @Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER}) @Retention(RetentionPolicy.RUNTIME) @Documented @Constraint( // æ ¡éªŒè§„åˆ™ validatedBy = {IsIdentValidator.class} ) public @interface IsIdent { // è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™: å¿…å¡«é¡¹ boolean required() default true; // é”™è¯¯æç¤ºä¿¡æ¯ String message() default \"{javax.validation.constraints.NotNull.message}\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; } åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ ¡éªŒè§„åˆ™ç±»ï¼Œè®¾ç½®æ³›å‹ä¸ºè‡ªå®šä¹‰çš„æ³¨è§£ public class IsIdentValidator implements ConstraintValidator { private boolean required = false; @Override public void initialize(IsIdent isIdent) { boolean required = isIdent.required(); } @Override public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) { if (required) { return ValidatorUtil.isIdent(s); }else { if (StringUtils.isEmpty(s)){ return true; }else { return ValidatorUtil.isIdent(s); } } } } åœ¨ utils åŒ…ä¸‹åˆ›å»º ValidatorUtil å·¥å…·ç±» public class ValidatorUtil { private static final Pattern ident_pattern = Pattern.compile(\"å­¦ç”Ÿ|å¯¼å‘˜|ç®¡ç†å‘˜\"); public static boolean isIdent(String ident){ if (StringUtils.isEmpty(ident)){ return false; } Matcher matcher = ident_pattern.matcher(ident); return matcher.matches(); } } å¼‚å¸¸å¤„ç† å¼‚å¸¸å¤„ç†ç±»æ•è· MethodArgumentNotValidException è·å–å®šä¹‰çš„å¼‚å¸¸æç¤ºä¿¡æ¯: e.getBindingResult().getAllErrors().get(0).getDefaultMessage() ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¸¸ç”¨æ ¡éªŒæ³¨è§£"},{"categories":null,"content":"\rvalidation ä¸ºæé«˜ç¨‹åºå®‰å…¨æ€§ã€å¥å£®åº¦ï¼Œå¯¹ HTTP è¯·æ±‚æ•°æ®çš„æ ¡éªŒéœ€è¦åœ¨æœåŠ¡ç«¯å†æ¬¡æ ¡éªŒ validation å®ç°ç”¨æ³¨è§£è§£å†³ä»£ç ä¸­å¤§é‡æ•°æ®æ ¡éªŒè€Œå¸¦æ¥çš„å†—ä½™ SpringMVC ä½¿ç”¨çš„æ˜¯ Hibernate Validator å®ç°çš„ JSR-303 æ ¡éªŒè§„èŒƒ ä½¿ç”¨æ–¹å¼ï¼š å¯¼å…¥ä¾èµ– org.hibernate hibernate-validator 5.4.3.Final åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  æ•°æ®æ ¡éªŒå™¨ classpath:messages åœ¨ resources ä¸­åˆ›å»º messages.properties, é…ç½®é”™è¯¯æ¶ˆæ¯æç¤º username.null=ç”¨æˆ·ä¸èƒ½ä¸ºç©º password.illegal=å¯†ç å¿…é¡»ä¸º5åˆ°20ä¹‹é—´çš„å¤§å°å†™å­—ç¬¦ age.illegal=å¹´é¾„å¿…é¡»åœ¨18åˆ°60ä¹‹é—´ã€‚ å¸¸ç”¨æ ¡éªŒæ³¨è§£ @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @AssertFalse è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false @Min(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Max(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @DecimalMax(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Size(max=, min=) è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Digits (integer, fraction) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Past è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Future è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Pattern(regex=,flag=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ Hibernate Validator é™„åŠ çš„ constraint @NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº 0 @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€ @Length(min=,max=) è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @NotEmpty è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º @Range(min=,max=,message=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†… åœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹é…ç½® @Valid åœ¨ @Valid ä¿®é¥°çš„ç±»ä¸­æ·»åŠ ç›¸å…³æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£ åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ³¨è§£ç±»ï¼Œé…ç½®æ ¡éªŒè§„åˆ™ã€è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™ @Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER}) @Retention(RetentionPolicy.RUNTIME) @Documented @Constraint( // æ ¡éªŒè§„åˆ™ validatedBy = {IsIdentValidator.class} ) public @interface IsIdent { // è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™: å¿…å¡«é¡¹ boolean required() default true; // é”™è¯¯æç¤ºä¿¡æ¯ String message() default \"{javax.validation.constraints.NotNull.message}\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; } åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ ¡éªŒè§„åˆ™ç±»ï¼Œè®¾ç½®æ³›å‹ä¸ºè‡ªå®šä¹‰çš„æ³¨è§£ public class IsIdentValidator implements ConstraintValidator { private boolean required = false; @Override public void initialize(IsIdent isIdent) { boolean required = isIdent.required(); } @Override public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) { if (required) { return ValidatorUtil.isIdent(s); }else { if (StringUtils.isEmpty(s)){ return true; }else { return ValidatorUtil.isIdent(s); } } } } åœ¨ utils åŒ…ä¸‹åˆ›å»º ValidatorUtil å·¥å…·ç±» public class ValidatorUtil { private static final Pattern ident_pattern = Pattern.compile(\"å­¦ç”Ÿ|å¯¼å‘˜|ç®¡ç†å‘˜\"); public static boolean isIdent(String ident){ if (StringUtils.isEmpty(ident)){ return false; } Matcher matcher = ident_pattern.matcher(ident); return matcher.matches(); } } å¼‚å¸¸å¤„ç† å¼‚å¸¸å¤„ç†ç±»æ•è· MethodArgumentNotValidException è·å–å®šä¹‰çš„å¼‚å¸¸æç¤ºä¿¡æ¯: e.getBindingResult().getAllErrors().get(0).getDefaultMessage() ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#è‡ªå®šä¹‰æ³¨è§£"},{"categories":null,"content":"\rvalidation ä¸ºæé«˜ç¨‹åºå®‰å…¨æ€§ã€å¥å£®åº¦ï¼Œå¯¹ HTTP è¯·æ±‚æ•°æ®çš„æ ¡éªŒéœ€è¦åœ¨æœåŠ¡ç«¯å†æ¬¡æ ¡éªŒ validation å®ç°ç”¨æ³¨è§£è§£å†³ä»£ç ä¸­å¤§é‡æ•°æ®æ ¡éªŒè€Œå¸¦æ¥çš„å†—ä½™ SpringMVC ä½¿ç”¨çš„æ˜¯ Hibernate Validator å®ç°çš„ JSR-303 æ ¡éªŒè§„èŒƒ ä½¿ç”¨æ–¹å¼ï¼š å¯¼å…¥ä¾èµ– org.hibernate hibernate-validator 5.4.3.Final åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  æ•°æ®æ ¡éªŒå™¨ classpath:messages åœ¨ resources ä¸­åˆ›å»º messages.properties, é…ç½®é”™è¯¯æ¶ˆæ¯æç¤º username.null=ç”¨æˆ·ä¸èƒ½ä¸ºç©º password.illegal=å¯†ç å¿…é¡»ä¸º5åˆ°20ä¹‹é—´çš„å¤§å°å†™å­—ç¬¦ age.illegal=å¹´é¾„å¿…é¡»åœ¨18åˆ°60ä¹‹é—´ã€‚ å¸¸ç”¨æ ¡éªŒæ³¨è§£ @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @AssertFalse è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false @Min(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Max(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @DecimalMax(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Size(max=, min=) è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Digits (integer, fraction) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Past è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Future è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Pattern(regex=,flag=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ Hibernate Validator é™„åŠ çš„ constraint @NotBlank(message =) éªŒè¯å­—ç¬¦ä¸²é nullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº 0 @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€ @Length(min=,max=) è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @NotEmpty è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º @Range(min=,max=,message=) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†… åœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹é…ç½® @Valid åœ¨ @Valid ä¿®é¥°çš„ç±»ä¸­æ·»åŠ ç›¸å…³æ³¨è§£ è‡ªå®šä¹‰æ³¨è§£ åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ³¨è§£ç±»ï¼Œé…ç½®æ ¡éªŒè§„åˆ™ã€è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™ @Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER}) @Retention(RetentionPolicy.RUNTIME) @Documented @Constraint( // æ ¡éªŒè§„åˆ™ validatedBy = {IsIdentValidator.class} ) public @interface IsIdent { // è‡ªå®šä¹‰æ–¹æ³•è§„åˆ™: å¿…å¡«é¡¹ boolean required() default true; // é”™è¯¯æç¤ºä¿¡æ¯ String message() default \"{javax.validation.constraints.NotNull.message}\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; } åœ¨ validator åŒ…ä¸‹åˆ›å»ºæ ¡éªŒè§„åˆ™ç±»ï¼Œè®¾ç½®æ³›å‹ä¸ºè‡ªå®šä¹‰çš„æ³¨è§£ public class IsIdentValidator implements ConstraintValidator { private boolean required = false; @Override public void initialize(IsIdent isIdent) { boolean required = isIdent.required(); } @Override public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) { if (required) { return ValidatorUtil.isIdent(s); }else { if (StringUtils.isEmpty(s)){ return true; }else { return ValidatorUtil.isIdent(s); } } } } åœ¨ utils åŒ…ä¸‹åˆ›å»º ValidatorUtil å·¥å…·ç±» public class ValidatorUtil { private static final Pattern ident_pattern = Pattern.compile(\"å­¦ç”Ÿ|å¯¼å‘˜|ç®¡ç†å‘˜\"); public static boolean isIdent(String ident){ if (StringUtils.isEmpty(ident)){ return false; } Matcher matcher = ident_pattern.matcher(ident); return matcher.matches(); } } å¼‚å¸¸å¤„ç† å¼‚å¸¸å¤„ç†ç±»æ•è· MethodArgumentNotValidException è·å–å®šä¹‰çš„å¼‚å¸¸æç¤ºä¿¡æ¯: e.getBindingResult().getAllErrors().get(0).getDefaultMessage() ","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:1","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¼‚å¸¸å¤„ç†"},{"categories":null,"content":"\råˆ†å¸ƒå¼ Session é—®é¢˜ ä½¿ç”¨ nginx åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶ï¼Œè‹¥ä½¿ç”¨é»˜è®¤è½®è¯¢æœºåˆ¶ç”¨æˆ·æ¯æ¬¡è®¿é—®çš„æœåŠ¡å™¨ä¸åŒï¼Œå¯¼è‡´å¶ç°çš„ Session ä¸¢å¤± è§£å†³æ–¹æ¡ˆï¼š Session å¤åˆ¶ï¼šé€šè¿‡ä¿®æ”¹ Tomcat çš„é…ç½®ï¼ŒA æœåŠ¡å™¨ä¸­ Session ä¿®æ”¹æ—¶åŒæ—¶å¤åˆ¶åˆ° B æœåŠ¡å™¨ä¸­ ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œåªéœ€ä¿®æ”¹ Tomcat é…ç½® ç¼ºç‚¹ï¼šSession åŒæ­¥ä¼šå ç”¨å†…ç½‘å¸¦å®½ã€ç”±äºåŒæ­¥é€ æˆæ€§èƒ½ä¸‹é™ã€å ç”¨å†…å­˜æ— æ³•æœ‰æ•ˆæ°´å¹³æ‰©å±• å‰ç«¯å­˜å‚¨ï¼šç›´æ¥å°† Session å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ ä¼˜ç‚¹ï¼šä¸å ç”¨æœåŠ¡å™¨å†…å­˜ ç¼ºç‚¹ï¼šå­˜åœ¨å®‰å…¨é£é™©ã€å ç”¨å¤–ç½‘å¸¦å®½ Session ç²˜æ»ï¼šå°†åŒä¸€ç”¨æˆ·è¯·æ±‚éƒ½å‘å¾€åŒä¸€æœåŠ¡å™¨ ä¼˜ç‚¹ï¼šæ— éœ€ä¿®æ”¹ä»£ç ã€æœåŠ¡å™¨å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šæ·»åŠ æ–°æœºå™¨æ—¶ã€åº”ç”¨é‡å¯æ—¶ ä¼šé‡æ–° Hash å¯¼è‡´ç™»å½•å¤±æ•ˆ åç«¯é›†ä¸­å­˜å‚¨ï¼šä½¿ç”¨ç¼“å­˜æœåŠ¡å™¨ç»Ÿä¸€å­˜å‚¨ Session ä¼˜ç‚¹ï¼šå®‰å…¨ã€å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šå¢åŠ å¤æ‚åº¦ã€éœ€è¦ä¿®æ”¹ä»£ç  SpringMVC ä¸­ é…ç½® Redis å¯¼å…¥ redis jedis ä¾èµ– \u003c!-- redis --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.data\u003c/groupId\u003e \u003cartifactId\u003espring-data-redis\u003c/artifactId\u003e \u003cversion\u003e2.7.0\u003c/version\u003e \u003c/dependency\u003e \u003c!-- jedis --\u003e \u003cdependency\u003e \u003cgroupId\u003eredis.clients\u003c/groupId\u003e \u003cartifactId\u003ejedis\u003c/artifactId\u003e \u003cversion\u003e3.8.0\u003c/version\u003e \u003c/dependency\u003e åœ¨ resources ç›®å½•ä¸‹åˆ›å»º redis.properties é…ç½® redis åŸºç¡€è¿æ¥ä¿¡æ¯ # Redis Setting # Redisé»˜è®¤æœ‰16ä¸ªåº“ï¼Œåºå·æ˜¯0-15ï¼Œé»˜è®¤æ˜¯é€‰ä¸­çš„æ˜¯0å·æ•°æ®åº“ spring.redis.database=0 # RedisæœåŠ¡å™¨åœ°å€ spring.redis.host=47.113.216.124 # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ï¼Œé»˜è®¤æ˜¯6379 spring.redis.port=6380 # RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰ spring.redis.password=redis # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxWaitMillis=-1 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxIdle=8 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.minIdle=0 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.timeout=2000 åœ¨ resources ç›®å½•ä¸‹åˆ›å»º applicationContext-redis.xml é…ç½® redis \u003c!-- è½½å…¥redis.properties,è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœæœ‰å¤šä¸ªpropertiesæ–‡ä»¶ï¼Œå¿…é¡»ç”¨é€—å·åˆ†å¼€ï¼Œä¸èƒ½å†™æˆä¸¤ä¸ª \u003ccontext:property-placeholder/\u003e --\u003e \u003ccontext:property-placeholder location=\"classpath:redis.properties\" /\u003e \u003c!-- é…ç½®JedisPoolConfigè¿æ¥æ± --\u003e \u003cbean id=\"poolConfig\" class=\"redis.clients.jedis.JedisPoolConfig\"\u003e \u003cproperty name=\"maxIdle\" value=\"${spring.redis.pool.maxIdle}\"\u003e\u003c/property\u003e \u003cproperty name=\"minIdle\" value=\"${spring.redis.pool.minIdle}\"\u003e\u003c/property\u003e \u003cproperty name=\"maxWaitMillis\" value=\"${spring.redis.pool.maxWaitMillis}\"\u003e\u003c/property\u003e \u003c/bean\u003e \u003c!-- é…ç½®jedisè¿æ¥å·¥å‚ --\u003e \u003cbean id=\"connectionFactory\" class=\"org.springframework.data.redis.connection.jedis.JedisConnectionFactory\"\u003e \u003cproperty name=\"poolConfig\" ref=\"poolConfig\"\u003e\u003c/property\u003e \u003cproperty name=\"hostName\" value=\"${spring.redis.host}\"\u003e\u003c/property\u003e \u003cproperty name=\"port\" value=\"${spring.redis.port}\"\u003e\u003c/property\u003e \u003cproperty name=\"password\" value=\"${spring.redis.password}\"\u003e\u003c/property\u003e \u003cproperty name=\"database\" value=\"${spring.redis.database}\"\u003e\u003c/property\u003e \u003cproperty name=\"timeout\" value=\"${spring.redis.timeout}\"\u003e\u003c/property\u003e \u003c/bean\u003e \u003c!-- é…ç½®RedisTemplate --\u003e \u003cbean id=\"stringRedisSerializer\" class=\"org.springframework.data.redis.serializer.StringRedisSerializer\" /\u003e \u003cbean id=\"cacheRedisTemplate\" class=\"org.springframework.data.redis.core.RedisTemplate\" \u003e \u003cproperty name=\"connectionFactory\" ref=\"connectionFactory\" /\u003e \u003cproperty name=\"keySerializer\" ref=\"stringRedisSerializer\" /\u003e \u003cproperty name=\"hashKeySerializer\" ref=\"stringRedisSerializer\" /\u003e \u003cproperty name=\"valueSerializer\" ref=\"stringRedisSerializer\" /\u003e \u003cproperty name=\"hashValueSerializer\" ref=\"stringRedisSerializer\" /\u003e \u003c/bean\u003e åœ¨ä¸» spring é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ redis é…ç½®æ–‡ä»¶ \u003c!--å¼•å…¥redisé…ç½®æ–‡ä»¶--\u003e \u003cimport resource=\"applicationContext-redis.xml\"/\u003e é”™è¯¯ï¼šCould not resolve placeholder â€˜spring.redis.pool.maxIdleâ€™ in value â€œ${springâ€¦â€¦ é”™è¯¯å¤§æ„ä¸ºä¸èƒ½è·å– properties é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ åŸå› ï¼šSpring å®¹å™¨é»˜è®¤ä½¿ç”¨å•ä¾‹æ¨¡å¼åå°„è·å– \u003ccontext:property-placeholder location=\"classpath:......\" /\u003e ä¸­çš„å†…å®¹ï¼Œç”±äºæ˜¯å•ä¾‹æ¨¡å¼ï¼Œåœ¨å¤šæ¬¡ä½¿ç”¨æ­¤æ ‡ç­¾æ—¶åªä¼šè§£æä¸€ä¸ª è§£å†³ï¼šåœ¨æ¯æ¬¡ä½¿ç”¨ context:property-placeholder æ ‡ç­¾ä¸­éƒ½æ·»åŠ  ignore-unresolvable=\"true\" å°è£… redisTemplate åœ¨ redis åŒ…ä¸‹åˆ›å»º RedisService ç±» @Component public final class RedisService { // é”åç§° public static final String LOCK_PREFIX = \"redis_lock:\"; @Resource private RedisTemplate\u003cString, String\u003e redisTemplate; /** * ---------------------------------é€šç”¨--------------------------------- */ public void expire(String key, long l, TimeUnit timeUnit) { redisTemplate.expire(key, l, timeUnit); } public Long getExpire(String key) { return redisTemplate.getExpire(key); } public Long getExpire(String key, TimeUnit timeUnit) { return redisTemplate.getExpire(key, timeUnit); } public Boolean delete(String key) { return redisTemplate.delete(key); } public DataType type(String key) { return redisTemplate.type(key); } public Long deletes(Col","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:2","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åˆ†å¸ƒå¼-session-é—®é¢˜"},{"categories":null,"content":"\råˆ†å¸ƒå¼ Session é—®é¢˜ ä½¿ç”¨ nginx åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶ï¼Œè‹¥ä½¿ç”¨é»˜è®¤è½®è¯¢æœºåˆ¶ç”¨æˆ·æ¯æ¬¡è®¿é—®çš„æœåŠ¡å™¨ä¸åŒï¼Œå¯¼è‡´å¶ç°çš„ Session ä¸¢å¤± è§£å†³æ–¹æ¡ˆï¼š Session å¤åˆ¶ï¼šé€šè¿‡ä¿®æ”¹ Tomcat çš„é…ç½®ï¼ŒA æœåŠ¡å™¨ä¸­ Session ä¿®æ”¹æ—¶åŒæ—¶å¤åˆ¶åˆ° B æœåŠ¡å™¨ä¸­ ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œåªéœ€ä¿®æ”¹ Tomcat é…ç½® ç¼ºç‚¹ï¼šSession åŒæ­¥ä¼šå ç”¨å†…ç½‘å¸¦å®½ã€ç”±äºåŒæ­¥é€ æˆæ€§èƒ½ä¸‹é™ã€å ç”¨å†…å­˜æ— æ³•æœ‰æ•ˆæ°´å¹³æ‰©å±• å‰ç«¯å­˜å‚¨ï¼šç›´æ¥å°† Session å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ ä¼˜ç‚¹ï¼šä¸å ç”¨æœåŠ¡å™¨å†…å­˜ ç¼ºç‚¹ï¼šå­˜åœ¨å®‰å…¨é£é™©ã€å ç”¨å¤–ç½‘å¸¦å®½ Session ç²˜æ»ï¼šå°†åŒä¸€ç”¨æˆ·è¯·æ±‚éƒ½å‘å¾€åŒä¸€æœåŠ¡å™¨ ä¼˜ç‚¹ï¼šæ— éœ€ä¿®æ”¹ä»£ç ã€æœåŠ¡å™¨å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šæ·»åŠ æ–°æœºå™¨æ—¶ã€åº”ç”¨é‡å¯æ—¶ ä¼šé‡æ–° Hash å¯¼è‡´ç™»å½•å¤±æ•ˆ åç«¯é›†ä¸­å­˜å‚¨ï¼šä½¿ç”¨ç¼“å­˜æœåŠ¡å™¨ç»Ÿä¸€å­˜å‚¨ Session ä¼˜ç‚¹ï¼šå®‰å…¨ã€å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šå¢åŠ å¤æ‚åº¦ã€éœ€è¦ä¿®æ”¹ä»£ç  SpringMVC ä¸­ é…ç½® Redis å¯¼å…¥ redis jedis ä¾èµ– org.springframework.data spring-data-redis 2.7.0 redis.clients jedis 3.8.0 åœ¨ resources ç›®å½•ä¸‹åˆ›å»º redis.properties é…ç½® redis åŸºç¡€è¿æ¥ä¿¡æ¯ # Redis Setting # Redisé»˜è®¤æœ‰16ä¸ªåº“ï¼Œåºå·æ˜¯0-15ï¼Œé»˜è®¤æ˜¯é€‰ä¸­çš„æ˜¯0å·æ•°æ®åº“ spring.redis.database=0 # RedisæœåŠ¡å™¨åœ°å€ spring.redis.host=47.113.216.124 # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ï¼Œé»˜è®¤æ˜¯6379 spring.redis.port=6380 # RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰ spring.redis.password=redis # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxWaitMillis=-1 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxIdle=8 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.minIdle=0 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.timeout=2000 åœ¨ resources ç›®å½•ä¸‹åˆ›å»º applicationContext-redis.xml é…ç½® redis åœ¨ä¸» spring é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ redis é…ç½®æ–‡ä»¶ é”™è¯¯ï¼šCould not resolve placeholder â€˜spring.redis.pool.maxIdleâ€™ in value â€œ${springâ€¦â€¦ é”™è¯¯å¤§æ„ä¸ºä¸èƒ½è·å– properties é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ åŸå› ï¼šSpring å®¹å™¨é»˜è®¤ä½¿ç”¨å•ä¾‹æ¨¡å¼åå°„è·å– ä¸­çš„å†…å®¹ï¼Œç”±äºæ˜¯å•ä¾‹æ¨¡å¼ï¼Œåœ¨å¤šæ¬¡ä½¿ç”¨æ­¤æ ‡ç­¾æ—¶åªä¼šè§£æä¸€ä¸ª è§£å†³ï¼šåœ¨æ¯æ¬¡ä½¿ç”¨ context:property-placeholder æ ‡ç­¾ä¸­éƒ½æ·»åŠ  ignore-unresolvable=\"true\" å°è£… redisTemplate åœ¨ redis åŒ…ä¸‹åˆ›å»º RedisService ç±» @Component public final class RedisService { // é”åç§° public static final String LOCK_PREFIX = \"redis_lock:\"; @Resource private RedisTemplate redisTemplate; /** * ---------------------------------é€šç”¨--------------------------------- */ public void expire(String key, long l, TimeUnit timeUnit) { redisTemplate.expire(key, l, timeUnit); } public Long getExpire(String key) { return redisTemplate.getExpire(key); } public Long getExpire(String key, TimeUnit timeUnit) { return redisTemplate.getExpire(key, timeUnit); } public Boolean delete(String key) { return redisTemplate.delete(key); } public DataType type(String key) { return redisTemplate.type(key); } public Long deletes(Col","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:2","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#springmvc-ä¸­-é…ç½®-redis"},{"categories":null,"content":"\råˆ†å¸ƒå¼ Session é—®é¢˜ ä½¿ç”¨ nginx åšè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶ï¼Œè‹¥ä½¿ç”¨é»˜è®¤è½®è¯¢æœºåˆ¶ç”¨æˆ·æ¯æ¬¡è®¿é—®çš„æœåŠ¡å™¨ä¸åŒï¼Œå¯¼è‡´å¶ç°çš„ Session ä¸¢å¤± è§£å†³æ–¹æ¡ˆï¼š Session å¤åˆ¶ï¼šé€šè¿‡ä¿®æ”¹ Tomcat çš„é…ç½®ï¼ŒA æœåŠ¡å™¨ä¸­ Session ä¿®æ”¹æ—¶åŒæ—¶å¤åˆ¶åˆ° B æœåŠ¡å™¨ä¸­ ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œåªéœ€ä¿®æ”¹ Tomcat é…ç½® ç¼ºç‚¹ï¼šSession åŒæ­¥ä¼šå ç”¨å†…ç½‘å¸¦å®½ã€ç”±äºåŒæ­¥é€ æˆæ€§èƒ½ä¸‹é™ã€å ç”¨å†…å­˜æ— æ³•æœ‰æ•ˆæ°´å¹³æ‰©å±• å‰ç«¯å­˜å‚¨ï¼šç›´æ¥å°† Session å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ ä¼˜ç‚¹ï¼šä¸å ç”¨æœåŠ¡å™¨å†…å­˜ ç¼ºç‚¹ï¼šå­˜åœ¨å®‰å…¨é£é™©ã€å ç”¨å¤–ç½‘å¸¦å®½ Session ç²˜æ»ï¼šå°†åŒä¸€ç”¨æˆ·è¯·æ±‚éƒ½å‘å¾€åŒä¸€æœåŠ¡å™¨ ä¼˜ç‚¹ï¼šæ— éœ€ä¿®æ”¹ä»£ç ã€æœåŠ¡å™¨å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šæ·»åŠ æ–°æœºå™¨æ—¶ã€åº”ç”¨é‡å¯æ—¶ ä¼šé‡æ–° Hash å¯¼è‡´ç™»å½•å¤±æ•ˆ åç«¯é›†ä¸­å­˜å‚¨ï¼šä½¿ç”¨ç¼“å­˜æœåŠ¡å™¨ç»Ÿä¸€å­˜å‚¨ Session ä¼˜ç‚¹ï¼šå®‰å…¨ã€å¯ä»¥æ°´å¹³æ‰©å±• ç¼ºç‚¹ï¼šå¢åŠ å¤æ‚åº¦ã€éœ€è¦ä¿®æ”¹ä»£ç  SpringMVC ä¸­ é…ç½® Redis å¯¼å…¥ redis jedis ä¾èµ– org.springframework.data spring-data-redis 2.7.0 redis.clients jedis 3.8.0 åœ¨ resources ç›®å½•ä¸‹åˆ›å»º redis.properties é…ç½® redis åŸºç¡€è¿æ¥ä¿¡æ¯ # Redis Setting # Redisé»˜è®¤æœ‰16ä¸ªåº“ï¼Œåºå·æ˜¯0-15ï¼Œé»˜è®¤æ˜¯é€‰ä¸­çš„æ˜¯0å·æ•°æ®åº“ spring.redis.database=0 # RedisæœåŠ¡å™¨åœ°å€ spring.redis.host=47.113.216.124 # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ï¼Œé»˜è®¤æ˜¯6379 spring.redis.port=6380 # RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰ spring.redis.password=redis # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxWaitMillis=-1 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.maxIdle=8 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.pool.minIdle=0 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ spring.redis.timeout=2000 åœ¨ resources ç›®å½•ä¸‹åˆ›å»º applicationContext-redis.xml é…ç½® redis åœ¨ä¸» spring é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ redis é…ç½®æ–‡ä»¶ é”™è¯¯ï¼šCould not resolve placeholder â€˜spring.redis.pool.maxIdleâ€™ in value â€œ${springâ€¦â€¦ é”™è¯¯å¤§æ„ä¸ºä¸èƒ½è·å– properties é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ åŸå› ï¼šSpring å®¹å™¨é»˜è®¤ä½¿ç”¨å•ä¾‹æ¨¡å¼åå°„è·å– ä¸­çš„å†…å®¹ï¼Œç”±äºæ˜¯å•ä¾‹æ¨¡å¼ï¼Œåœ¨å¤šæ¬¡ä½¿ç”¨æ­¤æ ‡ç­¾æ—¶åªä¼šè§£æä¸€ä¸ª è§£å†³ï¼šåœ¨æ¯æ¬¡ä½¿ç”¨ context:property-placeholder æ ‡ç­¾ä¸­éƒ½æ·»åŠ  ignore-unresolvable=\"true\" å°è£… redisTemplate åœ¨ redis åŒ…ä¸‹åˆ›å»º RedisService ç±» @Component public final class RedisService { // é”åç§° public static final String LOCK_PREFIX = \"redis_lock:\"; @Resource private RedisTemplate redisTemplate; /** * ---------------------------------é€šç”¨--------------------------------- */ public void expire(String key, long l, TimeUnit timeUnit) { redisTemplate.expire(key, l, timeUnit); } public Long getExpire(String key) { return redisTemplate.getExpire(key); } public Long getExpire(String key, TimeUnit timeUnit) { return redisTemplate.getExpire(key, timeUnit); } public Boolean delete(String key) { return redisTemplate.delete(key); } public DataType type(String key) { return redisTemplate.type(key); } public Long deletes(Col","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:2","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#shiro-ä¸­ä½¿ç”¨-redis-å­˜å‚¨-session"},{"categories":null,"content":"\rç§’æ€æ€è·¯","date":"2022-04-16","objectID":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:32:3","series":null,"tags":null,"title":"æ ¡å›­åå‹¤ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/%E6%A0%A1%E5%9B%AD%E5%90%8E%E5%8B%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ç§’æ€æ€è·¯"},{"categories":null,"content":"\rVue JavaScriptæ¡†æ¶ ç®€åŒ–Domæ“ä½œ å“åº”å¼æ•°æ®é©±åŠ¨ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#vue"},{"categories":null,"content":"\rä½¿ç”¨Vue å¯¼å…¥å¼€å‘ç‰ˆæœ¬çš„Vue.js \u003cscriptÂ src=\"https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js\"\u003e\u003c/script\u003e åˆ›å»ºVueå®ä¾‹å¯¹è±¡ï¼Œè®¾ç½®elå±æ€§å’Œdataå±æ€§ å°†idä¸ºappçš„æ ‡ç­¾å†…çš„ä¿¡æ¯æ”¹ä¸ºmessageå¯¹åº”çš„ä¿¡æ¯ \u003cdiv id=\"app\"\u003e {{message}} \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"#app\", \u003c!-- el å°±æ˜¯ element --\u003e data:{ message:\"Hello Vue!\" } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä½¿ç”¨vue"},{"categories":null,"content":"\relï¼šæŒ‚è½½ç‚¹ é€šè¿‡ css é€‰æ‹©å™¨ è®¾ç½® Vue ç®¡ç†çš„å…ƒç´  åœ¨elå‘½ä¸­çš„å…ƒç´ å†…éƒ¨åµŒå¥—çš„æ ‡ç­¾ä¹Ÿä¼šè¢«Vueæ‰€ç®¡ç† \u003cdivÂ id=\"app\"\u003e {{message}} \u003c!--æ”¯æŒè¡¨è¾¾å¼: {{ message + \"123\" }}--\u003e \u003cspan\u003e{{message}}\u003c/span\u003e \u003c/div\u003e ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–cssé€‰æ‹©å™¨æ¥è®¾ç½®Vueç®¡ç†çš„å…ƒç´ ï¼Œå»ºè®®ä½¿ç”¨idé€‰æ‹©å™¨ ä¸èƒ½ä½¿ç”¨HTMLæˆ–BODYçš„åŒæ ‡ç­¾ el æŒ‚è½½ç‚¹çš„ä½œç”¨åŸŸï¼š el å‘½ä¸­çš„å…ƒç´  el å‘½ä¸­çš„å…ƒç´ å†…éƒ¨çš„å…ƒç´  el æ— æ³•å‘½ä¸­ html å’Œ body æ ‡ç­¾ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#elæŒ‚è½½ç‚¹"},{"categories":null,"content":"\rdataï¼šæ•°æ®å¯¹è±¡ å®šä¹‰Vueç”¨åˆ°çš„æ•°æ® dataä¸­å¯ä»¥å†™å¤æ‚ç±»å‹çš„æ•°æ®ï¼Œä½¿ç”¨æ—¶éµå®ˆjsçš„è¯­æ³•å³å¯ \u003cdiv id=\"app\" class=\"app\"\u003e \u003ch2\u003e{{message}}\u003c/h2\u003e \u003ch2\u003e{{people.name}}\u003c/h2\u003e \u003ch2\u003e{{array[1]}}\u003c/h2\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"#app\", data:{ message:\"Hello Vue!\", people:{ name:\"å”åƒ§\" }, array:[123, 12, 1] } }) \u003c/script\u003e data æ•°æ®å¯¹è±¡çš„ç±»å‹ å­—ç¬¦ä¸²ï¼š{{ å­—ç¬¦ä¸²å }} å¯¹è±¡ï¼š{{ å¯¹è±¡å . å±æ€§å }} æ•°ç»„ï¼š{{ æ•°ç»„å [ ä¸‹æ ‡ ] }} ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#dataæ•°æ®å¯¹è±¡"},{"categories":null,"content":"\rmethodsï¼šæ–¹æ³• å®šä¹‰ Vue ç”¨åˆ°çš„æ–¹æ³• åœ¨ methods ä¸­å®šä¹‰çš„æ–¹æ³•ä¸­ï¼Œå¯ä½¿ç”¨ this è·å–åˆ° data ä¸­çš„æ•°æ® \u003cdiv id=\"app\"\u003e \u003cbutton @click=\"sub\"\u003e-\u003c/button\u003e \u003cspan\u003e{{num}}\u003c/span\u003e \u003cbutton @click=\"add\"\u003e+\u003c/button\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"#app\", data:{ num : 0 }, methods:{ add:function(){ if(this.num \u003c 10){ this.num++; }else{ alert(\"æ»¡äº†ï¼Œåˆ«ç‚¹äº†\") } }, sub:function(){ if(this.num \u003e 0){ this.num--; }else{ alert(\"æ— äº†ï¼Œåˆ«ç‚¹äº†\") } } } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#methodsæ–¹æ³•"},{"categories":null,"content":"\rVueæŒ‡ä»¤ ä¸åŒäºä¼ ç»Ÿè· DOM å…ƒç´ æ“ä½œå®ƒä»¬çš„å½¢å¼ï¼ŒVue é‡‡ç”¨ä¸€ç³»åˆ— v- å¼€å¤´çš„ç‰¹æ®Šè¯­æ³•æ¥å®ç° Vue çš„é¡µé¢ç”±æ•°æ®ç”Ÿæˆï¼Œæ•°æ®æ”¹å˜é¡µé¢ä¼šåŒæ­¥è·Ÿç€æ”¹å˜ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#vueæŒ‡ä»¤"},{"categories":null,"content":"\r1. å†…å®¹ç»‘å®šã€äº‹ä»¶ç»‘å®š\rv-textï¼šè®¾ç½®æ–‡æœ¬å€¼ è®¾ç½®å…ƒç´ çš„ textContent æ”¯æŒè¡¨è¾¾å¼ï¼š\u003cdiv v-text=\"message+'!'\"\u003e \u003c/div ä½¿ç”¨ v-text=\"\" æˆ– {{}} æ’å€¼è¡¨è¾¾å¼ \u003cdiv\u003e \u003c!-- {{xxx}} æ’å€¼è¡¨è¾¾å¼ --\u003e \u003c!-- {{xxx + â€œ123â€}} æ’å€¼è¡¨è¾¾å¼æ‹¼æ¥å­—ç¬¦ä¸² --\u003e \u003ch2 v-text=\"message\"\u003e{{\"ä½¿ç”¨é»˜è®¤å†™æ³•ä¼šæ›¿æ¢æ‰å…¨éƒ¨å†…å®¹\"}}\u003c/h2\u003e \u003ch2 v-text=\"info\"\u003e\u003c/h2\u003e \u003ch2 \u003e{{message+\"123\"}}\u003c/h2\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"div\", data:{ message:\"Hello World!\", info:\"qwerdf\" } }) \u003c/script\u003e v-htmlï¼šè®¾ç½®HTML ä¸ v-text ç›¸åŒï¼Œä¸è¿‡å¯ä»¥è§£æ HTML æŒ‡ä»¤ è®¾ç½®å…ƒç´ çš„ innerHTML ä½¿ç”¨ v-html=\"\" è§£æhtmlå­—ç¬¦ä¸² \u003cdiv id=\"app\"\u003e \u003cp v-html=\"content\"\u003e\u003c/p\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"#app\", data:{ content:\"\u003ca href='#'\u003eæµ‹è¯•é“¾æ¥\u003c/a\u003e\" } }) \u003c/script\u003e v-onï¼šç»‘å®šäº‹ä»¶ è®¾ç½®å…ƒç´ çš„ç»‘å®šäº‹ä»¶ onXXX å®šä¹‰åœ¨ methods å±æ€§ä¸­ ä½¿ç”¨ v-on:click æˆ– @click v-on:keyup.enter é™åˆ¶è§¦å‘çš„ä¿®é¥°ç¬¦ enter æŒ‰å›è½¦æ—¶ æ–¹æ³•å†…éƒ¨å¯ä»¥é€šè¿‡ this å…³é”®å­—è®¿é—® data å±æ€§ä¸­çš„æ•°æ® \u003cdiv id=\"app\"\u003e \u003cbutton v-on:click=\"doit\"\u003eæµ‹è¯•\u003c/button\u003e \u003cbutton @click=\"doit\"\u003e{{content}}\u003c/button\u003e \u003cbutton @dblclick=\"doit\"\u003eæµ‹è¯•\u003c/button\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"#app\", data:{ content:\"\u003ca href='#'\u003eæµ‹è¯•é“¾æ¥\u003c/a\u003e\" }, methods:{ doit:function(){ this.content = \"testLink\"; alert(this.content); } } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:1","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#1-å†…å®¹ç»‘å®šäº‹ä»¶ç»‘å®š"},{"categories":null,"content":"\r1. å†…å®¹ç»‘å®šã€äº‹ä»¶ç»‘å®š\rv-textï¼šè®¾ç½®æ–‡æœ¬å€¼ è®¾ç½®å…ƒç´ çš„ textContent æ”¯æŒè¡¨è¾¾å¼ï¼š ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:1","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-textè®¾ç½®æ–‡æœ¬å€¼"},{"categories":null,"content":"\r1. å†…å®¹ç»‘å®šã€äº‹ä»¶ç»‘å®š\rv-textï¼šè®¾ç½®æ–‡æœ¬å€¼ è®¾ç½®å…ƒç´ çš„ textContent æ”¯æŒè¡¨è¾¾å¼ï¼š ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:1","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-htmlè®¾ç½®html"},{"categories":null,"content":"\r1. å†…å®¹ç»‘å®šã€äº‹ä»¶ç»‘å®š\rv-textï¼šè®¾ç½®æ–‡æœ¬å€¼ è®¾ç½®å…ƒç´ çš„ textContent æ”¯æŒè¡¨è¾¾å¼ï¼š ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:1","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-onç»‘å®šäº‹ä»¶"},{"categories":null,"content":"\r2. æ˜¾å¼åˆ‡æ¢ã€å±æ€§ç»‘å®š\rv-showï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ åˆ‡æ¢å…ƒç´ çš„ style=\"display:none\" ä½¿ç”¨ v-show=\"true\" å¸ƒå°”ã€å¼•ç”¨ã€è¡¨è¾¾å¼ï¼Œæ•°æ®æ”¹å˜åæ˜¾ç¤ºçŠ¶æ€ä¼šåŒæ­¥åˆ·æ–° \u003cdiv\u003e \u003cimg v-show=\"isShow\" src=\"/image.jpg\" /\u003e \u003cbutton @click=\"show\"\u003eæ˜¾ç¤º/éšè—\u003c/button\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"div\", data:{ isShow : true }, methods:{ show:function(){ this.isShow = !this.isShow; } } }) \u003c/script\u003e v-ifï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ æ“çºµDomæ ‘ï¼ˆå¯¹æ€§èƒ½æ¶ˆè€—è¾ƒv-showå¤§ï¼‰ ä½¿ç”¨v-if=\"true\" å…¶ä»–åŒv-show \u003cdiv\u003e \u003cimg v-if=\"isShow\u003e=18\" src=\"/image.jpg\" /\u003e \u003cbutton @click=\"show\"\u003eæ˜¾ç¤º\u003c/button\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"div\", data:{ isShow : 17 }, methods:{ show:function(){ this.isShow++; } } }) \u003c/script\u003e v-bindï¼šè®¾ç½®å…ƒç´ å±æ€§ å®Œæ•´å†™æ³• v-bind:å±æ€§å=\"å€¼\" å¯ç®€å†™ :å±æ€§åï¼Œä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ã€{active:isActive} æ ¹æ® isActive çš„å€¼åˆ¤æ–­æ˜¯å¦å¡«å…¥ â€œactiveâ€ \u003cdiv\u003e \u003cimg v-bind:style=\"css\" src=\"/image.jpg\" /\u003e \u003cbr\u003e \u003cimg :src=\"imgSrc\" /\u003e \u003cbr\u003e \u003cimg :class=\"isActive?'active':''\" :src=\"imgSrc\" @click=\"toggleActive\" /\u003e \u003cbr\u003e \u003cimg :class={active:isActive} :src=\"imgSrc\" @click=\"toggleActive\" /\u003e \u003cbr\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el:\"div\", data:{ css:\"border:1px solid red\", imgSrc:\"/image.jpg\", isActive:false }, methods:{ toggleActive:function(){ this.isActive = !this.isActive; } } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:2","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#2-æ˜¾å¼åˆ‡æ¢å±æ€§ç»‘å®š"},{"categories":null,"content":"\r2. æ˜¾å¼åˆ‡æ¢ã€å±æ€§ç»‘å®š\rv-showï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ åˆ‡æ¢å…ƒç´ çš„ style=\"display:none\" ä½¿ç”¨ v-show=\"true\" å¸ƒå°”ã€å¼•ç”¨ã€è¡¨è¾¾å¼ï¼Œæ•°æ®æ”¹å˜åæ˜¾ç¤ºçŠ¶æ€ä¼šåŒæ­¥åˆ·æ–° æ˜¾ç¤º/éšè— v-ifï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ æ“çºµDomæ ‘ï¼ˆå¯¹æ€§èƒ½æ¶ˆè€—è¾ƒv-showå¤§ï¼‰ ä½¿ç”¨v-if=\"true\" å…¶ä»–åŒv-show æ˜¾ç¤º v-bindï¼šè®¾ç½®å…ƒç´ å±æ€§ å®Œæ•´å†™æ³• v-bind:å±æ€§å=\"å€¼\" å¯ç®€å†™ :å±æ€§åï¼Œä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ã€{active:isActive} æ ¹æ® isActive çš„å€¼åˆ¤æ–­æ˜¯å¦å¡«å…¥ â€œactiveâ€ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:2","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-showåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€"},{"categories":null,"content":"\r2. æ˜¾å¼åˆ‡æ¢ã€å±æ€§ç»‘å®š\rv-showï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ åˆ‡æ¢å…ƒç´ çš„ style=\"display:none\" ä½¿ç”¨ v-show=\"true\" å¸ƒå°”ã€å¼•ç”¨ã€è¡¨è¾¾å¼ï¼Œæ•°æ®æ”¹å˜åæ˜¾ç¤ºçŠ¶æ€ä¼šåŒæ­¥åˆ·æ–° æ˜¾ç¤º/éšè— v-ifï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ æ“çºµDomæ ‘ï¼ˆå¯¹æ€§èƒ½æ¶ˆè€—è¾ƒv-showå¤§ï¼‰ ä½¿ç”¨v-if=\"true\" å…¶ä»–åŒv-show æ˜¾ç¤º v-bindï¼šè®¾ç½®å…ƒç´ å±æ€§ å®Œæ•´å†™æ³• v-bind:å±æ€§å=\"å€¼\" å¯ç®€å†™ :å±æ€§åï¼Œä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ã€{active:isActive} æ ¹æ® isActive çš„å€¼åˆ¤æ–­æ˜¯å¦å¡«å…¥ â€œactiveâ€ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:2","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-ifåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€"},{"categories":null,"content":"\r2. æ˜¾å¼åˆ‡æ¢ã€å±æ€§ç»‘å®š\rv-showï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ åˆ‡æ¢å…ƒç´ çš„ style=\"display:none\" ä½¿ç”¨ v-show=\"true\" å¸ƒå°”ã€å¼•ç”¨ã€è¡¨è¾¾å¼ï¼Œæ•°æ®æ”¹å˜åæ˜¾ç¤ºçŠ¶æ€ä¼šåŒæ­¥åˆ·æ–° æ˜¾ç¤º/éšè— v-ifï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ æ“çºµDomæ ‘ï¼ˆå¯¹æ€§èƒ½æ¶ˆè€—è¾ƒv-showå¤§ï¼‰ ä½¿ç”¨v-if=\"true\" å…¶ä»–åŒv-show æ˜¾ç¤º v-bindï¼šè®¾ç½®å…ƒç´ å±æ€§ å®Œæ•´å†™æ³• v-bind:å±æ€§å=\"å€¼\" å¯ç®€å†™ :å±æ€§åï¼Œä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ã€{active:isActive} æ ¹æ® isActive çš„å€¼åˆ¤æ–­æ˜¯å¦å¡«å…¥ â€œactiveâ€ ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:2","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-bindè®¾ç½®å…ƒç´ å±æ€§"},{"categories":null,"content":"\r3. åˆ—è¡¨å¾ªç¯ã€è¡¨å•å…ƒç´ ç»‘å®š\rv-forï¼šåˆ—è¡¨å¾ªç¯ å®Œæ•´å†™æ³• v-for=\"item in arr\" ã€v-for=\"(item,index) in arr\" å¾ªç¯çš„æ¬¡æ•°ç”±æ•°ç»„çš„é•¿åº¦å†³å®šï¼Œå¯å“åº”å¼åŒæ­¥æ›´æ–°æ•°æ® \u003cdiv id=\"app\"\u003e \u003cul\u003e \u003cli v-for=\"(item,index) in arr\"\u003e {{index+1 + \" -\u003e \" + item}} \u003c/li\u003e \u003c/ul\u003e \u003c/div\u003e \u003cscript\u003e new Vue({ el:\"#app\", data:{ arr:[\"a\", 'b', 3, { name:\"mike\", tel:\"12233334444\" }] } }) \u003c/script\u003e v-modelï¼šåŒå‘æ•°æ®ç»‘å®š å®Œæ•´å†™æ³• v-model=\"dataä¸­å…ƒç´ \" è·å–å’Œè®¾ç½®è¡¨å•å…ƒç´ çš„å€¼ï¼Œä¸ºè¡¨å•å…ƒç´ è®¾ç½®é»˜è®¤ value å€¼ä¸º data ä¸­å…ƒç´ å€¼ï¼Œå½“è¡¨å•ä¸­å€¼æ”¹å˜æ—¶ä¹Ÿä¼šåŒæ­¥åˆ° data å…ƒç´ ä¸­ \u003cdiv id=\"app\"\u003e \u003cinput type=\"text\" v-model=\"message\" \u003e {{message}} \u003c/div\u003e \u003cscript\u003e new Vue({ el:\"#app\", data:{ message:\"åˆ˜å˜‰å®\" } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:3","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#3-åˆ—è¡¨å¾ªç¯è¡¨å•å…ƒç´ ç»‘å®š"},{"categories":null,"content":"\r3. åˆ—è¡¨å¾ªç¯ã€è¡¨å•å…ƒç´ ç»‘å®š\rv-forï¼šåˆ—è¡¨å¾ªç¯ å®Œæ•´å†™æ³• v-for=\"item in arr\" ã€v-for=\"(item,index) in arr\" å¾ªç¯çš„æ¬¡æ•°ç”±æ•°ç»„çš„é•¿åº¦å†³å®šï¼Œå¯å“åº”å¼åŒæ­¥æ›´æ–°æ•°æ® {{index+1 + \" -\u003e \" + item}} v-modelï¼šåŒå‘æ•°æ®ç»‘å®š å®Œæ•´å†™æ³• v-model=\"dataä¸­å…ƒç´ \" è·å–å’Œè®¾ç½®è¡¨å•å…ƒç´ çš„å€¼ï¼Œä¸ºè¡¨å•å…ƒç´ è®¾ç½®é»˜è®¤ value å€¼ä¸º data ä¸­å…ƒç´ å€¼ï¼Œå½“è¡¨å•ä¸­å€¼æ”¹å˜æ—¶ä¹Ÿä¼šåŒæ­¥åˆ° data å…ƒç´ ä¸­ {{message}} ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:3","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-foråˆ—è¡¨å¾ªç¯"},{"categories":null,"content":"\r3. åˆ—è¡¨å¾ªç¯ã€è¡¨å•å…ƒç´ ç»‘å®š\rv-forï¼šåˆ—è¡¨å¾ªç¯ å®Œæ•´å†™æ³• v-for=\"item in arr\" ã€v-for=\"(item,index) in arr\" å¾ªç¯çš„æ¬¡æ•°ç”±æ•°ç»„çš„é•¿åº¦å†³å®šï¼Œå¯å“åº”å¼åŒæ­¥æ›´æ–°æ•°æ® {{index+1 + \" -\u003e \" + item}} v-modelï¼šåŒå‘æ•°æ®ç»‘å®š å®Œæ•´å†™æ³• v-model=\"dataä¸­å…ƒç´ \" è·å–å’Œè®¾ç½®è¡¨å•å…ƒç´ çš„å€¼ï¼Œä¸ºè¡¨å•å…ƒç´ è®¾ç½®é»˜è®¤ value å€¼ä¸º data ä¸­å…ƒç´ å€¼ï¼Œå½“è¡¨å•ä¸­å€¼æ”¹å˜æ—¶ä¹Ÿä¼šåŒæ­¥åˆ° data å…ƒç´ ä¸­ {{message}} ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:3","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#v-modelåŒå‘æ•°æ®ç»‘å®š"},{"categories":null,"content":"\rç½‘ç»œåº”ç”¨\raxios ç½‘ç»œè¯·æ±‚åº“ å†…éƒ¨å°è£…äº† Ajaxï¼Œå®¹é‡å°ï¼Œæ˜“ä¸ Vue ç»“åˆ get axios.get(\"è¯·æ±‚åœ°å€?k1=v1\u0026k2=v2\") .then(function(resp){ //æˆåŠŸå“åº”çš„å›è°ƒæ–¹æ³• },function(err){ //æŠ¥é”™ä¹‹åçš„å›è°ƒæ–¹æ³• }) post axios.post(\"è¯·æ±‚åœ°å€\",{k1:v1,k2:v2}) .then(function(resp){ //æˆåŠŸå“åº”çš„å›è°ƒæ–¹æ³• },function(err){ //æŠ¥é”™ä¹‹åçš„å›è°ƒæ–¹æ³• }) vue ä¸­çš„ä½¿ç”¨ \u003cdiv id=\"app\"\u003e \u003cinput type=\"button\" value=\"getJoke\" @click=\"getJoke\"\u003e {{ joke }} \u003c/div\u003e \u003cscript\u003e new Vue({ el:\"#app\", data:{ joke:\"è¿™æ˜¯ä¸€æ¡ç¬‘è¯\" }, methods:{ getJoke:function(){ //å› ä¸º ajax æ˜¯å¼‚æ­¥çš„, åœ¨ ajax ä»£ç ä¸­çš„ this æ˜¯ whindow å¯¹è±¡è€Œä¸æ˜¯ vue å¯¹è±¡ //æ‰€ä»¥è¦å°†å½“å‰ vue å¯¹è±¡å­˜èµ·æ¥, ä»¥ä¾¿æ–¹æ³•å†… ajax ä»£ç ä¸­è¿›è¡Œè°ƒç”¨ var that = this; axios.get(\"https://autumnfish.cn/api/joke\") .then(function(resp){ that.joke = resp.data; console.log(this); },function(err){ console.log(err); }) } } }) \u003c/script\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç½‘ç»œåº”ç”¨"},{"categories":null,"content":"\rç½‘ç»œåº”ç”¨\raxios ç½‘ç»œè¯·æ±‚åº“ å†…éƒ¨å°è£…äº† Ajaxï¼Œå®¹é‡å°ï¼Œæ˜“ä¸ Vue ç»“åˆ get axios.get(\"è¯·æ±‚åœ°å€?k1=v1\u0026k2=v2\") .then(function(resp){ //æˆåŠŸå“åº”çš„å›è°ƒæ–¹æ³• },function(err){ //æŠ¥é”™ä¹‹åçš„å›è°ƒæ–¹æ³• }) post axios.post(\"è¯·æ±‚åœ°å€\",{k1:v1,k2:v2}) .then(function(resp){ //æˆåŠŸå“åº”çš„å›è°ƒæ–¹æ³• },function(err){ //æŠ¥é”™ä¹‹åçš„å›è°ƒæ–¹æ³• }) vue ä¸­çš„ä½¿ç”¨ {{ joke }} ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#axios-ç½‘ç»œè¯·æ±‚åº“"},{"categories":null,"content":"\rè·¨åŸŸé—®é¢˜ æµè§ˆå™¨çš„ åŒæºç­–ç•¥ æ˜¯ç”± NetScape æå‡ºçš„ä¸€ä¸ªè‘—åçš„å®‰å…¨ç­–ç•¥ï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ã€‚ åŒæºå°±æ˜¯æŒ‡ åè®®ã€åŸŸåã€ç«¯å£éƒ½è¦ç›¸åŒ è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆï¼š JSONP ç”±å‰ç«¯è§£å†³è·¨åŸŸé—®é¢˜ï¼Œåªèƒ½è§£å†³ GET è¯·æ±‚ CORS æ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œæä¾›äº† Web æœåŠ¡ä»ä¸åŒç½‘åŸŸä¼ æ¥æ²™ç›’è„šæœ¬çš„æ–¹æ³•ï¼Œé¿å¼€æµè§ˆå™¨çš„åŒæºç­–ç•¥ åç«¯è§£å†³æ–¹æ¡ˆ åœ¨ ç±» / æ–¹æ³• ä¸ŠåŠ æ³¨è§£ @CrossOrigin(origins = \"*\") æ ‡è¯†æ­¤ ç±» / æ–¹æ³• æ¥æ”¶æ‰€æœ‰åŸŸå‘æ¥çš„è¯·æ±‚ @Controller @RequestMapping(\"/user\") @CrossOrigin(origins = \"*\") public class TestController { @RequestMapping(\"/get.do\") @ResponseBody //@CrossOrigin(origins = \"*\") public User getUser(){ return new User(\"mike\", \"123\"); } } ä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®ç±»å®ç° ç•¥ ä¹Ÿå¯ä»¥ä½¿ç”¨ xml é…ç½®è§£å†³ \u003cmvc:cors\u003e \u003cmvc:mapping path=\"/**\"/\u003e \u003c/mvc:cors\u003e ","date":"2022-04-12","objectID":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"VUEè‡ªå­¦ç¬”è®°","uri":"/vue%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è·¨åŸŸé—®é¢˜"},{"categories":null,"content":"\rShiro å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® ç¬”è®°æ‘˜è‡ª ç¼–ç¨‹ä¸è‰¯äºº å°é™ˆ ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro"},{"categories":null,"content":"\ræƒé™ç®¡ç† æƒé™ç®¡ç†å±äºç³»ç»Ÿå®‰å…¨çš„èŒƒç•´ï¼Œå®ç° å¯¹ç”¨æˆ·è®¿é—®ç³»ç»Ÿçš„æ§åˆ¶ æŒ‰ç…§ å®‰å…¨è§„åˆ™ æˆ– å®‰å…¨ç­–ç•¥ æ§åˆ¶ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±è¢«æˆæƒçš„èµ„æº èº«ä»½è®¤è¯ï¼šåˆ¤æ–­å½“å‰è®¿é—®çš„ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®ç³»ç»Ÿçš„æƒé™ï¼ˆç”¨æˆ·åã€å£ä»¤ï¼‰ æˆæƒï¼šåˆ¤æ–­é€šè¿‡è®¤è¯çš„ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®ç³»ç»Ÿèµ„æºçš„æƒé™ï¼ˆè®¿é—®æ§åˆ¶ï¼‰ ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æƒé™ç®¡ç†"},{"categories":null,"content":"\rShiro æ˜¯ä¸€æ¬¾ Java æƒé™ç®¡ç†æ¡†æ¶ï¼Œç”± Apache å…¬å¸å¼€å‘ ç›¸æ¯” SpringSecurity æ¡†æ¶æ²¡æœ‰å…¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†ç›¸å¯¹ç®€å•ã€æ˜“ç”¨ ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-1"},{"categories":null,"content":"\rShiro æ ¸å¿ƒæ¶æ„ Security Managerï¼šå®‰å…¨ç®¡ç†å™¨ Autheniticatorï¼šè®¤è¯å™¨ Authorizerï¼šæˆæƒå™¨ Session Managerï¼šä¼šè¯ç®¡ç†å™¨ Session Daoï¼šä¼šè¯ Daoï¼ˆå¯¹ä¼šè¯æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥æŒä¹…åŒ–å’Œå†…å­˜çš„å­˜å‚¨ï¼‰ Cache Managerï¼šç¼“å­˜ç®¡ç†å™¨ï¼ˆå­˜å‚¨ç”¨æˆ·è®¤è¯æˆæƒæ•°æ®ï¼‰ Pluggable Realmsï¼šå¯æ‰©å±•çš„åŸŸï¼ˆè·å–è®¤è¯æˆæƒæ•°æ®ï¼Œå®Œæˆè®¤è¯æˆæƒæ“ä½œï¼‰ Cryptographyï¼šç®—æ³•åŒ¹é…å™¨ï¼ˆæä¾›ä¸€äº›å¸¸ç”¨ç®—æ³•ã€å·¥å…·ç±»ï¼‰ ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-æ ¸å¿ƒæ¶æ„"},{"categories":null,"content":"\rShiro è®¤è¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿçš„åˆæ³•ç”¨æˆ·ï¼Œåˆ¤æ–­ç”¨æˆ·çš„ç”¨æˆ·åå’Œå£ä»¤æ˜¯å¦å’Œç³»ç»Ÿä¸­çš„ä¸€è‡´ Shiro è®¤è¯çš„å…³é”®å¯¹è±¡ Subject ä¸»ä½“ï¼šè¿›è¡Œè®¤è¯çš„éƒ½ç§°ä¸ºä¸»ä½“ï¼ˆç”¨æˆ·ã€ç¨‹åºï¼‰ Principal èº«ä»½ä¿¡æ¯ï¼šä¸»ä½“è¿›è¡Œè®¤è¯çš„æ ‡è¯†ï¼Œè¦å…·æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥æœ‰å¤šä¸ªèº«ä»½ä½†å¿…é¡»æœ‰ä¸€ä¸ªä¸»èº«ä»½ï¼ˆç”¨æˆ·åã€ID å·ç­‰ï¼‰ Credential å‡­è¯ä¿¡æ¯ï¼šåªæœ‰ä¸»ä½“çŸ¥é“çš„å®‰å…¨ä¿¡æ¯ï¼ˆå¯†ç ã€è¯ä¹¦ï¼‰ è®¤è¯æµç¨‹ å°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯å’Œå‡­è¯ä¿¡æ¯ç”Ÿæˆ Token ä»¤ç‰Œï¼ŒéªŒè¯ Token æ˜¯å¦æ­£ç¡®ï¼Œåšå¤„ç† ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-è®¤è¯"},{"categories":null,"content":"\rShiro ä½¿ç”¨\rå¯¼å…¥ä¾èµ– \u003c!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-core --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.shiro\u003c/groupId\u003e \u003cartifactId\u003eshiro-core\u003c/artifactId\u003e \u003cversion\u003e1.9.0\u003c/version\u003e \u003c/dependency\u003e åœ¨ resources ç›®å½•ä¸‹åˆ›å»º Shiro çš„é…ç½®æ–‡ä»¶ shiro.ini [users] xiaochen:123 zhangsan:123456 lisi:789 åˆ›å»ºæµ‹è¯•ç±» public static void main(String[] args) { //åˆ›å»ºå®‰å…¨ç®¡ç†å™¨å¯¹è±¡ DefaultSecurityManager securityManager = new DefaultSecurityManager(); //ä¸ºå®‰å…¨ç®¡ç†å™¨è®¾ç½® realm securityManager.setRealm(new IniRealm(\"classpath:shiro.ini\")); //ä½¿ç”¨å®‰å…¨å·¥å…·ç±»è®¾ç½®å®‰å…¨ç®¡ç†å™¨ SecurityUtils.setSecurityManager(securityManager); //è·å¾—å½“å‰ç™»å½•çš„ä¸»ä½“å¯¹è±¡ Subject subject = SecurityUtils.getSubject(); //åˆ›å»ºç”¨æˆ·åå¯†ç çš„ä»¤ç‰Œ UsernamePasswordToken token = new UsernamePasswordToken(\"xiaochen\", \"123\"); try { //(boolean) åˆ¤æ–­æ˜¯å¦è®¤è¯æˆåŠŸ System.out.println(subject.isAuthenticated()); //ç”¨æˆ·è®¤è¯, è®¤è¯å¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ subject.login(token); System.out.println(subject.isAuthenticated()); } catch (UnknownAccountException e) { System.out.println(\"æœªçŸ¥çš„è´¦å·: ç”¨æˆ·åä¸å­˜åœ¨\"); } catch (IncorrectCredentialsException e) { System.out.println(\"æ— æ•ˆçš„å‡­è¯ä¿¡æ¯: å¯†ç é”™è¯¯\"); } } è®¤è¯æµç¨‹ï¼š è¿›å…¥ DelegatingSubject éªŒè¯æ˜¯å¦æœ‰ä¼šè¯ è°ƒç”¨å†…éƒ¨çš„ securityManager çš„ login æ–¹æ³• è¿›å…¥ ModularRealmAuthenticator çš„å†…éƒ¨éªŒè¯æ˜¯å¦é…äº† Realm éªŒè¯æ˜¯å¦æ”¯æŒ token è¿›å…¥å…¶å†…éƒ¨ä»£ç†çš„ AuthenticatingRealm ç±»çš„ doGetAuthenticationInfo æ–¹æ³•æŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ token è°ƒç”¨å­ç±» SimpleAccountRealm ç±»çš„ doGetAuthenticationInfo æ–¹æ³•å¼€å§‹æ ¡éªŒ è°ƒç”¨ getUser æ–¹æ³•é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢è´¦æˆ·ï¼ˆä¼šæŠ›å‡º UnknownAccountException è´¦æˆ·ä¸å­˜åœ¨å¼‚å¸¸ï¼‰ doGetAuthenticationInfo æ–¹æ³•ç»§ç»­éªŒè¯æ˜¯å¦é”å®šï¼ŒéªŒè¯å¯†ç æ˜¯å¦è¿‡æœŸ å›åˆ° AuthenticatingRealm ç±»çš„ assertCredentialsMatch æ–¹æ³•ä½¿ç”¨å†…éƒ¨ä»£ç†çš„ CredentialsMatch éªŒè¯å¯†ç æ˜¯å¦åŒ¹é… ç”± SimpleAccountRealm ç±»çš„ doGetAuthenticationInfo æ–¹æ³•å®Œæˆå¯¹ç”¨æˆ·åçš„æ ¡éªŒ ç”± SimpleAccountRealm çš„çˆ¶ç±» AuthenticatingReam ç±»çš„ assertCredentialsMatch æ–¹æ³•å®Œæˆå¯¹å¯†ç çš„æ ¡éªŒ ç”± SimpleAccountRealm ç±»çš„ doGetAuthorizationInfo æ–¹æ³•å®Œæˆæˆæƒ ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-ä½¿ç”¨"},{"categories":null,"content":"\rè‡ªå®šä¹‰ Realm è‡ªå®šä¹‰ Realm ç±»ç»§æ‰¿ AuthorizingRealm æˆæƒæ˜¯ æ¯æ¬¡æŸ¥è¯¢æƒé™ æ—¶è°ƒç”¨ï¼Œåœ¨æˆæƒæ–¹æ³•ä¸­æŸ¥è¯¢ç”¨æˆ·çš„æƒé™ä¿¡æ¯ è®¤è¯ä¸­çš„ç”¨æˆ·åç”±æ­¤ç±»æ¥åˆ¤æ–­ï¼Œå¯†ç ç”± SimpleAuthenticationInfo çš„çˆ¶ç±»åˆ¤æ–­ã€æŠ›å‡ºå¼‚å¸¸ public class CustomerRealm extends AuthorizingRealm { //æˆæƒ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { return null; } //è®¤è¯ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { //è·å–tokenä¸­çš„èº«ä»½ä¿¡æ¯ String principal = (String) token.getPrincipal(); //ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·åå¯†ç ä¿¡æ¯åšåˆ¤æ–­ if (\"xiaochen\".equals(principal)){ //ç”¨æˆ·å å¯†ç  å½“å‰Realmåå­— return new SimpleAuthenticationInfo(principal, \"123\", this.getName()); } return null; } } ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è‡ªå®šä¹‰-realm"},{"categories":null,"content":"\rShiro çš„åŠ å¯†ç®—æ³• MD5 ç®—æ³• MD5 ç®—æ³•ä¸å¯é€†ï¼Œä¸€ä¸ªæ˜æ–‡å¯¹åº”ä¸€ä¸ªå¯†æ–‡( 16è¿›åˆ¶ï¼Œ32ä½é•¿åº¦çš„å­—ç¬¦ä¸² ) ä¸€èˆ¬ç”¨æ¥åŠ å¯†ã€ç­¾å( æ ¡éªŒå’Œ ) MD5 åŠ ç›ï¼šå°±æ˜¯åœ¨æ˜æ–‡åŠ ä¸Šéšæœºçš„å­—ç¬¦åå†è¿›è¡ŒåŠ å¯† // æ˜æ–‡ + ç› + hashæ•£åˆ—æ¬¡æ•° Md5Hash md5Hash = new Md5Hash(\"123\", \"X*1oq\", 1024); //é»˜è®¤ç›åŠ åœ¨æ˜æ–‡å‰ System.out.println(md5Hash.toHex()); Shiro ä¸­çš„å¯†ç æ ¡éªŒæœºåˆ¶ä½¿ç”¨çš„æ˜¯ AuthenticatingReam ç±»çš„ assertCredentialsMatch æ–¹æ³•çš„åº•å±‚è°ƒç”¨çš„æ˜¯è‡ªèº«ä»£ç†çš„ CredentialsMatcher å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºè‡ªå®šä¹‰çš„ Realm ç±»æ—¶ï¼Œå¯ä»¥ä¸ºå…¶ set ä¸€ä¸ª CredentialsMatcher ï¼šHashedCredentialsMatcher è‡ªå®šä¹‰ Realm ç±» public class CustomerRealm extends AuthorizingRealm { //æˆæƒ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) { return null; } //è®¤è¯ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { //è·å–tokenä¸­çš„ç”¨æˆ·å String principal = (String) token.getPrincipal(); //ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·åå¯†ç ä¿¡æ¯åšåˆ¤æ–­ if (\"xiaochen\".equals(principal)){ //ç”¨æˆ·å return new SimpleAuthenticationInfo(principal, //åŠ saltåçš„å¯†ç  \"1846940e9a8bf8560e2311ec98a55a43\", //è´¦æˆ·å¯¹åº”çš„éšæœºç› ByteSource.Util.bytes(\"X*1oq\"), //å½“å‰Realmåå­— this.getName()); } return null; } } æµ‹è¯•ä½¿ç”¨ DefaultSecurityManager securityManager = new DefaultSecurityManager(); //åˆ›å»ºè‡ªå®šä¹‰çš„ Realm å®ä¾‹ CustomerRealm realm = new CustomerRealm(); //åˆ›å»º Shiro æä¾›çš„ CredentialsMatcher HashedCredentialsMatcher hashedCredentialsMatcher = new HashedCredentialsMatcher(); //è®¾ç½®å…¶åŠ å¯†æ–¹å¼ hashedCredentialsMatcher.setHashAlgorithmName(\"md5\"); //è®¾ç½®æ•£åˆ—æ¬¡æ•° hashedCredentialsMatcher.setHashIterations(1024); //ä¸ºè‡ªå®šä¹‰çš„ Realm è®¾ç½® CredentialsMatcher realm.setCredentialsMatcher(hashedCredentialsMatcher); securityManager.setRealm(realm); SecurityUtils.setSecurityManager(securityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken(\"xiaochen\", \"123\"); try { subject.login(token); System.out.println(\"æˆåŠŸç™»å½•\"); } catch (AuthenticationException e) { e.printStackTrace(); } ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-çš„åŠ å¯†ç®—æ³•"},{"categories":null,"content":"\rShiro æˆæƒåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿçš„åˆæ³•ç”¨æˆ·ï¼Œåˆ¤æ–­ç”¨æˆ·çš„ç”¨æˆ·åå’Œå£ä»¤æ˜¯å¦å’Œç³»ç»Ÿä¸­çš„ä¸€è‡´ Shiro æˆæƒçš„å…³é”®å¯¹è±¡ Subject ä¸»ä½“ï¼šä¸»ä½“è¦è®¿é—®çš„ç³»ç»Ÿä¸­çš„èµ„æºï¼ˆé¡µé¢ã€å›¾ç‰‡ï¼‰ Resource èµ„æºï¼šèµ„æºç±»å‹ï¼ˆå•†å“ä¿¡æ¯ï¼‰ ä¸ èµ„æºå®ä¾‹ï¼ˆç¼–å·ä¸º 001 çš„å•†å“ä¿¡æ¯ï¼‰ Permission æƒé™/è®¸å¯ï¼šä¸»ä½“å¯¹èµ„æºçš„æ“ä½œæƒé™ï¼Œé€šè¿‡æƒé™å¯çŸ¥å¯¹å“ªäº›èµ„æºæœ‰å“ªäº›æ“ä½œè®¸å¯ï¼ˆæŸ¥è¯¢æƒé™ã€ä¿®æ”¹æƒé™ï¼‰ æˆæƒæµç¨‹ ä¸ºç”¨æˆ·æˆå¯¹åº”æƒé™ï¼Œå½“ç”¨æˆ·æ“ä½œèµ„æºæ—¶ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æœ‰æƒé™ æˆæƒæ–¹å¼ï¼š åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼šRBACï¼ˆRole-Based Access Controlï¼‰ä»¥è§’è‰²ä¸ºä¸­å¿ƒè¿›è¡Œè®¿é—®æ§åˆ¶ åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼šRBACï¼ˆResource-Based Access Controlï¼‰å·²èµ„æºä¸ºä¸­å¿ƒè¿›è¡Œè®¿é—®æ§åˆ¶ æƒé™å­—ç¬¦ä¸²ï¼š èµ„æºæ ‡è¯†ç¬¦ : æ“ä½œ : èµ„æºå®ä¾‹æ ‡è¯†ç¬¦ æ„æ€æ˜¯å¯¹å“ªä¸ªèµ„æºçš„å“ªä¸ªå®ä¾‹å…·æœ‰ä»€ä¹ˆæ“ä½œ ç”¨æˆ·åˆ›å»ºï¼šuser:create ç”¨æˆ·ä¿®æ”¹å®ä¾‹ 001 çš„æƒé™ï¼šuser:update:001 ç”¨æˆ·å¯¹å®ä¾‹ 001 çš„æ‰€æœ‰æƒé™ï¼šuser:*:001 ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-æˆæƒ"},{"categories":null,"content":"\rShiro æˆæƒçš„ä½¿ç”¨ doGetAuthorizationInfo æˆæƒæ–¹æ³•åœ¨æ¯æ¬¡ æŸ¥è¯¢æƒé™ä¿¡æ¯æ—¶ è¢«è°ƒç”¨ public class CustomerRealm extends AuthorizingRealm { //æˆæƒ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { //è·å–èº«ä»½ä¿¡æ¯ String primaryPrincipal = (String) principals.getPrimaryPrincipal(); System.out.println(primaryPrincipal); //å°†æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºçš„è§’è‰²ä¿¡æ¯èµ‹ç»™æƒé™å¯¹è±¡ SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo(); simpleAuthorizationInfo.addRole(\"user\"); simpleAuthorizationInfo.addRole(\"admin\"); //å°†æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºçš„æƒé™ä¿¡æ¯èµ‹ç»™æƒé™å¯¹è±¡ simpleAuthorizationInfo.addStringPermission(\"user:*:01\"); simpleAuthorizationInfo.addStringPermission(\"order:create\"); return simpleAuthorizationInfo; } //è®¤è¯ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { return null; } } æµ‹è¯•ä½¿ç”¨ public static void main(String[] args) { DefaultSecurityManager securityManager = new DefaultSecurityManager(); //åˆ›å»ºè‡ªå®šä¹‰çš„ Realm å®ä¾‹ CustomerRealm realm = new CustomerRealm(); //åˆ›å»º Shiro æä¾›çš„ CredentialsMatcher HashedCredentialsMatcher hashedCredentialsMatcher = new HashedCredentialsMatcher(); //è®¾ç½®å…¶åŠ å¯†æ–¹å¼ hashedCredentialsMatcher.setHashAlgorithmName(\"md5\"); //è®¾ç½®æ•£åˆ—æ¬¡æ•° hashedCredentialsMatcher.setHashIterations(1024); //ä¸ºè‡ªå®šä¹‰çš„ Realm è®¾ç½® CredentialsMatcher realm.setCredentialsMatcher(hashedCredentialsMatcher); securityManager.setRealm(realm); SecurityUtils.setSecurityManager(securityManager); Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken(\"xiaochen\", \"123\"); try { subject.login(token); System.out.println(\"æˆåŠŸç™»å½•\"); } catch (AuthenticationException e) { e.printStackTrace(); } //å¦‚æœæˆåŠŸè®¤è¯ if (subject.isAuthenticated()){ //è¯¥ç”¨æˆ·æ˜¯å¦æœ‰ admin çš„æƒé™(boolean) System.out.println(subject.hasRole(\"admin\")); //è¯¥ç”¨æˆ·æ˜¯å¦åˆ†åˆ«æœ‰ åˆ—è¡¨ä¸­ çš„æƒé™(boolean[]) boolean[] booleans = subject.hasRoles(Arrays.asList(\"admin\", \"super\")); for (boolean b : booleans) { System.out.print(b+\" \"); } //è¯¥ç”¨æˆ·æ˜¯å¦æœ‰æ‰€æœ‰ åˆ—è¡¨ä¸­ çš„æƒé™(boolean) System.out.println(subject.hasAllRoles(Arrays.asList(\"admin\", \"user\"))); System.out.println(); System.out.println(\"=============================\"); //è¯¥ç”¨æˆ·æ˜¯å¦æœ‰ å­—ç¬¦ä¸² ä¸­çš„æƒé™ System.out.println(\"æ‰€æœ‰æƒé™\"+subject.isPermitted(\"user:*:*\")); System.out.println(\"åˆ›å»º01æƒé™\"+subject.isPermitted(\"user:create:01\")); //è¯¥ç”¨æˆ·åˆ†åˆ«å…·æœ‰è¿™äº›æƒé™? boolean[] permitted = subject.isPermitted(\"user:*:02\", \"order:*:02\", \"order:update:01\"); for (boolean b : permitted) { System.out.print(b+\" \"); } System.out.println(); //è¯¥ç”¨æˆ·æ˜¯å¦åŒæ—¶å…·æœ‰è¿™äº›æƒé™? System.out.println(subject.isPermittedAll(\"user:create:01\", \"order:create:02\")); } } ","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#shiro-æˆæƒçš„ä½¿ç”¨"},{"categories":null,"content":"\rå®æˆ˜è¡¥å…… Shiro æä¾›äº† ShiroFilter è¿‡æ»¤å™¨ï¼Œå®ç°å¯¹æ¯æ¬¡è¯·æ±‚çš„è®¤è¯æ“ä½œ è®¾ç½® SpringMVC åŠ Shiro çš„ä¾èµ– \u003c!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --\u003e \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e \u003cversion\u003e4.0.1\u003c/version\u003e \u003cscope\u003eprovided\u003c/scope\u003e \u003c/dependency\u003e \u003c!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-webmvc\u003c/artifactId\u003e \u003cversion\u003e5.3.18\u003c/version\u003e \u003c/dependency\u003e \u003c!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.shiro\u003c/groupId\u003e \u003cartifactId\u003eshiro-spring\u003c/artifactId\u003e \u003cversion\u003e1.9.0\u003c/version\u003e \u003c/dependency\u003e ç¼–å†™ web.xml æ–‡ä»¶å†…å®¹ \u003c!-- shiroè¿‡è™‘å™¨ï¼ŒDelegatingFilterProxyé€šè¿‡ä»£ç†æ¨¡å¼ å…³è”springå®¹å™¨ä¸­çš„beanå’Œfilter --\u003e \u003cfilter\u003e \u003cfilter-name\u003eshiroFilter\u003c/filter-name\u003e \u003cfilter-class\u003eorg.springframework.web.filter.DelegatingFilterProxy\u003c/filter-class\u003e \u003c!-- è®¾ç½®trueç”±servletå®¹å™¨æ§åˆ¶filterçš„ç”Ÿå‘½å‘¨æœŸ --\u003e \u003cinit-param\u003e \u003cparam-name\u003etargetFilterLifecycle\u003c/param-name\u003e \u003cparam-value\u003etrue\u003c/param-value\u003e \u003c/init-param\u003e \u003c!-- è®¾ç½®springå®¹å™¨filterçš„bean idï¼Œå¦‚æœä¸è®¾ç½®åˆ™æ‰¾ä¸filter-nameä¸€è‡´çš„bean--\u003e \u003c!-- \u003cinit-param\u003e--\u003e \u003c!-- \u003cparam-name\u003etargetBeanName\u003c/param-name\u003e--\u003e \u003c!-- \u003cparam-value\u003eshiroFilter\u003c/param-value\u003e--\u003e \u003c!-- \u003c/init-param\u003e--\u003e \u003c/filter\u003e \u003cfilter-mapping\u003e \u003cfilter-name\u003eshiroFilter\u003c/filter-name\u003e \u003curl-pattern\u003e/*\u003c/url-pattern\u003e \u003c/filter-mapping\u003e ç¼–å†™ Spring é…ç½®æ–‡ä»¶å†…å®¹ \u003c!-- è®¾ç½®è‡ªåŠ¨æ³¨å…¥ä¾èµ– --\u003e \u003ccontext:component-scan base-package=\"com.test\" /\u003e \u003c!-- è®¾ç½®è§†å›¾è§£æå™¨, å°†é»˜è®¤å‰ç¼€è®¾ä¸ºé¡¹ç›®æ ¹ç›®å½•, é»˜è®¤åç¼€ä¸º .html --\u003e \u003cbean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\" \u003e \u003cproperty name=\"prefix\" value=\"/\" /\u003e \u003cproperty name=\"suffix\" value=\".html\" /\u003e \u003c/bean\u003e ç¼–å†™ Shiro çš„é…ç½®ç±» @Configuration public class ShiroConfig { //1.åˆ›å»º ShiroFilter è´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ //å°† name è®¾ä¸ºä¸ web.xml ä¸­ filter-name ä¸€è‡´, è®©è¿‡æ»¤å™¨è‡ªåŠ¨æ‰¾åˆ°è¿™ä¸ª bean @Bean(name = \"shiroFilter\") public ShiroFilterFactoryBean getShiroFilterFactoryBean(DefaultWebSecurityManager defaultWebSecurityManager){ //åˆ›å»ºè¿‡æ»¤å·¥å‚å®ä¾‹, è®¾ç½®é»˜è®¤å®‰å…¨ç®¡ç†å™¨ ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean(); shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager); Map\u003cString, String\u003e map = new HashMap\u003c\u003e(); //é…ç½®ç³»ç»Ÿçš„å—é™èµ„æº: æ‰€æœ‰è¯·æ±‚ map.put(\"/index.html\", \"authc\"); // authc ä»£è¡¨èµ„æºéœ€è¦è®¤è¯å’Œæˆæƒ //é…ç½®ç³»ç»Ÿçš„å…¬å…±èµ„æº map.put(\"/user/login\", \"anon\"); shiroFilterFactoryBean.setFilterChainDefinitionMap(map); //è®¾ç½®è¢«æ‹¦æˆªæ—¶é‡å®šå‘çš„é¡µé¢ shiroFilterFactoryBean.setLoginUrl(\"/login.html\"); return shiroFilterFactoryBean; } //2.åˆ›å»ºå®‰å…¨ç®¡ç†å™¨ @Bean public DefaultWebSecurityManager getDefaultWebSecurityManager(Realm realm){ DefaultWebSecurityManager defaultWebSecurityManager = new DefaultWebSecurityManager(); defaultWebSecurityManager.setRealm(realm); return defaultWebSecurityManager; } //3.åˆ›å»ºè‡ªå®šä¹‰ Realm @Bean public Realm getRealm(){ return new CustomerRealm(); } } é…ç½® å—é™ã€å…¬å…± èµ„æºæ—¶è®¾ç½®çš„ç®€ç§°ï¼ˆShiroé»˜è®¤çš„è¿‡æ»¤å™¨ï¼‰ é…ç½®ç¼©å†™ å¯¹åº”çš„è¿‡æ»¤å™¨ åŠŸèƒ½ anon AnonymousFilter æŒ‡å®š url å¯ä»¥æœªè®¤è¯æ—¶è®¿é—® authc FormAuthenticationFilter æŒ‡å®š url éœ€è¦è®¤è¯ username password rememberMe ç­‰å‚æ•°ã€‚ä½†ä¸€èˆ¬ä¸ç”¨è¿™ä¸ªï¼Œè‡ªå®šä¹‰é€»è¾‘å¯ä»¥æ›´å¥½çš„å®šåˆ¶å‡ºé”™çš„è¿”å›ä¿¡æ¯ authcBasic BasicHttpAuthenticationFilter æŒ‡å®š url éœ€è¦ basic ç™»å½• logout LogoutFilter é…ç½®æŒ‡å®š url å³å¯, é€€å‡º, ç™»å‡ºè¿‡æ»¤å™¨ noSessionCreation NoSessionCreationFilter ç¦æ­¢åˆ›å»ºä¼šè¯ perms PermissionsAuthorizationFilter éœ€è¦æŒ‡å®šæƒé™æ‰èƒ½è®¿é—® port PortFilter éœ€è¦æŒ‡å®šç«¯å£æ‰èƒ½è®¿é—® rest HttpMethodPermissionFilter å°† http è¯·æ±‚æ–¹æ³•è½¬åŒ–æˆç›¸åº”çš„åŠ¨è¯æ¥æ„é€ ä¸€ä¸ªæƒé™å­—ç¬¦ä¸² roles RolesAuthorizationFilter éœ€è¦æŒ‡å®šè§’æ‰èƒ½è®¿é—® ssl SslFilter éœ€è¦ https è¯·æ±‚æ‰èƒ½è®¿é—® user UserFilter éœ€è¦å·²ç™»å½•æˆ– â€˜è®°ä½æˆ‘â€™ çš„ç”¨æˆ·æ‰èƒ½è®¿é—® ç¼–å†™è®¤è¯æˆæƒçš„ Realm ç±»å†…å®¹ public class CustomerRealm extends AuthorizingRealm { @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) { return null; } @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { String username = (String) token.getPrincipal(); if (\"xiaochen\".equals(username)) { return new SimpleAuthenticationInfo(username, \"123\", this.getName()); } return null; } } ç¼–å†™æ§åˆ¶å±‚å†…å®¹ @Controller @RequestMapping(\"/test\") public class MainController { //http://localhost:8080/springMVCWithShiro/test/login.do @RequestMapping(\"/","date":"2022-04-11","objectID":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:0","series":null,"tags":null,"title":"Shiroè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/shiro%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å®æˆ˜è¡¥å……"},{"categories":null,"content":"\rJava å¤šçº¿ç¨‹ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® ç¬”è®°æ‘˜è‡ª è¥¿éƒ¨å¼€æº ç§¦ç–† ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#java-å¤šçº¿ç¨‹ç¬”è®°"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#å¤šçº¿ç¨‹åŸºç¡€"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿›ç¨‹ä¸çº¿ç¨‹"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#thread-ç±»å¸¸ç”¨æ–¹æ³•"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„äº”å¤§æ­¥éª¤"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„ç›¸å…³æ–¹æ³•"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„åœæ­¢"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„é˜»å¡"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„ç¤¼è®©"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„æ’é˜Ÿ"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„ä¼˜å…ˆçº§"},{"categories":null,"content":"\rå¤šçº¿ç¨‹åŸºç¡€\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè¿›ç¨‹å°±æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿåˆ†é…çš„å•ä½ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡Œæ—¶é‡Œé¢æœ‰å¾ˆå¤šè¿›ç¨‹ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰ä¸€è‡³å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯ CPU è°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ˜¯å¤šä¸ªæ ¸å¿ƒæ¯ä¸ªæ ¸å¿ƒå¤„ç†ä¸€ä¸ªçº¿ç¨‹ Thread ç±»å¸¸ç”¨æ–¹æ³• Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ Thread.currentThread().getName() è·å–å½“å‰çº¿ç¨‹ name new Thread(t1, \"å¼ ä¸‰\") åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œä¸ºçº¿ç¨‹è®¾ç½® name Thread.sleep(200); è®¾ç½®é˜»å¡ï¼Œå•ä½ ms çº¿ç¨‹çš„äº”å¤§æ­¥éª¤ æ–°å»º å°±ç»ª è¿è¡Œ é˜»å¡ ç»ˆæ­¢ çº¿ç¨‹çš„ç›¸å…³æ–¹æ³• final void setPriority(int newPriority) æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§ static void sleep(long millis) ã€ä¼‘çœ ã€‘ void join() ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ï¼Œã€æ’é˜Ÿã€‘ static void yield() æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼Œã€ç¤¼è®©ã€‘ void interrupt() ä¸­æ–­çº¿ç¨‹ï¼ˆå‹¿ç”¨ï¼‰ boolean isAlive() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ Thread.state getState() è·å–çº¿ç¨‹çš„çŠ¶æ€ï¼ˆNEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼‰ çº¿ç¨‹çš„åœæ­¢ stop()ã€destory() å·²ç»è¢«æ ‡è¯†è¿‡æ—¶ä¸å»ºè®®ä½¿ç”¨ è®©çº¿ç¨‹è‡ªå·±åœä¸‹æ¥ã€æ¨èã€‘ è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼Œå½“å…¶å€¼ä¸º flase æ—¶ï¼Œç»ˆæ­¢å…¶å¾ªç¯ class MyThread implements Runnable{ boolean flag = true; @Override public void run() { int i = 1; while (flag){ System.out.println(i++); } } public void stop(){ this.flag = false; } } çº¿ç¨‹çš„é˜»å¡ Thread.sleep(1000ms) ã€é™æ€æ–¹æ³•ã€‘ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€æŠŠé”ï¼Œsleep ä¸ä¼šé‡Šæ”¾é” wait() åŒæ­¥é”å®šæ—¶ çº¿ç¨‹çš„ç¤¼è®© Thread.yield()ã€é™æ€æ–¹æ³•ã€‘ è®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œæš‚åœä¸€ä¸‹ cpu ä¼šé‡æ–°è°ƒåº¦çº¿ç¨‹ï¼Œä¸ä¸€å®šä¼šç¤¼è®©æˆåŠŸ çº¿ç¨‹çš„æ’é˜Ÿ t.join() è®© t çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œæ‰§è¡Œç»“æŸåå…¶ä»–çº¿ç¨‹æ‰å¯ç»§ç»­ çº¿ç¨‹çš„ä¼˜å…ˆçº§ getPriority().setPriority(5) çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”± 1 ~ 10 è¡¨ç¤ºï¼Œä¼˜å…ˆçº§è¶Šé«˜æƒé‡å°±è¶Šå¤§ï¼Œä½†è°ƒåº¦å™¨æœªå¿…å®Œå…¨æŒ‰ä¼˜å…ˆçº§æ¥æ‰§è¡Œ å®ˆæŠ¤çº¿ç¨‹ daemon çº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ JVM ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯• setDaemon(true) è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#å®ˆæŠ¤çº¿ç¨‹-daemon-çº¿ç¨‹"},{"categories":null,"content":"\rçº¿ç¨‹çš„å®ç° run æ–¹æ³•ï¼šçº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ start æ–¹æ³•ï¼šå¼€å¯çº¿ç¨‹çš„æ–¹æ³•ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”± CPU è°ƒåº¦æ‰§è¡Œ ç»§æ‰¿ Thead ç±» OOP å•ç»§æ‰¿å±€é™æ€§ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Thread ç±» class çº¿ç¨‹å¯¹è±¡ extends Thread é‡å†™ run æ–¹æ³• è°ƒç”¨å…¶ start æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Runnable æ¥å£ é¿å…å•ç»§æ‰¿çš„å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Runnable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Runnable é‡å†™ run æ–¹æ³• åˆ›å»º Thread ä»£ç†ç±»å®ä¾‹ Thread ä»£ç†å¯¹è±¡ = new Thread(çº¿ç¨‹å¯¹è±¡) è°ƒç”¨ä»£ç†ç±» srart æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Callable æ¥å£ å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Callable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Callable\u003cè¿”å›å€¼ç±»å‹\u003e é‡å†™ call æ–¹æ³•ï¼ˆéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰public Boolean call() throws Exception åˆ›å»ºçº¿ç¨‹å¯¹è±¡ åˆ›å»ºæ‰§è¡ŒæœåŠ¡ // çº¿ç¨‹æ± æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼‰ ExecutorService service = Executors.newFixedThreadPool(1); æäº¤æ‰§è¡Œ //æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ Future\u003cBoolean\u003e r = service.submit(çº¿ç¨‹å¯¹è±¡); è·å–ç»“æœ //åˆ›å»ºäº†å‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ è¿”å›å€¼ç±»å‹ res = r.get(); å…³é—­æœåŠ¡ service.shutdown(); å°é—®é¢˜ ä½¿ç”¨ Runnable å®ç°å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¯´ Thread æ˜¯ä»£ç†ç±»ï¼Ÿ å› ä¸ºæ­¤æ—¶çš„ Thread å……å½“çš„å°±æ˜¯é™æ€ä»£ç†ä¸­çš„ä»£ç†ç±» åœ¨ new Thread(çº¿ç¨‹å¯¹è±¡) åï¼ŒThread ç±»ä¼šå°†çº¿ç¨‹å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ private Runnable target; åœ¨å¯åŠ¨çº¿ç¨‹åï¼Œè°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ target.run(); å¹¶å¯¹å…¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€åŠŸèƒ½å¢å¼º ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹çš„å®ç°"},{"categories":null,"content":"\rçº¿ç¨‹çš„å®ç° run æ–¹æ³•ï¼šçº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ start æ–¹æ³•ï¼šå¼€å¯çº¿ç¨‹çš„æ–¹æ³•ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”± CPU è°ƒåº¦æ‰§è¡Œ ç»§æ‰¿ Thead ç±» OOP å•ç»§æ‰¿å±€é™æ€§ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Thread ç±» class çº¿ç¨‹å¯¹è±¡ extends Thread é‡å†™ run æ–¹æ³• è°ƒç”¨å…¶ start æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Runnable æ¥å£ é¿å…å•ç»§æ‰¿çš„å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Runnable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Runnable é‡å†™ run æ–¹æ³• åˆ›å»º Thread ä»£ç†ç±»å®ä¾‹ Thread ä»£ç†å¯¹è±¡ = new Thread(çº¿ç¨‹å¯¹è±¡) è°ƒç”¨ä»£ç†ç±» srart æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Callable æ¥å£ å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Callable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Callable\u003cè¿”å›å€¼ç±»å‹\u003e é‡å†™ call æ–¹æ³•ï¼ˆéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰public Boolean call() throws Exception åˆ›å»ºçº¿ç¨‹å¯¹è±¡ åˆ›å»ºæ‰§è¡ŒæœåŠ¡ // çº¿ç¨‹æ± æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼‰ ExecutorService service = Executors.newFixedThreadPool(1); æäº¤æ‰§è¡Œ //æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ Future r = service.submit(çº¿ç¨‹å¯¹è±¡); è·å–ç»“æœ //åˆ›å»ºäº†å‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ è¿”å›å€¼ç±»å‹ res = r.get(); å…³é—­æœåŠ¡ service.shutdown(); å°é—®é¢˜ ä½¿ç”¨ Runnable å®ç°å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¯´ Thread æ˜¯ä»£ç†ç±»ï¼Ÿ å› ä¸ºæ­¤æ—¶çš„ Thread å……å½“çš„å°±æ˜¯é™æ€ä»£ç†ä¸­çš„ä»£ç†ç±» åœ¨ new Thread(çº¿ç¨‹å¯¹è±¡) åï¼ŒThread ç±»ä¼šå°†çº¿ç¨‹å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ private Runnable target; åœ¨å¯åŠ¨çº¿ç¨‹åï¼Œè°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ target.run(); å¹¶å¯¹å…¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€åŠŸèƒ½å¢å¼º ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#ç»§æ‰¿-thead-ç±»"},{"categories":null,"content":"\rçº¿ç¨‹çš„å®ç° run æ–¹æ³•ï¼šçº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ start æ–¹æ³•ï¼šå¼€å¯çº¿ç¨‹çš„æ–¹æ³•ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”± CPU è°ƒåº¦æ‰§è¡Œ ç»§æ‰¿ Thead ç±» OOP å•ç»§æ‰¿å±€é™æ€§ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Thread ç±» class çº¿ç¨‹å¯¹è±¡ extends Thread é‡å†™ run æ–¹æ³• è°ƒç”¨å…¶ start æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Runnable æ¥å£ é¿å…å•ç»§æ‰¿çš„å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Runnable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Runnable é‡å†™ run æ–¹æ³• åˆ›å»º Thread ä»£ç†ç±»å®ä¾‹ Thread ä»£ç†å¯¹è±¡ = new Thread(çº¿ç¨‹å¯¹è±¡) è°ƒç”¨ä»£ç†ç±» srart æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Callable æ¥å£ å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Callable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Callable\u003cè¿”å›å€¼ç±»å‹\u003e é‡å†™ call æ–¹æ³•ï¼ˆéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰public Boolean call() throws Exception åˆ›å»ºçº¿ç¨‹å¯¹è±¡ åˆ›å»ºæ‰§è¡ŒæœåŠ¡ // çº¿ç¨‹æ± æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼‰ ExecutorService service = Executors.newFixedThreadPool(1); æäº¤æ‰§è¡Œ //æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ Future r = service.submit(çº¿ç¨‹å¯¹è±¡); è·å–ç»“æœ //åˆ›å»ºäº†å‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ è¿”å›å€¼ç±»å‹ res = r.get(); å…³é—­æœåŠ¡ service.shutdown(); å°é—®é¢˜ ä½¿ç”¨ Runnable å®ç°å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¯´ Thread æ˜¯ä»£ç†ç±»ï¼Ÿ å› ä¸ºæ­¤æ—¶çš„ Thread å……å½“çš„å°±æ˜¯é™æ€ä»£ç†ä¸­çš„ä»£ç†ç±» åœ¨ new Thread(çº¿ç¨‹å¯¹è±¡) åï¼ŒThread ç±»ä¼šå°†çº¿ç¨‹å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ private Runnable target; åœ¨å¯åŠ¨çº¿ç¨‹åï¼Œè°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ target.run(); å¹¶å¯¹å…¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€åŠŸèƒ½å¢å¼º ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#å®ç°-runnable-æ¥å£"},{"categories":null,"content":"\rçº¿ç¨‹çš„å®ç° run æ–¹æ³•ï¼šçº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ start æ–¹æ³•ï¼šå¼€å¯çº¿ç¨‹çš„æ–¹æ³•ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”± CPU è°ƒåº¦æ‰§è¡Œ ç»§æ‰¿ Thead ç±» OOP å•ç»§æ‰¿å±€é™æ€§ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Thread ç±» class çº¿ç¨‹å¯¹è±¡ extends Thread é‡å†™ run æ–¹æ³• è°ƒç”¨å…¶ start æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Runnable æ¥å£ é¿å…å•ç»§æ‰¿çš„å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Runnable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Runnable é‡å†™ run æ–¹æ³• åˆ›å»º Thread ä»£ç†ç±»å®ä¾‹ Thread ä»£ç†å¯¹è±¡ = new Thread(çº¿ç¨‹å¯¹è±¡) è°ƒç”¨ä»£ç†ç±» srart æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Callable æ¥å£ å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Callable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Callable\u003cè¿”å›å€¼ç±»å‹\u003e é‡å†™ call æ–¹æ³•ï¼ˆéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰public Boolean call() throws Exception åˆ›å»ºçº¿ç¨‹å¯¹è±¡ åˆ›å»ºæ‰§è¡ŒæœåŠ¡ // çº¿ç¨‹æ± æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼‰ ExecutorService service = Executors.newFixedThreadPool(1); æäº¤æ‰§è¡Œ //æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ Future r = service.submit(çº¿ç¨‹å¯¹è±¡); è·å–ç»“æœ //åˆ›å»ºäº†å‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ è¿”å›å€¼ç±»å‹ res = r.get(); å…³é—­æœåŠ¡ service.shutdown(); å°é—®é¢˜ ä½¿ç”¨ Runnable å®ç°å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¯´ Thread æ˜¯ä»£ç†ç±»ï¼Ÿ å› ä¸ºæ­¤æ—¶çš„ Thread å……å½“çš„å°±æ˜¯é™æ€ä»£ç†ä¸­çš„ä»£ç†ç±» åœ¨ new Thread(çº¿ç¨‹å¯¹è±¡) åï¼ŒThread ç±»ä¼šå°†çº¿ç¨‹å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ private Runnable target; åœ¨å¯åŠ¨çº¿ç¨‹åï¼Œè°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ target.run(); å¹¶å¯¹å…¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€åŠŸèƒ½å¢å¼º ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#å®ç°-callable-æ¥å£"},{"categories":null,"content":"\rçº¿ç¨‹çš„å®ç° run æ–¹æ³•ï¼šçº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ start æ–¹æ³•ï¼šå¼€å¯çº¿ç¨‹çš„æ–¹æ³•ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”± CPU è°ƒåº¦æ‰§è¡Œ ç»§æ‰¿ Thead ç±» OOP å•ç»§æ‰¿å±€é™æ€§ åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿ Thread ç±» class çº¿ç¨‹å¯¹è±¡ extends Thread é‡å†™ run æ–¹æ³• è°ƒç”¨å…¶ start æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Runnable æ¥å£ é¿å…å•ç»§æ‰¿çš„å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Runnable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Runnable é‡å†™ run æ–¹æ³• åˆ›å»º Thread ä»£ç†ç±»å®ä¾‹ Thread ä»£ç†å¯¹è±¡ = new Thread(çº¿ç¨‹å¯¹è±¡) è°ƒç”¨ä»£ç†ç±» srart æ–¹æ³•å¼€å¯çº¿ç¨‹ å®ç° Callable æ¥å£ å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°è¾ƒä¸ºå¤æ‚ åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç° Callable æ¥å£ class çº¿ç¨‹å¯¹è±¡ implements Callable\u003cè¿”å›å€¼ç±»å‹\u003e é‡å†™ call æ–¹æ³•ï¼ˆéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼‰public Boolean call() throws Exception åˆ›å»ºçº¿ç¨‹å¯¹è±¡ åˆ›å»ºæ‰§è¡ŒæœåŠ¡ // çº¿ç¨‹æ± æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼‰ ExecutorService service = Executors.newFixedThreadPool(1); æäº¤æ‰§è¡Œ //æƒ³è¦åˆ›å»ºå‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ Future r = service.submit(çº¿ç¨‹å¯¹è±¡); è·å–ç»“æœ //åˆ›å»ºäº†å‡ ä¸ªçº¿ç¨‹å°±å†™å¤šå°‘è¡Œ è¿”å›å€¼ç±»å‹ res = r.get(); å…³é—­æœåŠ¡ service.shutdown(); å°é—®é¢˜ ä½¿ç”¨ Runnable å®ç°å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¯´ Thread æ˜¯ä»£ç†ç±»ï¼Ÿ å› ä¸ºæ­¤æ—¶çš„ Thread å……å½“çš„å°±æ˜¯é™æ€ä»£ç†ä¸­çš„ä»£ç†ç±» åœ¨ new Thread(çº¿ç¨‹å¯¹è±¡) åï¼ŒThread ç±»ä¼šå°†çº¿ç¨‹å¯¹è±¡ä½œä¸ºå…¶æˆå‘˜å˜é‡ private Runnable target; åœ¨å¯åŠ¨çº¿ç¨‹åï¼Œè°ƒç”¨ Thread ç±»çš„ run æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ target.run(); å¹¶å¯¹å…¶è¿›è¡Œè®¿é—®æ§åˆ¶ã€åŠŸèƒ½å¢å¼º ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#å°é—®é¢˜"},{"categories":null,"content":"\rçº¿ç¨‹åŒæ­¥ çº¿ç¨‹åŒæ­¥å°±æ˜¯ä¸€ç§ç­‰å¾…æœºåˆ¶ï¼Œå¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥çº¿ç¨‹çš„ç­‰å¾…æ± å½¢æˆé˜Ÿåˆ—ï¼Œç­‰å¾…å‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåé¢çš„æ‰èƒ½æ‰§è¡Œ é”æœºåˆ¶ï¼Œä¸ºå½“å‰çº¿ç¨‹è®¾ç½®æ’å®ƒé”ï¼Œç‹¬å èµ„æº synchronized lock ä½¿ç”¨ Lock å¯¹è±¡å……å½“åŒæ­¥é”ï¼ŒLock æ¥å£çš„å®ç°ç±» ReentrantLock ã€å¯é‡å…¥é”ã€‘å¯ä»¥æ˜¾å¼çš„åŠ é”ã€é‡Šæ”¾é” æ˜¯æ˜¾å¼é”ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­é” åªæœ‰ä»£ç å—é”ï¼Œæ²¡æœ‰æ–¹æ³•é” ä½¿ç”¨ Lock é”å‡å°‘ JVM è°ƒåº¦çº¿ç¨‹çš„æ—¶é—´ï¼Œæ€§èƒ½æ›´å¥½ ä¼˜å…ˆä½¿ç”¨ï¼šLock \u003e åŒæ­¥ä»£ç å— \u003e åŒæ­¥æ–¹æ³• class MyThread1 implements Runnable { private ReentrantLock lock = new ReentrantLock(); @Override public void run() { try { lock.lock(); ... //}catch (Exception e){ }finally { lock.unlock(); } } } é”æœºåˆ¶ä¼šå­˜åœ¨çš„é—®é¢˜ï¼š å½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¦æŒ‚èµ·ç­‰å¾… å¤šçº¿ç¨‹ç«äº‰æ—¶ï¼ŒåŠ é”ã€é‡Šæ”¾é”ï¼Œä¼šå¯¼è‡´è¾ƒå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€è°ƒåº¦å»¶æ—¶ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜ å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹åœ¨ç­‰å¾…ä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ€§èƒ½å€’ç½® ä¸ºæ–¹æ³•åŠ é” é”çš„æ˜¯åŒæ­¥ç›‘è§†å™¨ ä¹Ÿå°±æ˜¯ this class Blank{ int money; synchronized void buy(){ ... } } æ·»åŠ é”æ–¹æ³•å— é”çš„åŒæ­¥ç›‘è§†å™¨æ˜¯æ‹¬å·ä¸­çš„å¯¹è±¡ thisï¼šé” this å°±æ˜¯ç»™å½“å‰è¿™ä¸ªå¯¹è±¡æ•´ä¸ªé”èµ·æ¥äº†ï¼Œç›¸ç­‰äºç»™é“¶è¡Œé”èµ·æ¥ï¼Œä½†æ˜¯äººä»¬è¿˜åœ¨é‡Œé¢å–é’± å˜é‡ï¼šé” å˜åŒ–çš„é‡ ï¼Œé”çš„æ˜¯è¿›è¡Œä¸šåŠ¡æ“ä½œçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è´¦æˆ·è¿™ä¸ªç±»è€Œä¸æ˜¯é“¶è¡Œè¿™ä¸ªç±» class Account{ ... } class Blank{ Account account; //å¦‚æœæ­¤æ—¶å°†funæ–¹æ³•ä¸Šé”ï¼Œå°±æ˜¯é”™è¯¯çš„é” fun(){ sybchronized (account) { ... } } } ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹åŒæ­¥"},{"categories":null,"content":"\ræ­»é” å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œéƒ½åœæ­¢æ‰§è¡Œçš„æƒ…å½¢ äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤º å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³» class DLTest extends Thread { static Integer a = new Integer(0); static Integer b = new Integer(1); int flag; public DLTest(int flag) { this.flag = flag; } @Override public void run() { makeup(); } private void makeup() { if (flag == 0){ synchronized (a){ System.out.println(Thread.currentThread().getName()+\" æ‹¿åˆ°äº†a\"); synchronized (b){ System.out.println(Thread.currentThread().getName()+\" æ‹¿åˆ°äº†b\"); } } }else { synchronized (b){ System.out.println(Thread.currentThread().getName()+\" æ‹¿åˆ°äº†b\"); synchronized (a){ System.out.println(Thread.currentThread().getName()+\" æ‹¿åˆ°äº†a\"); } } } } public static void main(String[] args) { DLTest dl1 = new DLTest(0); DLTest dl2 = new DLTest(1); dl1.start(); dl2.start(); } } ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹æ˜¯å¦æ­»é”ï¼š jps //æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¸‹çš„javaè¿›ç¨‹çš„pidåŠåŸºæœ¬ä¿¡æ¯ jstack è¿›ç¨‹å· //æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹ï¼ˆpidï¼‰çš„å †æ ˆä¿¡æ¯ï¼Œç”¨ä»¥åˆ†æçº¿ç¨‹æƒ…å†µ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­»é”"},{"categories":null,"content":"\rç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ å‡è®¾ä»“åº“ä¸­åªèƒ½å­˜æ”¾ä¸€ä»¶äº§å“, ç”Ÿäº§è€…å°†ç”Ÿäº§å‡ºæ¥çš„äº§å“æ”¾å…¥ä»“åº“, æ¶ˆè´¹è€…å°†ä»“åº“ä¸­äº§å“å–èµ°æ¶ˆè´¹. å¦‚æœä»“åº“ä¸­æ²¡æœ‰äº§å“, åˆ™ç”Ÿäº§è€…å°†äº§å“æ”¾å…¥ä»“åº“, å¦åˆ™åœæ­¢ç”Ÿäº§å¹¶ç­‰å¾…, ç›´åˆ°ä»“åº“ä¸­çš„äº§å“è¢«æ¶ˆè´¹è€…å–èµ°ä¸ºæ­¢. å¦‚æœä»“åº“ä¸­æ”¾æœ‰äº§å“, åˆ™æ¶ˆè´¹è€…å¯ä»¥å°†äº§å“å–èµ°æ¶ˆè´¹, å¦åˆ™åœæ­¢æ¶ˆè´¹å¹¶ç­‰å¾…, ç›´åˆ°ä»“åº“ä¸­å†æ¬¡æ”¾å…¥äº§å“ä¸ºæ­¢. åªèƒ½åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨ wait() è®©çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šçŸ¥ã€ä¼šé‡Šæ”¾é”ã€‘ notify() å”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ notityAll() å”¤é†’ä¸€ä¸ªå¯¹è±¡ä¸Šæ‰€æœ‰è°ƒç”¨ wait çš„çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"},{"categories":null,"content":"\rçº¿ç¨‹æ±  ç»å¸¸åˆ›å»ºã€é”€æ¯çº¿ç¨‹å¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§ ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥ æé«˜ç›¸åº”é€Ÿåº¦ é™ä½èµ„æºæ¶ˆè€— ä¾¿äºçº¿ç¨‹ç®¡ç† ExecutorService çº¿ç¨‹æ± æ¥å£ Executors å·¥å…·ç±»ã€å·¥å‚ç±»ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›ä¸åŒç±»å‹çš„çº¿ç¨‹æ±  import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest { public static void main(String[] args) { //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ± å¤§å°ä¸º 10 ExecutorService service = Executors.newFixedThreadPool(10); //æ‰§è¡Œ service.execute(new MyThread2()); service.execute(new MyThread2()); service.execute(new MyThread2()); service.execute(new MyThread2()); service.execute(new MyThread2()); //å…³é—­çº¿ç¨‹æ±  service.shutdown(); } } class MyThread2 implements Runnable { @Override public void run() { System.out.println(Thread.currentThread().getName()); } } Callable å°±æ˜¯ä½¿ç”¨çš„çº¿ç¨‹æ± åˆ›å»ºçš„çº¿ç¨‹ ","date":"2022-04-05","objectID":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"Javaå¤šçº¿ç¨‹å¤ä¹ ç¬”è®°mdç‰ˆ","uri":"/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹æ± "},{"categories":null,"content":"\rJUC å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® ç¬”è®°æ‘˜è‡ª å°šç¡…è°· ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#juc"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ JUC æ˜¯ java.util.concurrent å·¥å…·åŒ…çš„ç®€ç§° æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†å·¥å…·åŒ…ï¼Œä» JDK 1.5 å¼€å§‹å‡ºç° ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-juc"},{"categories":null,"content":"\rè¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šæŒ‡ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç¨‹åºä¸€æ—¦è¿è¡Œå°±æ˜¯è¿›ç¨‹ã€èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‘ çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šç³»ç»Ÿåˆ†é…å¤„ç†å™¨æ—¶é—´èµ„æºçš„åŸºæœ¬å•å…ƒï¼Œæ˜¯è¿›ç¨‹ä¹‹å†…ç‹¬ç«‹æ‰§è¡Œçš„ä¸€ä¸ªå•å…ƒæ‰§è¡Œæµã€ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ã€‘ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:1","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿›ç¨‹ä¸çº¿ç¨‹"},{"categories":null,"content":"\rè¿›ç¨‹çš„çŠ¶æ€ çº¿ç¨‹ä¸­çš„æšä¸¾ç±»ï¼šThread.state NEW æ–°å»º RUNNABLE å‡†å¤‡å°±ç»ª BLOCKED é˜»å¡ WAITING ä¸è§ä¸æ•£ï¼ˆwait() / join() æ²¡æœ‰æŒ‡å®šè¶…æ—¶å€¼æ—¶ï¼‰ TIMED_WAITING è¿‡æ—¶ä¸å€™ ï¼ˆwait() / join() æŒ‡å®šäº†è¶…æ—¶å€¼æ—¶ï¼‰ TERMINATED ç»ˆç»“ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:2","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿›ç¨‹çš„çŠ¶æ€"},{"categories":null,"content":"\rwait ä¸ sleep åŒºåˆ«ä¸åŒç‚¹ï¼š å£°æ˜çš„ä½ç½®ä¸åŒï¼šThread ç±»ä¸­å£°æ˜ sleep , Object ç±»ä¸­å£°æ˜ wait éœ€æ±‚ä¸åŒï¼šsleep å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœºæ™¯ä¸‹è°ƒç”¨ï¼Œwait å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ æ˜¯å¦é‡Šæ”¾åŒæ­¥é”ï¼šwait ä¼šé‡Šæ”¾é”ï¼Œsleep ä¸ä¼š ç»“æŸé˜»å¡çš„æ–¹å¼ï¼šwait éœ€è¦ notify / notifyAll ç»“æŸé˜»å¡ï¼Œsleep ç­‰è‡ªèº«ç»“æŸå°±å¥½ ç›¸åŒç‚¹ï¼š éƒ½ä¼šè¢« interrupted æ–¹æ³•ä¸­æ–­ éƒ½æ˜¯åœ¨å“ªé‡Œç¡å°±åœ¨å“ªé‡Œé†’ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:3","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#wait-ä¸-sleep-åŒºåˆ«"},{"categories":null,"content":"\rå¹¶å‘ä¸å¹¶è¡Œ ä¸²è¡Œï¼šå¤šä¸ªä»»åŠ¡æ’é˜Ÿæ‰§è¡Œï¼Œä¸€æ¬¡åªèƒ½å–ä¸€ä¸ªæ‰§è¡Œä¸€ä¸ª å¹¶è¡Œï¼šåŒä¸€æ—¶é—´ç‚¹ï¼Œå¯ä»¥åŒæ—¶å–å¤šä¸ªä»»åŠ¡ï¼ŒåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå¤šä¸ª CPU æ ¸å¿ƒç‹¬ç«‹åŒæ—¶æ‰§è¡Œ å¹¶å‘ï¼šåŒä¸€æ—¶é—´æ®µå†…ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯è¿™æ®µæ—¶é—´å†…çœ‹èµ·æ¥åƒæ˜¯åŒæ—¶æ‰§è¡Œçš„ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:4","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¹¶å‘ä¸å¹¶è¡Œ"},{"categories":null,"content":"\rå…¶ä»–æ¦‚å¿µ ç®¡ç¨‹ï¼šMonitor ç›‘è§†å™¨ï¼Œå°±æ˜¯é”ï¼Œé”ä½çš„å¯¹è±¡ï¼ˆæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç®¡ç¨‹å¯¹è±¡ï¼‰ é”çš„è¿›å…¥ã€é€€å‡ºå°±æ˜¯ä½¿ç”¨ç®¡ç¨‹å¯¹è±¡å®ç°çš„ å®ˆæŠ¤çº¿ç¨‹ï¼št.setDaemon(true) å°†ä¸€ä¸ªçº¿ç¨‹è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œä¸€ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸç›¸åŒ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:5","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…¶ä»–æ¦‚å¿µ"},{"categories":null,"content":"\rLock æ¥å£ ä»€ä¹ˆæ˜¯å¯é‡å…¥ï¼Ÿ å¯é‡å…¥æ€§è¡¨ç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—é”ï¼Œè€Œä¸åŒçº¿ç¨‹ä¾ç„¶ä¸å¯å¤šæ¬¡è·å¾—é”ï¼Œå€ŸåŠ© AQS åŒæ­¥å™¨æ¥å®ç° Lock ä¸ synchronized çš„åŒºåˆ« Lock ä¸æ˜¯ java è¯­è¨€å†…ç½®çš„ Lock éœ€è¦æ‰‹åŠ¨ä¸Šé”å’Œé‡Šæ”¾é” synchronized å‘ç”Ÿå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼ŒLock åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ä¸ä¼šé‡Šæ”¾é”ï¼Œéœ€è¦åœ¨ finally ä¸­é‡Šæ”¾é” Lock å¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œsynchronized ä¸è¡Œ Lock å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œsynchronized ä¸è¡Œ Lock åœ¨é”ç«äº‰æ¿€çƒˆæ—¶æ•ˆç‡è¾ƒé«˜ Lock æ¥å£çš„å®ç°ç±» ReentrantLock å¯é‡å…¥é” class MyThread{ Lock lock = new ReentrantLock(); void fun(){ lock.lock(); try{ //ä¸šåŠ¡ä»£ç  }finally{ lock.unlock(); } } } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#lock-æ¥å£"},{"categories":null,"content":"\rçº¿ç¨‹é—´é€šä¿¡ å³ ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€… çš„é—®é¢˜ ç”¨åˆ°çš„ Object æ–¹æ³• wait() åœ¨å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•å‰ï¼Œå¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ã€ä¼šé‡Šæ”¾é”ã€‘ notify() å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹ notifyAll() å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ ç”¨åˆ°çš„ Condition æ–¹æ³• ç”¨æ³•ï¼šä½¿ç”¨ Lock é”æ—¶ï¼Œç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œç­‰å¾…å’Œå”¤é†’ Lock lock = new ReentrantLock(); Condition condition = lock.newCondition(); condition.await(); condition.signal(); condition.signalAll(); await() åŒ wait() signal() åŒ notify() signalAll() åŒ notifyAll() ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¾‹å­ä¹‹ synchronized public class ShareIncrDecr { public static void main(String[] args) { Share share = new Share(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { try { //è¿™æ˜¯ç”Ÿäº§è€…çº¿ç¨‹ï¼Œè´Ÿè´£ +1 share.incr(); } catch (InterruptedException e) { e.printStackTrace(); } } }).start(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { try { //è¿™æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œè´Ÿè´£ -1 share.decr(); } catch (InterruptedException e) { e.printStackTrace(); } } }).start(); } } /** * Share ç±»å°±æ˜¯ä¸€ä¸ªå¸¦æ§åˆ¶çš„å…±äº«å¯¹è±¡ * ä»“åº“ç©ºæ—¶ï¼Œå°±å…è®¸ç”Ÿäº§è€…ç”Ÿäº§ï¼Œä¸å…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹ * ä»“åº“æ»¡æ—¶ï¼Œå°±å…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¸å…è®¸ç”Ÿäº§è€…ç”Ÿäº§ */ class Share{ private int number = 0; void incr() throws InterruptedException { synchronized(this){ if (number != 0){ //éç©ºå°±ç­‰å¾… this.wait(); } //ç”Ÿäº§ number++; System.out.println(Thread.currentThread().getName()+\" ç›®å‰ \"+number); //å”¤é†’ç­‰å¾…ç€çš„æ‰€æœ‰çº¿ç¨‹ this.notifyAll(); } } void decr() throws InterruptedException { synchronized(this){ if (number != 1){ //ä¸æ»¡å°±ç­‰å¾… this.wait(); } //æ¶ˆè´¹ number--; System.out.println(Thread.currentThread().getName()+\" ç›®å‰ \"+number); //å”¤é†’ç­‰å¾…ç€çš„æ‰€æœ‰çº¿ç¨‹ this.notifyAll(); } } } é‡åˆ°çš„é—®é¢˜ï¼š è™šå‡å”¤é†’ å°±æ˜¯å½“æœ‰å¤šä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œä¸€ä¸ªç”Ÿäº§è€…åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªç”Ÿäº§è€…æ”¹å˜äº†æ ‡è®°å€¼ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªç”Ÿäº§è€…ç»“æŸç­‰å¾…ä¹‹åæ²¡æœ‰å†æ¬¡åˆ¤æ–­æ ‡è®°å€¼ã€‚å› ä¸º wait æ–¹æ³•ä¼šé‡Šæ”¾é”ï¼Œç¬¬ä¸€ä¸ªç”Ÿäº§è€…é‡Šæ”¾äº†é”ï¼Œç¬¬äºŒä¸ªç”Ÿäº§è€…å°±æœ‰å¯èƒ½æ”¹å˜å…¶æ ‡è®°å€¼ è§£å†³ï¼šif å˜ while synchronized(this){ while (number != 1){ //wait çš„ç‰¹ç‚¹ï¼šåœ¨å“ªé‡Œç¡ï¼Œå°±åœ¨å“ªé‡Œé†’ this.wait(); } number++ / --; this.notifyAll(); } ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ notifyAll è€Œä¸æ˜¯ notify , notifyAll å²‚ä¸æ˜¯ä¼šå”¤é†’æ‰€æœ‰çº¿ç¨‹å¯¼è‡´ èµ„æºç«äº‰ é™ä½æ€§èƒ½? æ­£å› ä¸ºnotifyåªéšæœºå”¤é†’ä¸€ä¸ªé˜»å¡çº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œ+1ä¹‹åæ‰§è¡Œnotifyï¼Œè€Œå”¤é†’çš„çº¿ç¨‹ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶çš„çº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹å°±éƒ½é˜»å¡äº†ã€‚è€Œä½¿ç”¨notifyAllï¼Œä¼šå”¤é†’æ‰€æœ‰é˜»å¡çº¿ç¨‹ï¼Œåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹ç¬¦åˆæ¡ä»¶å°±å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå°±ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µäº†ã€‚ çº¿ç¨‹çš„å®šåˆ¶åŒ–é€šä¿¡ public class ShareDiy { public static void main(String[] args) { ShareResource shareResource = new ShareResource(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { try { shareResource.print5(i); } catch (InterruptedException e) { e.printStackTrace(); } } }, \"AA\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { try { shareResource.print10(i); } catch (InterruptedException e) { e.printStackTrace(); } } }, \"BB\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { try { shareResource.print15(i); } catch (InterruptedException e) { e.printStackTrace(); } } }, \"CC\").start(); } } class ShareResource{ private int flag = 1; Lock lock = new ReentrantLock(); //æ¯ä¸€ä¸ª condition å¯¹åº”äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œä¹Ÿå°±æ˜¯è®© condition ä¾æ¬¡æ‰§è¡Œ Condition c1 = lock.newCondition(); Condition c2 = lock.newCondition(); Condition c3 = lock.newCondition(); public void print5(int loop) throws InterruptedException { lock.lock(); try { while (flag != 1){ //å¦‚æœå½“å‰æŠ¢åˆ°æ‰§è¡Œçš„çº¿ç¨‹ä¸æ˜¯æŒ‡å®šçš„çº¿ç¨‹ï¼šç­‰å¾… c1.await(); } for (int i = 0; i \u003c 10; i++) { System.out.println(Thread.currentThread().getName()+\" :: \"+i+\"åœ¨è½®æ•°\"+loop); } //æŒ‡å®šä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ flag = 2; //å”¤é†’ä¸‹ä¸€çº¿ç¨‹ c2.signal(); } finally { lock.unlock(); } } public void print10(int loop) throws InterruptedException { lock.lock(); try { while (flag != 2){ //å¦‚æœå½“å‰æŠ¢åˆ°æ‰§è¡Œçš„çº¿ç¨‹ä¸æ˜¯æŒ‡å®šçš„çº¿ç¨‹ï¼šç­‰å¾… c2.await(); } for (int i = 0; i \u003c 10; i++) { System.out.println(Thread.currentThread().getName()+\" :: \"+i+\"åœ¨è½®æ•°\"+loop); } //æŒ‡å®šä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ flag = 3; //å”¤é†’ä¸‹ä¸€çº¿ç¨‹ c3.signal(); } finally { lock.unlock(); } } public void print15(int loop) throws InterruptedException { lock.lock(); try { while (flag != 3){ //å¦‚æœå½“å‰æŠ¢åˆ°æ‰§è¡Œçš„çº¿ç¨‹ä¸æ˜¯æŒ‡å®šçš„çº¿ç¨‹ï¼šç­‰å¾… c3.await(); } for (int i = 0; i \u003c 10; i++) { System.out.println(Thread.currentThread().getName()+\" :: \"+i+\"åœ¨è½®æ•°\"+loop); } //æŒ‡å®šä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ flag = 1; //å”¤é†’ä¸‹ä¸€çº¿ç¨‹ c1.signal(); } finally { lock.unlock(); } } } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#çº¿ç¨‹é—´é€šä¿¡"},{"categories":null,"content":"\ré›†åˆçš„çº¿ç¨‹å®‰å…¨ ArrayListï¼šå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ ã€è·å–å…ƒç´ æ—¶ï¼Œä¼šå‘ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸ List list = new ArrayList(); for (int i = 0; i \u003c 10000; i++) { new Thread(()-\u003e{ list.add(1); System.out.println(list); }).start(); } //Exception in thread \"Thread-xx\" java.util.ConcurrentModificationException è§£å†³æ–¹æ¡ˆ Vectorï¼šæ˜¯ List æ¥å£çš„å®ç°ç±»ï¼Œé€šè¿‡ synchronized ä¿®é¥°æ–¹æ³•å®ç°çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡è¾ƒä½ï¼ˆJDK 1.0ï¼‰ List list = new Vector(); Collectionsï¼šé€šè¿‡ Collections å·¥å…·ç±»çš„ synchronizedList æ–¹æ³•è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ listï¼Œæ•ˆç‡è¾ƒä½è¾ƒå¤è€ List list = Collections.synchronizedList(new ArrayList\u003c\u003e()); CopyOnWriteArrayListï¼šæ˜¯ JUC åŒ…ä¸­çº¿ç¨‹å®‰å…¨ list ä½¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œå°±æ˜¯åœ¨å¹¶å‘è¯»çš„æ—¶å€™å¤„ç†å†™çš„å®‰å…¨ ç‹¬ç«‹å†™ å…ˆå¤åˆ¶å‡ºä¸€ä»½æ–°é›†åˆï¼Œå‘æ–°çš„é›†åˆä¸­å†™å…¥æ•°æ®ï¼Œå†™å®Œå†è¦†ç›–åˆå¹¶åŸæœ‰å†…å®¹ï¼Œè¯»å–æ–°çš„é›†åˆç©ºé—´ä¸­çš„å†…å®¹ List list = new CopyOnWriteArrayList(); HashSetï¼šå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ ã€è·å–å…ƒç´ æ—¶ï¼Œä¼šå‘ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸ Set set = new HashSet(); for (int i = 0; i \u003c 100; i++) { new Thread(()-\u003e{ set.add(UUID.randomUUID().toString().substring(0, 4)); System.out.println(set); }).start(); } //Exception in thread \"Thread-xx\" java.util.ConcurrentModificationException è§£å†³æ–¹æ¡ˆ CopyOnWriteArraySetï¼šæ˜¯ JUC åŒ…ä¸­çº¿ç¨‹å®‰å…¨ set ä½¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œå°±æ˜¯åœ¨å¹¶å‘è¯»çš„æ—¶å€™å¤„ç†å†™çš„å®‰å…¨ ç‹¬ç«‹å†™ å…ˆå¤åˆ¶å‡ºä¸€ä»½æ–°é›†åˆï¼Œå‘æ–°çš„é›†åˆä¸­å†™å…¥æ•°æ®ï¼Œå†™å®Œå†è¦†ç›–åˆå¹¶åŸæœ‰å†…å®¹ï¼Œè¯»å–æ–°çš„é›†åˆç©ºé—´ä¸­çš„å†…å®¹ Set set = new CopyOnWriteArraySet(); HashMapï¼šå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ ã€è·å–å…ƒç´ æ—¶ï¼Œä¼šå‘ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸ Map\u003cString, String\u003e map = new HashMap\u003c\u003e(); for (int i = 0; i \u003c 100; i++) { new Thread(()-\u003e{ map.put(UUID.randomUUID().toString().substring(0, 4), \"1\"); System.out.println(map); }).start(); } //Exception in thread \"Thread-xx\" java.util.ConcurrentModificationException è§£å†³æ–¹æ¡ˆ ConcurrentHashMapï¼šæ˜¯ JUC åŒ…ä¸­çº¿ç¨‹å®‰å…¨ map Map\u003cString, String\u003e map = new ConcurrentHashMap\u003c\u003e(); ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é›†åˆçš„çº¿ç¨‹å®‰å…¨"},{"categories":null,"content":"\rå¤šçº¿ç¨‹é”","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¤šçº¿ç¨‹é”"},{"categories":null,"content":"\rsynchronized é”çš„å…«ç§æƒ…å†µ class Test{ public static void main(String[] args) throws InterruptedException { Phone phone1 = new Phone(); Phone phone2 = new Phone(); new Thread(()-\u003e{ // phone.sayHello(); phone1.sendSMS(); }).start(); Thread.sleep(100); new Thread(()-\u003e{ phone1.sendEmail(); }).start(); } } class Phone { synchronized void sendSMS() throws InterruptedException { TimeUnit.SECONDS.sleep(4); System.out.println(\"å‘é€çŸ­ä¿¡\"); } synchronized void sendEmail(){ System.out.println(\"å‘é€é‚®ä»¶\"); } void sayHello(){ System.out.println(\"ä½ å¥½\"); } } æ ‡å‡†è®¿é—®,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šæ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´æ˜¯ this å‘é€çŸ­ä¿¡ å‘é€é‚®ä»¶ åœ¨çŸ­ä¿¡æ–¹æ³•å†…åœå››ç§’,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šæ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´æ˜¯ this å‘é€çŸ­ä¿¡ å‘é€é‚®ä»¶ æ™®é€šçš„ hello æ–¹æ³•,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šhello æ–¹æ³•ä¸é”æ— å…³ï¼Œå…ˆæ‰§è¡Œ hello ä½ å¥½ å‘é€é‚®ä»¶ æœ‰ä¸¤éƒ¨æ‰‹æœº,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šä¸æ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´æ˜¯å„è‡ªçš„ this å‘é€é‚®ä»¶ å‘é€çŸ­ä¿¡ åŒä¸€éƒ¨æ‰‹æœº,éƒ½æ˜¯é™æ€åŒæ­¥æ–¹æ³•,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šæ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´æ˜¯ Class å‘é€çŸ­ä¿¡ å‘é€é‚®ä»¶ æœ‰ä¸¤éƒ¨æ‰‹æœº,éƒ½æ˜¯é™æ€åŒæ­¥æ–¹æ³•,å…ˆçŸ­ä¿¡è¿˜æ˜¯å…ˆé‚®ä»¶ï¼šæ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´æ˜¯ Class å‘é€çŸ­ä¿¡ å‘é€é‚®ä»¶ åŒä¸€éƒ¨æ‰‹æœº,çŸ­ä¿¡é™æ€åŒæ­¥ã€é‚®ä»¶åŒæ­¥ï¼šä¸æ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´ä¸åŒ å‘é€é‚®ä»¶ å‘é€çŸ­ä¿¡ æœ‰ä¸¤éƒ¨æ‰‹æœº,çŸ­ä¿¡é™æ€åŒæ­¥ã€é‚®ä»¶åŒæ­¥ï¼šä¸æ˜¯åŒä¸€æŠŠé”ï¼Œé”çš„èŒƒå›´ä¸åŒ å‘é€é‚®ä»¶ å‘é€çŸ­ä¿¡ é”çš„ä¸‰ç§è¡¨ç°å½¢å¼ï¼š å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„ Class å¯¹è±¡ å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯ Synchronized æ‹¬å·é‡Œçš„é…ç½®çš„å¯¹è±¡ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:1","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#synchronized-é”çš„å…«ç§æƒ…å†µ"},{"categories":null,"content":"\rå…¬å¹³é”ä¸éå…¬å¹³é” éå…¬å¹³é” synchronizedã€æ— å‚çš„ ReentrantLock å®¹æ˜“æœ‰çº¿ç¨‹é¥¿æ­»ï¼Œæ•ˆç‡é«˜ ä¸éœ€è¦æ’é˜Ÿï¼Œç›´æ¥æŠ¢ å…¬å¹³é” ReentrantLock(true) é˜³å…‰æ™®ç…§ï¼Œæ•ˆç‡ä½ ä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰æ’é˜Ÿé˜Ÿåˆ—ï¼Œå¦‚æœæœ‰åˆ™æ’é˜Ÿï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‰§è¡Œ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:2","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…¬å¹³é”ä¸éå…¬å¹³é”"},{"categories":null,"content":"\rå¯é‡å…¥é” å¯é‡å…¥é”ä¹Ÿç§°é€’å½’é”ï¼Œå³è¿›å…¥äº†ç¬¬ä¸€å±‚ä¹‹åå†…å±‚çš„éƒ½å¯ä»¥éšæ„è¿›å…¥ synchronized æ˜¯éšå¼çš„å¯é‡å…¥é”ï¼ŒReentrantLock æ˜¯æ˜¾å¼çš„å¯é‡å…¥é” lock é”åœ¨åµŒå¥— lock é”æ—¶ä¼šè®°å½•é”çš„ state æ•°é‡ï¼Œåœ¨åµŒå¥—ä¸­ä¸è§£é”ä¸ä¼šå½±å“è¿è¡Œï¼Œä½†ä¼šå½±å“åµŒå¥—å¤–çš„é”ä¸Šé” ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:3","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¯é‡å…¥é”"},{"categories":null,"content":"\rCallable \u0026 Future æ¥å£ Callable å®ç°æœ‰è¿”å›å€¼çš„ call æ–¹æ³• call æ–¹æ³•å¯ä»¥å¼•å‘å¼‚å¸¸ ä¸èƒ½ç›´æ¥æ›¿æ¢ Runnableï¼Œå› ä¸º Thread çš„æ„é€ æ–¹æ³•ä¸æ”¯æŒ Callable ç±»å‹ FutureTask æ˜¯ Runnable æ¥å£çš„å®ç°ç±»ï¼Œæ„é€ å™¨ä¸­å¯ä»¥ä¼ é€’ Callable ï¼Œå®ç°è®© Thread ä»£ç† FutureTask ä»£ç† Callable å®ç°ç±» æœªæ¥ä»»åŠ¡ FutureTask åŸç† å•ç‹¬å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œç­‰çº¿ç¨‹è¿è¡Œç»“æŸæ€»ç»“è¿”å›å…¶è¿”å›å€¼ ç”±äº Callable æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥ç”¨ lambda è¡¨è¾¾å¼ç®€å†™ FutureTask\u003cInteger\u003e futureTask1 = new FutureTask\u003c\u003e(()-\u003e{ return 1024; }); new Thread(futureTask1).start(); //isDone() æ–¹æ³•ï¼Œè¿”å›çº¿ç¨‹æ˜¯å¦è¿è¡Œç»“æŸæœ‰è¿”å›å€¼ while (!futureTask1.isDone()){ System.out.println(\"ç­‰å¾…çº¿ç¨‹è¿è¡Œ\"); } try { //get() ä¼šé˜»å¡çº¿ç¨‹ç›´åˆ°è¿è¡Œå®Œæ¯• System.out.println(futureTask1.get()); //æ­¤æ—¶å¤šæ¬¡ get() ä¸éœ€è¦å¤šæ¬¡æ‰§è¡Œçº¿ç¨‹, FutureTask ä¼šè®°å½•ç»“æœ } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } //çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å main çº¿ç¨‹æ‰ä¼šç»“æŸ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#callable--future-æ¥å£"},{"categories":null,"content":"\rJUC ä¸‰å¤§è¾…åŠ©ç±»","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#juc-ä¸‰å¤§è¾…åŠ©ç±»"},{"categories":null,"content":"\rå‡å°‘è®¡æ•° CountDownlatch CountDownlatch ç±»å¯ä»¥è®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ï¼Œé€šè¿‡ countDown æ–¹æ³•æ¥è¿›è¡Œ -1 æ“ä½œï¼Œå½“è®¡æ•°å™¨å€¼ä¸º 0 æ—¶å”¤é†’ await ç»§ç»­æ‰§è¡Œ await() é˜»å¡å½“å‰çº¿ç¨‹ countDown() å°†è®¡æ•°å™¨ -1 //åˆ›å»ºè®¡æ•°å™¨åŒæ—¶è®¾ç½®å€¼ CountDownLatch countDownLatch = new CountDownLatch(6); for (int i = 0; i \u003c 6; i++) { new Thread(()-\u003e { System.out.println(Thread.currentThread().getName()+\"ç¦»å¼€äº†æ•™å®¤\"); //æ¯æ¬¡æ‰§è¡Œ countDown æ–¹æ³•è®¡æ•°å™¨çš„å€¼éƒ½ -1 countDownLatch.countDown(); }, String.valueOf(i)).start(); } //é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°è®¡æ•°å™¨å€¼ä¸º 0 countDownLatch.await(); System.out.println(\"ç­é•¿å…³é—¨äº†\"); ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:1","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å‡å°‘è®¡æ•°-countdownlatch"},{"categories":null,"content":"\rå¾ªç¯æ …æ  CyclicBarrier CyclicBarrier ç±»å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°è¾¾åˆ°æŸä¸ªå…¬å…±å±éšœç‚¹ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»ä¸æ—¶åœ°ç­‰å¾… CyclicBarrier(int n, Runnable act) n: åˆ°è¾¾å±éšœç‚¹çš„æ•°ï¼Œact: æ‰§è¡Œçš„åŠŸèƒ½ await() è®©å‚ä¸è€…åœ¨æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œä¸€ç›´ç­‰å¾… //åˆ›å»ºå¾ªç¯æ …æ , æŒ‡å®šçº¿ç¨‹æ•°é‡, æ‰§è¡ŒæˆåŠŸåçš„æ“ä½œ CyclicBarrier cyclicBarrier = new CyclicBarrier(NUMBER, ()-\u003e{ System.out.println(\"ä¸ƒé¢—é¾™ç å·²ç»é›†é½, ç¥é¾™æ¥å–½\"); }); for (int i = 0; i \u003c 7; i++) { new Thread(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"é¾™ç æ”¶é›†äº†\"); try { //è®©å‚ä¸è€…ç­‰å¾…ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹è¿è¡Œç»“æŸ cyclicBarrier.await(); } catch (InterruptedException | BrokenBarrierException e) { e.printStackTrace(); } }, String.valueOf(i)).start(); } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:2","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¾ªç¯æ …æ -cyclicbarrier"},{"categories":null,"content":"\rä¿¡å·ç¯ Semaphore Semaphore ç±»ç›¸å½“ä¸€ä¸ªä¿¡å·ç¯ï¼Œæ§åˆ¶åŒä¸€æ—¶é—´é˜»å¡çš„çº¿ç¨‹çš„æ•°é‡ acquire() è·å–ä¸€ä¸ªè®¸å¯ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡ release() é‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå…¶ä»–é˜»å¡çš„çº¿ç¨‹è¢«å”¤é†’ //è®¾ç½®è®¸å¯æ•°é‡ Semaphore semaphore = new Semaphore(3); for (int i = 0; i \u003c 6; i++) { new Thread(()-\u003e{ try { //è·å¾—ä¸€ä¸ªè®¸å¯, é˜»å¡å…¶ä»–çº¿ç¨‹ semaphore.acquire(); System.out.println(Thread.currentThread().getName()+\"æŠ¢åˆ°äº†è½¦ä½\"); TimeUnit.SECONDS.sleep(new Random().nextInt(5)); System.out.println(Thread.currentThread().getName()+\"------ç¦»å¼€äº†è½¦ä½\"); } catch (InterruptedException e) { e.printStackTrace(); }finally { //é‡Šæ”¾è¿™ä¸ªè®¸å¯, å”¤é†’å…¶ä»–çº¿ç¨‹ semaphore.release(); } }).start(); } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¿¡å·ç¯-semaphore"},{"categories":null,"content":"\rReentrantReadWriteLock è¯»å†™é”","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#reentrantreadwritelock-è¯»å†™é”"},{"categories":null,"content":"\ræ‚²è§‚é”ä¸ä¹è§‚é” æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼Œå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ ä¹è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´æœ‰æ²¡æœ‰äººå»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:1","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ‚²è§‚é”ä¸ä¹è§‚é”"},{"categories":null,"content":"\rè¡¨é”ä¸è¡Œé” æ˜¯æ•°æ®åº“ä¸­çš„æ¦‚å¿µ è¡¨é”ï¼šå¯¹è¡¨ä¸­æ•°æ®æ“ä½œæ—¶ï¼Œå¯¹æ•´ä¸ªè¡¨è¿›è¡Œä¸Šé”ï¼ŒåŒä¸€æ—¶é—´åˆ«äººä¸èƒ½æ“ä½œè¿™ä¸ªè¡¨ è¡Œé”ï¼šå¯¹è¡¨ä¸­æ•°æ®æ“ä½œæ—¶ï¼Œåªå¯¹è¿™ä¸€è¡Œè¿›è¡Œä¸Šé”ï¼ŒåŒä¸€æ—¶é—´åˆ«äººè¿˜å¯ä»¥æ“ä½œè¡¨ä¸­å…¶ä»–å­—æ®µï¼ˆä¼šå¼•å‘æ­»é”ï¼‰ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¡¨é”ä¸è¡Œé”"},{"categories":null,"content":"\rå…±äº«é”ä¸ç‹¬å é” å…±äº«é”ä¸æ’å®ƒé”éƒ½æ˜¯é€šè¿‡ AQS å®ç°çš„ å…±äº«é”ï¼šå…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œï¥§èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œï¥§èƒ½ä¿®æ”¹æ•°æ® ç‹¬å é”ï¼šä¹Ÿå«æ’ä»–é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’ä»–é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ï¥§èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ® ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:3","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…±äº«é”ä¸ç‹¬å é”"},{"categories":null,"content":"\rè¯»é”ä¸å†™é” ä¸ºä½•è¦ä½¿ç”¨è¯»å†™é”ï¼Ÿ å¦‚æœæœªåŠ é”ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å†™ï¼Œå¯¼è‡´å†™è¿˜æ²¡ç»“æŸå°±å¼€å§‹è¯» //è¯»å†™é”çš„å®è´¨æ˜¯ Lock é” ReadWriteLock rwLock = new ReentrantReadWriteLock(); //ä¸ºä»£ç åŠ å†™é” rwLock.writeLock().lock(); rwLock.writeLock().unlock(); //ä¸ºä»£ç åŠ è¯»é” rwLock.readLock().lock(); rwLock.readLock().unlock(); /** * å¾—åˆ°çš„æ•ˆæœå°±æ˜¯åœ¨å†™çš„æ—¶å€™ï¼Œå†™é”ç‹¬å å†™å®Œè¿™ä¸ªå†™ä¸‹ä¸€ä¸ªï¼Œè¯»ä¹Ÿä¸èƒ½æŠ¢å é” * è¯»çš„æ—¶å€™å¯ä»¥è®©åˆ«çš„è¯»çº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†æ˜¯æ­¤æ—¶ä¸èƒ½å†™ */ è¯»é”ï¼šæ˜¯å…±äº«é”ï¼Œä¸€ä¸ªçº¿ç¨‹è¯»çš„æ—¶å€™åˆ«çš„çº¿ç¨‹ä¹Ÿå¯ä»¥è¯»ï¼Œä½†æ˜¯ä¸èƒ½å†™ ReentrantReadWriteLock ç±»çš„ ReadLock æ–¹æ³• å†™é”ï¼šæ˜¯ç‹¬å é”ï¼Œä¸€ä¸ªçº¿ç¨‹å†™çš„æ—¶å€™åˆ«çš„çº¿ç¨‹ä¸èƒ½å¯¹å…¶è¿›è¡Œä»»ä½•æ“ä½œ ReentrantReadWriteLock ç±»çš„ WriteLock æ–¹æ³• è¯»é”å†™é”éƒ½æœ‰å¯èƒ½é€ æˆæ­»é”ï¼Œå½“ä¸€çº¿ç¨‹æ”¹çš„æ—¶å€™è¦ç­‰äºŒçº¿ç¨‹è¯»ï¼Œè€Œçº¿ç¨‹æ”¹çš„æ—¶å€™è¦ç­‰ä¸€çº¿ç¨‹è¯»ï¼Œå‘ç”Ÿæ­»é” é”é™çº§ï¼š å°†å†™é”é™çº§ä¸ºè¯»é” å…ˆè·å–å†™é”ï¼Œå†è·å–è¯»é”ï¼Œé‡Šæ”¾å†™é”ï¼Œé‡Šæ”¾è¯»é” å½“çº¿ç¨‹è·å–è¯»é”çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰å…¶ä»–çº¿ç¨‹åŒæ—¶ä¹Ÿåœ¨æŒæœ‰è¯»é”ï¼Œå› æ­¤ä¸èƒ½æŠŠè·å–è¯»é”çš„çº¿ç¨‹â€œå‡çº§â€ä¸ºå†™é” è€Œå¯¹äºè·å¾—å†™é”çš„çº¿ç¨‹ï¼Œå®ƒä¸€å®šç‹¬å äº†è¯»å†™é”ï¼Œå› æ­¤å¯ä»¥ç»§ç»­è®©å®ƒè·å–è¯»é” å½“å®ƒåŒæ—¶è·å–äº†å†™é”å’Œè¯»é”åï¼Œè¿˜å¯ä»¥å…ˆé‡Šæ”¾å†™é”ç»§ç»­æŒæœ‰è¯»é”ï¼Œè¿™æ ·ä¸€ä¸ªå†™é”å°±â€œé™çº§â€ä¸ºäº†è¯»é” è¯»å†™é”çš„ç¼ºç‚¹ï¼š é€ æˆé¥¥é¥¿é”ï¼šä¸€ç›´å†™æ²¡æ³•è¯»ï¼Œä¸€ç›´è¯»æ²¡æ³•å†™ è¯»çš„åŒæ—¶ä¸å¯ä»¥å†™ï¼Œè¦ç­‰å¾…è¯»å®Œï¼Œå†™çš„åŒæ—¶å¯ä»¥è¯» ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:4","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¯»é”ä¸å†™é”"},{"categories":null,"content":"\rvolatile ä¿®é¥°ç¬¦ ç¡®ä¿å…¶ä¿®é¥°çš„å˜é‡åœ¨å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ //è®¾ç½®çº¿ç¨‹åœæ­¢çš„æ ‡å¿— private volatile boolean stop = false; //...... public void stop(){ flag = true; //è¿™é‡Œæ¨èä½¿ç”¨ interrupt å¦åˆ™ä¸ä¼šç«‹å³åœæ­¢çº¿ç¨‹ï¼Œä¼šç­‰å¾…æ­¤æ¬¡çº¿ç¨‹å®Œæˆæ‰ä¼šåœæ­¢ monitorThread.interrupt(); } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:5","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#volatile-ä¿®é¥°ç¬¦"},{"categories":null,"content":"\rBlockingQueue é˜»å¡é˜Ÿåˆ— é˜»å¡ï¼šå½“é˜Ÿåˆ—ä¸­å…ƒç´ æ»¡çš„æ—¶å€™ Thread 1 å¤„äºé˜»å¡çŠ¶æ€ï¼Œå½“é˜Ÿåˆ—ç©ºçš„æ—¶å€™ Thread 2 å¤„äºé˜»å¡çŠ¶æ€ã€‚å°±æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¼šæŒ‚èµ·çº¿ç¨‹ï¼Œä¸€æ—¦æ»¡è¶³æŸäº›æ¡ä»¶ï¼Œè¢«æŒ‚èµ·çº¿ç¨‹åˆä¼šè‡ªåŠ¨è¢«å”¤èµ· BlockingQueue é˜»å¡é˜Ÿåˆ—ä¸€æ‰‹åŒ…åŠäº†åˆé€‚çº¿ç¨‹çš„é˜»å¡ä¸å”¤é†’æ“ä½œï¼Œå®ç°ç±»ï¼š ArrayBlockingQueue æ˜¯åŸºäºæ•°ç»„çš„å®šé•¿çš„ï¼ˆæœ‰ç•Œçš„ï¼‰é˜»å¡é˜Ÿåˆ— LinkedblockingQueue æ˜¯ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°ï¼šInteger.MAX_VALUE DelayQueue æ˜¯ç”±ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆæŒ‡å®šçš„å»¶è¿Ÿåˆ°äº†æ‰èƒ½ä»ä¸­è·å–æ•°æ®ï¼‰ PrionrityBlockingQueue æ˜¯æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ— SynchronousQueue æ˜¯å•ä¸ªå…ƒç´ çš„é˜»å¡é˜Ÿåˆ— LinkedTransferQueue æ˜¯é“¾è¡¨ç»„æˆçš„æ— ç•Œçš„é˜»å¡é˜Ÿåˆ— LinkedBlockingQueue æ˜¯ç”±é“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ— æ ¸å¿ƒæ–¹æ³• é€šè¿‡å‡ ç»„ä¸åŒçš„æ–¹æ³•å®ç°ä¸åŒçš„é˜»å¡å¤„ç† æŠ›å‡ºå¼‚å¸¸ï¼ˆArrayBlockingQueue ä¸ºä¾‹ï¼‰ï¼š addï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œç»§ç»­æ·»åŠ åˆ™æŠ›å‡ºå¼‚å¸¸ï¼šjava.lang.IllegalStateException: Queue full removeï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œç»§ç»­ç§»å‡ºåˆ™æŠ›å‡ºå¼‚å¸¸ï¼šjava.util.NoSuchElementException elememtï¼šæŠ›å‡ºå¼‚å¸¸ï¼šjava.util.NoSuchElementException ç‰¹æ®Šå€¼ï¼ˆArrayBlockingQueue ä¸ºä¾‹ï¼‰ï¼š offerï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œfalse pollï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œnull peekï¼šnull é˜»å¡ï¼ˆArrayBlockingQueue ä¸ºä¾‹ï¼‰ï¼š putï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜»å¡é˜Ÿåˆ—ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ä¸ºæ»¡ takeï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œé˜»å¡é˜Ÿåˆ—ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ä¸ºç©º è¶…æ—¶ï¼ˆArrayBlockingQueue ä¸ºä¾‹ï¼‰ï¼š offerï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜»å¡é˜Ÿåˆ—ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ä¸ºæ»¡æˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´ poolï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œé˜»å¡é˜Ÿåˆ—ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´ ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#blockingqueue-é˜»å¡é˜Ÿåˆ—"},{"categories":null,"content":"\r==ThreadPool çº¿ç¨‹æ± == åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼š ç»§æ‰¿ Thread ç±» å®ç° Runnable æ¥å£ å®ç° Callable æ¥å£ ä½¿ç”¨çº¿ç¨‹æ±  ä»€ä¹ˆæ˜¯çº¿ç¨‹æ±  ä¸€ç§çº¿ç¨‹ä½¿ç”¨æ¨¡å¼ã€‚çº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œ è¿›è€Œå½±å“ç¼“å­˜å±€éƒ¨æ€§å’Œæ•´ä½“æ€§èƒ½ã€‚ è€Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…ç€ç›‘ç£ç®¡ç†è€…åˆ†é…å¯å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚ é¿å…äº†åœ¨å¤„ç†çŸ­æ—¶é—´ä»»åŠ¡æ—¶åˆ›å»ºä¸é”€æ¯çº¿ç¨‹çš„ä»£ä»·ã€‚ çº¿ç¨‹æ± ä¸ä»…èƒ½å¤Ÿä¿è¯å†…æ ¸çš„å……åˆ†åˆ©ç”¨ï¼Œè¿˜èƒ½é˜²æ­¢è¿‡åˆ†è°ƒåº¦ã€‚ çº¿ç¨‹æ± çš„ç‰¹ç‚¹ é™ä½èµ„æºæ¶ˆè€—ï¼šé€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºå¥½çš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€æ¯ æé«˜å“åº”é€Ÿåº¦ï¼šä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œå¯ä»¥ä¸éœ€è¦ç­‰å¾…å°±èƒ½ç«‹å³æ‰§è¡Œ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼šå¯ä»¥å¯¹çº¿ç¨‹ç»Ÿä¸€åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ çº¿ç¨‹æ± çš„æ¶æ„ Java ä¸­çš„çº¿ç¨‹æ± é€šè¿‡ Executor æ¡†æ¶å®ç° çº¿ç¨‹æ± çš„ä½¿ç”¨æ–¹å¼ ä¸‰å¤§å¸¸ç”¨çº¿ç¨‹æ±  åº•å±‚éƒ½æ˜¯é€šè¿‡å®ä¾‹ ThreadPoolExecutor ä¸åŒçš„æ„é€ æ–¹æ³•å®ç°çš„çº¿ç¨‹æ±  Executors.newFixedThreadPool(int æ± å¤§å°); ä¸€æ± å¤šçº¿ç¨‹ çº¿ç¨‹å®šé‡ï¼Œæ–¹ä¾¿æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘é‡ çº¿ç¨‹å¯ä»¥é‡å¤åˆ©ç”¨ï¼Œåœ¨æ˜¾å¼å…³é—­ä¹‹å‰ä¸€ç›´éƒ½åœ¨ è¶…å‡ºçš„çº¿ç¨‹è¢«æäº¤æ—¶éœ€åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… //åˆ›å»ºçº¿ç¨‹æ±  æ± çš„å¤§å°ä¸º 5 ExecutorService threadPool1 = Executors.newFixedThreadPool(5); try { //å¾ªç¯ 10 æ¬¡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹è¿è¡Œä¸¤æ¬¡ for (int i = 0; i \u003c 10; i++) { threadPool1.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ¥äº†å•Š \"); }); } } finally { //å…³é—­çº¿ç¨‹æ±  threadPool1.shutdown(); } /* pool-1-thread-3æ¥äº†å•Š pool-1-thread-4æ¥äº†å•Š pool-1-thread-5æ¥äº†å•Š pool-1-thread-2æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-2æ¥äº†å•Š pool-1-thread-5æ¥äº†å•Š pool-1-thread-4æ¥äº†å•Š pool-1-thread-3æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š Executors.newSingleThreadExecutor(); ä¸€æ± ä¸€çº¿ç¨‹ï¼Œä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ çº¿ç¨‹æ± ä¸­æœ€å¤šæ‰§è¡Œ 1 ä¸ªçº¿ç¨‹ï¼Œä¹‹åæäº¤çš„çº¿ç¨‹æ´»åŠ¨å°†ä¼šæ’åœ¨é˜Ÿåˆ—ä¸­ä»¥æ­¤æ‰§è¡Œ //åˆ›å»ºä¸€æ± ä¸€çº¿ç¨‹çš„çº¿ç¨‹æ±  ExecutorService threadPool2 = Executors.newSingleThreadExecutor(); try { //å¾ªç¯ 10 æ¬¡ï¼Œè®©è¿™ä¸ªçº¿ç¨‹è¿è¡Œ 10 æ¬¡ for (int i = 0; i \u003c 10; i++) { threadPool2.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ¥äº†å•Š \"); }); } } finally { //å…³é—­çº¿ç¨‹æ±  threadPool2.shutdown(); } /* pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š Executors.newCachedThreadPool(); é‡å¼ºåˆ™å¼ºï¼Œæ ¹æ®éœ€æ±‚åˆ›å»ºçº¿ç¨‹ï¼Œå¯æ‰©å®¹ çº¿ç¨‹æ± ä¸­æ•°é‡æ²¡æœ‰å›ºå®šï¼Œå¯è¾¾åˆ°æœ€å¤§å€¼ï¼ˆInterger. MAX_VALUEï¼‰ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯è¿›è¡Œç¼“å­˜é‡å¤åˆ©ç”¨å’Œå›æ”¶ï¼ˆå›æ”¶é»˜è®¤æ—¶é—´ä¸º 1 åˆ†é’Ÿï¼‰ å½“çº¿ç¨‹æ± ä¸­ï¼Œæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ //åˆ›å»ºä¸€æ± å¯æ‰©å®¹çš„çº¿ç¨‹æ±  ExecutorService threadPool3 = Executors.newCachedThreadPool(); try { //å¾ªç¯ 20 æ¬¡ï¼Œçº¿ç¨‹æ± è‡ªåŠ¨åˆ¤æ–­éœ€è¦çš„çº¿ç¨‹æ•° for (int i = 0; i \u003c 20; i++) { threadPool3.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ¥äº†å•Š \"); }); } } finally { //å…³é—­çº¿ç¨‹æ±  threadPool3.shutdown(); } /* pool-1-thread-2æ¥äº†å•Š pool-1-thread-6æ¥äº†å•Š pool-1-thread-7æ¥äº†å•Š pool-1-thread-3æ¥äº†å•Š pool-1-thread-9æ¥äº†å•Š pool-1-thread-5æ¥äº†å•Š pool-1-thread-10æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-8æ¥äº†å•Š pool-1-thread-12æ¥äº†å•Š pool-1-thread-4æ¥äº†å•Š pool-1-thread-13æ¥äº†å•Š pool-1-thread-11æ¥äº†å•Š pool-1-thread-5æ¥äº†å•Š pool-1-thread-1æ¥äº†å•Š pool-1-thread-12æ¥äº†å•Š pool-1-thread-8æ¥äº†å•Š pool-1-thread-4æ¥äº†å•Š pool-1-thread-11æ¥äº†å•Š pool-1-thread-13æ¥äº†å•Š çº¿ç¨‹æ± çš„ä¸ƒä¸ªå‚æ•° ä»¥ä¸Šçº¿ç¨‹æ± å®ç°ç±»çš„åº•å±‚éƒ½æ˜¯è°ƒç”¨äº† ThreadPoolExecutor ç±»çš„å®ä¾‹ï¼ŒThreadPoolExecutor ç±»çš„æ„é€ å‚æ•°æœ‰ä¸ƒä¸ª int corePoolSize å¸¸é©»çº¿ç¨‹æ•°é‡ int maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°é‡ long keepAliveTime çº¿ç¨‹å­˜æ´»æ—¶é—´ TimeUnit unit å­˜æ´»æ—¶é—´çš„å•ä½ BlockingQueue\u003cRunnable\u003e workQueue é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨è¶…å‡ºæœ€å¤§çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹ ThreadFactory threadFactory çº¿ç¨‹å·¥ç¨‹ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ RejectedExecutionHandler handler æ‹’ç»ç­–è®º çº¿ç¨‹æ± çš„åº•å±‚å·¥ä½œæµç¨‹ åœ¨çº¿ç¨‹æ± è¢«åˆ›å»ºåï¼Œçº¿ç¨‹æ± ä¸­æ— çº¿ç¨‹ åœ¨è°ƒç”¨çº¿ç¨‹æ±  execute æ–¹æ³•åï¼š å¦‚æœ corePool å¸¸é©»æ± æœªæ»¡ï¼Œåˆ™è¿›å…¥å¸¸é©»æ±  å¦‚æœ corePool å¸¸é©»æ± æ»¡äº†ï¼Œåˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾… å¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œåœ¨æœ€å¤§çº¿ç¨‹æ•°èŒƒå›´å†…ï¼Œåˆ™ä¸ºå…¶å¼€è¾Ÿæ–°çš„çº¿ç¨‹ä¼˜å…ˆå¤„ç† å¦‚æœå½“å‰çº¿ç¨‹è¿›å…¥åæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œä¼šä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ‰§è¡Œ å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ keepAliveTime æ—¶ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„å¤§å° çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œçˆ±å’‹å’‹åœ°ã€é»˜è®¤ã€‘ CallerRunsPolicyï¼šå°†ä»»åŠ¡é€€å›è‡³è°ƒç”¨è€…ï¼Œå“ªæ¥çš„å›å“ªå» DiscardOldestPolicyï¼šæŠ›å¼ƒå½“ä»£é˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œæ’µèµ°è€å¤´ DiscardPolicyï¼šä¸é”™ä»»ä½•å¤„ç†ï¼Œæ— è§†å®ƒ è‡ªå®šä¹‰çº¿ç¨‹æ±  é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¸­ä¸å…è®¸ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ±  å› ä¸ºè¿™äº›é»˜è®¤çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ä¸º Interger. MAX_VALUEï¼š2147483647 ï¼Œéå¸¸å¤§ å¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œå¯¼è‡´ OOM ExecutorService myThreadPool = new ThreadPoolExecutor( 2,//å¸¸é©»çº¿ç¨‹æ•°é‡ 5,//æœ€å¤§çº¿ç¨‹æ•°é‡ 2L,//çº¿ç¨‹å­˜æ´»æ—¶é—´ TimeUnit.SECONDS,//å­˜æ´»æ—¶é—´å•ä½ new ArrayBlockingQueue\u003c\u003e(3),//é˜»å¡é˜Ÿåˆ— Executors.defaultThreadFactory(),//çº¿ç¨‹å·¥å‚ new ThreadPoolExecutor.AbortPolicy()//æ‹’ç»ç­–ç•¥ ); try { //å¾ªç¯åˆ›å»ºæ‰§è¡Œçº¿ç¨‹ 8 æ¬¡ for (int i = 0; i \u003c 8; i++) { myThreadPool.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ¥äº†å•Š \"); }); } } finally { //å…³é—­çº¿ç¨‹æ±  myThreadPool.shutdown(); } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#threadpool-çº¿ç¨‹æ± "},{"categories":null,"content":"\rFork / Join åˆ†æ”¯åˆå¹¶æ¡†æ¶å°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡è¿›è¡Œå¹¶è¡Œå¤„ç†æœ€ç»ˆå°†å­ä»»åŠ¡ç»“æœåˆå¹¶æˆæœ€åå¤„ç†ç»“æœï¼ŒForkï¼šæ‹†åˆ†ï¼ŒJoinï¼šåˆå¹¶ ä»»åŠ¡åˆ†å‰²ï¼šFork/Join æ¡†æ¶ä¼šæŠŠå¤§çš„ä»»åŠ¡åˆ†ä¸ºè¶³å¤Ÿå°çš„å°ä»»åŠ¡ï¼Œå¦‚æœå­ä»»åŠ¡æ¯”è¾ƒå¤§è¿˜ä¼šç»§ç»­åˆ†å‰² æ‰§è¡Œä»»åŠ¡ï¼šåˆ†å‰²çš„å­ä»»åŠ¡æ”¾åˆ°åŒç«¯é˜Ÿåˆ—ä¸­ï¼Œå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»åŒç«¯é˜Ÿåˆ—ä¸­è·å–æ‰§è¡Œä»»åŠ¡ åˆå¹¶ç»“æœï¼šå­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœéƒ½æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¯»å–é˜Ÿåˆ—ä¸­çš„æ•°æ®å¹¶åˆå¹¶ /** * è®¡ç®— 1+2+3+ ... +100, å…ˆå°† 1-100 æ‹†åˆ†ä¸º 1-50 51-100 * å†å‘ä¸‹æ‹†åˆ† 1-25 26-50 51-75 76-100 ç›´è‡³æ‹†åˆ†æ’å€¼å°äº 10 * è®¡ç®—åä¾æ¬¡å‘ä¸Šåˆå¹¶æœ€ååˆå¹¶å‡º 1-100 çš„å€¼ */ public class MyTask extends RecursiveTask\u003cInteger\u003e { private static final int VALUE = 10; private int begin; private int end; private int result; public MyTask(int begin, int end) { this.begin = begin; this.end = end; } @Override protected Integer compute() { if ((end - begin) \u003c= VALUE){ for (int i = begin; i \u003c= end; i++) { result += i; } }else{ //è·å–ä¸­é—´å€¼ int middle = (begin + end) / 2; //æ‹†åˆ†å·¦è¾¹ MyTask myTask1 = new MyTask(begin, middle); myTask1.fork(); //æ‹†åˆ†å³è¾¹ MyTask myTask2 = new MyTask(middle+1, end); myTask2.fork(); //åˆå¹¶ç»“æœ result = myTask1.join() + myTask2.join(); } return result; } public static void main(String[] args) throws ExecutionException, InterruptedException { //åˆ›å»º MyTask å¯¹è±¡ MyTask myTask = new MyTask(0, 100); //åˆ›å»ºåˆ†æ”¯åˆå¹¶æ± å¯¹è±¡ ForkJoinPool forkJoinPool = new ForkJoinPool(); ForkJoinTask\u003cInteger\u003e forkJoinTask = forkJoinPool.submit(myTask); //è·å–æœ€ç»ˆåˆå¹¶ç»“æœ System.out.println(forkJoinTask.get()); //å…³é—­æ± å¯¹è±¡ forkJoinPool.shutdown(); } } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#fork--join-åˆ†æ”¯åˆå¹¶æ¡†æ¶"},{"categories":null,"content":"\rCompletableFuture å¼‚æ­¥å›è°ƒCompletableFuture ç±»å®ç° Future æ¥å£ å¼‚æ­¥ï¼šå¼‚æ­¥é€šå¸¸æ„å‘³ç€éé˜»å¡ï¼Œ å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„ä»»åŠ¡å•ç‹¬è¿è¡Œåœ¨ä¸ä¸»çº¿ç¨‹åˆ†ç¦»çš„å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”é€šè¿‡å›è°ƒå¯ ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­å¾—åˆ°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ˜¯å¦å®Œæˆï¼Œå’Œæ˜¯å¦å¼‚å¸¸ç­‰ä¿¡æ¯ æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥è°ƒç”¨ CompletableFuture\u003cVoid\u003e å½“æ³›å‹æ— è¿”å›å€¼æ—¶ï¼Œå¯ä»¥å†™ Void æ ‡è¯† runAsync() å®ç° Runnable è®¾ç½®çº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ get() è·å¾—çº¿ç¨‹æ‰§è¡Œç»“æœ //æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥è°ƒç”¨ //å®ç°ä¸€ä¸ªRunnableæ¥å£ CompletableFuture\u003cVoid\u003e completableFuture = CompletableFuture.runAsync(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ˜¯æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥é€šä¿¡\"); }); try { //è·å–å…¶æ‰§è¡Œç»“æœ completableFuture.get(); } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } æœ‰è¿”å›å€¼çš„å¼‚æ­¥è°ƒç”¨ supplyAsync() å®ç° Supplier è®¾ç½®çº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ whenComplete() å®ç° BiConsumer å¯é€šè¿‡æ–¹æ³•å½¢å‚è·å–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„è¿”å›å€¼åŠé”™è¯¯ä¿¡æ¯ get() è·å¾—çº¿ç¨‹æ‰§è¡Œç»“æœ //æœ‰è¿”å›å€¼çš„å¼‚æ­¥è°ƒç”¨ å®ç°ä¸€ä¸ªSupplieræ¥å£çš„getæ–¹æ³• CompletableFuture\u003cInteger\u003e integerCompletableFuture = CompletableFuture.supplyAsync(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ˜¯æœ‰è¿”å›å€¼çš„å¼‚æ­¥é€šä¿¡\"); //int i = 1/0; return 1024; }); // å®ç°ä¸€ä¸ªBiConsumeræ¥å£çš„acceptæ–¹æ³• integerCompletableFuture.whenComplete((t, u)-\u003e{ System.out.println(\"t = \"+t); //è¿”å›å€¼ System.out.println(\"u = \"+u); //å¼‚å¸¸ä¿¡æ¯ }); try { //è·å¾—çº¿ç¨‹æ‰§è¡Œç»“æœ integerCompletableFuture.get(); } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } ","date":"2022-04-05","objectID":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:0","series":null,"tags":null,"title":"JUCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/juc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#completablefuture-å¼‚æ­¥å›è°ƒ"},{"categories":null,"content":"\rJVM å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2022-01-21 ç¬”è®°æ‘˜è‡ªï¼šå°šç¡…è°· å®‹çº¢åº· ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm"},{"categories":null,"content":"\rJVM Javaè™šæ‹ŸæœºåŸºç¡€ JVM : Java HotSpot Virtual Machine æ˜¯ç¨‹åºè™šæ‹Ÿæœºï¼Œå°±æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒ JVM æ˜¯ Java è¯­è¨€çš„åŸºçŸ³ï¼Œè´Ÿè´£ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„ç‹¬ç«‹æ€§ï¼Œç¼–è¯‘æ–‡ä»¶çš„å°å°ºå¯¸ å¦‚æœå°† Java API æ¯”ä½œæ•°å­¦å…¬å¼çš„è¯ï¼Œé‚£ä¹ˆ JVM å°±æ˜¯å¥½æ¯”å…¬å¼çš„æ¨å¯¼è¿‡ç¨‹ åŸºç¡€çŸ¥è¯†æ‰æ˜¯ é‡ç‚¹ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-javaè™šæ‹ŸæœºåŸºç¡€"},{"categories":null,"content":"\rJVM çš„ç‰¹ç‚¹ ä¸€æ¬¡ç¼–è¯‘åˆ°å¤„è¿è¡Œ è‡ªåŠ¨å†…å­˜ç®¡ç† è‡ªåŠ¨åƒåœ¾å›æ”¶åŠŸèƒ½ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-çš„ç‰¹ç‚¹"},{"categories":null,"content":"\rJVM çš„ä½ç½®JVM æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œå®ƒä¸ç¡¬ä»¶æ²¡æœ‰ç›´æ¥çš„äº¤äº’ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-çš„ä½ç½®"},{"categories":null,"content":"\rJVM çš„æ•´ä½“ç»“æ„HotSpot è™šæ‹Ÿæœºçš„æ•´ä½“ç»“æ„ï¼šä¸‰å±‚ ç±»è£…è½½å™¨(ç±»åŠ è½½å™¨)å­ç³»ç»Ÿ å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è‡³å†…å­˜ä¸­ç”Ÿæˆ class å¯¹è±¡ åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ– è¿è¡Œæ—¶æ•°æ®åŒº æ–¹æ³•åŒºã€å †ï¼š==å¤šä¸ªçº¿ç¨‹å…±äº«çš„== è™šæ‹Ÿæœºæ ˆã€æœ¬éƒ½æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ï¼š==æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„== æ‰§è¡Œå¼•æ“ è§£é‡Šå™¨ã€JITç¼–è¯‘å™¨(åç«¯ç¼–è¯‘å™¨(å³æ—¶ç¼–è¯‘å™¨))ã€åƒåœ¾å›æ”¶å™¨ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:3","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-çš„æ•´ä½“ç»“æ„"},{"categories":null,"content":"\ræŒ‡ä»¤é›†æ¶æ„ æ ˆå¼æŒ‡ä»¤é›†æ¶æ„ï¼šJavaâ€¦ å…¥æ ˆå‡ºæ ˆå®ç°ç®€å•ï¼Œé€‚ç”¨èµ„æºå—é™çš„ç³»ç»Ÿ é›¶åœ°å€æŒ‡ä»¤ æŒ‡ä»¤é›†å°ï¼ŒæŒ‡ä»¤å¤š ä¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œè·¨å¹³å°æ€§ å¯„å­˜å™¨å¼æŒ‡ä»¤é›†æ¶æ„ï¼šAndroidâ€¦ æ€§èƒ½ä¼˜ç§€ï¼Œé«˜æ•ˆ ä¸€åœ°å€ã€äºŒåœ°å€ã€ä¸‰åœ°å€æŒ‡ä»¤ æŒ‡ä»¤é›†å¤šï¼ŒæŒ‡ä»¤å°‘ å®Œå…¨ä¾èµ–ç¡¬ä»¶ï¼Œå¯ç§»æ¤æ€§å·® ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:4","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‡ä»¤é›†æ¶æ„"},{"categories":null,"content":"\rJVM çš„ç”Ÿå‘½å‘¨æœŸ å¯åŠ¨ é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨(bootstrap class loader)åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»(initial class)æ¥å®Œæˆçš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±è™šæ‹Ÿæœºçš„å…·ä½“å®ç°æŒ‡å®šçš„ æ‰§è¡Œ åœ¨æ‰§è¡Œ Java ç¨‹åºçš„æ—¶å€™è™šæ‹Ÿæœºè¿è¡Œï¼Œç¨‹åºç»“æŸååœæ­¢ æ‰§è¡Œ Java ç¨‹åºçš„æ—¶å€™ï¼ŒçœŸæ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªå«åš Java è™šæ‹Ÿæœºçš„è¿›ç¨‹ é”€æ¯ ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ å¼‚å¸¸æˆ–é”™è¯¯è€Œç»ˆæ­¢ æ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯ è°ƒç”¨äº† exit \\ halt æ–¹æ³• ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-çš„ç”Ÿå‘½å‘¨æœŸ"},{"categories":null,"content":"\rJVM ä¸ JDK çš„åŒºåˆ« JVM ç›®çš„æ˜¯åœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„å­—èŠ‚ç ï¼Œå®ƒä»¬èƒ½ç»™å‡ºç›¸åŒçš„ç»“æœ JVM ä¸æ­¢ä¸€ç§ï¼Œåªè¦æ»¡è¶³ JVM è§„èŒƒå³å¯ï¼Œå¦‚ HotSpot VM ç­‰ åœ¨ Java SE Specifications (opens new window) ä¸Šå¯ä»¥æ‰¾åˆ°å„ä¸ªç‰ˆæœ¬çš„ JDK å¯¹åº”çš„ JVM è§„èŒƒ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:6","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-ä¸-jdk-çš„åŒºåˆ«"},{"categories":null,"content":"\rJava è¯­è¨€ ç¼–è¯‘ä¸è§£é‡Šå…±å­˜Java è¯­è¨€ä¸€æ¬¡ç¼–å†™åˆ°å¤„è¿è¡Œï¼Œç¼–å†™çš„ .java æ–‡ä»¶ç”±ç¼–è¯‘å™¨ç¼–è¯‘ä¸º JVM å¯ä»¥ç†è§£çš„å­—èŠ‚ç æ–‡ä»¶ .class åå†ç”±è§£é‡Šå™¨ \u0026 JIT è§£é‡Šæ‰§è¡Œ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:7","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#java-è¯­è¨€-ç¼–è¯‘ä¸è§£é‡Šå…±å­˜"},{"categories":null,"content":"\rOracle JDK vs OpenJDK Oriacle JDK ä¸ºé•¿æœŸç»´æŠ¤ç‰ˆæœ¬ï¼Œä¸æ˜¯å¼€æºçš„ï¼Œæ›´ä¸ºç¨³å®šï¼Œå•†ç”¨éœ€è¦ä»˜è´¹ OpenJDK å¤§æ¦‚æ¯ä¸‰ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ï¼Œå¼€æºï¼Œä¸ Oracle JDK çš„ä»£ç å‡ ä¹ç›¸åŒ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:8","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#oracle-jdk-vs-openjdk"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jvm-å‘å±•å†ç¨‹"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sun-classic-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#exact-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#hotspot-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#eba-jrockit-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ibm-j9-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#kvmcdccldc"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#azul-vm--bea-liquid-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#apache-harmony"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#microsoft-jvm--taobao-jvm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#daivik-vm"},{"categories":null,"content":"\rJVM å‘å±•å†ç¨‹å†·çŸ¥è¯†: java ä¹‹çˆ¶ è©¹å§†æ–¯é«˜æ–¯æ— ç›®å‰å°±èŒäºè°·æ­Œ SUN Classic VM ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨çš„è™šæ‹Ÿæœº HptSpotå†…ç½®æ­¤è™šæ‹Ÿæœº è™šæ‹Ÿæœºå†…éƒ¨åªæœ‰è§£é‡Šå™¨ å¯ä»¥å¤–æŒ‚ JIT å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†ä¼šæ¥ç®¡è§£é‡Šå™¨å·¥ä½œ (å¯åŠ¨æš‚åœæ—¶é—´å˜é•¿) Exact VM å‡†ç¡®å¼å†…å­˜ç®¡ç† è™šæ‹ŸæœºçŸ¥é“å†…å­˜ä¸­æŸä¸ªæ•°æ®çš„ç±»å‹ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½(é›å½¢) HotSpot VM JDK 1.3 è‡³ä»Šä¸€ç›´é»˜è®¤ä½¿ç”¨ åŠ å…¥æ–¹æ³•åŒºæ¦‚å¿µ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½: é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢ æ”¯æŒè§£é‡Šå™¨å’Œ JIT ç¼–è¯‘å™¨åŒæ—¶å·¥ä½œ EBA JRockit VM BEA å›¢é˜Ÿå¼€å‘ï¼Œåè¢« Oracle æ”¶è´­ æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVM å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå…¨é  JIT æ‹¥æœ‰å…¨é¢çš„ Java è¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ (ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯) IBM J9 VM IBM å…¬å¸å¼€å‘ï¼Œä¹Ÿç®€ç§° IT4J IBM å…¬å¸å¸¸ç”¨ KVMã€CDCã€CLDC é’ˆå¯¹äº Java ME äº§å“ KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œè€äººæœºç­‰ä½ç«¯è®¾å¤‡è¿˜åœ¨ä½¿ç”¨ Azul VM \u0026 BEA Liquid VM Azul è™šæ‹Ÿæœºè¢«ç§°ä¸ºé«˜æ€§èƒ½è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºï¼Œå¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾ G å†…å­˜â€¦ Liquid è™šæ‹Ÿæœºå¯ä»¥è¶Šè¿‡æ“ä½œç³»ç»Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶ï¼Œé«˜æ€§èƒ½â€¦ Apache Harmony æ˜¯ IBM å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVM ç”±äºå—åˆ° SUN å…¬å¸ OpenJDK çš„å‹åˆ¶ï¼Œè¢«æ”¾å¼ƒ Microsoft JVM \u0026 Taobao JVM Microsoft JVM åœ¨ WindowsXP SP3 ä¹‹å‰å­˜åœ¨äº Windows ç³»ç»Ÿä¸­ï¼Œåè¢« SUN å…¬å¸æŒ‡æ§ GGâ€¦ Taobao JVM ç”±é˜¿é‡Œå‘å¸ƒçš„ä¸€ä¸ªæ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œæ·˜å®ã€å¤©çŒ«åœ¨ç”¨ Daivik VM é‡‡ç”¨å¯„å­˜å™¨æ¶æ„ï¼Œæ‰§è¡Œçš„æ˜¯ dex æ–‡ä»¶(å¯ç”± class æ–‡ä»¶è½¬æ¢æ¥) åº”ç”¨äº Android 5.0 å‰ Graal VM å¢å¼º HotSpot è™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸º â€œä»»ä½•è¯­è¨€â€ çš„è¿è¡Œå¹³å° æ”¯æŒä¸åŒè¯­è¨€é—´æ··ç”¨æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€çš„æœ¬åœ°åº“æ–‡ä»¶ åŸç†æ˜¯å°†ä¸åŒè¯­è¨€é€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½æ¥å—çš„ä¸­é—´æ ¼å¼ï¼Œè¿˜å¯ä»¥å³æ—¶ç¼–è¯‘ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:9","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#graal-vm"},{"categories":null,"content":"\rå†…å­˜ä¸åƒåœ¾å›æ”¶HotSpot è™šæ‹Ÿæœºçš„æ•´ä½“ç»“æ„åˆ†ä¸ºä¸‰å±‚ï¼šç±»åŠ è½½å­ç³»ç»Ÿã€è¿è¡Œæ—¶æ•°æ®åŒºã€æ‰§è¡Œå¼•æ“ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å†…å­˜ä¸åƒåœ¾å›æ”¶"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨\u003cclinit\u003e()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#1-ç±»åŠ è½½å™¨å­ç³»ç»Ÿ"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#1-åŠ è½½é˜¶æ®µ-loading"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#2-é“¾æ¥é˜¶æ®µ-linking"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#3-åˆå§‹åŒ–é˜¶æ®µ-initialization"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»åŠ è½½å™¨çš„åˆ†ç±»"},{"categories":null,"content":"\r1. ç±»åŠ è½½å™¨å­ç³»ç»Ÿç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£: åŠ è½½Classæ–‡ä»¶ ç±»åŠ è½½å­ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µ 1. åŠ è½½é˜¶æ®µ Loading è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ 2. é“¾æ¥é˜¶æ®µ Linking éªŒè¯ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ å‡†å¤‡ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ è§£æ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ 3. åˆå§‹åŒ–é˜¶æ®µ Initialization æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ç±»åŠ è½½å™¨çš„åˆ†ç±»ä»ä¸Šåˆ°ä¸‹ ä¸º åŒ…å«å…³ç³» å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ==åŒäº²å§”æ´¾æœºåˆ¶==Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ æŒ‰éœ€åŠ è½½ æ–¹å¼ï¼Œé‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼ï¼šæŠŠè¯·æ±‚äº¤ç»™çˆ¶ç±»å¤„ç†ï¼Œæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå…ˆæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»æ‰§è¡Œ å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨çˆ¶ç±»ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ ç›´è‡³å¼•å¯¼ç±»åŠ è½½å™¨ å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå¦åˆ™æ‰è‡ªå·±å°è¯• åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹ï¼š é¿å…ç±»çš„é‡å¤åŠ è½½ ç¡®ä¿ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒ API è¢«éšæ„ç¯¡æ”¹ (æ²™ç®±å®‰å…¨æœºåˆ¶) æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼š æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åŒäº²å§”æ´¾æœºåˆ¶"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#2-è¿è¡Œæ—¶æ•°æ®åŒº"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç¨‹åºè®¡æ•°å™¨pcå¯„å­˜å™¨"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è™šæ‹Ÿæœºæ ˆ-java-æ ˆ"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ ˆé¡¶ç¼“å­˜åŒº"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–¹æ³•çš„è°ƒç”¨"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¤šæ€æ€§çš„å‰æ"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ ˆçš„ç›¸å…³é¢è¯•é¢˜"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœ¬åœ°æ–¹æ³•æ ˆ"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœ¬åœ°æ–¹æ³•æ¥å£"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœ¬åœ°æ–¹æ³•æ ˆ-1"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å †"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–°ç”ŸåŒº"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…»è€åŒº"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…ƒç©ºé—´"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³äº-oom"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³äº-gc"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³äº-tlab"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–¹æ³•åŒº"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å­˜å‚¨çš„å†…å®¹"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–¹æ³•åŒºçš„å¸¸è§é¢è¯•é¢˜"},{"categories":null,"content":"\r2. è¿è¡Œæ—¶æ•°æ®åŒº\ræ–¹æ³•åŒº Method Area ã€å †ç©ºé—´ Heap Area ï¼šè¿›ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆ Stack Area ã€PCå¯„å­˜å™¨ PC Register ã€æœ¬åœ°æ–¹æ³•æ ˆ Native Method Stackï¼šæ¯ä¸ªçº¿ç¨‹ç§æœ‰ ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨) ç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„ æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ ç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ˜¯ JVM è§„èŒƒä¸­å”¯ä¸€æ²¡æœ‰è§„å®šä»»ä½• GC / OOM çš„åŒºåŸŸ è™šæ‹Ÿæœºæ ˆ( Java æ ˆ) è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æ ˆä¸­å­˜å‚¨ç€æ ˆå¸§ï¼Œæ ˆå¸§å¯¹åº”ç€æ–¹æ³• ç”¨äºå­˜å‚¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å› Java æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ï¼Œæ ˆçš„ä¼˜ç‚¹â€¦ï¼Œæ ˆå­˜åœ¨ OOM æ ˆå¸§ï¼š å±€éƒ¨å˜é‡è¡¨ æ˜¯ä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° slotï¼šå˜é‡æ§½ã€‚32ä½æ•°æ®å ä¸€ä¸ª slotï¼Œ64ä½æ•°æ®å ä¸¤ä¸ª slot ( longã€double ) åœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨åç¼–è¯‘æŒ‡ä»¤ï¼šjavap -v -p HeapTest.class \u003e HeapTestClass.txt å°†è¯¦ç»†çš„ class æ–‡ä»¶åç¼–è¯‘ç»“æœè½¬å­˜åœ¨æ–‡ä»¶ä¸­ æ“ä½œæ•°æ ˆ(è¡¨è¾¾å¼æ ˆ) ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœã€è®¡ç®—è¿‡ç¨‹ä¸­çš„å˜é‡ã€è¿”å›å€¼ æ‰§è¡Œå¼•æ“æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤å‡ºå…¥æ ˆ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å¤§å° 32ä½æ•°æ®å ä¸€ä¸ªæ ˆå•ä½æ·±åº¦ï¼Œ64ä½æ•°æ®å ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦( longã€double ) åŠ¨æ€é“¾æ¥(æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨) å°† Class æ–‡ä»¶å¸¸é‡æ± ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æ–¹æ³•è¿”å›åœ°å€(æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„å®šä¹‰) å­˜å‚¨è¯¥æ–¹æ³• PC å¯„å­˜å™¨çš„å€¼ ä½œä¸ºè¿”å›åœ°å€ ä¸€äº›é™„åŠ æ¶ˆæ¯ å¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ æ ˆé¡¶ç¼“å­˜åŒº ç”±äº JVM è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯æ ˆå¼è™šæ‹Ÿæœºï¼ŒæŒ‡ä»¤é›†å°æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šçš„æŒ‡ä»¤ï¼Œå¯¹å†…å­˜çš„è¯»å†™ä¹Ÿæ›´é¢‘ç¹ HotSpot å°†æ ˆé¡¶çš„å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ æ–¹æ³•çš„è°ƒç”¨ é™æ€é“¾æ¥ åœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ—©æœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ï¼Œè¿è¡ŒæœŸä¿æŒä¸å˜ C++ ä¸­çš„ã€éè™šæ–¹æ³•ã€‘: é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³• åŠ¨æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šå…¶ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„ç»‘å®šå…³ç³»çš„ ã€æ™šæœŸç»‘å®šã€‘ç›®æ ‡æ–¹æ³•ç»“æ„åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šï¼Œåªèƒ½åœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ ä¼ å…¥ç±»å‹ ç»‘å®šç›¸å…³çš„æ–¹æ³• (å¤šæ€) C++ ä¸­çš„ã€è™šæ–¹æ³•ã€‘: ä¸æ˜¯éè™šæ–¹æ³•çš„æ–¹æ³• è™šæ–¹æ³•è¡¨ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä¸ºé¿å…æ¯æ¬¡éƒ½å»å¯»æ‰¾å¯¹åº”å¼•ç”¨ï¼Œæé«˜æ€§èƒ½ å¤šæ€æ€§çš„å‰æ ç±»çš„ç»§æ‰¿å…³ç³» æ–¹æ³•çš„é‡å†™ éè™šæ–¹æ³•ï¼šä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼Œä¸èƒ½å®ç°å¤šæ€çš„æ–¹æ³• æ ˆçš„ç›¸å…³é¢è¯•é¢˜ è°ƒæ•´æ ˆçš„å¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ï¼Ÿ ä¸èƒ½ä¿è¯ï¼Œå¯ä»¥é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ ˆçš„è‡ªåŠ¨æ‰©å±•ï¼Œä½†å½“æ•°æ®é‡è¶³å¤Ÿå¤šæ—¶ä¾æ—§æ— æ³•é¿å… StackOverflow ç”šè‡³ OOM åƒåœ¾å›æ”¶ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆå—ï¼Ÿ ä¸ä¼š æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ ä½•ä¸ºçº¿ç¨‹å®‰å…¨ å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®ä¸ºå…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒç•¥åŒæ­¥æœºåˆ¶ï¼Œåˆ™ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ åˆ†å…·ä½“æƒ…å†µ å¦‚æœå±€éƒ¨å˜é‡åªåœ¨è‡ªå·±æ–¹æ³•å†…åˆ›å»ºä½¿ç”¨å¹¶é”€æ¯ï¼Œåˆ™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœå±€éƒ¨å˜é‡æ˜¯è¢«ä¼ è¿›æ¥çš„æˆ–ä¼šå½“ä½œè¿”å›å€¼è¿”å›ï¼Œåˆ™å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ Errorï¼ˆé”™è¯¯ï¼‰ GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ ç¨‹åºè®¡æ•°å™¨ F F æœ¬åœ°æ–¹æ³•æ ˆ T F è™šæ‹Ÿæœºæ ˆ T F æ–¹æ³•åŒº T T å † T T æœ¬åœ°æ–¹æ³•æ ˆ\ræœ¬åœ°æ–¹æ³•æ¥å£ Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ï¼Œä¸ºèåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸º Java æ‰€ç”¨ ä½¿ç”¨æœ¬åœ°æ–¹æ³•å®ç° jre ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ æœ¬åœ°æ–¹æ³•æ ˆ Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ æœ¬åœ°æ–¹æ³•é€šå¸¸æ˜¯ç”± C / C++ ç¼–å†™ æœ¬åœ°æ–¹æ³•ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„å¯„å­˜å™¨ï¼Œå †å†…å­˜ï¼Œè„±ç¦»è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚å…¶ä¸å— JVM è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæœ‰åŒè™šæ‹Ÿæœºç›¸åŒçš„æƒé™ åœ¨ HotSpot JVM ä¸­ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ å † å †åŒºåœ¨ JVM å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œæ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸ JVM ä¸­ï¼Œå †åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ æ ˆä¸­å­˜æ”¾ç€å¯¹å †ä¸­çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿è¡Œç»“æŸåï¼Œå †ä¸­çš„å†…å­˜å¹¶ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œè€Œæ˜¯ç­‰å¾…åƒåœ¾å›æ”¶å™¨ JDK 8 ä¹‹åçš„å¯¹ç©ºé—´é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒºã€å…»è€åŒºã€å…ƒç©ºé—´ é»˜è®¤æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ä¸º 1 : 2 ï¼ˆå¯ä»¥é€šè¿‡ -XX:NewRatio=2 è°ƒèŠ‚ï¼‰ é»˜è®¤æ–°ç”Ÿä»£ä¸­ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…0åŒº1åŒºçš„æ¯”ä¾‹ä¸º 8 : 1 : 1ï¼ˆå¯ä»¥é€šè¿‡ -XX:SurvivorRatio=8 è°ƒèŠ‚, é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ï¼‰ æ–°ç”ŸåŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ ä¼Šç”¸å›­åŒº Eden å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨ä¼Šç”¸å›­åŒºä¸­è¢« new å‡ºæ¥çš„ ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡ï¼Œéƒ½æ˜¯åœ¨æ–°ç”Ÿä»£é”€æ¯çš„ å½“ä¼Šç”¸å›­åŒºæ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œæ­¤æ—¶åƒåœ¾å›æ”¶ GC å¼€å§‹å·¥ä½œï¼Œå°†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡é”€æ¯ï¼ˆåŒ…æ‹¬å¹¸å­˜è€…åŒºï¼‰ï¼Œå°†æœªè¢«é”€æ¯çš„å¹¸å­˜å¯¹è±¡æ”¾è‡³å¹¸å­˜è€… 0 / 1 åŒºï¼ˆæ­¤æ—¶ä¸ºç©ºçš„å¹¸å­˜è€…åŒºï¼‰ å¹¸å­˜è€…0åŒº Survivor0 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å¹¸å­˜è€…1åŒº Survivor1 å­˜æ”¾ä¼Šç”¸å›­åŒºæœªè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ æ¯æ¬¡ GC å·¥ä½œï¼Œéƒ½ä¼šå°†æœªè¾¾åˆ°é™åˆ¶çš„å¯¹è±¡å­˜æ”¾åœ¨å¦ä¸€å¹¸å­˜è€…åŒº å½“å¾ªç¯æ¬¡æ•°åˆ°è¾¾é™åˆ¶ï¼ˆ15æ¬¡ï¼‰æ—¶ï¼Œå°†å¯¹è±¡æ”¾è‡³å…»è€åŒº å…»è€åŒºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒº / å¹¸å­˜è€…åŒºï¼‰æ”¾ä¸ä¸‹çš„è¶…å¤§å¯¹è±¡ å…ƒç©ºé—´å­˜å‚¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼ˆå…ƒç©ºé—´æ—§ç§°æ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£åœ¨ JDK 1.8 ä¹‹åæ˜¯ HotSpot è™šæ‹Ÿæœºç‰¹æœ‰çš„ï¼‰ å…³äº OOM OutOfMemoryError å †ç©ºé—´æº¢å‡º å¸¸è§äºå¯¹è±¡åˆ›å»ºæ¬¡æ•°è¿‡å¤šä¸”éƒ½ä¸ä¼šè¢«å›æ”¶çš„æƒ…å†µ å…³äº GC é¢‘ç¹åœ¨æ–°ç”Ÿä»£æ”¶é›†ï¼Œå¾ˆå°‘åœ¨è€å¹´ä»£æ”¶é›†ï¼Œå‡ ä¹ä¸å†å…ƒç©ºé—´æ”¶é›† Minor GC â‰ˆ Young GC æ–°ç”Ÿä»£ï¼ˆä¼Šç”¸å›­åŒºï¼‰çš„åƒåœ¾å›æ”¶ã€STWï¼šä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ¢å¤ã€‘ Major GC â‰ˆ Old GCè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€é€Ÿåº¦æ…¢ Minor GC 10å€ä»¥ä¸Šï¼ŒSTW æ—¶é—´æ›´é•¿ã€‘ Full GC æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶ï¼ˆè€å¹´ä»£ / æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œè°ƒç”¨ System.gc( ) æ—¶å¯èƒ½è§¦å‘ï¼‰ã€å¼€å‘æ—¶å°½é‡é¿å…ã€‘ å…³äº TLAB TLABï¼šThread Local Allocation Buffer çº¿ç¨‹ç§æœ‰åˆ†é…ç¼“å†²åŒº åœ¨ä¼Šç”¸å›­åŒºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€å—ç§æœ‰çš„ç¼“å†²åŒºåä¸º TLABï¼Œä¸ Java API ä¸­ Thread Local æ²¡æœ‰å…³ç³» TLAB é»˜è®¤å ä¼Šç”¸å›­åŒºçš„ 1% å†…å­˜ JVM ä¼šä¼˜å…ˆå‘ TLAB ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´ä¸­åˆ†é…å¤±è´¥ï¼ŒJVM ä¼šå°è¯•ä½¿ç”¨åŠ é”æœºåˆ¶ä¿è¯æ•°æ®åŸå­æ€§ï¼ˆä¸ºåˆ›å»ºå¯¹è±¡æ—¶çš„åœ°å€åŠ é”ï¼‰ TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œå®ƒè¢«ç¿»è¯‘ä¸º çº¿ç¨‹ç§æœ‰åˆ†é…åŒº æ›´ä¸ºåˆç†ä¸€ç‚¹ å½“ä¸€ä¸ªTLABç”¨æ»¡ï¼ˆåˆ†é…æŒ‡é’ˆtopæ’ä¸Šåˆ†é…æé™endäº†ï¼‰ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè€Œåœ¨è€TLABé‡Œçš„å¯¹è±¡è¿˜ç•™åœ¨åŸåœ°ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡â€”â€”å®ƒä»¬æ— æ³•æ„ŸçŸ¥è‡ªå·±æ˜¯å¦æ˜¯æ›¾ç»ä»TLABåˆ†é…å‡ºæ¥çš„ï¼Œè€Œåªå…³å¿ƒè‡ªå·±æ˜¯åœ¨edené‡Œåˆ†é…çš„ã€‚ å †ç©ºé—´å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:+PrintFlagsInitial æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼ -XX:+PrintFlagsFinal æŸ¥çœ‹æ‰€æœ‰å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆä¿®æ”¹è¿‡çš„ä¸ä¼šå’Œåˆå§‹å€¼ä¸€è‡´ï¼‰ å…·ä½“æŸ¥çœ‹æŸä¸ªå‚æ•°çš„æŒ‡ä»¤ï¼š jps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹ jinfo -flag SurvivorRatio è¿›ç¨‹id -Xmn ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£çš„å†…å­˜å¤§å° -Xms ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åˆå§‹å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/64ï¼‰ -Xmx ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æœ€å¤§å¤§å°ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„ 1/4ï¼‰ åœ¨å¼€å‘æ—¶æ¨èå°†åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°è®¾ç½®ç›¸åŒçš„æ•°å€¼ï¼Œé¿å…è‡ªåŠ¨æ‰©å®¹æ—¶å¤„ç†å™¨èµ„æºæµªè´¹ -XX:NewRatio è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åœ¨å †ç»“æ„ä¸­çš„å æ¯” -XX:SurvivorRatio è®¾ç½®æ–°ç”Ÿä»£ä¸­ Eden å’Œ s0 / s1 åŒºçš„å æ¯”ï¼Œ é»˜è®¤æœ‰è‡ªé€‚åº”å†…å­˜åˆ†é…ç­–ç•¥ -XX:MaxTenuringThreshold è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„ -XX:+PrintGCDetails è¾“å‡ºè¯¦ç»†çš„ GC å¤„ç†æ—¥å¿— å †ç©ºé—´ç›¸å…³é¢è¯•é¢˜ ä¸ºä»€ä¹ˆéœ€è¦æœ‰ä¸¤å—å¹¸å­˜è€…åŒºæ¥å›å€’è…¾ï¼Ÿ å› ä¸ºè¦è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œåœ¨ Minor GC ä¹‹åå¹¸å­˜è€…åŒºä¼šå‡ºç°å†…å­˜å ç”¨ä¸è¿ç»­çš„æƒ…å†µï¼Œæœ‰å¤§å¯¹è±¡è¿›æ¥æ—¶ä¼šå‡ºç°æœ‰ç©ºé—´ä½†æ— å¤„å®‰æ”¾çš„é—®é¢˜ï¼Œæ­¤æ—¶å¦‚æœå‘å¦ä¸€å¹¸å­˜è€…åŒºè½¬ç§»å‹ç¼©ä¸€æ¬¡å³å¯è§£å†³ã€‚è¿™æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„æ€è·¯ã€å¤åˆ¶ç®—æ³•ã€‘ã€‚ å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©å˜›ï¼Ÿ ä¸æ˜¯ï¼Œ==å‡ ä¹æ‰€æœ‰==çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åˆ†é…åœ¨å †ç©ºé—´ä¸­ã€‚å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨å †ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å­˜åœ¨æ ˆä¸­ã€‚ é€ƒé€¸åˆ†æï¼šæ–¹æ³•å†…åˆ›å»ºçš„å¯¹è±¡å¦‚æœæœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ï¼Œåˆ™å‘ç”Ÿäº†é€ƒé€¸ï¼ˆ JDK 8 ä¸­ä½¿ç”¨æ ‡é‡æ›¿æ¢ä¼˜åŒ–è€Œæ¥ï¼‰ã€‚ é€ƒé€¸æ–¹æ³•ä¸ºä»£ç åšçš„ä¼˜åŒ–ï¼š æ–¹æ³•åŒº æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸ ç”¨äºå­˜å‚¨ ç±»çš„ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡å­˜å‚¨ã€å¼•ç”¨åœ¨å †ï¼‰ å’Œå †ä¸€æ ·ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­å¯ä»¥ä¸è¿ç»­ï¼Œé€»è¾‘ä¸Šè¿ç»­ åœ¨ JDK 7 æ–¹æ³•åŒºç§°ä½œä¸ºæ°¸ä¹…ä»£ï¼Œåœ¨ JDK 8 æ–¹æ³•åŒºç§°ä½œä¸ºå…ƒç©ºé—´ å…ƒç©ºé—´å’Œæ°¸ä¹…ä»£çš„åŒºåˆ«ï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¡¥å……å¯¹è±¡çš„åˆ›å»ºè¯¦æƒ…"},{"categories":null,"content":"\r3. æ‰§è¡Œå¼•æ“ åŒºåˆ«äºç‰©ç†æœºçš„æ¦‚å¿µï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶æ”¯æŒçš„æŒ‡ä»¤é›† ä¸»è¦ä»»åŠ¡æ˜¯å°†å­—èŠ‚ç è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨èƒ½å¤Ÿè¯†åˆ«çš„æŒ‡ä»¤ã€åç«¯ç¼–è¯‘ã€‘ æ‰§è¡Œå¼•æ“æ ¹æ® PC å¯„å­˜å™¨ çš„æŒ‡ä»¤åœ°å€è¿è¡Œï¼Œé€šè¿‡å±€éƒ¨å˜é‡è¡¨å¯¹åº”å †ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®å¯¹åº”åˆ°æ–¹æ³•åŒºçš„ç±»å‹ä¿¡æ¯ å‰ç«¯ç¼–è¯‘åŸç†å›¾ï¼š åç«¯ç¼–è¯‘åŸç†å›¾ï¼š è§£é‡Šå™¨ å¯¹å­—èŠ‚ç  é€è¡Œè§£é‡Š é€æ¡æ‰§è¡Œ ä¼˜ç‚¹ï¼šä¸Šæ¥å¯ä»¥ç›´æ¥è§£é‡Šæ‰§è¡Œï¼Œå“åº”é€Ÿåº¦å¿« ç¼ºç‚¹ï¼šè¾ƒä¸ºä½æ•ˆ JIT å³æ—¶ç¼–è¯‘å™¨ å°†æºä»£ç ç›´æ¥å…¨éƒ¨ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€ ç¼ºç‚¹ï¼šå“åº”æ—¶é—´è¾ƒé•¿ ä¼˜ç‚¹ï¼šä½¿ç”¨çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ ç¼“å­˜çƒ­ç‚¹ä»£ç ä¸å¿…é‡å¤ç¼–è¯‘ï¼Œæ•ˆç‡é«˜é€Ÿåº¦å¿« HotSpot çš„ C1 C2 ç¼–è¯‘å™¨ çƒ­ç‚¹ä»£ç  ä¸€æ®µæ—¶é—´å†…è¢«è°ƒç”¨æ¬¡æ•°è¾ƒå¤šçš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“ã€æ ˆä¸Šæ›¿æ¢ ï¼ˆOSRç¼–è¯‘ï¼‰ã€‘ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼šåŸºäºè®¡æ•°å™¨çƒ­ç‚¹æ¢æµ‹ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼šç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„æ¬¡æ•° å›è¾¹è®¡æ•°å™¨ï¼šç»Ÿè®¡å¾ªç¯ä½“å¾ªç¯æ¬¡æ•° çƒ­åº¦è¡°å‡ï¼šæ¯ç»å†ä¸€ä¸ª åŠè¡°å‘¨æœŸ è°ƒç”¨çš„è®¡æ•°å™¨ä¸­çš„å€¼éƒ½ä¼š è¡°å‡ ä¸€åŠ ç¼–è¯‘å™¨å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:CompileThreshold è®¾ç½®çƒ­ç‚¹ä»£ç çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•° -XX:-UseCounterDecay å…³é—­çƒ­åº¦è¡°å‡ -XX:CounterHalfLifeTime è°ƒæ•´åŠè¡°æœŸæ—¶é—´ï¼ˆç§’ï¼‰ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:3","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#3-æ‰§è¡Œå¼•æ“"},{"categories":null,"content":"\r3. æ‰§è¡Œå¼•æ“ åŒºåˆ«äºç‰©ç†æœºçš„æ¦‚å¿µï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶æ”¯æŒçš„æŒ‡ä»¤é›† ä¸»è¦ä»»åŠ¡æ˜¯å°†å­—èŠ‚ç è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨èƒ½å¤Ÿè¯†åˆ«çš„æŒ‡ä»¤ã€åç«¯ç¼–è¯‘ã€‘ æ‰§è¡Œå¼•æ“æ ¹æ® PC å¯„å­˜å™¨ çš„æŒ‡ä»¤åœ°å€è¿è¡Œï¼Œé€šè¿‡å±€éƒ¨å˜é‡è¡¨å¯¹åº”å †ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®å¯¹åº”åˆ°æ–¹æ³•åŒºçš„ç±»å‹ä¿¡æ¯ å‰ç«¯ç¼–è¯‘åŸç†å›¾ï¼š åç«¯ç¼–è¯‘åŸç†å›¾ï¼š è§£é‡Šå™¨ å¯¹å­—èŠ‚ç  é€è¡Œè§£é‡Š é€æ¡æ‰§è¡Œ ä¼˜ç‚¹ï¼šä¸Šæ¥å¯ä»¥ç›´æ¥è§£é‡Šæ‰§è¡Œï¼Œå“åº”é€Ÿåº¦å¿« ç¼ºç‚¹ï¼šè¾ƒä¸ºä½æ•ˆ JIT å³æ—¶ç¼–è¯‘å™¨ å°†æºä»£ç ç›´æ¥å…¨éƒ¨ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€ ç¼ºç‚¹ï¼šå“åº”æ—¶é—´è¾ƒé•¿ ä¼˜ç‚¹ï¼šä½¿ç”¨çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ ç¼“å­˜çƒ­ç‚¹ä»£ç ä¸å¿…é‡å¤ç¼–è¯‘ï¼Œæ•ˆç‡é«˜é€Ÿåº¦å¿« HotSpot çš„ C1 C2 ç¼–è¯‘å™¨ çƒ­ç‚¹ä»£ç  ä¸€æ®µæ—¶é—´å†…è¢«è°ƒç”¨æ¬¡æ•°è¾ƒå¤šçš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“ã€æ ˆä¸Šæ›¿æ¢ ï¼ˆOSRç¼–è¯‘ï¼‰ã€‘ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼šåŸºäºè®¡æ•°å™¨çƒ­ç‚¹æ¢æµ‹ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼šç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„æ¬¡æ•° å›è¾¹è®¡æ•°å™¨ï¼šç»Ÿè®¡å¾ªç¯ä½“å¾ªç¯æ¬¡æ•° çƒ­åº¦è¡°å‡ï¼šæ¯ç»å†ä¸€ä¸ª åŠè¡°å‘¨æœŸ è°ƒç”¨çš„è®¡æ•°å™¨ä¸­çš„å€¼éƒ½ä¼š è¡°å‡ ä¸€åŠ ç¼–è¯‘å™¨å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:CompileThreshold è®¾ç½®çƒ­ç‚¹ä»£ç çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•° -XX:-UseCounterDecay å…³é—­çƒ­åº¦è¡°å‡ -XX:CounterHalfLifeTime è°ƒæ•´åŠè¡°æœŸæ—¶é—´ï¼ˆç§’ï¼‰ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:3","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è§£é‡Šå™¨"},{"categories":null,"content":"\r3. æ‰§è¡Œå¼•æ“ åŒºåˆ«äºç‰©ç†æœºçš„æ¦‚å¿µï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶æ”¯æŒçš„æŒ‡ä»¤é›† ä¸»è¦ä»»åŠ¡æ˜¯å°†å­—èŠ‚ç è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨èƒ½å¤Ÿè¯†åˆ«çš„æŒ‡ä»¤ã€åç«¯ç¼–è¯‘ã€‘ æ‰§è¡Œå¼•æ“æ ¹æ® PC å¯„å­˜å™¨ çš„æŒ‡ä»¤åœ°å€è¿è¡Œï¼Œé€šè¿‡å±€éƒ¨å˜é‡è¡¨å¯¹åº”å †ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®å¯¹åº”åˆ°æ–¹æ³•åŒºçš„ç±»å‹ä¿¡æ¯ å‰ç«¯ç¼–è¯‘åŸç†å›¾ï¼š åç«¯ç¼–è¯‘åŸç†å›¾ï¼š è§£é‡Šå™¨ å¯¹å­—èŠ‚ç  é€è¡Œè§£é‡Š é€æ¡æ‰§è¡Œ ä¼˜ç‚¹ï¼šä¸Šæ¥å¯ä»¥ç›´æ¥è§£é‡Šæ‰§è¡Œï¼Œå“åº”é€Ÿåº¦å¿« ç¼ºç‚¹ï¼šè¾ƒä¸ºä½æ•ˆ JIT å³æ—¶ç¼–è¯‘å™¨ å°†æºä»£ç ç›´æ¥å…¨éƒ¨ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€ ç¼ºç‚¹ï¼šå“åº”æ—¶é—´è¾ƒé•¿ ä¼˜ç‚¹ï¼šä½¿ç”¨çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ ç¼“å­˜çƒ­ç‚¹ä»£ç ä¸å¿…é‡å¤ç¼–è¯‘ï¼Œæ•ˆç‡é«˜é€Ÿåº¦å¿« HotSpot çš„ C1 C2 ç¼–è¯‘å™¨ çƒ­ç‚¹ä»£ç  ä¸€æ®µæ—¶é—´å†…è¢«è°ƒç”¨æ¬¡æ•°è¾ƒå¤šçš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“ã€æ ˆä¸Šæ›¿æ¢ ï¼ˆOSRç¼–è¯‘ï¼‰ã€‘ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼šåŸºäºè®¡æ•°å™¨çƒ­ç‚¹æ¢æµ‹ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼šç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„æ¬¡æ•° å›è¾¹è®¡æ•°å™¨ï¼šç»Ÿè®¡å¾ªç¯ä½“å¾ªç¯æ¬¡æ•° çƒ­åº¦è¡°å‡ï¼šæ¯ç»å†ä¸€ä¸ª åŠè¡°å‘¨æœŸ è°ƒç”¨çš„è®¡æ•°å™¨ä¸­çš„å€¼éƒ½ä¼š è¡°å‡ ä¸€åŠ ç¼–è¯‘å™¨å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:CompileThreshold è®¾ç½®çƒ­ç‚¹ä»£ç çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•° -XX:-UseCounterDecay å…³é—­çƒ­åº¦è¡°å‡ -XX:CounterHalfLifeTime è°ƒæ•´åŠè¡°æœŸæ—¶é—´ï¼ˆç§’ï¼‰ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:3","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#jit-å³æ—¶ç¼–è¯‘å™¨"},{"categories":null,"content":"\r3. æ‰§è¡Œå¼•æ“ åŒºåˆ«äºç‰©ç†æœºçš„æ¦‚å¿µï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå¯ä»¥æ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶æ”¯æŒçš„æŒ‡ä»¤é›† ä¸»è¦ä»»åŠ¡æ˜¯å°†å­—èŠ‚ç è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨èƒ½å¤Ÿè¯†åˆ«çš„æŒ‡ä»¤ã€åç«¯ç¼–è¯‘ã€‘ æ‰§è¡Œå¼•æ“æ ¹æ® PC å¯„å­˜å™¨ çš„æŒ‡ä»¤åœ°å€è¿è¡Œï¼Œé€šè¿‡å±€éƒ¨å˜é‡è¡¨å¯¹åº”å †ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®å¯¹åº”åˆ°æ–¹æ³•åŒºçš„ç±»å‹ä¿¡æ¯ å‰ç«¯ç¼–è¯‘åŸç†å›¾ï¼š åç«¯ç¼–è¯‘åŸç†å›¾ï¼š è§£é‡Šå™¨ å¯¹å­—èŠ‚ç  é€è¡Œè§£é‡Š é€æ¡æ‰§è¡Œ ä¼˜ç‚¹ï¼šä¸Šæ¥å¯ä»¥ç›´æ¥è§£é‡Šæ‰§è¡Œï¼Œå“åº”é€Ÿåº¦å¿« ç¼ºç‚¹ï¼šè¾ƒä¸ºä½æ•ˆ JIT å³æ—¶ç¼–è¯‘å™¨ å°†æºä»£ç ç›´æ¥å…¨éƒ¨ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€ ç¼ºç‚¹ï¼šå“åº”æ—¶é—´è¾ƒé•¿ ä¼˜ç‚¹ï¼šä½¿ç”¨çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ ç¼“å­˜çƒ­ç‚¹ä»£ç ä¸å¿…é‡å¤ç¼–è¯‘ï¼Œæ•ˆç‡é«˜é€Ÿåº¦å¿« HotSpot çš„ C1 C2 ç¼–è¯‘å™¨ çƒ­ç‚¹ä»£ç  ä¸€æ®µæ—¶é—´å†…è¢«è°ƒç”¨æ¬¡æ•°è¾ƒå¤šçš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“ã€æ ˆä¸Šæ›¿æ¢ ï¼ˆOSRç¼–è¯‘ï¼‰ã€‘ çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼šåŸºäºè®¡æ•°å™¨çƒ­ç‚¹æ¢æµ‹ æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼šç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„æ¬¡æ•° å›è¾¹è®¡æ•°å™¨ï¼šç»Ÿè®¡å¾ªç¯ä½“å¾ªç¯æ¬¡æ•° çƒ­åº¦è¡°å‡ï¼šæ¯ç»å†ä¸€ä¸ª åŠè¡°å‘¨æœŸ è°ƒç”¨çš„è®¡æ•°å™¨ä¸­çš„å€¼éƒ½ä¼š è¡°å‡ ä¸€åŠ ç¼–è¯‘å™¨å¸¸ç”¨è°ƒèŠ‚å‚æ•° -XX:CompileThreshold è®¾ç½®çƒ­ç‚¹ä»£ç çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•° -XX:-UseCounterDecay å…³é—­çƒ­åº¦è¡°å‡ -XX:CounterHalfLifeTime è°ƒæ•´åŠè¡°æœŸæ—¶é—´ï¼ˆç§’ï¼‰ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:3","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#çƒ­ç‚¹ä»£ç "},{"categories":null,"content":"\rStringTable String åœ¨ JDK 8 ä¸­æ˜¯ç”± char æ•°ç»„æ„æˆï¼Œåœ¨ JDK 9 åŠä¹‹åæ˜¯ç”± byte æ•°ç»„åŠ æ ‡è®°æ„æˆï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´ String å…·æœ‰ä¸å¯å˜æ€§ã€å¼•ç”¨ç±»å‹ã€‘ å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒçš„å­—ç¬¦ä¸²çš„ String å»é‡ï¼ˆG1åƒåœ¾å›æ”¶å™¨æ“ä½œï¼‰ å¯é€šè¿‡ UserStringDeduplication (bool) å¼€å¯ String å»é‡ï¼ˆé»˜è®¤å…³é—­ï¼‰ å¯é€šè¿‡ PrintStringDeduplicationStatistics (bool) æ‰“å°è¯¦ç»†çš„å»é‡ä¿¡æ¯ å¯é€šè¿‡ StringDeduplicationAgeThreshold (uintx) æŒ‡å®šå»é‡å€™é€‰çš„å¹´é¾„ StringTableSize StringTableSize å³ String å¸¸é‡æ± å¤§å°ï¼Œè¿‡å°æ—¶å®¹æ˜“å‘ç”Ÿ hash ç¢°æ’ï¼Œéœ€è¦è¡¥é½é“¾è¡¨ å¢åŠ æœç´¢éš¾åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ åœ¨ JDK 6 ä¸­ StringTableSize çš„å€¼ä¸º 1009ï¼ŒJDK 7 åŠä¹‹å StringTableSize çš„å€¼ä¸º 60013 å¯é€šè¿‡ -XX:StringTableSize ä¿®æ”¹ StringTableSize çš„å€¼ï¼ˆJDK 8 åªèƒ½ä¿®æ”¹ä¸º 1009 ä»¥ä¸Šçš„å€¼ï¼‰ intern( ) æ–¹æ³• å½“å­—ç¬¦ä¸²==å¸¸é‡==ä¸å­—ç¬¦ä¸²==å¸¸é‡==æ‹¼æ¥æ—¶ï¼Œç»“æœç›´æ¥å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œã€ç¼–è¯‘æœŸä¼˜åŒ–ã€‘ï¼ˆåŒ…æ‹¬ final ä¿®é¥°çš„å¸¸é‡ï¼‰ å½“å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸º==å˜é‡==ï¼Œç»“æœå°±å­˜å‚¨åœ¨å †ä¸­ï¼Œåº•å±‚ä¸º new StringBuilder å append( ) è¿›å»åè¿”å› toString( ) JDK 5 ä¹‹å‰ä¸º StringBuffer ï¼Œçº¿ç¨‹å®‰å…¨ä½†æ•ˆç‡è¾ƒä½ è¡¥å……ï¼š ä½¿ç”¨ â€+â€ æ‹¼æ¥å­—ç¬¦ä¸²æ—¶åº•å±‚ä¼šè°ƒç”¨ StringBuilder å’Œ String å¯¹è±¡ï¼Œå½“å¤§é‡æ‹¼æ¥å­—ç¬¦ä¸²æ—¶æ•ˆç‡ä½ï¼Œå ç”¨é«˜ å¦‚æœç¡®å®šç»å¸¸æ‹¼æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šé«˜äºæŸä¸ªå€¼æ—¶ï¼Œå¯ä»¥å°†æ­¤å€¼åœ¨ StringBuilder çš„æœ‰å‚æ„é€ å™¨ä¸­æŒ‡å®š æ‹¼æ¥çš„ç»“æœå¯¹è±¡è°ƒç”¨ intern( ) æ–¹æ³•åï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰å½“å‰å­—ç¬¦ä¸²çš„è¯ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ String å¸¸é‡æ± å¸¸è§é¢è¯•é¢˜ new String(\"ab\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ new å‡ºæ¥çš„ String å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„ â€œabâ€ new String(\"a\") + new String(\"b\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ å…­ä¸ªå¯¹è±¡ ä½¿ç”¨ + è¿æ¥å­—ç¬¦ä¸² new StringBuilder() new String(â€œaâ€) å¸¸é‡æ± ä¸­çš„ â€œaâ€ new String(â€œbâ€) å¸¸é‡æ± ä¸­çš„ â€œbâ€ Stringbuilder çš„è¿”å›å€¼ä¸ºå…¶ toString æ–¹æ³•çš„è¿”å›å€¼ String å¯¹è±¡ã€æ­¤æ—¶å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œabâ€ ã€‘ å¦‚å›¾ï¼Œä¸ºä½•åœ¨ JDK 7/8 ä¸­ s3 == s4 çš„å€¼ä¸º true ? å› ä¸ºåœ¨ JDK 7 ä¹‹åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨åœ¨å †ç©ºé—´ä¸­ã€‚s3 åœ¨å®šä¹‰æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œ11â€ , æ‰€ä»¥åœ¨æ‰§è¡Œ intern æ–¹æ³•æ—¶å°† s3 çš„å¼•ç”¨åœ°å€æ”¾ç½®åœ¨äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå®šä¹‰ s4 æ—¶å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ s3 çš„åœ°å€èµ‹ç»™ s4 , æ‰€ä»¥ s3 == s4 ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:4","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#stringtable"},{"categories":null,"content":"\rStringTable String åœ¨ JDK 8 ä¸­æ˜¯ç”± char æ•°ç»„æ„æˆï¼Œåœ¨ JDK 9 åŠä¹‹åæ˜¯ç”± byte æ•°ç»„åŠ æ ‡è®°æ„æˆï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´ String å…·æœ‰ä¸å¯å˜æ€§ã€å¼•ç”¨ç±»å‹ã€‘ å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒçš„å­—ç¬¦ä¸²çš„ String å»é‡ï¼ˆG1åƒåœ¾å›æ”¶å™¨æ“ä½œï¼‰ å¯é€šè¿‡ UserStringDeduplication (bool) å¼€å¯ String å»é‡ï¼ˆé»˜è®¤å…³é—­ï¼‰ å¯é€šè¿‡ PrintStringDeduplicationStatistics (bool) æ‰“å°è¯¦ç»†çš„å»é‡ä¿¡æ¯ å¯é€šè¿‡ StringDeduplicationAgeThreshold (uintx) æŒ‡å®šå»é‡å€™é€‰çš„å¹´é¾„ StringTableSize StringTableSize å³ String å¸¸é‡æ± å¤§å°ï¼Œè¿‡å°æ—¶å®¹æ˜“å‘ç”Ÿ hash ç¢°æ’ï¼Œéœ€è¦è¡¥é½é“¾è¡¨ å¢åŠ æœç´¢éš¾åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ åœ¨ JDK 6 ä¸­ StringTableSize çš„å€¼ä¸º 1009ï¼ŒJDK 7 åŠä¹‹å StringTableSize çš„å€¼ä¸º 60013 å¯é€šè¿‡ -XX:StringTableSize ä¿®æ”¹ StringTableSize çš„å€¼ï¼ˆJDK 8 åªèƒ½ä¿®æ”¹ä¸º 1009 ä»¥ä¸Šçš„å€¼ï¼‰ intern( ) æ–¹æ³• å½“å­—ç¬¦ä¸²==å¸¸é‡==ä¸å­—ç¬¦ä¸²==å¸¸é‡==æ‹¼æ¥æ—¶ï¼Œç»“æœç›´æ¥å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œã€ç¼–è¯‘æœŸä¼˜åŒ–ã€‘ï¼ˆåŒ…æ‹¬ final ä¿®é¥°çš„å¸¸é‡ï¼‰ å½“å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸º==å˜é‡==ï¼Œç»“æœå°±å­˜å‚¨åœ¨å †ä¸­ï¼Œåº•å±‚ä¸º new StringBuilder å append( ) è¿›å»åè¿”å› toString( ) JDK 5 ä¹‹å‰ä¸º StringBuffer ï¼Œçº¿ç¨‹å®‰å…¨ä½†æ•ˆç‡è¾ƒä½ è¡¥å……ï¼š ä½¿ç”¨ â€+â€ æ‹¼æ¥å­—ç¬¦ä¸²æ—¶åº•å±‚ä¼šè°ƒç”¨ StringBuilder å’Œ String å¯¹è±¡ï¼Œå½“å¤§é‡æ‹¼æ¥å­—ç¬¦ä¸²æ—¶æ•ˆç‡ä½ï¼Œå ç”¨é«˜ å¦‚æœç¡®å®šç»å¸¸æ‹¼æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šé«˜äºæŸä¸ªå€¼æ—¶ï¼Œå¯ä»¥å°†æ­¤å€¼åœ¨ StringBuilder çš„æœ‰å‚æ„é€ å™¨ä¸­æŒ‡å®š æ‹¼æ¥çš„ç»“æœå¯¹è±¡è°ƒç”¨ intern( ) æ–¹æ³•åï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰å½“å‰å­—ç¬¦ä¸²çš„è¯ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ String å¸¸é‡æ± å¸¸è§é¢è¯•é¢˜ new String(\"ab\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ new å‡ºæ¥çš„ String å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„ â€œabâ€ new String(\"a\") + new String(\"b\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ å…­ä¸ªå¯¹è±¡ ä½¿ç”¨ + è¿æ¥å­—ç¬¦ä¸² new StringBuilder() new String(â€œaâ€) å¸¸é‡æ± ä¸­çš„ â€œaâ€ new String(â€œbâ€) å¸¸é‡æ± ä¸­çš„ â€œbâ€ Stringbuilder çš„è¿”å›å€¼ä¸ºå…¶ toString æ–¹æ³•çš„è¿”å›å€¼ String å¯¹è±¡ã€æ­¤æ—¶å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œabâ€ ã€‘ å¦‚å›¾ï¼Œä¸ºä½•åœ¨ JDK 7/8 ä¸­ s3 == s4 çš„å€¼ä¸º true ? å› ä¸ºåœ¨ JDK 7 ä¹‹åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨åœ¨å †ç©ºé—´ä¸­ã€‚s3 åœ¨å®šä¹‰æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œ11â€ , æ‰€ä»¥åœ¨æ‰§è¡Œ intern æ–¹æ³•æ—¶å°† s3 çš„å¼•ç”¨åœ°å€æ”¾ç½®åœ¨äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå®šä¹‰ s4 æ—¶å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ s3 çš„åœ°å€èµ‹ç»™ s4 , æ‰€ä»¥ s3 == s4 ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:4","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#stringtablesize"},{"categories":null,"content":"\rStringTable String åœ¨ JDK 8 ä¸­æ˜¯ç”± char æ•°ç»„æ„æˆï¼Œåœ¨ JDK 9 åŠä¹‹åæ˜¯ç”± byte æ•°ç»„åŠ æ ‡è®°æ„æˆï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´ String å…·æœ‰ä¸å¯å˜æ€§ã€å¼•ç”¨ç±»å‹ã€‘ å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒçš„å­—ç¬¦ä¸²çš„ String å»é‡ï¼ˆG1åƒåœ¾å›æ”¶å™¨æ“ä½œï¼‰ å¯é€šè¿‡ UserStringDeduplication (bool) å¼€å¯ String å»é‡ï¼ˆé»˜è®¤å…³é—­ï¼‰ å¯é€šè¿‡ PrintStringDeduplicationStatistics (bool) æ‰“å°è¯¦ç»†çš„å»é‡ä¿¡æ¯ å¯é€šè¿‡ StringDeduplicationAgeThreshold (uintx) æŒ‡å®šå»é‡å€™é€‰çš„å¹´é¾„ StringTableSize StringTableSize å³ String å¸¸é‡æ± å¤§å°ï¼Œè¿‡å°æ—¶å®¹æ˜“å‘ç”Ÿ hash ç¢°æ’ï¼Œéœ€è¦è¡¥é½é“¾è¡¨ å¢åŠ æœç´¢éš¾åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ åœ¨ JDK 6 ä¸­ StringTableSize çš„å€¼ä¸º 1009ï¼ŒJDK 7 åŠä¹‹å StringTableSize çš„å€¼ä¸º 60013 å¯é€šè¿‡ -XX:StringTableSize ä¿®æ”¹ StringTableSize çš„å€¼ï¼ˆJDK 8 åªèƒ½ä¿®æ”¹ä¸º 1009 ä»¥ä¸Šçš„å€¼ï¼‰ intern( ) æ–¹æ³• å½“å­—ç¬¦ä¸²==å¸¸é‡==ä¸å­—ç¬¦ä¸²==å¸¸é‡==æ‹¼æ¥æ—¶ï¼Œç»“æœç›´æ¥å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œã€ç¼–è¯‘æœŸä¼˜åŒ–ã€‘ï¼ˆåŒ…æ‹¬ final ä¿®é¥°çš„å¸¸é‡ï¼‰ å½“å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸º==å˜é‡==ï¼Œç»“æœå°±å­˜å‚¨åœ¨å †ä¸­ï¼Œåº•å±‚ä¸º new StringBuilder å append( ) è¿›å»åè¿”å› toString( ) JDK 5 ä¹‹å‰ä¸º StringBuffer ï¼Œçº¿ç¨‹å®‰å…¨ä½†æ•ˆç‡è¾ƒä½ è¡¥å……ï¼š ä½¿ç”¨ â€+â€ æ‹¼æ¥å­—ç¬¦ä¸²æ—¶åº•å±‚ä¼šè°ƒç”¨ StringBuilder å’Œ String å¯¹è±¡ï¼Œå½“å¤§é‡æ‹¼æ¥å­—ç¬¦ä¸²æ—¶æ•ˆç‡ä½ï¼Œå ç”¨é«˜ å¦‚æœç¡®å®šç»å¸¸æ‹¼æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šé«˜äºæŸä¸ªå€¼æ—¶ï¼Œå¯ä»¥å°†æ­¤å€¼åœ¨ StringBuilder çš„æœ‰å‚æ„é€ å™¨ä¸­æŒ‡å®š æ‹¼æ¥çš„ç»“æœå¯¹è±¡è°ƒç”¨ intern( ) æ–¹æ³•åï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰å½“å‰å­—ç¬¦ä¸²çš„è¯ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ String å¸¸é‡æ± å¸¸è§é¢è¯•é¢˜ new String(\"ab\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ new å‡ºæ¥çš„ String å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„ â€œabâ€ new String(\"a\") + new String(\"b\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ å…­ä¸ªå¯¹è±¡ ä½¿ç”¨ + è¿æ¥å­—ç¬¦ä¸² new StringBuilder() new String(â€œaâ€) å¸¸é‡æ± ä¸­çš„ â€œaâ€ new String(â€œbâ€) å¸¸é‡æ± ä¸­çš„ â€œbâ€ Stringbuilder çš„è¿”å›å€¼ä¸ºå…¶ toString æ–¹æ³•çš„è¿”å›å€¼ String å¯¹è±¡ã€æ­¤æ—¶å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œabâ€ ã€‘ å¦‚å›¾ï¼Œä¸ºä½•åœ¨ JDK 7/8 ä¸­ s3 == s4 çš„å€¼ä¸º true ? å› ä¸ºåœ¨ JDK 7 ä¹‹åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨åœ¨å †ç©ºé—´ä¸­ã€‚s3 åœ¨å®šä¹‰æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œ11â€ , æ‰€ä»¥åœ¨æ‰§è¡Œ intern æ–¹æ³•æ—¶å°† s3 çš„å¼•ç”¨åœ°å€æ”¾ç½®åœ¨äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå®šä¹‰ s4 æ—¶å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ s3 çš„åœ°å€èµ‹ç»™ s4 , æ‰€ä»¥ s3 == s4 ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:4","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#intern--æ–¹æ³•"},{"categories":null,"content":"\rStringTable String åœ¨ JDK 8 ä¸­æ˜¯ç”± char æ•°ç»„æ„æˆï¼Œåœ¨ JDK 9 åŠä¹‹åæ˜¯ç”± byte æ•°ç»„åŠ æ ‡è®°æ„æˆï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´ String å…·æœ‰ä¸å¯å˜æ€§ã€å¼•ç”¨ç±»å‹ã€‘ å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒçš„å­—ç¬¦ä¸²çš„ String å»é‡ï¼ˆG1åƒåœ¾å›æ”¶å™¨æ“ä½œï¼‰ å¯é€šè¿‡ UserStringDeduplication (bool) å¼€å¯ String å»é‡ï¼ˆé»˜è®¤å…³é—­ï¼‰ å¯é€šè¿‡ PrintStringDeduplicationStatistics (bool) æ‰“å°è¯¦ç»†çš„å»é‡ä¿¡æ¯ å¯é€šè¿‡ StringDeduplicationAgeThreshold (uintx) æŒ‡å®šå»é‡å€™é€‰çš„å¹´é¾„ StringTableSize StringTableSize å³ String å¸¸é‡æ± å¤§å°ï¼Œè¿‡å°æ—¶å®¹æ˜“å‘ç”Ÿ hash ç¢°æ’ï¼Œéœ€è¦è¡¥é½é“¾è¡¨ å¢åŠ æœç´¢éš¾åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ åœ¨ JDK 6 ä¸­ StringTableSize çš„å€¼ä¸º 1009ï¼ŒJDK 7 åŠä¹‹å StringTableSize çš„å€¼ä¸º 60013 å¯é€šè¿‡ -XX:StringTableSize ä¿®æ”¹ StringTableSize çš„å€¼ï¼ˆJDK 8 åªèƒ½ä¿®æ”¹ä¸º 1009 ä»¥ä¸Šçš„å€¼ï¼‰ intern( ) æ–¹æ³• å½“å­—ç¬¦ä¸²==å¸¸é‡==ä¸å­—ç¬¦ä¸²==å¸¸é‡==æ‹¼æ¥æ—¶ï¼Œç»“æœç›´æ¥å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œã€ç¼–è¯‘æœŸä¼˜åŒ–ã€‘ï¼ˆåŒ…æ‹¬ final ä¿®é¥°çš„å¸¸é‡ï¼‰ å½“å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸º==å˜é‡==ï¼Œç»“æœå°±å­˜å‚¨åœ¨å †ä¸­ï¼Œåº•å±‚ä¸º new StringBuilder å append( ) è¿›å»åè¿”å› toString( ) JDK 5 ä¹‹å‰ä¸º StringBuffer ï¼Œçº¿ç¨‹å®‰å…¨ä½†æ•ˆç‡è¾ƒä½ è¡¥å……ï¼š ä½¿ç”¨ â€+â€ æ‹¼æ¥å­—ç¬¦ä¸²æ—¶åº•å±‚ä¼šè°ƒç”¨ StringBuilder å’Œ String å¯¹è±¡ï¼Œå½“å¤§é‡æ‹¼æ¥å­—ç¬¦ä¸²æ—¶æ•ˆç‡ä½ï¼Œå ç”¨é«˜ å¦‚æœç¡®å®šç»å¸¸æ‹¼æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šé«˜äºæŸä¸ªå€¼æ—¶ï¼Œå¯ä»¥å°†æ­¤å€¼åœ¨ StringBuilder çš„æœ‰å‚æ„é€ å™¨ä¸­æŒ‡å®š æ‹¼æ¥çš„ç»“æœå¯¹è±¡è°ƒç”¨ intern( ) æ–¹æ³•åï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰å½“å‰å­—ç¬¦ä¸²çš„è¯ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ String å¸¸é‡æ± å¸¸è§é¢è¯•é¢˜ new String(\"ab\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ new å‡ºæ¥çš„ String å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„ â€œabâ€ new String(\"a\") + new String(\"b\") ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ å…­ä¸ªå¯¹è±¡ ä½¿ç”¨ + è¿æ¥å­—ç¬¦ä¸² new StringBuilder() new String(â€œaâ€) å¸¸é‡æ± ä¸­çš„ â€œaâ€ new String(â€œbâ€) å¸¸é‡æ± ä¸­çš„ â€œbâ€ Stringbuilder çš„è¿”å›å€¼ä¸ºå…¶ toString æ–¹æ³•çš„è¿”å›å€¼ String å¯¹è±¡ã€æ­¤æ—¶å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œabâ€ ã€‘ å¦‚å›¾ï¼Œä¸ºä½•åœ¨ JDK 7/8 ä¸­ s3 == s4 çš„å€¼ä¸º true ? å› ä¸ºåœ¨ JDK 7 ä¹‹åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨åœ¨å †ç©ºé—´ä¸­ã€‚s3 åœ¨å®šä¹‰æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰ â€œ11â€ , æ‰€ä»¥åœ¨æ‰§è¡Œ intern æ–¹æ³•æ—¶å°† s3 çš„å¼•ç”¨åœ°å€æ”¾ç½®åœ¨äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå®šä¹‰ s4 æ—¶å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ s3 çš„åœ°å€èµ‹ç»™ s4 , æ‰€ä»¥ s3 == s4 ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:4","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#string-å¸¸é‡æ± å¸¸è§é¢è¯•é¢˜"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference\u003cUser\u003e usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference\u003cUser\u003e uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue\u003cUser\u003e rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference\u003cUser\u003e pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶garbage-collection"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ ‡è®°ç®—æ³•"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#finalization-æœºåˆ¶"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ¸…é™¤ç®—æ³•"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å……"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨garbage-collector"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨åˆ†ç±»"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨çš„å‘å±•å²"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨ä¸åˆ†ä»£çš„å…³ç³»"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#serial-å›æ”¶å™¨"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#parnew-å›æ”¶å™¨"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#parallel-scavengeå›æ”¶å™¨jdk-8-é»˜è®¤"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#concurrent-mark-sweep-å›æ”¶å™¨"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#garbage-first-å›æ”¶å™¨jdk-9-é»˜è®¤"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gc-æ—¥å¿—åˆ†æ"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨çš„æœªæ¥"},{"categories":null,"content":"\råƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šè¿è¡Œç¨‹åºä¸­å†æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼š éœ€è¦é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä»¥ä¾¿äºåˆ†é…ç»™æ–°çš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰ GC é‚£ä¹ˆå†…å­˜æ€»æœ‰ä¸€å¤©ä¼šç”¨å®Œï¼Œæ— æ³•ä¿è¯ç¨‹åºçš„æ­£å¸¸è¿›è¡Œã€‚ é™ä½å†…å­˜æ³„éœ²å’Œæº¢å‡ºçš„é£é™©ï¼Œç¨‹åºå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡å¤„ç† åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•\ræ ‡è®°ç®—æ³•æ ‡è®°å‡ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ˆä¸å†è¢«ä»»ä½•å­˜æ´»å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ï¼‰ å¼•ç”¨è®¡æ•°ç®—æ³•ã€ python ä½¿ç”¨ã€‘ è®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨å°± +1ï¼Œå¼•ç”¨å¤±æ•ˆå°± -1ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º 0ï¼Œåˆ™å¯å›æ”¶ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ ç¼ºç‚¹ï¼šå­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼Œè®¡æ•°æ—¶é—´çš„å¼€é”€ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆé€ æˆå†…å­˜æ³„æ¼ï¼‰ å¯è¾¾æ€§åˆ†æç®—æ³•ã€ Java ä½¿ç”¨ã€‘ æ ¹å¯¹è±¡ï¼šä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ ï¼ˆæ ˆä¸­å¼•ç”¨çš„ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„ï¼Œæ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„ï¼Œå¸¸é‡æ± ä¸­çš„ï¼ŒåŒæ­¥é”æŒæœ‰çš„ï¼Œè™šæ‹Ÿæœºå†…éƒ¨çš„å¯¹è±¡ï¼‰ ä¸€ä¸ªæŒ‡é’ˆé‡Œé¢ä¿å­˜äº†å †ä¸­çš„å¯¹è±¡ï¼Œä½†è‡ªå·±åˆä¸å­˜å‚¨åœ¨å †ä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª Root å¯¹è±¡ ä»¥ä¸€ç»„æ ¹å¯¹è±¡é›†åˆä¸ºèµ·å§‹ç‚¹ï¼Œä»ä¸Šåˆ°ä¸‹æœç´¢æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¸æ˜¯åƒåœ¾å›æ”¶å¯¹è±¡ è™šæ‹Ÿæœºä¸­å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ï¼š å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥çš„è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå°±ä¸æ˜¯åƒåœ¾ï¼‰ å¯å¤æ´»çš„ï¼šä»æ ¹èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨ fnalize æ–¹æ³•ä¸­å¤æ´»ï¼ˆåˆ€ä¸‹ç•™äººï¼‰ ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„ finalize æ–¹æ³•è¢«è°ƒç”¨è¿‡å¹¶ä¸”æ²¡æœ‰è¢«å¤æ´»ï¼ˆæ­»å®šäº†ï¼‰ finalization æœºåˆ¶ å¯ç”±ç¨‹åºå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯å‰çš„å¤„ç†é€»è¾‘ åœ¨ GC å›æ”¶ä¸€ä¸ªå¯¹è±¡å‰ï¼Œæ€»æ˜¯è¦è°ƒç”¨ finalize( ) æ–¹æ³•ï¼ˆObject ç±»è‡ªå¸¦çš„æ–¹æ³•ï¼‰ åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶ï¼Œä¼šç»è¿‡==ä¸¤æ¬¡æ ‡è®°==ï¼š å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„ï¼Œç¬¬ä¸€æ¬¡æ ‡è®° è¿™ä¸ªå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ï¼Œè¿›è¡ŒäºŒæ¬¡æ ‡è®° å¦‚æœåœ¨ finalize æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œåˆ™ç§»å‡ºå³å°†å›æ”¶é›†åˆï¼Œç›´åˆ°å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯ ä¸å¯è§¦åŠçš„ ï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ æ¸…é™¤ç®—æ³• æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark - Sweepï¼‰ æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œç°è¡Œçš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™ â€˜æ¸…é™¤â€™ ä¼˜ç‚¹ï¼šæ˜“äºç†è§£ ç¼ºç‚¹ï¼šæ•ˆç‡ä¸ç®—é«˜ã€GC æ—¶ä¼šå‘ç”Ÿ STWã€æ¸…é™¤åå†…å­˜ä¸è¿ç»­ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨ï¼ˆå¹¶ä¸ä¼šçœŸæ­£çš„æŠŠå¯¹è±¡ç½®ç©ºï¼Œè€Œæ˜¯æŠŠ â€˜æ¸…é™¤â€™ çš„å¯¹è±¡åœ°å€è®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œä¸‹æ¬¡åˆ†é…å¯¹è±¡ä¼˜å…ˆåœ¨ç©ºé—²åˆ—è¡¨ä¸­è®°å½•çš„å†…å­˜åˆ†é…ï¼‰ å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ å¤åˆ¶ï¼šå°†å†…å­˜åˆ†ä¸º A B ä¸¤åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜å—è§’è‰² ä¼˜ç‚¹ï¼šæ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œç®€å•é«˜æ•ˆã€ä¸ä¼šå‡ºç°å†…å­˜ç¢ç‰‡ ç¼ºç‚¹ï¼šéœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€å†…å­˜ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘æ—¶æ‰è¡Œï¼ˆæ–°ç”Ÿä»£ä¸­å¤§å¤šæ•°å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼‰ã€åœ¨ G1 åƒåœ¾å›æ”¶å™¨ä¸­éœ€è¦ç»´æŠ¤ region å¼•ç”¨ï¼Œå› ä¸ºæ¯æ¬¡å¤åˆ¶éƒ½ä¼šå¯¼è‡´å†…å­˜åœ°å€å˜åŒ–ï¼Œæ ˆä¸­å¯¹å †å†…å­˜çš„çš„å¼•ç”¨å‘ç”Ÿå˜åŒ– æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆMark - Compactï¼‰ æ˜¯å¯¹ æ ‡è®° - æ¸…é™¤ ç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ï¼Œç›¸å½“äº æ ‡è®° - æ¸…é™¤ - å‹ç¼© ç®—æ³• æ ‡è®°ï¼šä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ å‹ç¼©ï¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä¹‹åæ¸…é™¤æ­¤å¤–çš„ç©ºé—´ ä¼˜ç‚¹ï¼šè§£å†³äº† æ ‡è®° - æ¸…é™¤ ç®—æ³•ä¸­å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€è§£å†³äº† å¤åˆ¶ç®—æ³• å ç”¨ä¸¤å€å†…å­˜çš„é«˜é¢ä»£ä»· ç¼ºç‚¹ï¼šæ•ˆç‡ä½äºå¤åˆ¶ç®—æ³•ã€ä¹Ÿéœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€ç§»åŠ¨è¿‡ç¨‹ä¸­ä¹Ÿéœ€è¦ STW ä¸‰ç§ç®—æ³•æ¯”è¾ƒ åˆ†ä»£æ”¶é›†ç®—æ³• é’ˆå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£åŒºåŸŸè¾ƒè€å¹´ä»£å°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ è€å¹´ä»£ï¼šæ ‡è®° - æ¸…é™¤ + æ ‡è®° - å‹ç¼©ï¼Œè€å¹´ä»£åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠæ–°ç”Ÿä»£é¢‘ç¹ HotSpot ä¸­ä½¿ç”¨ CMS å›æ”¶å™¨ï¼ŒCMS å›æ”¶å™¨æ˜¯åŸºäº æ ‡è®° - æ¸…é™¤ å®ç°çš„ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼Œä½¿ç”¨ æ ‡è®° - å‹ç¼© çš„ Serial Old å›æ”¶å™¨åšè¡¥å¿ å¢é‡æ”¶é›†ç®—æ³• æ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹éƒ½åªæ”¶é›†ä¸€å°å—åŒºåŸŸï¼Œä¸ç”¨æˆ·çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ ä¼˜ç‚¹ï¼šæœ‰æ•ˆå‡å°‘å•æ¬¡ STW å»¶è¿Ÿï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®š ç¼ºç‚¹ï¼šé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ åˆ†åŒºç®—æ³• å°†å †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„å°ç©ºé—´ regionï¼Œæ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨ç‹¬ç«‹å›æ”¶ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶æ¯æ¬¡å›æ”¶å¤šå°‘å°ç©ºé—´ åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µè¡¥å…… System.gc( ); æ˜¾ç¤ºçš„è°ƒç”¨ full gc ï¼Œå¯¹å †ç©ºé—´åŠå…ƒç©ºé—´è¿›è¡Œåƒåœ¾å›æ”¶ å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ Runtime.getRuntime().gc(); æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³• æ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ï¼ˆéœ€ç­‰å¾…å®‰å…¨ç‚¹ï¼‰ å¯ä»¥ä½¿ç”¨ System.runFinalization(); ç¡®ä¿ finalze æ–¹æ³•çš„æ‰§è¡Œ Slot æ§½çš„å¤ç”¨ï¼šä¸ºä»€ä¹ˆå£°æ˜äº†ä¸€ä¸ª bytes å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨çš„æ§½æ•°ä¹Ÿæ˜¯ 2 ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­åªæœ‰ä¸€æ¡ args å‘¢ï¼Ÿ å› ä¸º bytes å®é™…å­˜å‚¨åœ¨åºå· 1 çš„ä½ç½®ï¼Œæ ˆä¸­æœ‰å¼•ç”¨ GC ä¸ä¼šå›æ”¶ bytes ä½†æ˜¯å½“ä¸‹æ–¹å£°æ˜ byte b = 127 ä¹‹åå±€éƒ¨å˜é‡è¡¨åºå· 1 çš„ä½ç½®è¢«å¤ç”¨ï¼Œæ­¤æ—¶ bytes å°†ä¼šè¢« GC å›æ”¶ å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼ è·³è½¬è‡³æ–¹æ³•åŒºå†…å­˜æ³„æ¼ç›¸å…³å†…å®¹ STWï¼šStop The World ä¸ºç¡®ä¿æ ‡è®°æ—¶ä»¥åŠæ¸…é™¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå‘ç”Ÿçš„åœé¡¿ï¼Œåœæ­¢æ•´ä¸ªç¨‹åº å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¼•ç”¨å…³ç³»ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœå‡†ç¡®æ€§æ— æ³•ä¿è¯ å› ä¸º STW çš„å­˜åœ¨ï¼ŒThread çš„ sleep æ—¶é—´ä¸ä¸€å®šååˆ†å‡†ç¡® åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘ å¹¶å‘ï¼šå•ä¸ªå¤„ç†å™¨åœ¨åŒä¸€æ—¶é—´æ®µä¸­ï¼Œå‡ ä¸ªç¨‹åºå¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œï¼Œä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿã€‘ å¹¶è¡Œï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œä¸ä¼šäº’ç›¸æŠ¢å èµ„æºã€æŸä¸€æ—¶é—´ç‚¹åŒæ—¶å‘ç”Ÿã€‘ åƒåœ¾å›æ”¶çš„å¹¶å‘ã€å¹¶è¡Œã€ä¸²è¡Œ å¹¶å‘ï¼šåŒä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ‰æ•ˆå‡å°‘å•æ¬¡ STW æ—¶é•¿ å¹¶è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼Œå¤šæ¡åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œå·¥ä½œ ä¸²è¡Œï¼šç”¨æˆ·çº¿ç¨‹ STW çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶é—´ç‚¹åªæœ‰ä¸€æ¡åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œ åƒåœ¾å›æ”¶çš„å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ GC èƒ½å¤Ÿå®‰å…¨ã€å¯æ§çš„å›æ”¶å¯¹è±¡çš„æ—¶é—´ç‚¹ï¼Œå®‰å…¨ç‚¹çš„é€‰æ‹©ä»¥ æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾ ä¸ºæ ‡å‡† å®‰å…¨ç‚¹çš„é€‰æ‹©æ–¹å¼ æŠ¢å…ˆå¼ä¸­æ–­ï¼šä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œåˆ™æ¢å¤çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ï¼ˆæ²¡æœ‰ JVM ç”¨è¿™ç§ï¼‰ ä¸»åŠ¨å¼ä¸­æ–­ï¼šå„çº¿ç¨‹åœ¨å®‰å…¨ç‚¹æ—¶è½®è¯¢ä¸€ä¸ªä¸­æ–­æ ‡è®°ï¼Œå½“è¿™ä¸ªæ ‡è®°ä¸ºçœŸæ—¶ï¼Œä¸»åŠ¨å°†è‡ªå·±ä¸­æ–­æŒ‚èµ· ä¾‹å¦‚ï¼ˆæ‰§è¡Œè¾ƒæ…¢çš„æŒ‡ä»¤ï¼šæ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰ï¼‰ å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰ å½“çº¿ç¨‹å¤„äº Sleep æˆ–è€… Blocked çŠ¶æ€ï¼ŒJVM æ— æ³•ä¸­æ–­æ—¶ ä»£ç åœ¨ä¸€æ®µç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŒºåŸŸä¸­ä»»æ„ GC éƒ½æ˜¯å®‰å…¨çš„ å½“çº¿ç¨‹å¤„äºå®‰å…¨åŒºæ—¶ï¼Œéœ€ç­‰å¾… GC å®Œæˆæ‰èƒ½é€€å‡ºå®‰å…¨åŒº å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰ æœ€ä¼ ç»Ÿçš„å¼•ç”¨ Object obj = new Object(); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ è½¯å¼•ç”¨ SoftReference usr = new SoftReference\u003c\u003e(new User()); æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ é«˜é€Ÿç¼“å­˜ä¼šä½¿ç”¨åˆ°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜æº¢å‡ºå‰å›æ”¶ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ è¢«ç½®ç©ºçš„å¼ºå¼•ç”¨ã€ä¼ å‚æ—¶ new å‡ºæ¥çš„å¯¹è±¡ æ„é€ å¼±å¼•ç”¨ User user = new User(); WeakReference uwr = new WeakReference\u003c\u003e(new User()); user = null; æ˜¯å¯è¾¾çš„ï¼Œå¯è§¦åŠçš„ åªè¦åƒåœ¾å›æ”¶å™¨å·¥ä½œï¼Œå¼±å¼•ç”¨å°±è¢«å›æ”¶ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ æ„é€ è™šå¼•ç”¨ User user = new User(); ReferenceQueue rq = new ReferenceQueue\u003c\u003e(); //å¼•ç”¨é˜Ÿåˆ— PhantomReference pr = new PhantomReference\u003c\u003e(user,rq); user = null; ä½¿ç”¨è™šå¼•ç”¨ä¸ºäº†åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œå¯¹è±¡å›æ”¶è·Ÿè¸ª ç»ˆç»“å™¨å¼•ç”¨ åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼Œfinalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ¥æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨ finalze æ–¹æ³•ï¼Œåœ¨ç¬¬äºŒæ¬¡ GC æ—¶å›æ”¶å¯¹è±¡ åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰\råƒåœ¾å›æ”¶å™¨åˆ†ç±» æŒ‰ç…§çº¿ç¨‹æ•°åˆ†ç±» ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå• cpu å¹³å°ã€ç¡¬ä»¶èµ„æºå—é™å¹³å°ã€Serialã€Serial Oldã€‘ å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„ cpu ã€ParNewã€Parallelã€Scavengeã€Parallel Oldã€‘ æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ç±» å¹¶å‘å¼åƒåœ¾å›æ”¶ï¼šç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¿«é€Ÿäº¤æ›¿æ‰§è¡Œï¼Œå»¶è¿Ÿæ—¶é—´æ®µã€CMSã€G1ã€‘ ç‹¬å å¼åƒåœ¾å›æ”¶ï¼šåƒåœ¾å›æ”¶æ—¶ç‹¬å ä¸€æ•´æ®µæ—¶é—´ï¼Œç”¨æˆ·çº¿ç¨‹ç­‰å¾…åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ æŒ‰ç…§ç¢ç‰‡å¤„ç†åˆ†ç±» å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šé‡‡ç”¨äº†å¸¦æœ‰å‹ç¼©ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ï¼šä¸è¿›è¡Œå†…å­˜ç©ºé—´å‹ç¼©çš„åƒåœ¾å›æ”¶å™¨ æŒ‰ç…§å·¥ä½œçš„å†…å­˜åŒºé—´åˆ†ç±» å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ è€å¹´ä»£çš„åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶å™¨çš„æ€§èƒ½æŒ‡æ ‡ ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å ç”¨æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€a/a+bã€‘ åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€b/a+bã€‘ æš‚","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:5","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åƒåœ¾å›æ”¶å™¨ç›¸å…³é¢è¯•é¢˜"},{"categories":null,"content":"\rå­—èŠ‚ç ä¸ç±»çš„åŠ è½½","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å­—èŠ‚ç ä¸ç±»çš„åŠ è½½"},{"categories":null,"content":"\rå…³äºå­—èŠ‚ç å†…å®¹ç•¥ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³äºå­—èŠ‚ç å†…å®¹"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨\u003cclinit\u003e()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ \u003cclinit\u003e æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» \u003cclinit\u003e çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œ\u003cclinit\u003eæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œ\u003cclinit\u003eæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œ\u003cclinit\u003eæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œ\u003cclinit\u003eæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„\u003cclinit\u003eæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»çš„åŠ è½½"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡ç¨‹1loading-åŠ è½½é˜¶æ®µ"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡ç¨‹2linking-é“¾æ¥é˜¶æ®µ"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡ç¨‹3initialization-åˆå§‹åŒ–é˜¶æ®µ"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å“ªäº›åœºæ™¯ä¸‹ä¸éœ€è¦ç”Ÿæˆ-clinit-æ–¹æ³•"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#clinit-çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡ç¨‹4using-ä½¿ç”¨é˜¶æ®µ"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡ç¨‹5unloading-å¸è½½é˜¶æ®µ"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»çš„å¸è½½"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å†è°ˆç±»åŠ è½½å™¨"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»çš„æ˜¾å¼åŠ è½½ä¸éšå¼åŠ è½½"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å‘½åç©ºé—´"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç±»åŠ è½½å™¨çš„ä¸‰å¤§ç‰¹å¾"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#classloader-ç±»åŠ è½½å™¨"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#classloader-ä¸ç°æœ‰ç±»åŠ è½½å™¨çš„å…³ç³»"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åŒäº²å§”æ´¾æœºåˆ¶-1"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶-a-nameæ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶-a"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ²™ç®±å®‰å…¨æœºåˆ¶"},{"categories":null,"content":"\rç±»çš„åŠ è½½\rè¿‡ç¨‹1ï¼šLoading åŠ è½½é˜¶æ®µ è·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å…¶ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ (å…ƒæ•°æ®: ç±»çš„æ–¹æ³•ä»£ç ï¼Œå˜é‡åï¼Œæ–¹æ³•åï¼Œè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç­‰) è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆæ­¤ç±»çš„ java.lang.Class å®ä¾‹ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ ==ç±»åŠ è½½å™¨çš„å·¥ä½œå°±åªåœ¨åŠ è½½é˜¶æ®µï¼Œé“¾æ¥ã€åˆå§‹åŒ–éƒ½æ˜¯ç”± JVM å®Œæˆçš„== å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ â€“ ç±»æ¨¡æ¿å¯¹è±¡ é€šè¿‡ç±»çš„å…¨é™å®šåï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµ è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµç”Ÿæˆæ–¹æ³•åŒºå†…çš„ Java ç±»æ¨¡æ¿ å †ä¸­åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ï¼ŒæŒ‡å‘æ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®ï¼ˆæ¨¡æ¿ï¼‰ æ•°ç»„ç±»å‹æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹éœ€è¦ç”±ç±»åŠ è½½å™¨åˆ›å»ºã€‚ åŸºç¡€æ•°æ®ç±»å‹ï¼šç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œæƒé™ä¸º Public å¼•ç”¨æ•°æ®ç±»å‹ï¼šéœ€è¦ç±»åŠ è½½å™¨åŠ è½½ï¼Œæƒé™çœ‹å…·ä½“ç±»çš„è®¿é—®æƒé™ è·å–ç±»äºŒè¿›åˆ¶æ•°æ®æµçš„æ–¹å¼ è¯»å…¥ class æ–‡ä»¶ è¯»å…¥ jarã€zip ç­‰æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ å­˜åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ® ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œåŠ è½½ åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ å¦‚æœæ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼ŒæŠ›å‡º ClassFormatError è¿‡ç¨‹2ï¼šLinking é“¾æ¥é˜¶æ®µ Verification éªŒè¯é˜¶æ®µ ç¡®ä¿ class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œæ­£ç¡®æ€§ã€æ— å±é™©æ€§ java è™šæ‹Ÿæœºä¸­ class æ–‡ä»¶å¿…é¡»ä»¥ CA FE BA BE å¼€å¤´ ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ æ ¼å¼éªŒè¯ï¼š ä¼šä¸åŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œï¼ŒéªŒè¯ä¹‹åæ‰ä¼šåŠ è½½ç›¸å…³äºŒè¿›åˆ¶æ•°æ®ã€‚ éªŒè¯æ˜¯å¦ CAFEBABE å¼€å¤´ï¼ˆé­”æ•°ï¼‰ éªŒè¯ä¸»ç‰ˆæœ¬ä¸å‰¯ç‰ˆæœ¬æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†… éªŒè¯æ•°æ®ä¸­æ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯å¦æ­£ç¡® è¯­ä¹‰æ£€æŸ¥ï¼š éªŒè¯æ˜¯å¦æ‰€æœ‰ç±»éƒ½æœ‰çˆ¶ç±»å­˜åœ¨ éªŒè¯ final çš„æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦è¢«é‡å†™æˆ–é‡è½½äº† éªŒè¯éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–æ¥å£æ–¹æ³• éªŒè¯æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆé‡å¤æ–¹æ³•ï¼Œfinal / static çš„æŠ½è±¡æ–¹æ³•ï¼‰ å­—èŠ‚ç éªŒè¯ï¼š éªŒè¯å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„æŒ‡ä»¤ éªŒè¯å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®çš„ç±»å‹å‚æ•° éªŒè¯å˜é‡çš„èµ‹å€¼ç±»å‹æ˜¯å¦æ­£ç¡® æ ˆæ˜ å°„å¸§ï¼šå°½å¯èƒ½çš„æ£€æµ‹åœ¨ç‰¹å®šå­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆæ— æ³•åšåˆ° 100% å‡†ç¡®ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼š åœ¨è§£æé˜¶æ®µæ‰ä¼šæ‰§è¡Œ éªŒè¯å¸¸é‡æ± ä¸­ç¬¦å·å¼•ç”¨çš„è¿™äº›ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¡®å®å­˜åœ¨ Preparation å‡†å¤‡é˜¶æ®µ ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶èµ‹åˆå§‹å€¼: é›¶å€¼ å¸¸é‡ï¼ˆfinal ä¿®é¥°ï¼‰åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«èµ‹å€¼äº†ï¼Œå‡†å¤‡é˜¶æ®µåªä¼šæ˜¾å¼çš„åˆå§‹åŒ– ä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆå§‹åŒ–ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šåˆå§‹åŒ–å®ä¾‹å˜é‡ ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚æ²¡æœ‰ä»£ç æ‰§è¡Œ ä¼šä¸º final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ç±»å˜é‡èµ‹å…¶å­—é¢é‡å€¼ ä¸ä¼šä¸ºå¸¸é‡èµ‹å€¼ï¼Œå› ä¸º final åœ¨ç¼–è¯‘æœŸå°±å·²ç»è¢«èµ‹å€¼äº† Resolution è§£æé˜¶æ®µ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ å°†ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨åˆ°æ–¹æ³•åŒºçœŸå®çš„åœ°å€ è¿‡ç¨‹3ï¼šinitialization åˆå§‹åŒ–é˜¶æ®µ æ‰§è¡Œç±»æ„é€ å™¨()çš„è¿‡ç¨‹ clinit: æ˜¯ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—çš„è¯­å¥åˆå¹¶è€Œæ¥ è™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„ clinit æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ clinit æ‰§è¡Œå®Œæ¯• clinit åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šè¢«åŒæ­¥åŠ é” (ä¿è¯åªåŠ è½½ä¸€æ¬¡) ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒåŒ…æ‹¬ final ä¿®é¥°çš„æœ‰æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ– èµ‹å€¼çš„ç±»å˜é‡ æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç  ç”±çˆ¶åŠå­ï¼Œé™æ€å…ˆè¡Œ å“ªäº›åœºæ™¯ä¸‹ï¼Œä¸éœ€è¦ç”Ÿæˆ æ–¹æ³• æ²¡æœ‰ç±»å˜é‡çš„ç±» ç±»å˜é‡ä¸ç”¨æ˜¾å¼çš„èµ‹å€¼çš„ç±» ç±»å˜é‡éƒ½æ˜¯æœ‰ final ä¿®é¥°çš„ä¸éœ€è¦æ–¹æ³•è°ƒç”¨ / å®ä¾‹åŒ–çš„ç±» çš„å¤šçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ clinit æ–¹æ³•æ˜¯åŠ é”çº¿ç¨‹å®‰å…¨çš„ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡åç›´æ¥è¿”å›å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ æ­»é”ï¼šå¦‚æœåŠ è½½ç±» A éœ€è¦åŠ è½½ç±» B ï¼ŒåŠ è½½ç±» B éœ€è¦åŠ è½½ç±» A ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ï¼Œå°±ä¼šé€ æˆæ­»é” ç±»çš„ä¸»åŠ¨ä½¿ç”¨ä¸è¢«åŠ¨ä½¿ç”¨çš„é—®é¢˜ ä¸»åŠ¨ä½¿ç”¨æ—¶ä¼šè°ƒç”¨ clinit æ–¹æ³•ï¼Œè¢«åŠ¨ä½¿ç”¨æ—¶ä¸ä¼šè°ƒç”¨ clinit æ–¹æ³• ä¸»åŠ¨ä½¿ç”¨ï¼š åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ– /*ååºåˆ—åŒ–ä¾‹å­*/ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"åºåˆ—åŒ–åçš„ç±»æ–‡ä»¶\")); ç±»å ç±» = (ç±»å)ois.readObject(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•æ—¶ ç±»å.æ–¹æ³•å(); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ç±»ã€æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼ˆ final ç‰¹æ®Šï¼‰ å¦‚æœæ˜¯ static åŠ  final ä¿®é¥°æ—¶ï¼Œå…·ä½“è¦çœ‹æ˜¾å¼èµ‹å€¼æœ‰æ²¡æœ‰æ–¹æ³•çš„è°ƒç”¨æˆ–è€…ç±»çš„å®ä¾‹åŒ– System.out.print(ç±»å.é™æ€å­—æ®µå); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“ä½¿ç”¨ java.lang.reflect åŒ…ä¸­çš„æ–¹æ³•åå°„ç±»çš„æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚ï¼šClass.forName(â€œcom.Testâ€) Class.forName(\"com.mysql.cj.jdbc.Driver\"); //æ­¤æ—¶ä¼šæ‰§è¡Œæ–¹æ³•è¿›è¡Œåˆå§‹åŒ– å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» åœ¨ä¸€ä¸ªç±»åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒå®ç°çš„æ¥å£ åœ¨ä¸€ä¸ªæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿä¸ä¼šå…ˆåˆå§‹åŒ–å®ƒçš„çˆ¶æ¥å£ åªæœ‰åœ¨é¦–æ¬¡ä½¿ç”¨æ¥å£çš„é™æ€å­—æ®µæ—¶ï¼Œæ‰ä¼šå¯¼è‡´æ¥å£çš„åˆå§‹åŒ– å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº† default æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥çš„å®ç°æ¥å£çš„ç±»çš„åˆå§‹åŒ–ï¼Œéƒ½è¦å…ˆåˆå§‹åŒ–æ¥å£ JDK 8 æ–°ç‰¹æ€§ï¼šå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ä½“ï¼Œä½†å¿…é¡»æ˜¯ default ä¿®é¥°çš„ class Father implements InterfClass{ public static void main(String[] args) { //è¿è¡Œæ—¶ä¼šå…ˆåŠ è½½åˆå§‹åŒ– main ä¸»ç±»ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œæ¥å£InterfClassçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ– } } interface InterfClass{ public default void fun (){ sout... } } å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼Œï¼ˆmain æ–¹æ³•ï¼‰ å¦‚ 6 æ‰€ç¤º å½“ä¾æ¬¡è°ƒç”¨ MethodHandle å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥ MethodHandle æŒ‡å‘çš„æ”¾æ–¹æ³•æ‰€åœ¨çš„ç±» JDK 7 ä¸­ Java è¯­è¨€å¯¹åŠ¨æ€æ€§çš„æ”¯æŒåŠ å…¥çš„â€¦ æµ‹è¯•ç±»åŠ è½½çš„ç›¸å…³å‚æ•° -XX:+TraceClassLoading æ˜¾ç¤ºç±»åŠ è½½è¯¦æƒ… è¢«åŠ¨ä½¿ç”¨ï¼š å½“è®¿é—®ä¸€ä¸ªé™æ€å­—æ®µæ—¶ï¼Œåªæœ‰çœŸæ­£å£°æ˜è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ– ä¾‹å­ï¼šè®¿é—®çˆ¶ç±»çš„é™æ€å­—æ®µæ—¶ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ– é€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– Father[] father = new Father[10]; //è¿™ä¸ªæ—¶å€™ Father ç±»ä¸ä¼šè¢«åˆå§‹åŒ– è°ƒç”¨å¸¸é‡ä¸ä¼šè§¦å‘æ­¤ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ã€‚å› ä¸ºå¸¸é‡åœ¨è¿æ¥é˜¶æ®µå·²ç»è¢«æ˜¾å¼èµ‹å€¼äº† static final int a = 1; //è¿™æ ·å®šä¹‰çš„ä¸ä¼š static final int b = Integer.valueOf(2); //è¿™æ ·å®šä¹‰çš„ä¼š è°ƒç”¨ ClassLoader ç±»çš„ loadClass( ) æ–¹æ³•åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸æ˜¯å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³• ClassLoader.getSystemClassLoader().loadClass(\"com.mysql.cj.jdbc.Driver\"); //ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ– è¿‡ç¨‹4ï¼šUsing ä½¿ç”¨é˜¶æ®µ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œnew å‡ºå®ä¾‹å¯¹è±¡â€¦ è¿‡ç¨‹5ï¼šUnloading å¸è½½é˜¶æ®µ ä¸€ä¸ªç±»åœ¨è¢«ç±»åŠ è½½å™¨åŠ è½½ã€åŠ è½½é˜¶æ®µã€‘æ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”±ç±»åŠ è½½å™¨å®ä¾‹å¯¹è±¡æ ¹æ®è¿™ä¸ªå®ä¾‹åœ¨æ–¹æ³•åŒºä¸­åˆ›å»ºç±»çš„ä¿¡æ¯ ==ä¸€ä¸ªç±»ä½•æ—¶ç»“æŸç”Ÿå‘½å‘¨æœŸï¼Œå–å†³äºå®ƒçš„ Class å¯¹è±¡åˆé€‚ç»“æŸç”Ÿå‘½å‘¨æœŸ== éœ€è¦å…¶æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½è¢«å›æ”¶ éœ€è¦å…¶ Class å¼•ç”¨å˜é‡è¢«å›æ”¶ éœ€è¦å…¶ç±»åŠ è½½å™¨çš„å¼•ç”¨å˜é‡åŠå¯¹è±¡è¢«å›æ”¶ å½“è¿™ä¸ªç±» Class å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œæ–¹æ³•åŒºå†…å®¹æ‰å¯ä»¥è¢«å›æ”¶ ç±»çš„å¸è½½ å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´æ˜¯ä¸å¯èƒ½è¢«å¸è½½çš„ï¼ˆ JVM è§„èŒƒï¼Œjls è§„èŒƒï¼‰ æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨è¿è¡ŒæœŸé—´ä¸å¤ªå¯èƒ½è¢«å¸è½½ï¼Œå› ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨å®ä¾‹æˆ–æ‰©å±•ç±»çš„å®ä¾‹åŸºæœ¬ä¸Šå¼„èƒ½è¢«ç›´æ¥æˆ–é—´æ¥çš„åŠ è½½åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªæœ‰åœ¨ç®€å•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¢«å¸è½½ï¼Œè°ƒç”¨ System.gc( ) å¼ºåˆ¶åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å¸è½½ å†è°ˆç±»åŠ è½½å™¨ å¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ä½¿ç”¨ C / C++ å®ç°çš„ ç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒç±»åº“ åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±» æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» ext å­ç›®å½• (æ‰©å±•ç›®å½•) åŠ è½½ç±»åº“ ç³»ç»Ÿç±»åŠ è½½å™¨ (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ApplicationClassLoader Java è¯­è¨€ç¼–å†™ï¼Œæ´¾ç”Ÿäº ClassLoader ç±»ï¼Œå±äºç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ä» path è·¯å¾„ä¸‹åŠ è½½ç±»åº“ æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼ŒJava åº”ç”¨çš„ç±»éƒ½ç”±å®ƒåŠ è½½ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ éœ€è¦ç»§æ‰¿äº ClassLoader å®ç°ç»å¦™çš„æ’ä»¶æœºåˆ¶ï¼šOS","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è‡ªå®šä¹‰ç±»åŠ è½½å™¨"},{"categories":null,"content":"\ræ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜"},{"categories":null,"content":"\rå…³äºæ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜ç•¥ ","date":"2022-01-21","objectID":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:1","series":null,"tags":null,"title":"JVMè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/jvm%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³äºæ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜"},{"categories":null,"content":"\rRabbitMQ å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-11-21 ç¬”è®°æ‘˜è‡ª bjpwernode ç§¦ä¸–å›½ ","date":"2021-11-21","objectID":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"RabbitMQè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#rabbitmq"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯é˜Ÿåˆ— MQ ( Message Queue ) è§£è€¦ ç”Ÿäº§è€…è´Ÿè´£å°†æ•°æ®å†™å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè°æƒ³ä¸æƒ³è¦è¿™ä¸ªæ•°æ®ï¼Œä¸ç”Ÿäº§è€…æ— å…³ æ¶ˆè´¹è€…ç›´æ¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œå³ä¾¿æ¶ˆè´¹è€…å®•æœºè¶…æ—¶ï¼Œä¸ç”Ÿäº§è€…æ— å…³ å¼‚æ­¥ ç”Ÿäº§è€…æ‰§è¡Œå®Œä¸»è¦åŠŸèƒ½åï¼Œå°†åç»­éœ€è¦å¤„ç†çš„åŠŸèƒ½å­˜å…¥æ¶ˆæ¯é˜Ÿåˆ—å³å¯è¿”å› å¼‚æ­¥åŒ–è°ƒç”¨å…¶ä»–ç³»ç»Ÿæ¥å£ï¼Œæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦ä¸å½±å“ç”Ÿäº§è€…æ€§èƒ½ å‰Šé”‹ / é™æµ ç”Ÿäº§è€…ä»¬æ ¹æ®è‡ªå·±çš„èƒ½åŠ›ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œå³ä¾¿ç³»ç»ŸåŒæ—¶æœ‰å†å¤šè¯·æ±‚éƒ½ä¸è‡³äºå´©æºƒ ","date":"2021-11-21","objectID":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"RabbitMQè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—"},{"categories":null,"content":"\rRabbitMQæ¶ˆæ¯é˜Ÿåˆ— Erlang è¯­è¨€å¼€å‘çš„ AMQP çš„å¼€æºå®ç° AMQPï¼šé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆåº”ç”¨å±‚ï¼‰ AMQP åè®®æœ¬èº«åŒ…æ‹¬ä¸‰å±‚ï¼š Module Layer: ä½äºåè®®æœ€é«˜å±‚ï¼Œä¸»è¦å®šä¹‰äº†ä¸€äº›ä¾›å®¢æˆ·ç«¯è°ƒç”¨çš„å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥åˆ©ç”¨è¿™äº›å‘½ä»¤å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨Queue . Declare å‘½ä»¤å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…ä½¿ç”¨Basic.Consume è®¢é˜…æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ Session Layer: ä½äºä¸­é—´å±‚ï¼Œä¸»è¦è´Ÿè´£å°†å®¢æˆ·ç«¯çš„å‘½ä»¤å‘é€ç»™æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡ç«¯çš„åº”ç­”è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸»è¦ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›å¯é æ€§åŒæ­¥æœºåˆ¶å’Œé”™è¯¯å¤„ç†ã€‚ Transport Layer: ä½äºæœ€åº•å±‚ï¼Œä¸»è¦ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®æµï¼Œæä¾›å¸§çš„å¤„ç†ã€ä¿¡é“å¤ç”¨ã€é”™è¯¯æ£€æµ‹å’Œæ•°æ®è¡¨ç¤ºç­‰ã€‚ ","date":"2021-11-21","objectID":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"RabbitMQè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#rabbitmqæ¶ˆæ¯é˜Ÿåˆ—"},{"categories":null,"content":"\rRabbitMQ ç‰¹ç‚¹ å¯é æ€§ï¼šæŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤ã€å‘å¸ƒç¡®è®¤ çµæ´»çš„è·¯ç”±ï¼šExchange æ¶ˆæ¯é›†ç¾¤ï¼šé›†ç¾¤ç»„æˆBroker é«˜å¯ç”¨ï¼šå®•æœºè§£å†³ å¤šç§åè®®ï¼šæ”¯æŒå¤šç§åè®® å¤šè¯­è¨€å®¢æˆ·ç«¯ï¼šæ”¯æŒå¸¸ç”¨ç¼–ç¨‹è¯­è¨€ ç®¡ç†ç•Œé¢ï¼šæä¾›å¯è§†åŒ–ç•Œé¢ è·Ÿè¸ªæœºåˆ¶ï¼šæ¶ˆæ¯å¼‚å¸¸æ—¶å¯è¿½è¸ªç»´æŠ¤ ","date":"2021-11-21","objectID":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"RabbitMQè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#rabbitmq-ç‰¹ç‚¹"},{"categories":null,"content":"\rRabbitMQå¸¸ç”¨å‘½ä»¤ å¯åŠ¨ RabbitMQï¼šrabbitmq-server start \u0026 å…³é—­ RabbitMQï¼šrabbitmqctl stop ","date":"2021-11-21","objectID":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"RabbitMQè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/rabbitmq%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#rabbitmqå¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rSpringBoot å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-11-15 ç¬”è®°æ‘˜è‡ª bjpwernode ç§¦ä¸–å›½ SpringBoot æ¡†æ¶ï¼Œæ•´åˆäº† Spring + SpringMVC + MyBatis æ¡†æ¶ï¼Œç®€åŒ–å¼€å‘ SpringBoot æŠ›å¼ƒäº†ç¹ççš„ xml é…ç½®è¿‡ç¨‹ï¼Œé‡‡ç”¨å¤§é‡é»˜è®¤é…ç½®ï¼Œç®€åŒ–å¼€å‘ ä½¿ç”¨ SpringBoot å¯ä»¥éå¸¸å®¹æ˜“å’Œå¿«é€Ÿçš„åˆ›å»ºåŸºäº Spring æ¡†æ¶çš„åº”ç”¨ç¨‹åº ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot"},{"categories":null,"content":"\rSpringBoot çš„ç‰¹æ€§ èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºåŸºäº Spring çš„åº”ç”¨ç¨‹åº èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ java main æ–¹æ³•å¯åŠ¨å†…åµŒçš„ Tomcat æœåŠ¡å™¨è¿è¡Œ SpringBoot ç¨‹åºï¼Œä¸éœ€è¦å¤–ç½® Tomcat å†éƒ¨ç½² war åŒ…æ–‡ä»¶ æä¾›çº¦å®šçš„ starter POMï¼ˆèµ·æ­¥ä¾èµ–ï¼‰ç®€åŒ– Maven é…ç½®ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–åŒ…ï¼Œæ¶ˆé™¤ç‰ˆæœ¬å†²çªé—®é¢˜ è‡ªåŠ¨åŒ–é…ç½®ï¼Œæ ¹æ®é¡¹ç›®çš„ Maven ä¾èµ–é…ç½®ï¼ŒSpring boot è‡ªåŠ¨é…ç½®æ•´åˆ ssm æä¾›äº†ç¨‹åºçš„å¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½ åŸºæœ¬å¯ä»¥æŠ›å¼ƒXMLé…ç½®æ–‡ä»¶ï¼Œé‡‡ç”¨æ³¨è§£é…ç½® ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-çš„ç‰¹æ€§"},{"categories":null,"content":"\rSpringBoot çš„å››å¤§æ ¸å¿ƒ èµ·æ­¥ä¾èµ– æ ¹æ®éœ€è¦çš„åŠŸèƒ½è‡ªåŠ¨é…ç½® Maven ä¾èµ– è‡ªåŠ¨é…ç½® æ ¹æ®èµ·æ­¥ä¾èµ–è‡ªåŠ¨æä¾›ç›¸å…³é…ç½® Actuator å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¯ä»¥çœ‹åˆ° SpringBoot è¿è¡ŒçŠ¶æ€ä¿¡æ¯ å‘½ä»¤è¡Œç•Œé¢ ä¸»è¦é’ˆå¯¹ Groovyï¼ˆä¸€ç§åŸºäº JVM çš„æ•æ·å¼€å‘è¯­è¨€ï¼‰ä½¿ç”¨ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-çš„å››å¤§æ ¸å¿ƒ"},{"categories":null,"content":"\ræ­å»º SpringBoot é¡¹ç›® åœ¨åˆ›å»º SpringBoot æ¨¡å—æ—¶ç¡®ä¿ç”µè„‘è”ç½‘ï¼Œç¡®è®¤ Server URL ä¸ºï¼šstart.springboot.io é€‰æ‹©èµ·æ­¥ä¾èµ– é¡¹ç›®ç»“æ„ ç¼–å†™æ§åˆ¶å™¨ å› ä¸ºè¿™é‡Œæ§åˆ¶å™¨ç±»ä½¿ç”¨çš„ä¸æ˜¯ @Controller æ³¨è§£ï¼Œæ‰€ä»¥å…¶ä¸­æ–¹æ³•è¿”å›å€¼ä¸ºé¡µé¢çš„è¾“å‡ºæµä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯å¯¹é¡µé¢çš„è¯·æ±‚è½¬å‘ @RestController æ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£ï¼Œç›¸å½“äºä¸ºæ‰€æœ‰æ–¹æ³•åŠ ä¸Šäº† @ResponseBody å¯åŠ¨ SpringBoot è‡ªå¸¦çš„ Tomcat æœåŠ¡å™¨ æˆæœ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-springboot-é¡¹ç›®"},{"categories":null,"content":"\r@SpringBootApplication æ³¨è§£ è¯¥æ³¨è§£ä¸º SpringBoot çš„==æ ¸å¿ƒæ³¨è§£== è¯¥æ³¨è§£æ ‡æ³¨çš„ç±»ä¸º SpringBoot çš„ç¨‹åºå…¥å£ç±» SpringBoot ä¼šæ‰«æå½“å‰ç±» åŒçº§è·¯å¾„ ä»¥åŠ å­å­™è·¯å¾„ ä¸­æ‰€æœ‰æ ‡æ³¨äº† SpringBoot æ³¨è§£çš„ç±» ä¸»è¦ä½œç”¨æ˜¯å¼€å¯ SpringBoot è‡ªåŠ¨é…ç½® ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:1","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springbootapplication-æ³¨è§£"},{"categories":null,"content":"\råˆ†æ ä¸»æ–¹æ³•å†…å®¹SpringApplication.run(SpringBootTestApplication.class, args); : å¯åŠ¨ SpringBoot åº”ç”¨ è¿è¡Œæ­¤ run æ–¹æ³•åï¼Œä¼šè¿”å› Spring çš„åº”ç”¨ä¸Šä¸‹æ–‡ ApplicationContext ç”±äºå¯åŠ¨çš„æ˜¯ WEB åº”ç”¨ï¼Œå› æ­¤å¯åŠ¨æ—¶ä¼šåŒæ—¶å¯åŠ¨å†…åµŒçš„ Tomcat æœåŠ¡å™¨ é»˜è®¤ç«¯å£å·ä¸º 8080ï¼Œé»˜è®¤åº”ç”¨ä¸Šä¸‹æ–‡è·¯å¾„ä¸º â€™ â€˜ï¼ˆè®¿é—®æ—¶æ— é¡¹ç›®åï¼‰ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ†æ-ä¸»æ–¹æ³•å†…å®¹"},{"categories":null,"content":"\råˆ†æ pom.xml æ–‡ä»¶å†…å®¹pom.xml ä¸­çš„ä¾èµ–ï¼š \u003cdependencies\u003e \u003c!--webé¡¹ç›®ç¯å¢ƒçš„èµ·æ­¥ä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-web\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!--æµ‹è¯•ç¯å¢ƒçš„èµ·æ­¥ä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003e åœ¨ \u003cparent\u003e æ ‡ç­¾ä¸­å¯ä»¥æŸ¥çœ‹å½“å‰é¡¹ç›®çˆ¶é¡¹ç›® spring-boot-starter-parent-2.5.6.pom çš„é…ç½®ä¿¡æ¯ï¼š \u003cproperties\u003e \u003c!--æŒ‡å®šé¡¹ç›®JDKç‰ˆæœ¬--\u003e \u003cjava.version\u003e1.8\u003c/java.version\u003e \u003c!--æŒ‡å®šè¾“å…¥çš„å­—ç¬¦é›†ç¼–ç æ ¼å¼--\u003e \u003cproject.build.sourceEncoding\u003eUTF-8\u003c/project.build.sourceEncoding\u003e \u003c!--æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦é›†ç¼–ç æ ¼å¼--\u003e \u003cproject.reporting.outputEncoding\u003eUTF-8\u003c/project.reporting.outputEncoding\u003e \u003c/properties\u003e \u003cbuild\u003e \u003c!--èµ„æºæ–‡ä»¶çš„è·¯å¾„ã€å‘½åè§„èŒƒæ ¼å¼--\u003e \u003cresources\u003e \u003cresource\u003e \u003cdirectory\u003e${basedir}/src/main/resources\u003c/directory\u003e \u003cfiltering\u003etrue\u003c/filtering\u003e \u003cincludes\u003e \u003cinclude\u003e**/application*.yml\u003c/include\u003e \u003cinclude\u003e**/application*.yaml\u003c/include\u003e \u003cinclude\u003e**/application*.properties\u003c/include\u003e \u003c/includes\u003e \u003c/resource\u003e \u003cresource\u003e \u003cdirectory\u003e${basedir}/src/main/resources\u003c/directory\u003e \u003cexcludes\u003e \u003cexclude\u003e**/application*.yml\u003c/exclude\u003e \u003cexclude\u003e**/application*.yaml\u003c/exclude\u003e \u003cexclude\u003e**/application*.properties\u003c/exclude\u003e \u003c/excludes\u003e \u003c/resource\u003e \u003c/resources\u003e \u003c/build\u003e åœ¨çˆ¶é¡¹ç›®çš„ \u003cparent\u003e æ ‡ç­¾ä¸­å¯ä»¥æŸ¥çœ‹çˆ¶é¡¹ç›®çˆ¶é¡¹ç›® spring-boot-dependencies-2.5.6.pom çš„é…ç½®ä¿¡æ¯ï¼š \u003c!--ä¾èµ–çš„ç‰ˆæœ¬æ§åˆ¶--\u003e \u003cproperties\u003e \u003c!--mysqlæ•°æ®åº“ç‰ˆæœ¬--\u003e \u003cmysql.version\u003e8.0.27\u003c/mysql.version\u003e \u003c!--Springæ¡†æ¶ç‰ˆæœ¬--\u003e \u003cspring-framework.version\u003e5.3.12\u003c/spring-framework.version\u003e ..... \u003c/properties\u003e è¿™äº›éƒ½å¯ä»¥åœ¨å½“å‰é¡¹ç›®çš„ pom.xml ä¸­è¦†ç›–ä¿®æ”¹ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:3","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ†æ-pomxml-æ–‡ä»¶å†…å®¹"},{"categories":null,"content":"\rå±æ€§é…ç½®æ–‡ä»¶ ç”¨äºæ”¹å˜ SpringBoot çš„é»˜è®¤è¿è¡Œè¡Œä¸º å¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ”¹å˜ SpringBoot çš„é»˜è®¤è¡Œä¸ºï¼Œä¾‹å¦‚ Tomcat çš„é»˜è®¤ç«¯å£å·ã€ä¸Šä¸‹æ–‡è®¿é—®è·¯å¾„ application.properties # è¿™é‡Œæ˜¯ SpringBoot çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ”¹å˜ SpringBoot çš„é»˜è®¤è¡Œä¸ºï¼Œä¾‹å¦‚ Tomcat çš„é»˜è®¤ç«¯å£å·ã€ä¸Šä¸‹æ–‡è®¿é—®è·¯å¾„ # è®¾ç½® Tomcat æœåŠ¡å™¨ç«¯å£å·ä¸º 9100 server.port=9100 # è®¾ç½®äººä¸‹æ–‡è®¿é—®è·¯å¾„(é¡¹ç›®å)ä¸º boot server.servlet.context-path=/boot application.yml # yml/yaml å’Œ properties ä¸€æ ·ï¼Œä¹Ÿæ˜¯ SpringBoot çš„é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡ yml æ–‡ä»¶æ›´å…·å±‚æ¬¡æ„Ÿ server: port: 9100 servlet: context-path: /boot properties å’Œ yml æ–‡ä»¶åŒæ—¶å­˜åœ¨æ—¶ï¼Œproperties æ–‡ä»¶çš„ä¼˜å…ˆçº§æ›´é«˜ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å±æ€§é…ç½®æ–‡ä»¶"},{"categories":null,"content":"\rå¤šç¯å¢ƒé…ç½® # æ¿€æ´»é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äºæŠŠ dev ä¸­çš„å†…å®¹æ‹·è´åˆ°è¿™ï¼ˆå¤šæ–‡ä»¶å¯ä»¥é€—å·åˆ†å‰²ï¼‰ spring.profiles.active=online ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:1","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¤šç¯å¢ƒé…ç½®"},{"categories":null,"content":"\rè‡ªå®šä¹‰å±æ€§ @Value åœ¨ application ç±»å¯è¯†åˆ«çš„ä»»ä½•ç±»ä¸­éƒ½å¯ä»¥ä½¿ç”¨ @Value(${å±æ€§å}) ä¸ºå˜é‡èµ‹å€¼ # æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨ä¸­æ–‡ï¼Œä¸èƒ½ä½¿ç”¨æ•æ„Ÿè¯å¦‚ name... stuName = zhangsan stuAge = 24 ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:2","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è‡ªå®šä¹‰å±æ€§-value"},{"categories":null,"content":"\rä¸ºå¯¹è±¡æ³¨å…¥å±æ€§ @ConfigurationProperties åœ¨ç±»ä¸Šæ–¹æ ‡æ³¨æ³¨è§£ @ConfigurationProperties(prefix = \"å‰ç¼€\") æ­¤ç±»å¿…é¡»æœ‰ get / set æ–¹æ³•ï¼Œå¿…é¡»ç”± Spring å®¹å™¨ç®¡ç† @ConfigurationProperties(prefix = \"stu\") @Component public class Student { private String name; private Integer age; public String getName() { return name; } public void setName(String name) { this.name = name; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } stu.name = zhangsan stu.age = 24 ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:3","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸ºå¯¹è±¡æ³¨å…¥å±æ€§-configurationproperties"},{"categories":null,"content":"\rä¸­æ–‡ä¹±ç é—®é¢˜ å½“å±æ€§å€¼ä¸ºä¸­æ–‡æ—¶ä¼šäº§ç”Ÿä¹±ç é—®é¢˜ï¼Œä¾‹ï¼š stu.name = å¼ ä¸‰ stu.age = 24 è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨unicodeç¼–ç çš„ä¸­æ–‡ï¼šç™¾åº¦ä¸€ä¸‹ â€œä¸­æ–‡è½¬unicodeâ€ # å¼ ä¸‰ =\u003e \\u5f20\\u4e09 stu.name = \\u5f20\\u4e09 stu.age = 24 ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:4","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸­æ–‡ä¹±ç é—®é¢˜"},{"categories":null,"content":"\rSpringBoot ä½¿ç”¨ JSP æ–‡ä»¶ SpringBoot é»˜è®¤ä¸æ¨è JSPï¼Œæƒ³ä½¿ç”¨ JSP éœ€è¦åœ¨ pom.xml æ‰‹åŠ¨å¯¼å…¥ç›¸å…³ä¾èµ– \u003c!--å¼•å…¥Spring Bootå†…åµŒçš„Tomcatå¯¹JSPçš„è§£æåŒ…ï¼Œä¸åŠ è§£æä¸äº†jspé¡µé¢--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.tomcat.embed\u003c/groupId\u003e \u003cartifactId\u003etomcat-embed-jasper\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- servletä¾èµ–çš„jaråŒ…start ï¼Œå¯é€‰--\u003e \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- servletä¾èµ–çš„jaråŒ…end --\u003e \u003c!-- jspä¾èµ–jaråŒ…start ï¼Œå¯é€‰--\u003e \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet.jsp\u003c/groupId\u003e \u003cartifactId\u003ejavax.servlet.jsp-api\u003c/artifactId\u003e \u003cversion\u003e2.3.1\u003c/version\u003e \u003c/dependency\u003e \u003c!-- jspä¾èµ–jaråŒ…end --\u003e \u003c!--jstlæ ‡ç­¾ä¾èµ–çš„jaråŒ…start ï¼Œå¯é€‰--\u003e \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e \u003cartifactId\u003ejstl\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!--jstlæ ‡ç­¾ä¾èµ–çš„jaråŒ…end --\u003e \u003cresources\u003e \u003cresource\u003e \u003c!--æºæ–‡ä»¶ä½ç½® --\u003e \u003cdirectory\u003esrc/main/webapp\u003c/directory\u003e \u003c!--ç¼–è¯‘åˆ° META-INF/resourece ç›®å½•ä¸‹ä¸èƒ½éšä¾¿å†™ è¿™ä¸ªè·¯å¾„è¡¨ç¤ºç¼–è¯‘åçš„æ ¹è·¯å¾„ --\u003e \u003ctargetPath\u003eMETA-INF/resources\u003c/targetPath\u003e \u003cincludes\u003e \u003c!--è¦é‚£äº›æ–‡ä»¶ç¼–è¯‘è¿‡å»ï¼Œ**è¡¨ç¤º webapp ç›®å½•ä¸‹ä»¥åŠå­å­™ç›®å½•ï¼Œ*.* è¡¨ç¤ºæ‰€æœ‰æ–‡ä»¶ --\u003e \u003cinclude\u003e**/*.*\u003c/include\u003e \u003c/includes\u003e \u003c/resource\u003e \u003c/resources\u003e åœ¨ application.properties æ–‡ä»¶ä¸­åŠ å…¥è§†å›¾è§£æå™¨ #è§†å›¾è§£æå™¨ï¼Œ / ç›¸å½“äº src/main/webapp ç›®å½• spring.mvc.view.prefix=/ spring.mvc.view.suffix=.jsp ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-ä½¿ç”¨-jsp-æ–‡ä»¶"},{"categories":null,"content":"\rSpringBoot æ•´åˆ MyBatis åœ¨åˆ›å»ºé¡¹ç›®æ—¶å‹¾é€‰ SQL ä¸­çš„ MyBatis Framework å’Œ MySQL Driverï¼ŒåŸºç¡€æ•´åˆ SSM åœ¨ pom.xml ä¸­ä¿®æ”¹ MySQL ç‰ˆæœ¬ \u003cdependency\u003e \u003cgroupId\u003emysql\u003c/groupId\u003e \u003cartifactId\u003emysql-connector-java\u003c/artifactId\u003e \u003cscope\u003eruntime\u003c/scope\u003e \u003c!--æŒ‡å®šMySQLé©±åŠ¨ç‰ˆæœ¬--\u003e \u003cversion\u003e8.0.27\u003c/version\u003e \u003c/dependency\u003e æ·»åŠ  MyBatis é€†å‘å·¥ç¨‹æ’ä»¶ \u003cplugin\u003e \u003cgroupId\u003eorg.mybatis.generator\u003c/groupId\u003e \u003cartifactId\u003emybatis-generator-maven-plugin\u003c/artifactId\u003e \u003cversion\u003e1.3.6\u003c/version\u003e \u003cconfiguration\u003e \u003c!--é…ç½®æ–‡ä»¶çš„ä½ç½®--\u003e \u003cconfigurationFile\u003eGeneratorMapper.xml\u003c/configurationFile\u003e \u003cverbose\u003etrue\u003c/verbose\u003e \u003coverwrite\u003etrue\u003c/overwrite\u003e \u003c/configuration\u003e \u003c/plugin\u003e åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º GeneratorMapper.xml é€†å‘å·¥ç¨‹æ˜ å°„æ–‡ä»¶ï¼Œå¹¶é…ç½®ä¿¡æ¯ \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!DOCTYPE generatorConfiguration PUBLIC \"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN\" \"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd\"\u003e \u003cgeneratorConfiguration\u003e \u003c!-- æŒ‡å®šè¿æ¥æ•°æ®åº“çš„JDBCé©±åŠ¨åŒ…æ‰€åœ¨ä½ç½®ï¼ŒæŒ‡å®šåˆ°ä½ æœ¬æœºçš„å®Œæ•´è·¯å¾„ --\u003e \u003cclassPathEntry location=\"D:\\Document\\JDBC\\mysql-connector-java-8.0.27.jar\"/\u003e \u003c!-- é…ç½®tableè¡¨ä¿¡æ¯å†…å®¹ä½“ï¼ŒtargetRuntimeæŒ‡å®šé‡‡ç”¨MyBatis3çš„ç‰ˆæœ¬ --\u003e \u003ccontext id=\"tables\" targetRuntime=\"MyBatis3\"\u003e \u003c!-- æŠ‘åˆ¶ç”Ÿæˆæ³¨é‡Šï¼Œç”±äºç”Ÿæˆçš„æ³¨é‡Šéƒ½æ˜¯è‹±æ–‡çš„ï¼Œå¯ä»¥ä¸è®©å®ƒç”Ÿæˆ --\u003e \u003ccommentGenerator\u003e \u003cproperty name=\"suppressAllComments\" value=\"true\" /\u003e \u003c/commentGenerator\u003e \u003c!-- é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ --\u003e \u003cjdbcConnection driverClass=\"com.mysql.cj.jdbc.Driver\" connectionURL=\"jdbc:mysql://127.0.0.1:3306/springbootdb\" userId=\"root\" password=\"129807\"\u003e \u003c/jdbcConnection\u003e \u003c!-- ç”Ÿæˆmodelç±»ï¼ŒtargetPackageæŒ‡å®šmodelç±»çš„åŒ…åï¼Œ targetProjectæŒ‡å®šç”Ÿæˆçš„modelæ”¾åœ¨eclipseçš„å“ªä¸ªå·¥ç¨‹ä¸‹é¢--\u003e \u003cjavaModelGenerator targetPackage=\"com.bjpn.springbootmybatis.model\" targetProject=\"src/main/java\"\u003e \u003cproperty name=\"enableSubPackages\" value=\"false\" /\u003e \u003cproperty name=\"trimStrings\" value=\"false\" /\u003e \u003c/javaModelGenerator\u003e \u003c!-- ç”ŸæˆMyBatisçš„Mapper.xmlæ–‡ä»¶ï¼ŒtargetPackageæŒ‡å®šmapper.xmlæ–‡ä»¶çš„åŒ…åï¼Œ targetProjectæŒ‡å®šç”Ÿæˆçš„mapper.xmlæ”¾åœ¨eclipseçš„å“ªä¸ªå·¥ç¨‹ä¸‹é¢ --\u003e \u003csqlMapGenerator targetPackage=\"com.bjpn.springbootmybatis.mapper\" targetProject=\"src/main/java\"\u003e \u003cproperty name=\"enableSubPackages\" value=\"false\" /\u003e \u003c/sqlMapGenerator\u003e \u003c!-- ç”ŸæˆMyBatisçš„Mapperæ¥å£ç±»æ–‡ä»¶,targetPackageæŒ‡å®šMapperæ¥å£ç±»çš„åŒ…åï¼Œ targetProjectæŒ‡å®šç”Ÿæˆçš„Mapperæ¥å£æ”¾åœ¨eclipseçš„å“ªä¸ªå·¥ç¨‹ä¸‹é¢ --\u003e \u003cjavaClientGenerator type=\"XMLMAPPER\" targetPackage=\"com.bjpn.springbootmybatis.mapper\" targetProject=\"src/main/java\"\u003e \u003cproperty name=\"enableSubPackages\" value=\"false\" /\u003e \u003c/javaClientGenerator\u003e \u003c!-- æ•°æ®åº“è¡¨ååŠå¯¹åº”çš„Javaæ¨¡å‹ç±»å --\u003e \u003ctable tableName=\"t_user\" domainObjectName=\"User\" enableCountByExample=\"false\" enableUpdateByExample=\"false\" enableDeleteByExample=\"false\" enableSelectByExample=\"false\" selectByExampleQueryId=\"false\"/\u003e \u003c/context\u003e \u003c/generatorConfiguration\u003e åœ¨ application.properties ä¸­é…ç½®æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ # æŒ‡å®š MySQL é©±åŠ¨ä½ç½® spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://127.0.0.1:3306/springbootdb?useUnicode=true\u0026characterEncoding=utf8\u0026useSSL=false spring.datasource.username=root spring.datasource.password=129807 åŒå‡» Maven å·¥å…·ä¸­çš„ mybatis-generator:generate ç”Ÿæˆ mapper åŒ…ï¼ˆmapperæ¥å£å’Œmapperæ˜ å°„æ–‡ä»¶ï¼‰åŠ model åŒ…ï¼ˆå®ä½“ç±»ï¼‰ è‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤ mapper æ¥å£åŒ…å«çš„åŠŸèƒ½ ==æŒ‡å®š MyBatis çš„ mapper æ˜ å°„æ–‡ä»¶ä½ç½®== åœ¨æ¯ä¸€ä¸ª mapper æ¥å£ä¸Šæ ‡æ³¨ @Mapper æ³¨è§£ åœ¨ SpringBoot çš„ä¸»æ–¹æ³•ä¸Šæ ‡æ³¨ @MapperScan(basePackages = {\"mapper åŒ…çš„ source root è·¯å¾„\"}) ã€æ¨èã€‘ åœ¨ application.properties ä¸­æŒ‡å®š Mybatis æ˜ å°„æ–‡ä»¶çš„è·¯å¾„ mybatis.mapper-locations=classpath:mapper/*.xml åœ¨ pom.xml ä¸­æ·»åŠ æŒ‡å®šèµ„æºè·¯å¾„ï¼Œè®©javaä¸‹æ‰€æœ‰ .xml æ–‡ä»¶éƒ½å‚ä¸ç¼–è¯‘ \u003cresources\u003e \u003cresource\u003e \u003cdirectory\u003esrc/main/java\u003c/directory\u003e \u003cincludes\u003e \u003cinclude\u003e**/*.xml\u003c/include\u003e \u003c/includes\u003e \u003c/resource\u003e \u003c/resources\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-æ•´åˆ-mybatis"},{"categories":null,"content":"\räº‹åŠ¡æ”¯æŒ åœ¨ SpringBoot çš„ä¸»æ–¹æ³•ä¸Šæ ‡æ³¨æ³¨è§£ @EnableTransactionManagement å¼€å¯äº‹åŠ¡ åœ¨éœ€è¦äº‹åŠ¡çš„ service æ–¹æ³•ä¸Šæ ‡æ³¨æ³¨è§£ @Transactional åœ¨å¼€å¯äº†äº‹åŠ¡çš„æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸å°±ä¼šè‡ªåŠ¨ rollback å›æ»š ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:1","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äº‹åŠ¡æ”¯æŒ"},{"categories":null,"content":"\rSpringBoot æ•´åˆRedis åœ¨åˆ›å»ºé¡¹ç›®æ—¶å‹¾é€‰ NoSQL ä¸­çš„ Spring Data Redis åœ¨ application.properties ä¸­é…ç½® Redis è¿æ¥åŸºæœ¬ä¿¡æ¯ #é…ç½®redisè¿æ¥ä¿¡æ¯ spring.redis.host=192.168.30.128 spring.redis.port=6379 spring.redis.password=129807 åœ¨ä¸šåŠ¡å±‚å®šä¹‰ RedisTemplate ç±»å˜é‡ï¼Œè®© Spring å®¹å™¨è‡ªåŠ¨å¯¼å…¥ @Resource private RedisTemplate redisTemplate; redisTemplate.opsForValue().set(\"userAll\", list); redisTemplate.opsForValue().get(\"userAll\"); ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-æ•´åˆredis"},{"categories":null,"content":"\rRedis çš„ç¼“å­˜ç©¿é€é—®é¢˜ Redis ä½œä¸ºæ•°æ®åº“çš„ç¼“å­˜æ•°æ®åº“æ—¶ï¼Œå¤šçº¿ç¨‹å¹¶å‘åŒæ—¶è¯·æ±‚ä¸€æ¡æ•°æ®æ—¶ï¼ŒRedis ä¸­å¹¶æ²¡æœ‰è¿™æ¡æ•°æ®å°±ä¼šåŒæ—¶ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ã€‚ è§£å†³æ–¹æ¡ˆï¼š ä¸ºä¸šåŠ¡æ–¹æ³•æ·»åŠ  synchronized é”ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ï¼Œç¬¬äºŒæ¬¡æ—¶ Redis ä¸­å·²ç»æœ‰ç¼“å­˜ï¼Œå…¶ä½™éƒ½è®¿é—® Redis ä¼šä½¿å¹¶å‘å¤±æ•ˆï¼Œé™ä½è¿è¡Œé€Ÿåº¦ ä¸ºä¸šåŠ¡ä»£ç å—æ·»åŠ  synchronized é”ï¼Œåœ¨ç¬¬ä¸€æ‰¹æ¬¡å¹¶å‘è¯·æ±‚ä¸­ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°æ•°æ®å¹¶å­˜åˆ°ç¼“å­˜æœåŠ¡å™¨åï¼Œç¬¬äºŒä¸ªè¯·æ±‚èƒ½ç›´æ¥è¯»å–åˆ°ç¼“å­˜æ•°æ® ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:1","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#redis-çš„ç¼“å­˜ç©¿é€é—®é¢˜"},{"categories":null,"content":"\rRedis é›†ç¾¤ã€å“¨å…µæ¨¡å¼ Redis ä½œä¸ºæ•°æ®åº“çš„ç¼“å­˜æ•°æ®åº“æ—¶ï¼Œä¸€æ—¦å®•æœºé¡¹ç›®å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œï¼Œè¿™æ—¶å°±ç”¨åˆ°äº†é›†ç¾¤ å¤šå° Redis æ•°æ®åº“åšé›†ç¾¤æ—¶ï¼Œé€šå¸¸ç”±ä¸€å°ä¸»æœåŠ¡å™¨å¤šå°ä»æœåŠ¡å™¨ç»„æˆï¼Œå½“ä¸»èŠ‚ç‚¹æ•°æ®æ”¹å˜æ—¶ï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨ä¾ç…§æ”¹å˜ é…ç½®ä¸»ä»èŠ‚ç‚¹ï¼š ä¸»èŠ‚ç‚¹ ä»èŠ‚ç‚¹ é…ç½®å“¨å…µèŠ‚ç‚¹ï¼š å“¨å…µï¼šç±»ä¼¼äº Dubbo çš„æ³¨å†Œä¸­å¿ƒï¼ŒJava ç¨‹åºä¸å“¨å…µäº¤äº’ï¼Œç”±å“¨å…µç®¡ç†èŠ‚ç‚¹çš„ä¸»ä»ï¼ˆä¾ç…§å®•æœºæƒ…å†µï¼‰ã€‚å®ç°é«˜å¯ç”¨ å’Œ Dubbo çš„ Zookeeper æ³¨å†Œä¸­å¿ƒä¸€æ ·ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½è®¿é—®å“¨å…µï¼Œå½“ä¸»èŠ‚ç‚¹ä¸å¯ç”¨æ—¶æ‰ä¼šç”±å“¨å…µç®¡ç† sentinel.conf * èŠ‚ç‚¹æ•°é‡ å¯åŠ¨å“¨å…µ * èŠ‚ç‚¹æ•°é‡ é…ç½® application.properties é…ç½® #é…ç½®rediså“¨å…µè¿æ¥ä¿¡æ¯ï¼šå“¨å…µåœ°å€ä»¬ï¼Œå“¨å…µåç§°ï¼Œå¯†ç  spring.redis.sentinel.nodes=192.168.235.128:26380,192.168.235.128:26382,192.168.235.128:26384 spring.redis.sentinel.master=mymaster spring.redis.password=123456 ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:2","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#redis-é›†ç¾¤å“¨å…µæ¨¡å¼"},{"categories":null,"content":"\rSpringBoot çƒ­éƒ¨ç½²æ’ä»¶ï¼š çƒ­éƒ¨ç½²æ’ä»¶å¯ä»¥åœ¨ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡æ–°åŠ è½½ä¿®æ”¹å†…å®¹ï¼Œé¿å…é‡å¯æœåŠ¡å™¨åå¤ç¼–è¯‘æœªä¿®æ”¹ä»£ç  åœ¨ pom.xml ä¸­å¼•å…¥çƒ­éƒ¨ç½²æ’ä»¶ä¾èµ– \u003c!--SpringBootçƒ­éƒ¨ç½²æ’ä»¶--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-devtools\u003c/artifactId\u003e \u003coptional\u003etrue\u003c/optional\u003e \u003c/dependency\u003e Recompile é€‰ä¸­çš„æ–‡ä»¶ï¼Œé¿å…é‡æ–°ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ã€‚ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-çƒ­éƒ¨ç½²æ’ä»¶"},{"categories":null,"content":"\rSpringBoot å¯åŠ¨é WEB å·¥ç¨‹ åœ¨åˆ›å»ºæ¨¡å—æ—¶ï¼Œä¸å‹¾é€‰èµ·æ­¥ä¾èµ– åœ¨ä¸»å…¥å£ run æ–¹æ³•å‰æ¥æ”¶è¿”å›å€¼ï¼šSpring å®¹å™¨ï¼Œè°ƒç”¨ getBean è·å–å®ä¾‹å¯¹è±¡ @SpringBootApplication public class SpringBootjavaApplication { public static void main(String[] args) { ApplicationContext context = SpringApplication.run(SpringBootjavaApplication.class, args); DoSomeService doSomeService = (DoSomeService) context.getBean(\"doSomeService\"); doSomeService.sayHello(); } } è®©ä¸»å…¥å£ç±»å®ç° CommandLineRunner æ¥å£ï¼Œå¹¶é‡å†™ run æ–¹æ³• ç¨‹åºå¯åŠ¨åä¼šè°ƒç”¨ run æ–¹æ³•ï¼Œæ­¤æ—¶çš„ Spring å®¹å™¨å·²ç»å¯åŠ¨å®Œæˆ @SpringBootApplication public class SpringBootjavaApplication implements CommandLineRunner { @Resource private DoSomeService doSomeService; public static void main(String[] args) { SpringApplication.run(SpringBootjavaApplication.class, args); } @Override public void run(String... args) throws Exception { doSomeService.sayHello(); } } ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-å¯åŠ¨é-web-å·¥ç¨‹"},{"categories":null,"content":"\rSpringBoot ä½¿ç”¨æ‹¦æˆªå™¨ åˆ›å»ºæ‹¦æˆªå™¨ç±» @Component public class MyInterceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { System.out.println(\"æ‹¦æˆªå™¨æˆåŠŸæ‹¦æˆª\"); return false; } } åˆ›å»ºé…ç½®ç±» @Configuration æ³¨è§£ä¸ºæ ‡è®°æ­¤ç±»ä¸º Spring çš„é…ç½®ç±» å®ç° WebMvcConfigurer æ¥å£ç›¸å½“äºå°†æ­¤ç±»æ·»åŠ åˆ° MVC çš„å‘½åç©ºé—´ä¸­ é€šè¿‡é‡å†™ addInterceptors æ–¹æ³•ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ç±»ï¼Œé…ç½®æ‹¦æˆªè§„åˆ™ @Configuration public class MyConfig implements WebMvcConfigurer { @Resource private MyInterceptor myInterceptor; /** * æ³¨å†Œæ‹¦æˆªå™¨ï¼Œç›¸å½“äº \u003cmvc:interceptors\u003e\u003c/mvc:interceptors\u003e * @param registry æ‹¦æˆªå™¨çš„æ³¨å†Œå¯¹è±¡ */ @Override public void addInterceptors(InterceptorRegistry registry) { //æ·»åŠ æ‹¦æˆªå™¨ InterceptorRegistration interceptorRegistration = registry.addInterceptor(myInterceptor); //é…ç½®æ‹¦æˆªè§„åˆ™ interceptorRegistration.addPathPatterns(\"/private/**\"); //é…ç½®è¯·æ±‚å¿½ç•¥è§„åˆ™ interceptorRegistration.excludePathPatterns(\"/private/test02\"); } } ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œåœ¨è®¿é—® test01 æ—¶æ‹¦æˆªï¼Œè®¿é—® test02 æ—¶å¿½ç•¥ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-ä½¿ç”¨æ‹¦æˆªå™¨"},{"categories":null,"content":"\rSpringBoot å­—ç¬¦ç¼–ç  æ·»åŠ  application.properties é…ç½® # æŒ‡å®šç¼–ç æ ¼å¼ spring.http.encoding.charset=UTF-8 # æ¿€æ´»HttpSpringBootç¼–ç  spring.http.encoding.enabled=true # å¼ºåˆ¶Requestå’ŒResponseéƒ½æ˜¯ç”¨è¿™ç§ç¼–ç æ ¼å¼ spring.http.encoding.force=true ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-å­—ç¬¦ç¼–ç "},{"categories":null,"content":"\rSpringBoot æ‰“åŒ… war åŒ… åœ¨åˆ›å»ºæ¨¡å—æ—¶å°±é€‰æ‹© warï¼Œpom.xml ä¸­é»˜è®¤æ‰“åŒ…æ–¹å¼å°±ä¼šå˜æˆ war åŒ…ï¼Œåœ¨æ‰“åŒ…æ—¶å†…åµŒ Tomcat ä¸å‚ä¸æ‰“åŒ… ç‚¹å‡» Maven å·¥å…·ä¸­çš„ package å³å¯åœ¨ target ç›®å½•ä¸­ç”Ÿæˆ war åŒ… ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-æ‰“åŒ…-war-åŒ…"},{"categories":null,"content":"\rSpringBoot æ‰“åŒ… jar åŒ… æ‰“åŒ… jar åŒ…å¹¶ä¸Šä¼ è‡³ linux æœåŠ¡å™¨ï¼Œä½¿ç”¨ java -jar jaråŒ…æ–‡ä»¶å.jar å¯åŠ¨ SpringBoot å†…åµŒTomcat å°è£… shell è„šæœ¬ touch ä¸€ä¸ª run.sh æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…å†™å…¥ java -jar jaråŒ…æ–‡ä»¶å.jar å‘½ä»¤ chmod 777 run.sh ä¿®æ”¹æ–‡ä»¶æƒé™ ./run.sh å¯åŠ¨ Tomcat æœåŠ¡å™¨ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-æ‰“åŒ…-jar-åŒ…"},{"categories":null,"content":"\rSpringBoot ä½¿ç”¨ Servletï¼ŒFilterServletï¼šã€å·²è¢«æ§åˆ¶å™¨æ›¿ä»£ï¼Œä¸å¿…æŒæ¡ã€‘ åœ¨å…¥å£ç±»ä¸Šæ ‡æ³¨ @ServletComponentScan(basePackage = \"ServletåŒ…è·¯å¾„\") åœ¨ Servlet ç±»ä¸Šæ–¹æ ‡æ³¨ WebServlet(\"/é¡¹ç›®å\") æ³¨è§£ï¼Œå³å¯è®© SpringBoot æ‰«æåˆ° é€šè¿‡ @Configuration é…ç½®ç±»è·å– Bean /** * @Beanæ ‡è®°å½“å‰æ–¹æ³•æ˜¯ä¸€ä¸ªSpringçš„Beané…ç½®æ–¹æ³• * æ–¹æ³•åå°±æ˜¯Beançš„IDï¼Œè¿”å›å€¼å°±æ˜¯Beançš„Class */ @Bean public ServletRegistrationBean heServletRegistrationBean(TestServlet testServlet){ //è·å–Servletæ³¨å†ŒBean ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(); //æ³¨å†ŒServlet servletRegistrationBean.setServlet(testServlet); //è¿”å›class return servletRegistrationBean; } Filterï¼šã€å·²è¢«æ‹¦æˆªå™¨æ›¿ä»£ï¼Œä¸å¿…æŒæ¡ã€‘ åœ¨å…¥å£ç±»ä¸Šæ ‡æ³¨ @ServletComponentScan(basePackage = \"FilteråŒ…è·¯å¾„\") åœ¨ Filterç±»ä¸Šæ–¹æ ‡æ³¨ @WebFilter(urlPatterns=\"/*\") æ³¨è§£ï¼Œå³å¯è®© SpringBoot æ‰«æåˆ° é€šè¿‡ @Configuration é…ç½®ç±»è·å– Bean @Bean public FilterRegistrationBean heFilterRegistration(TestFilter testFilter) { //è·å–Filteræ³¨å†ŒBean FilterRegistrationBean filterRegistration = new FilterRegistrationBean(); //æ³¨å†ŒFilter filterRegistration.setFilter(testFilter); //è®¾ç½®è¿‡æ»¤è·¯å¾„ filterRegistration.addUrlPatterns(\"/*\"); //è¿”å›class return filterRegistration; } ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:14:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-ä½¿ç”¨-servletfilter"},{"categories":null,"content":"\rSprintBoot å¥åº·æ£€æŸ¥æœºåˆ¶ åœ¨åˆ›å»ºæ¨¡å—æ—¶å‹¾é€‰ Ops ä¸­çš„Spring Boot Actuator ã€ä¸å¿…æŒæ¡ã€‘ GET /env æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡ HTTPæ–¹æ³• è·¯å¾„ æè¿° GET /configprops æŸ¥çœ‹é…ç½®å±æ€§ï¼ŒåŒ…æ‹¬é»˜è®¤é…ç½® http://www.haojson.comå¯¹jsonè¿›è¡Œæ ¼å¼åŒ– GET /beans æŸ¥çœ‹Springå®¹å™¨ç›®å‰åˆå§‹åŒ–çš„beanåŠå…¶å…³ç³»åˆ—è¡¨ GET /mappings æŸ¥çœ‹æ‰€æœ‰urlæ˜ å°„ GET /health æŸ¥çœ‹åº”ç”¨å¥åº·æŒ‡æ ‡ GET /info æŸ¥çœ‹åº”ç”¨ä¿¡æ¯ GET /metrics æŸ¥çœ‹åº”ç”¨åŸºæœ¬æŒ‡æ ‡ GET /metrics/{name} æŸ¥çœ‹å…·ä½“æŒ‡æ ‡ JMX /shutdown å…³é—­åº”ç”¨ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sprintboot-å¥åº·æ£€æŸ¥æœºåˆ¶"},{"categories":null,"content":"\rSpringBoot ä¸­çš„ Thymeleaf æ¨¡æ¿ Thymeleaf æ˜¯ç”¨æ¥å¼€å‘ Web å’Œç‹¬ç«‹ç¯å¢ƒé¡¹ç›®çš„æœåŠ¡å™¨ç«¯çš„ Java æ¨¡ç‰ˆå¼•æ“ SpringBoot å¹¶ä¸æ”¯æŒ JSP ä½†å®Œç¾æ•´åˆäº† Thymeleaf ï¼Œç”šè‡³é›†æˆäº† Thymeleaf çš„è‡ªåŠ¨åŒ–é…ç½®ã€è§†å›¾è§£æå™¨ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-ä¸­çš„-thymeleaf-æ¨¡æ¿"},{"categories":null,"content":"\rThymeleaf çš„ç‰¹ç‚¹ åŠ¨é™ç»“åˆï¼šThymeleaf åœ¨æœ‰ç½‘ç»œå’Œæ— ç½‘ç»œçš„ç¯å¢ƒä¸‹çš†å¯è¿è¡Œï¼Œå³èƒ½ç›´æ¥æ˜¾ç¤ºæ¨¡æ¿ä¸Šçš„é™æ€æ•°æ®ï¼›ä¹Ÿèƒ½åƒ Jsp ä¸€æ ·åŠ¨æ€çš„ä»åå°æ¥æ”¶æ•°æ®å¹¶æ›¿æ¢æ‰æ¨¡æ¿ä¸Šçš„é™æ€æ•°æ®ã€‚è¿™æ˜¯ç”±äºä»¥ HTML æ ‡ç­¾ä¸ºè½½ä½“ï¼Œè¦å¯„æ‰˜åœ¨ HTML æ ‡ç­¾ä¸‹å®ç°ã€‚ å¼€ç®±å³ç”¨ï¼šå®ƒæä¾›æ ‡å‡†å’Œ spring æ ‡å‡†ä¸¤ç§æ–¹è¨€ï¼Œå¯ä»¥ç›´æ¥å¥—ç”¨æ¨¡æ¿å®ç° JSTLã€ OGNL è¡¨è¾¾å¼æ•ˆæœï¼Œé¿å…æ¯å¤©å¥—æ¨¡æ¿ã€è¯¥jstlã€æ”¹æ ‡ç­¾çš„å›°æ‰°ã€‚åŒæ—¶å¼€å‘äººå‘˜ä¹Ÿå¯ä»¥æ‰©å±•å’Œåˆ›å»ºè‡ªå®šä¹‰çš„æ–¹è¨€ã€‚ å¤šæ–¹è¨€æ”¯æŒï¼šThymeleaf æä¾›springæ ‡å‡†æ–¹è¨€å’Œä¸€ä¸ªä¸ SpringMVC å®Œç¾é›†æˆçš„å¯é€‰æ¨¡å—ï¼Œå¯ä»¥å¿«é€Ÿçš„å®ç°è¡¨å•ç»‘å®šã€å±æ€§ç¼–è¾‘å™¨ã€å›½é™…åŒ–ç­‰åŠŸèƒ½ã€‚ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:1","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„ç‰¹ç‚¹"},{"categories":null,"content":"\rä½¿ç”¨ Thymeleaf åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå‹¾é€‰ Boot DevTools çƒ­éƒ¨ç½²ã€Spring Web åç«¯ã€Thymeleaf ç™¾é‡Œé¦™å¶ èµ·æ­¥ä¾èµ–ã€‚ åœ¨ application.properties å±æ€§é…ç½®æ–‡ä»¶ä¸­ï¼Œå…³é—­ thymeleaf çš„ç¼“å­˜ï¼Œæ–¹ä¾¿è°ƒè¯• #å¼€å‘é˜¶æ®µï¼Œå»ºè®®å…³é—­thymeleafçš„ç¼“å­˜ï¼Œä¸ç„¶æ²¡æœ‰åŠæ³•çœ‹åˆ°å®æ—¶é¡µé¢ spring.thymeleaf.cache=false åœ¨ application.properties å±æ€§é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½® Thymeleaf çš„è§†å›¾è§£æå™¨ ( åŒæŒ‡å‘ WEB-INF ä¸­çš„ JSP çš„è§†å›¾è§£æå™¨ä¸€æ · ) #é»˜è®¤è§†å›¾è§†å›¾å‰ç¼€ spring.thymeleaf.prefix=classpath:/templates/ #é»˜è®¤è§†å›¾åç¼€ spring.thymeleaf.suffix=.html åœ¨ templates è·¯å¾„ä¸‹åˆ›å»º html æ–‡ä»¶ï¼Œåœ¨ html æ ‡ç­¾ä¸­æ·»åŠ å±æ€§ \u003chtml lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"\u003e ä½¿ç”¨ã€æ•ˆæœ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:2","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨-thymeleaf"},{"categories":null,"content":"\rThymeleaf çš„å˜é‡è¡¨è¾¾å¼ ${å˜é‡å} è·å–å˜é‡å€¼ ${å˜é‡å.å±æ€§å} è·å–å¯¹è±¡ä¸­å±æ€§å ${å˜é‡å.æ–¹æ³•å()} è·å–å¯¹è±¡æ–¹æ³•çš„è¿”å›å€¼ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:3","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„å˜é‡è¡¨è¾¾å¼"},{"categories":null,"content":"\rThymeleaf çš„é€‰æ‹©å˜é‡è¡¨è¾¾å¼ éœ€é…åˆ th:object ä½¿ç”¨ *{å˜é‡å} è·å–å˜é‡å€¼ *{å˜é‡å.å±æ€§å} è·å–å¯¹è±¡ä¸­å±æ€§å *{å˜é‡å.æ–¹æ³•å()} è·å–å¯¹è±¡æ–¹æ³•çš„è¿”å›å€¼ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:4","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„é€‰æ‹©å˜é‡è¡¨è¾¾å¼"},{"categories":null,"content":"\rThymeleaf çš„ URL è¡¨è¾¾å¼ @{è·¯å¾„} ç”¨äº scriptã€linkã€aã€formã€img æ ‡ç­¾çš„åœ°å€å±æ€§ä¸­è·å–åŠ¨æ€æ•°æ® \u003c!--äº’è”ç½‘ç»å¯¹è·¯å¾„--\u003e \u003ca th:href=\"@{'https://www.baidu.com/s?wd='+${user.name}}\" target=\"_blank\"\u003eç™¾åº¦\u003c/a\u003e\u003cbr/\u003e \u003c!--é¡¹ç›®ç›¸å¯¹çš„è·¯å¾„--\u003e \u003ca th:href=\"@{/bb/test02}\" target=\"_blank\"\u003etest02\u003c/a\u003e\u003cbr/\u003e \u003c!--é¡¹ç›®çš„ç›¸å¯¹è·¯å¾„ã€ä¸æ¨èï¼Œå½“é¡¹ç›®å±‚æ¬¡ç»“æ„å¤æ‚æ—¶ï¼Œæœ‰å¯èƒ½ä¼šä¸¢å¤±åœ°å€è·¯å¾„ã€‘--\u003e \u003ca th:href=\"@{bb/test02}\" target=\"_blank\"\u003etest02\u003c/a\u003e\u003cbr/\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:5","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„-url-è¡¨è¾¾å¼"},{"categories":null,"content":"\rThymeleaf çš„å¸¸è§å±æ€§ th:value = \"${...}\" å°†åŠ¨æ€æ•°æ®è®¾ç½®åˆ°è¡¨å•å…ƒç´ çš„ value å±æ€§ä¸­ th:attr = \"å±æ€§å=${...}\" å¯ä»¥ä¿®æ”¹æŒ‡å®šå±æ€§çš„å€¼ï¼Œå¯ä»¥è‡ªå®šä¹‰å±æ€§ th:onclick = \"jsä»£ç \" å¯ä»¥å®ç°äº‹ä»¶å¤„ç†ï¼Œåœ¨ js ä»£ç ä¸­å¯ä»¥æ‹¼æ¥ Thymeleaf çš„å˜é‡è¡¨è¾¾å¼ï¼ˆåªæ”¯æŒæ•°å­—å’Œå¸ƒå°”ç±»å‹ï¼‰ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:6","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„å¸¸è§å±æ€§"},{"categories":null,"content":"\rThymeleaf çš„ each è¿­ä»£ List é›†åˆ ç”¨æ³• th:each = \"item,itemStat:${itemList}\" itemï¼šæ¯æ¬¡çš„è¿­ä»£å¯¹è±¡ itemStatï¼šè¿­ä»£å¯¹è±¡çš„ä¿¡æ¯ï¼ˆçœç•¥æ—¶é»˜è®¤åä¸º itemå+Statï¼‰ itemStat.indexï¼š0å¼€å§‹ä¸‹æ ‡ itemStat.countï¼š1å¼€å§‹ä¸‹æ ‡ itemStat.sizeï¼šè¿­ä»£å¯¹è±¡çš„å¤§å° itemStat.even / oddï¼šå½“å‰è¿­ä»£å¯¹è±¡ä¸‹æ ‡çš„å¥‡å¶ï¼Œ0å¼€å§‹ itemStat.firstï¼šæ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ª itemStat.lastï¼šæ˜¯å¦æ˜¯æœ€åä¸€ä¸ª itemStat.currentï¼šå½“å‰è¿­ä»£å¯¹è±¡ï¼Œç­‰ä»·äº item itemListï¼šåå°ä¼ è¿‡æ¥çš„æ•°æ® \u003ctr th:each=\"user,itemStat:${userList}\"\u003e \u003ctd th:text=\"${itemStat.count}\"\u003eåºå·\u003c/td\u003e \u003ctd th:text=\"${user.name}\"\u003eå§“å\u003c/td\u003e \u003ctd th:text=\"${user.sex}\"\u003eæ€§åˆ«\u003c/td\u003e \u003ctd th:text=\"${user.age}\"\u003eå¹´é¾„\u003c/td\u003e \u003ctd\u003e\u003ca th:href=\"@{'/modify?id='+${user.id}+'xxxxx'}\"\u003eä¿®æ”¹\u003c/a\u003e\u003c/td\u003e \u003ctd\u003e\u003ca th:href=\"@{'/delete?id='+${user.id}}\"\u003eåˆ é™¤\u003c/a\u003e\u003c/td\u003e \u003c/tr\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:7","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„-each-è¿­ä»£-list-é›†åˆ"},{"categories":null,"content":"\rThymeleaf çš„ each è¿­ä»£ Map é›†åˆ ç›´æ¥å¯¹ Map çš„ keyï¼Œvalue è¿›è¡Œè¿­ä»£ ç”¨æ³•ï¼šth:each = \"node:${itemMap}\" nodeï¼šitemMap æ¯æ¬¡çš„è¿­ä»£å¯¹è±¡ node.keyï¼šè·å–å½“å‰é”®å€¼å¯¹ä¸­çš„ key node.valueï¼šæ´»åŠ¨å½“å‰é”®å€¼å¯¹ä¸­çš„ value \u003ctr th:each=\"node:${userMap}\"\u003e \u003ctd th:text=\"${nodeStat.count}\"\u003eåºå·\u003c/td\u003e \u003ctd th:text=\"${node.key}\"\u003ekey\u003c/td\u003e \u003ctd th:text=\"${node.value}\"\u003evalue\u003c/td\u003e \u003ctd th:text=\"${node.value.id}\"\u003eid\u003c/td\u003e \u003ctd th:text=\"${node.value.name}\"\u003eå§“å\u003c/td\u003e \u003ctd th:text=\"${node.value.age}\"\u003eå¹´é¾„\u003c/td\u003e \u003ctd th:text=\"${node.value.sex}\"\u003eæ€§åˆ«\u003c/td\u003e \u003c/tr\u003e å°† Map è½¬æ¢æˆ keySet åï¼Œé€šè¿‡éå† key è·å– value è¿›è¡Œè¿­ä»£ ç”¨æ³•ï¼šth:each = \"key:${itemMap.keySet()}\" keyï¼šæ¯æ¬¡è¿­ä»£çš„ key å¯¹è±¡ itemMap.get(key)ï¼šå–å½“å‰ key å¯¹åº”çš„ value \u003ctr th:each=\"key:${userMap.keySet()}\"\u003e \u003ctd th:text=\"${keyStat.count}\"\u003eåºå·\u003c/td\u003e \u003ctd th:text=\"${key}\"\u003ekey\u003c/td\u003e \u003ctd th:text=\"${userMap.get(key)}\"\u003evalue\u003c/td\u003e \u003ctd th:text=\"${userMap.get(key).id}\"\u003eid\u003c/td\u003e \u003ctd th:text=\"${userMap.get(key).name}\"\u003eå§“å\u003c/td\u003e \u003ctd th:text=\"${userMap.get(key).age}\"\u003eå¹´é¾„\u003c/td\u003e \u003ctd th:text=\"${userMap.get(key).sex}\"\u003eæ€§åˆ«\u003c/td\u003e \u003c/tr\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:8","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„-each-è¿­ä»£-map-é›†åˆ"},{"categories":null,"content":"\rThymeleaf çš„ ifã€unless è¡¨è¾¾å¼ th:if = \"${è¡¨è¾¾å¼}\" å¦‚æœè¡¨è¾¾å¼ä¸º false åˆ™åˆ é™¤æ‰€åœ¨æ ‡ç­¾ \u003ctd th:if=\"${user.sex == '1'}\"\u003eç”·\u003c/td\u003e \u003ctd th:if=\"${user.sex == '0'}\"\u003eå¥³\u003c/td\u003e th:unless = \"${è¡¨è¾¾å¼}\" å¦‚æœè¡¨è¾¾å¼ä¸º true åˆ™åˆ é™¤æ‰€åœ¨æ ‡ç­¾ã€ä¸æ¨èä½¿ç”¨ã€‘ \u003ctd th:unless=\"${user.sex == '1'}\"\u003eå¥³\u003c/td\u003e \u003ctd th:unless=\"${user.sex == '0'}\"\u003eç”·\u003c/td\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:9","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„-ifunless-è¡¨è¾¾å¼"},{"categories":null,"content":"\rThymeleaf çš„ switch case è¡¨è¾¾å¼ th:case=\"*\" å½“æ‰€æœ‰ case éƒ½ä¸åŒ¹é…æ—¶æ‰§è¡Œ \u003ch3 th:switch=\"${week}\"\u003e \u003cspan th:case=\"1\"\u003eæ˜ŸæœŸä¸€\u003c/span\u003e \u003cspan th:case=\"2\"\u003eæ˜ŸæœŸäºŒ\u003c/span\u003e \u003cspan th:case=\"3\"\u003eæ˜ŸæœŸä¸‰\u003c/span\u003e \u003cspan th:case=\"4\"\u003eæ˜ŸæœŸå››\u003c/span\u003e \u003cspan th:case=\"5\"\u003eæ˜ŸæœŸäº”\u003c/span\u003e \u003cspan th:case=\"6\"\u003eæ˜ŸæœŸå…­\u003c/span\u003e \u003cspan th:case=\"7\"\u003eæ˜ŸæœŸæ—¥\u003c/span\u003e \u003cspan th:case=\"*\"\u003eé”™è¯¯æ•°æ®\u003c/span\u003e \u003c/h3\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:10","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„-switch-case-è¡¨è¾¾å¼"},{"categories":null,"content":"\rThymeleaf çš„å†…æ•›æ–‡æœ¬ã€å†…æ•›è„šæœ¬ å†…æ•›ï¼šinline [[${åŠ¨æ€æ•°æ®}]] å°†æ–‡æœ¬ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ [[${åŠ¨æ€æ•°æ®}]] å°†æ–‡æœ¬ç›´æ¥ç”¨åœ¨ js ä»£ç ä¸­ ä¸ºçˆ¶æ ‡ç­¾æ·»åŠ  th:inline = \"javascript\" åï¼Œä¼šè‡ªåŠ¨ä¸ºå†…åµŒæ–‡æœ¬æ·»åŠ åŒå¼•å·ã€‚ ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:11","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„å†…æ•›æ–‡æœ¬å†…æ•›è„šæœ¬"},{"categories":null,"content":"\rThymeleaf çš„å­—ç¬¦ä¸²æ‹¼æ¥ | | ä¸­å†™çš„æ–‡æœ¬å’Œå˜é‡è¡¨è¾¾å¼ä¼šè¢« Thymeleaf è‡ªåŠ¨è§£ææ‹¼æ¥ï¼ˆä¼˜é›…ï¼Œæ°¸ä¸è¿‡æ—¶ï¼‰ \u003ctd\u003e\u003ca th:href=\"@{|/modify?id=${user.id}\u0026xx=xxx|}\"\u003eä¿®æ”¹\u003c/a\u003e\u003c/td\u003e \u003ctd\u003e\u003ca th:href=\"@{'/delete?id='+${user.id}}\"\u003eåˆ é™¤\u003c/a\u003e\u003c/td\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:12","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„å­—ç¬¦ä¸²æ‹¼æ¥"},{"categories":null,"content":"\rThymeleaf çš„ä¸‰å…ƒè¿ç®—ç¬¦ ç”·:\u003cinput type=\"radio\" name=\"sex\" th:checked=\"*{sex=='1'?true:false}\"\u003e å¥³:\u003cinput type=\"radio\" name=\"sex\" th:checked=\"*{sex=='0'?true:false}\"\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:13","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„ä¸‰å…ƒè¿ç®—ç¬¦"},{"categories":null,"content":"\rThymeleaf çš„è¡¨è¾¾å¼åŸºæœ¬å¯¹è±¡ #request å¯¹è±¡ã€session å¯¹è±¡ \u003cp th:text=\"${#request.getSession().getAttribute('week')}\"\u003e\u003c/p\u003e \u003cp th:text=\"${#httpSession.getAttribute('week')}\"\u003e\u003c/p\u003e \u003cp th:text=\"${session.week}\"\u003e\u003c/p\u003e ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:14","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#thymeleaf-çš„è¡¨è¾¾å¼åŸºæœ¬å¯¹è±¡"},{"categories":null,"content":"\rSpringBoot çš„ REST æ¥å£æ¶æ„é£æ ¼ REST: è¡¨è¿°æ€§çŠ¶æ€ä¼ é€’ï¼Œæ˜¯ä¸€ç»„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’æ—¶æ¶æ„ç†å¿µå’Œè®¾è®¡åŸåˆ™ æ¶æ„é£æ ¼ï¼šapi çš„ç»„ç»‡æ–¹å¼ ä¼ ç»Ÿï¼šhttps://www.bilibili.com/video/BVxxx?p=57 RESTful é£æ ¼ï¼šhttps://www.bilibili.com/video/BVxxx/p/57 REST é£æ ¼çš„å¢åˆ æ”¹æŸ¥ æŸ¥ï¼šGET å¢ï¼šPOST åˆ ï¼šDELETE æ”¹ï¼šPUT \u003cform action=\"xxx\" method=\"post\"\u003e å§“åï¼š\u003cinput type=\"text\" name=\"username\"\u003e å¯†ç ï¼š\u003cinput type=\"password\" name=\"password\"\u003e \u003cinput type=\"hidden\" name=\"_method\" value=\"PUT\"\u003e \u003c!--çœŸå®çš„æäº¤æ–¹å¼--\u003e \u003c/form\u003e å¸¸ç”¨æ³¨è§£ï¼š @PathVariableï¼šè·¯å¾„å˜é‡ï¼Œä» url ä¸­è·å–æ•°æ® å½“å½¢å‚åå’Œè·¯å¾„å˜é‡åç›¸åŒæ—¶ï¼Œvalue å¯çœç•¥ @GetMapping(\"/test/{page}\") public String test(@PathVariable Integer page){ return \"test/\"+page; } @GetMapping æŸ¥è¯¢æ—¶ç”¨ï¼Œç›¸å½“äºåœ¨ RequestMapping åŸºç¡€ä¸ŠæŒ‡å®š method å‚æ•°å¿…é¡»ä¸º get @PostMapping æ·»åŠ æ—¶ç”¨ @PutMapping ä¿®æ”¹æ—¶ç”¨ @DeleteMapping åˆ é™¤æ—¶ç”¨ åœ¨ application.properties å¯ç”¨å¯¹ put ï¼Œdelete è¯·æ±‚æ–¹å¼çš„æ”¯æŒ # å¯ç”¨ hiddenmethod è¿‡æ»¤å™¨ spring.mvc.hiddenmethod.filter.enabled=true ","date":"2021-11-15","objectID":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:0","series":null,"tags":null,"title":"SpringBootè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springboot%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-çš„-rest-æ¥å£æ¶æ„é£æ ¼"},{"categories":null,"content":"\rDubbo å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-11-12 ç¬”è®°æ‘˜è‡ª bjpwernode ç§¦ä¸–å›½ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubbo"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯Dubbo é«˜æ€§èƒ½çš„ RPC æ¡†æ¶, è§£å†³äº†åˆ†å¸ƒå¼ä¸­çš„è°ƒç”¨é—®é¢˜ ä¸åŒäºHTTPéœ€è¦è¿›è¡Œ7æ­¥èµ°(ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹)ï¼ŒDubboé‡‡ç”¨Socketï¼ˆTCPï¼‰é€šä¿¡æœºåˆ¶ï¼Œä¸€æ­¥åˆ°ä½ å¯ç›´æ¥å°†å®ä¾‹åŒ–ï¼ˆå®ç° Serializable æ¥å£ï¼‰çš„æ•°æ®ä»¥äºŒè¿›åˆ¶æµå½¢å¼ä¼ è¾“ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯dubbo"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹ç³»ç»Ÿçš„é›†åˆ, ä½†æ˜¯ç”¨æˆ·ä½¿ç”¨èµ·æ¥åƒæ˜¯åœ¨ä½¿ç”¨ä¸€å¥—ç³»ç»Ÿ è§£å†³é«˜å¹¶å‘é—®é¢˜ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼"},{"categories":null,"content":"\råº”ç”¨æ¶æ„çš„å‘å±• å•ä¸€æ¶æ„ï¼šå°†æ‰€æœ‰ä¸šåŠ¡æ”¾åˆ°ä¸€å°æœåŠ¡å™¨ä¸­ æ€§èƒ½å·® å‚ç›´åº”ç”¨æ¶æ„ï¼šå°†å¤§åº”ç”¨æ‹†åˆ†æˆä¸ºå°åº”ç”¨(ä¸€èˆ¬æŒ‰ä¸šåŠ¡çº¬åº¦æ‹†åˆ†), æ ¹æ®è®¿é—®é¢‘ç‡å†³å®šéƒ¨ç½²çš„æœåŠ¡å™¨æ•°é‡ é¡µé¢æ›´æ”¹éš¾ åº”ç”¨é—´ä¸èƒ½ç›¸äº’è°ƒç”¨ åˆ†å¸ƒå¼æ¶æ„ï¼šå°†ä¸šåŠ¡æ‹†åˆ†å, ç”¨æŸç§ï¼ˆRPCï¼ˆDubboï¼‰ï¼‰æ–¹å¼å®ç°å„ä¸ªä¸šåŠ¡æ¨¡å—çš„è¿œç¨‹è°ƒç”¨å’Œå¤ç”¨ RPCæ¨¡å¼ï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¨¡å¼ï¼‰ åº”ç”¨é—´å®¢æˆ·ç›¸äº’è°ƒç”¨ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åº”ç”¨æ¶æ„çš„å‘å±•"},{"categories":null,"content":"\rDubboçš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ› é¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼šAé¡¹ç›®ä¸­çš„æ¥å£å¯è®©Bé¡¹ç›®å®ç°ï¼ˆç”±Dubboå®ç°ï¼‰ æ™ºèƒ½å®¹é”™è´Ÿè½½å‡è¡¡ æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç° ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubboçš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›"},{"categories":null,"content":"\rDubboçš„åŸºæœ¬æ¶æ„\r==æœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰==ï¼šæš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ï¼ŒæœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ ==æœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰==: è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œåœ¨å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­åŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•é€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥å†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ ==æ³¨å†Œä¸­å¿ƒï¼ˆRegistryï¼‰==ï¼šæ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´å°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€… ==ç›‘æ§ä¸­å¿ƒï¼ˆMonitorï¼‰==ï¼šç›‘æ§æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubboçš„åŸºæœ¬æ¶æ„"},{"categories":null,"content":"\råè®® Dubboæ”¯æŒå¤šç§åè®®ï¼šdubbo, hessian , rmi , http, webservice , thrift , memcached , redis Dubboå®˜æ–¹æ¨èä½¿ç”¨ dubbo åè®®ï¼Œé»˜è®¤ç«¯å£ 20880 åœ¨ Spring é…ç½®æ–‡ä»¶åŠ å…¥ \u003cdubbo:protocol name=\"dubbo\" port=\"20880\" /\u003e ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åè®®"},{"categories":null,"content":"\rä½¿ç”¨Dubbo\rä¸€ã€åˆ›å»ºæœåŠ¡æä¾›è€… åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ– \u003c!--Spring --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-context\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e \u003c!--Dubboä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003edubbo\u003c/artifactId\u003e \u003cversion\u003e2.6.2\u003c/version\u003e \u003c/dependency\u003e åœ¨ pom.xml ä¸­æ·»åŠ ç¼–è¯‘æ’ä»¶ \u003c!--JDK1.8ç¼–è¯‘æ’ä»¶--\u003e \u003cplugin\u003e \u003cartifactId\u003emaven-compiler-plugin\u003c/artifactId\u003e \u003cversion\u003e3.1\u003c/version\u003e \u003cconfiguration\u003e \u003csource\u003e1.8\u003c/source\u003e \u003ctarget\u003e1.8\u003c/target\u003e \u003c/configuration\u003e \u003c/plugin\u003e åˆ›å»ºå®ä½“ç±»å®ç° Serializable æ¥å£ åˆ›å»ºæ¥å£åŠå®ç°ç±» åœ¨ å®ç°ç±»å-privider.xmlï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  \u003c!--æœåŠ¡æä¾›è€…çš„å”¯ä¸€æ ‡è¯†--\u003e \u003cdubbo:application name=\"01-link-orderservice-provider\"/\u003e \u003c!--æŒ‡å®šdubboä½¿ç”¨çš„åè®®åŠç«¯å£å·--\u003e \u003cdubbo:protocol name=\"dubbo\" port=\"20880\"/\u003e \u003c!--æš´éœ²æœåŠ¡æ¥å£ interface:æš´éœ²çš„æ¥å£çš„å…¨é™å®šå ref:æš´éœ²çš„æ¥å£çš„å®ç°ç±» registry:ä¸ä½¿ç”¨æ³¨å†Œä¸­å¿ƒ N/A --\u003e \u003cdubbo:service interface=\"com.bjpn.service.OrderService\" ref=\"orderService\" registry=\"N/A\"/\u003e \u003c!--å°†æ¥å£å®ç°ç±»åˆ›å»ºåœ¨Springå®¹å™¨ä¸­--\u003e \u003cbean name=\"orderService\" class=\"com.bjpn.service.impl.OrderServiceImpl\"/\u003e æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"orderservce-provider.xml\"); //å¯åŠ¨ Spring å®¹å™¨ context.start(); //é˜»å¡è¿è¡Œ System.in.read(); } äºŒã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€… åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–ã€æ’ä»¶ åˆ›å»ºæ¥å£åŠå®ç°ç±»ï¼Œç¼–å†™ç»„åˆæ¥å£çš„å®ç°ç±»ï¼Œå¹¶åˆ›å»º set æ–¹æ³•ï¼ˆç”± Spring å®¹å™¨æ³¨å…¥ï¼‰ åœ¨ å®ç°ç±»å-consume.xml ï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  \u003c!--æœåŠ¡æ¶ˆè´¹è€…çš„å”¯ä¸€æ ‡è¯†--\u003e \u003cdubbo:application name=\"link-main-web\" /\u003e \u003c!--å¼•ç”¨è¿œç¨‹æ¥å£æœåŠ¡: ç±»ä¼¼äºBeanæ ‡ç­¾ï¼Œç”¨äºåˆ›å»ºæ¥è‡ªå¦ä¸€å°æœåŠ¡å™¨ä¸­çš„å¯¹è±¡ Dubboä¸ºå…¶æ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡è·å–åˆ°çš„è¿™ä¸ªä»£ç†å¯¹è±¡è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸­çš„å…·ä½“æ–¹æ³• id è¿œç¨‹æœåŠ¡ä»£ç†å¯¹è±¡å interface è¿œç¨‹æ¥å£å…¨é™å®šå url æœåŠ¡æä¾›è€…åœ°å€ registry N/Aä¸ä½¿ç”¨æ³¨å†Œä¸­å¿ƒ --\u003e \u003cdubbo:reference id=\"remoteShopService\" interface=\"com.bjpn.service.OrderService\" url=\"dubbo://localhost:20880\" registry=\"N/A\"/\u003e \u003c!--ä¸ºç»„åˆäº†è¿œç¨‹æ¥å£å®ç°ç±»çš„ç±»å®ä¾‹åŒ–--\u003e \u003cbean name=\"shopService\" class=\"com.bjpn.service.impl.ShopServiceImpl\"\u003e \u003cproperty name=\"orderService\" ref=\"remoteShopService\"/\u003e \u003c/bean\u003e æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"shop-consume.xml\"); ShopService shopService = (ShopService) context.getBean(\"shopService\"); Order order = shopService.buyGoods(10001, \"é›¶é£Ÿ\", 20.0, 2); System.out.println(order); } ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨dubbo"},{"categories":null,"content":"\rä½¿ç”¨Dubbo\rä¸€ã€åˆ›å»ºæœåŠ¡æä¾›è€… åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ– org.springframework spring-context 4.3.16.RELEASE com.alibaba dubbo 2.6.2 åœ¨ pom.xml ä¸­æ·»åŠ ç¼–è¯‘æ’ä»¶ maven-compiler-plugin 3.1 1.8 1.8 åˆ›å»ºå®ä½“ç±»å®ç° Serializable æ¥å£ åˆ›å»ºæ¥å£åŠå®ç°ç±» åœ¨ å®ç°ç±»å-privider.xmlï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"orderservce-provider.xml\"); //å¯åŠ¨ Spring å®¹å™¨ context.start(); //é˜»å¡è¿è¡Œ System.in.read(); } äºŒã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€… åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–ã€æ’ä»¶ åˆ›å»ºæ¥å£åŠå®ç°ç±»ï¼Œç¼–å†™ç»„åˆæ¥å£çš„å®ç°ç±»ï¼Œå¹¶åˆ›å»º set æ–¹æ³•ï¼ˆç”± Spring å®¹å™¨æ³¨å…¥ï¼‰ åœ¨ å®ç°ç±»å-consume.xml ï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"shop-consume.xml\"); ShopService shopService = (ShopService) context.getBean(\"shopService\"); Order order = shopService.buyGoods(10001, \"é›¶é£Ÿ\", 20.0, 2); System.out.println(order); } ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€åˆ›å»ºæœåŠ¡æä¾›è€…"},{"categories":null,"content":"\rä½¿ç”¨Dubbo\rä¸€ã€åˆ›å»ºæœåŠ¡æä¾›è€… åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ– org.springframework spring-context 4.3.16.RELEASE com.alibaba dubbo 2.6.2 åœ¨ pom.xml ä¸­æ·»åŠ ç¼–è¯‘æ’ä»¶ maven-compiler-plugin 3.1 1.8 1.8 åˆ›å»ºå®ä½“ç±»å®ç° Serializable æ¥å£ åˆ›å»ºæ¥å£åŠå®ç°ç±» åœ¨ å®ç°ç±»å-privider.xmlï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"orderservce-provider.xml\"); //å¯åŠ¨ Spring å®¹å™¨ context.start(); //é˜»å¡è¿è¡Œ System.in.read(); } äºŒã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€… åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–ã€æ’ä»¶ åˆ›å»ºæ¥å£åŠå®ç°ç±»ï¼Œç¼–å†™ç»„åˆæ¥å£çš„å®ç°ç±»ï¼Œå¹¶åˆ›å»º set æ–¹æ³•ï¼ˆç”± Spring å®¹å™¨æ³¨å…¥ï¼‰ åœ¨ å®ç°ç±»å-consume.xml ï¼ˆ spring é…ç½®æ–‡ä»¶ï¼‰ ä¸­æ·»åŠ  æµ‹è¯•è¿è¡Œ public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"shop-consume.xml\"); ShopService shopService = (ShopService) context.getBean(\"shopService\"); Order order = shopService.buyGoods(10001, \"é›¶é£Ÿ\", 20.0, 2); System.out.println(order); } ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…"},{"categories":null,"content":"\rDubboæœåŠ¡åŒ–æœ€è¿‘å®è·µ åˆ†åŒ… å°†æœåŠ¡æ¥å£ã€æœåŠ¡æ¨¡å‹ã€æœåŠ¡å¼‚å¸¸ç­‰å‡æ”¾åœ¨å…¬å…±åŒ…ä¸­ å°†éœ€è¦é‡å¤ç¼–å†™çš„æ¥å£ã€ç±»ç­‰ install åœ¨ maven ä»“åº“ä¸­ ç²’åº¦ æœåŠ¡æ¥å£å°½å¯èƒ½å¤§ç²’åº¦ï¼ˆé«˜å†…èšï¼‰ æ¥å£ä»¥ä¸šåŠ¡åœºæ™¯åˆ’åˆ†ï¼Œè€Œä¸æ˜¯æŸåŠŸèƒ½çš„æŸä¸€æ­¥éª¤ ç‰ˆæœ¬ ä¸ºæ¥å£å®šä¹‰ç‰ˆæœ¬å·ï¼ŒåŒºåˆ†åŒä¸€æ¥å£çš„ä¸åŒå®ç° å¯ä¸º\u003cdubbo:service \u003cdubbo:reference æ ‡ç­¾æŒ‡å®šç›¸åŒ version å±æ€§ï¼Œç»‘å®šæš´éœ²çš„æ¥å£å®ç°ç±»å’Œå¼•ç”¨è¿œç¨‹çš„ â€œ æ¥å£å®ç°ç±» â€ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubboæœåŠ¡åŒ–æœ€è¿‘å®è·µ"},{"categories":null,"content":"\rDubboå¸¸ç”¨æ ‡ç­¾ å…¬ç”¨æ ‡ç­¾ \u003cdubbo:application name=â€æœåŠ¡çš„åç§°â€/\u003e é…ç½®åº”ç”¨ä¿¡æ¯ï¼Œå”¯ä¸€æ ‡è¯†æœåŠ¡ \u003cdubbo:registry address=â€ip:portâ€ protocol=â€åè®®â€/\u003e é…ç½®æ³¨å†Œä¸­å¿ƒ check=\"false\" å¯åŠ¨æ—¶æ˜¯å¦æ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å¯ç”¨ æœåŠ¡æä¾›è€…æ ‡ç­¾ \u003cdubbo:service interface=â€æœåŠ¡æ¥å£åâ€ ref=â€æœåŠ¡å®ç°å¯¹è±¡beanâ€\u003e é…ç½®æš´éœ²çš„æœåŠ¡ retries=\"2\" è‡ªåŠ¨é‡è¯•æ¬¡æ•° timeout=\"2000\" è¶…æ—¶æ—¶é—´ï¼Œ2000æ¯«ç§’å†…æ²¡æœ‰å“åº”åˆ™ä¸å†é‡è¯• version=\"1.0.0\" / version=\"1.0.1\"å®šä¹‰ç‰ˆæœ¬å·ï¼Œåœ¨æä¾›ç›¸åŒæ¥å£çš„å®ç°ç±»æ—¶ ç”¨ç‰ˆæœ¬å·åŒºåˆ† æœåŠ¡æ¶ˆè´¹è€…æ ‡ç­¾ \u003cdubbo:reference id=â€æœåŠ¡å¼•ç”¨beançš„idâ€ interface=â€æœåŠ¡æ¥å£åâ€/\u003e å¼•ç”¨è¿œç¨‹æœåŠ¡ check=\"false\" å¯åŠ¨æ—¶æ˜¯å¦æ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å¯ç”¨ retries=\"2\" è‡ªåŠ¨é‡è¯•æ¬¡æ•° timeout=\"2000\" è¶…æ—¶æ—¶é—´ï¼Œ2000æ¯«ç§’å†…æ²¡æœ‰å“åº”åˆ™ä¸å†é‡è¯• version=\"1.0.0\" å®šä¹‰ç‰ˆæœ¬å·ï¼Œåœ¨æä¾›ç›¸åŒæ¥å£çš„å®ç°ç±»æ—¶ ç”¨ç‰ˆæœ¬å·åŒºåˆ† ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubboå¸¸ç”¨æ ‡ç­¾"},{"categories":null,"content":"\ræ³¨å†Œä¸­å¿ƒ æœåŠ¡æä¾›è€…å°†æœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼ˆæ¥å£çš„å…¨é™å®šåï¼‰å’ŒåŸºæœ¬ä¿¡æ¯ï¼ˆIPã€ç«¯å£ã€ç‰ˆæœ¬å·â€¦ï¼‰ç™»è®°åˆ°æ³¨å†Œä¸­å¿ƒ æœåŠ¡æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾æœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿”å›æœåŠ¡çš„æ¸…å•åˆ—è¡¨ï¼Œç„¶åæ‹¿åˆ°æœåŠ¡çš„åŸºæœ¬ä¿¡æ¯å‘æœåŠ¡æä¾›è€…ç´¢è¦æœåŠ¡ æ³¨å†Œä¸­å¿ƒç”¨äºå°†æœåŠ¡ç»Ÿä¸€ç®¡ç† æ³¨å†Œä¸­å¿ƒçš„ç±»å‹ Multicastæ³¨å†Œä¸­å¿ƒï¼šç»„æ’­æ–¹å¼ Redisæ³¨å†Œä¸­å¿ƒï¼šä½¿ç”¨Redisä½œä¸ºæ³¨å†Œä¸­å¿ƒ Simpleæ³¨å†Œä¸­å¿ƒï¼šå°±æ˜¯ä¸€ä¸ªdubboæœåŠ¡ã€‚ä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚æä¾›æŸ¥æ‰¾æœåŠ¡çš„åŠŸèƒ½ã€‚ Zookeeperæ³¨å†Œä¸­å¿ƒï¼šä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒã€æ¨èä½¿ç”¨ã€‘ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ³¨å†Œä¸­å¿ƒ"},{"categories":null,"content":"\rZookeeper Zookeeperæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼Œåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ Zookeeper ä½¿ç”¨ï¼š é…ç½®å®‰è£…ç›®å½• conf ä¸‹çš„ zoo.cfg åœ¨å®‰è£…ç›®å½• bin ç›®å½•ä¸‹å¯åŠ¨ Zookeeper ä¸ºé¡¹ç›®æ·»åŠ  Zookeeper ä¾èµ– \u003c!-- zookeeperå®¢æˆ·ç«¯ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.curator\u003c/groupId\u003e \u003cartifactId\u003ecurator-framework\u003c/artifactId\u003e \u003cversion\u003e4.1.0\u003c/version\u003e \u003c/dependency\u003e åœ¨é¡¹ç›® spring.xml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ , å¹¶åˆ é™¤ registry=\"N/A\" ã€url=\"dubbo://localhost:20880\" \u003c!--æŒ‡å®šæ³¨å†Œä¸­å¿ƒ--\u003e \u003cdubbo:registry address=\"zookeeper://192.168.30.128:2181\"/\u003e ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:1","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#zookeeper"},{"categories":null,"content":"\rDubbo ä¸­ Zookeeper çš„é«˜å¯ç”¨ é«˜å¯ç”¨ï¼šé€šå¸¸æ¥æè¿°ä¸€ä¸ªç³»ç»Ÿç»è¿‡ä¸“é—¨çš„è®¾è®¡ï¼Œä»è€Œå‡å°‘ä¸èƒ½æä¾›æœåŠ¡çš„æ—¶é—´ï¼Œè€Œä¿æŒå…¶æœåŠ¡çš„é«˜åº¦å¯ç”¨æ€§ã€‚ å¥å£®æ€§ï¼šDubbo ä¼šå°† Zookeeper ä¸­æœåŠ¡ä¿¡æ¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå³ä½¿å®•æœºä¹Ÿå¯ä»¥ä¿è¯æ³¨å†Œä¸­å¿ƒæä¾›æœåŠ¡åˆ—è¡¨æŸ¥è¯¢ï¼Œä½†ä¸èƒ½æ³¨å†Œæ–°æœåŠ¡ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:2","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#dubbo-ä¸­-zookeeper-çš„é«˜å¯ç”¨"},{"categories":null,"content":"\rç›‘æ§ä¸­å¿ƒ Dubbo æä¾›çš„ç®€é™‹çš„ç®¡ç†æ§åˆ¶å° ç›‘æ§æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…çš„è¿è¡ŒçŠ¶æ€ ","date":"2021-11-12","objectID":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:0","series":null,"tags":null,"title":"Dubboè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/dubbo%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç›‘æ§ä¸­å¿ƒ"},{"categories":null,"content":"\rCRMï¼šå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿ å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-19 â€“ 2022-01 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æå® é¡¹ç›®ä½¿ç”¨æ‰‹å†Œï¼š ä¿®æ”¹ pom.xml ä¸­ MySQL é©±åŠ¨ç­‰ä¾èµ–ç‰ˆæœ¬ åˆ›å»º crm2 åº“å¹¶å¯¼å…¥ crm2.sql åœ¨ crm/utils/RedisUtil.java ä¸­é…ç½® Jedis è¿æ¥ä¿¡æ¯ é¡¹ç›®æ¼”ç¤ºï¼š æ¼”ç¤ºåœ°å€ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#crmå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿ"},{"categories":null,"content":"\rJSPçš„baseæ ‡ç­¾ basePathä¸ºæ‹¼æ¥çš„urlè¿æ¥ baseæ ‡ç­¾hrefå¼•å…¥äº†basePathå˜é‡ åœ¨é¡µé¢ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„åœ°æ–¹å¯ä»¥ä½¿ç”¨basePathå‰ç¼€ è‡ªåŠ¨æ‹¼æ¥å‡ºï¼šhttp://localhost:8080/crm/ \u003c%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" isELIgnored=\"false\" %\u003e \u003c% String basePath = request.getScheme() + \"://\" + request.getServerName() + \":\" + request.getServerPort() + request.getContextPath() + \"/\"; %\u003e \u003chtml\u003e \u003chead\u003e \u003cbase href=\"\u003c%=basePath%\u003e\"\u003e ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#jspçš„baseæ ‡ç­¾"},{"categories":null,"content":"\r1. applicationContext-web.xml æ³¨è§£æ‰«æ, æ‰«æ ontroller åŒ…ä¸‹çš„æ³¨è§£ æ³¨è§£é©±åŠ¨, åŠ è½½å¤„ç†å™¨é€‚é…å™¨å’Œå¤„ç†å™¨æ˜ å°„å™¨ è§†å›¾è§£æå™¨, å‰ç¼€å’Œåç¼€åŠ è½½è§†å›¾ ( Jsp ) å‰ç¼€ : /WEB-INF/jsp åç¼€ : .jsp æ§åˆ¶å™¨è¿”å›çš„èµ„æº : return \"/index\"; /WEB-INF/jsp/index.jsp æ‹¦æˆªå™¨é…ç½® æƒé™æ ¡éªŒ: é™¤äº†è®¿é—®ç™»å½•é¡µé¢å’Œç™»å½•æ“ä½œå¤–, å…¶ä½™å¿…é¡»è¦æ±‚å½“å‰ç”¨æˆ·ç™»å½•æ‰å¯ä»¥è®¿é—® æ–‡ä»¶ä¸Šä¼ è§£æå™¨ æ–‡ä»¶ä¸Šä¼ æ“ä½œ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#1-applicationcontext-webxml"},{"categories":null,"content":"\r2. applicationContext-service .xml æ³¨è§£æ‰«æ, æ‰«æ service åŒ…ä¸‹çš„æ³¨è§£ åŠ è½½ spring çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶ aop = åˆ‡é¢ + åˆ‡å…¥ç‚¹ å£°æ˜å¼äº‹åŠ¡æ§åˆ¶ = åˆ‡å…¥ç‚¹ + åˆ‡é¢ + äº‹åŠ¡ç®¡ç†å™¨ save, update , deleteå¼€å¤´çš„æ–¹æ³•éœ€è¦å¼€å¯äº‹åŠ¡ å…¶ä»–æ–¹æ³•åªè¯»äº‹åŠ¡ åŠ è½½ applicationContext-dao.xml é…ç½®æ–‡ä»¶ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#2-applicationcontext-service-xml"},{"categories":null,"content":"\r3. applicationContext-dao.xml æ•°æ®åº“è¿æ¥æ± é…ç½® driver, url, username, password mybatis çš„æ•´åˆ sqlSessionFactoryBean ç”ŸæˆsqlSessionFactory åŠ è½½ mybatis çš„é…ç½®æ–‡ä»¶ mapperScanner ç”ŸæˆsqlSession æ‰«æ mybatis çš„ dao æ¥å£, å°†æ¥å£åˆ›å»ºå¯¹åº”çš„ä»£ç†å¯¹è±¡, äº¤ç»™ spring å®¹å™¨è¿›è¡Œç®¡ç† ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#3-applicationcontext-daoxml"},{"categories":null,"content":"\ré¡¹ç›®æ­å»ºæµå›¾\rexceptionåŒ…ï¼šå¼‚å¸¸åŒ… interceptoråŒ…ï¼šæ‹¦æˆªå™¨åŒ… settingåŒ…ï¼šä»£è¡¨settingä¸šåŠ¡æ¨¡å—ï¼Œä»¥åè¿˜æœ‰workbenchç­‰ daoåŒ…ï¼šå¤„ç†æŒä¹…å±‚çš„æ¥å£å’Œmapperæ–‡ä»¶ domainåŒ…ï¼šå­˜æ”¾å®ä½“ç±»ï¼Œä¹Ÿæœ‰å‘½åä¸ºentityã€pojo serviceåŒ…ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘å±‚äº‹åŠ¡ä¸šåŠ¡ç­‰ webåŒ…ï¼šwebé¡¹ç›® controlleråŒ…ï¼šå­˜æ”¾Servletæ–‡ä»¶ utilsåŒ…ï¼šå·¥å…·åŒ…ï¼Œå…¶ä¸­æ”¾çš„å·¥å…·ä¹Ÿä¼šè¢«å…¶ä»–ä¸šåŠ¡ä½¿ç”¨ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#é¡¹ç›®æ­å»ºæµå›¾"},{"categories":null,"content":"\rUUID ä»€ä¹ˆæ˜¯UUIDï¼šå…±36ä½ç”±å­—æ¯å’Œæ•°å­—å’Œ â€™ - â€™ ç”Ÿæˆçš„éšæœºä¸²ï¼Œå…¨ä¸–ç•Œå”¯ä¸€ã€‚ UUIDç»„æˆï¼šéšæœºæ•° + æ—¶é—´æˆ³ + ç¡¬ä»¶ç¼–ç  UUID uuid = UUID.randomUUID(); String id = uuid.toString(); id = id.replaceAll(\"-\", \"\"); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#uuid"},{"categories":null,"content":"\rAjaxè·¯å¾„URL ç›¸å¯¹è·¯å¾„ï¼šsettings/user/login.do ç›¸å¯¹è·¯å¾„ä¼šè‡ªåŠ¨æ‹¼æ¥é¡¹ç›®åç§° http://localhost:8080/crm/settings/user/login.do ç»å¯¹è·¯å¾„ï¼š/settings/user/login.do ç»å¯¹è·¯å¾„ä¸ä¼šè‡ªåŠ¨æ‹¼æ¥é¡¹ç›®åç§° http://localhost:8080/settings/user/login.do ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ajaxè·¯å¾„url"},{"categories":null,"content":"\rAjaxè¿”å›å€¼respçº¦å®šå®šä¹‰ codeï¼šè¿”å›å€¼çš„ç¼–ç  0ï¼šæ“ä½œæˆåŠŸ 1ï¼šæ“ä½œå¤±è´¥ 2ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ â€¦ msgï¼šæ—¥å¿—ä¿¡æ¯ dataï¼šå…·ä½“æ•°æ® resp{ code: \"0/1/...\", msg: \"respInfo\", data: { null, [\"abcd\", \"efgh\", \"jklm\"], [ {name: \"admin\", pswd: \"123\"}, {name: \"admin1\", pswd: \"1234\"}, ] } } ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:8:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ajaxè¿”å›å€¼respçº¦å®šå®šä¹‰"},{"categories":null,"content":"\rå®ä½“ç±»åºåˆ—åŒ–ä¸ååºåˆ—åŒ– å®ç° Serializable æ¥å£ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:9:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å®ä½“ç±»åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"},{"categories":null,"content":"\rIDEA çš„ Free mybatis plugins æ’ä»¶ å¯ä»¥æ ¹æ® DAO ç±»æ–¹æ³•åè‡ªåŠ¨ç”Ÿæˆ Mapperæ˜ å°„æ–‡ä»¶çš„å¯¹åº”æ ‡ç­¾ find =\u003e \u003cselect\u003e delete =\u003e \u003cdelete\u003e update =\u003e \u003cupdate\u003e insert =\u003e \u003cinsert\u003e ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:10:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#idea-çš„-free-mybatis-plugins-æ’ä»¶"},{"categories":null,"content":"\rCookieçš„è®¾ç½® //å°†Cookieè®¾ç½®ä¸ºæ ¹è·¯å¾„ä¸‹ï¼Œè®©æ‰€æœ‰æ¨¡å—éƒ½èƒ½è®¿é—®åˆ°è¿™ä¸ªCookie cookie.setPath(\"/\"); //è®¾ç½®Cookieå­˜æ”¾åœ¨ç¡¬ç›˜ä¸­ï¼Œ60*60*24ä¸ºä¸€å¤© cookie.setMaxAge(60*60*24*10); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:11:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#cookieçš„è®¾ç½®"},{"categories":null,"content":"\ræ¸…é™¤Sessionä¸­çš„æ•°æ® session.removeAttribute(â€œæ•°æ®åâ€); //2. æ¸…é™¤Sessionä¸­çš„æ•°æ® HttpSession session = request.getSession(); session.removeAttribute(\"user\"); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:12:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ¸…é™¤sessionä¸­çš„æ•°æ®"},{"categories":null,"content":"\rçµæ´»è¿ç”¨JSTL \u003cc:forEach items=\"${typeList}\" var=\"t\" varStatus=\"i\"\u003e \u003c%-- varStatus: ç›¸å½“äºindex i.indexä»0å¼€å§‹ i.countä»1å¼€å§‹ --%\u003e \u003c%--çµæ´»è¿ç”¨ä¸‰ç›®è¡¨è¾¾å¼--%\u003e \u003ctr class=\"${i.count%2 == 0? \"\": \"active\"}\"\u003e \u003ctd\u003e\u003cinput type=\"checkbox\" /\u003e\u003c/td\u003e \u003ctd\u003e${i.count}\u003c/td\u003e \u003ctd\u003e${t.code}\u003c/td\u003e \u003ctd\u003e${t.name}\u003c/td\u003e \u003ctd\u003e${t.description}\u003c/td\u003e \u003c/tr\u003e \u003c/c:forEach\u003e ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:13:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#çµæ´»è¿ç”¨jstl"},{"categories":null,"content":"\rå…¨é€‰ä¸åé€‰ jspä¼ ç»Ÿå®ç°æ–¹å¼ //å…¨é€‰ function SelectAllAndUnSelectAll(){ var select = $(\"#checkAll\").prop(\"checked\"); for (var i = 0; i \u003c $(\"input[name=ck]\").length; i++) { $(\"input[name=ck]\")[i].checked = select; } } //åé€‰ function reSelectAll(){ if($(\"input[name=ck]\").length == $(\"input[name=ck]:checked\").length){ $(\"#checkAll\").prop(\"checked\", true); }else{ $(\"#checkAll\").prop(\"checked\", false); } } ajaxå¼‚æ­¥åˆ·æ–°çš„æ–¹å¼ ä½¿ç”¨å¼‚æ­¥åˆ·æ–°åŠ è½½å‡ºæ¥çš„ä»£ç ä¸èƒ½ä½¿ç”¨ $(\"input[name=ck]\") jQuery æ–¹å¼ç»‘å®šDOMå¯¹è±¡ // ä¸æ˜¯ç”± ajax å¼‚æ­¥å‡ºæ¥çš„ html æ ‡ç­¾ äº‹ä»¶å å­å®¹å™¨å¯¹è±¡ å›è°ƒæ–¹æ³• $(\"#dictionaryValueListBody\").on(\"click\", \"input[name=ck]\", function (){ $(\"#checkAll\").prop(\"checked\", $(\"input[name=ck]:checked\").length == $(\"input[name=ck]\").length) }) ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:14:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…¨é€‰ä¸åé€‰"},{"categories":null,"content":"\rå°è£…è¿”å›å€¼ç±»å‹å®ä½“ç±» æ¯æ¬¡ ajax è¯·æ±‚éƒ½è¦è¿”å›ä¸€äº›å›ºå®šæ ¼å¼çš„ MAP å°†ä½¿ç”¨é¢‘ç‡é«˜ç›¸ä¼¼åº¦é«˜çš„ MAP å†…å®¹åŒ…è£…æˆå®ä½“ç±» è¿”å›æ—¶å°±å¯ä»¥è¿”å›è¿™ä¸ªç±» ajax åœ¨å‰ç«¯ä¹Ÿå¯ä»¥å‘è§£æ MAP ä¸€æ ·è§£æè¿™ä¸ªç±»ä¸­çš„å†…å®¹ã€ é€šè¿‡å®ä½“ç±»è¿›è¡Œå°è£… é€šè¿‡ MAP é›†åˆåŸºç¡€ä¸Šè¿›è¡Œå°è£… å¯¹åˆ†é¡µæŸ¥è¯¢è¿›è¡Œå°è£… ç•¥ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:15:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å°è£…è¿”å›å€¼ç±»å‹å®ä½“ç±»"},{"categories":null,"content":"\rå½“å‰æ–¹æ³•å·²è¿‡æ—¶æ ‡è®° @Deprecated ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:16:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å½“å‰æ–¹æ³•å·²è¿‡æ—¶æ ‡è®°"},{"categories":null,"content":"\råœ¨mybatisåŠ¨æ€æŸ¥è¯¢çš„ifæ ‡ç­¾ä¸­ \u003c \u003e ä¼šè¢«è§£ææˆæ ‡ç­¾çš„å¼€å§‹å’Œç»“æŸ åº”ä½¿ç”¨ \u0026lt; \u0026gt;è½¬ä¹‰ æ¨¡ç³ŠæŸ¥è¯¢ â€˜%â€™ å·¦å³éƒ½è¦åŠ ä¸Šç©ºæ ¼ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:17:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#åœ¨mybatisåŠ¨æ€æŸ¥è¯¢çš„ifæ ‡ç­¾ä¸­"},{"categories":null,"content":"\rHTMLï¼šè®¾ç½®selectæ ‡ç­¾é»˜è®¤option è®¾ç½® select æ ‡ç­¾ value å±æ€§å³å¯ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:18:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#htmlè®¾ç½®selectæ ‡ç­¾é»˜è®¤option"},{"categories":null,"content":"\rPOI: Office æ–‡æ¡£çš„ Java å¤„ç†åŒ… POI å¯¹ Excel æ–‡ä»¶çš„åæ ‡ HSSFWorkbook : Excelå·¥ä½œç°¿å¯¹è±¡ HSSFSheet: Excelé¡µç å¯¹è±¡ HSSFRow : Excelè¡Œå¯¹è±¡ HSSFCell: Excelåˆ—/å•å…ƒæ ¼å¯¹è±¡ ä½¿ç”¨ MultipartFile è·å–åˆ°å‰ç«¯ä¼ å…¥çš„å¯¹è±¡ï¼Œç„¶åé€šè¿‡ HSSFWorkbook ç­‰å¯¹è±¡è½¬æ¢æå–åï¼Œå­˜å…¥æ•°æ®åº“ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:19:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#poi-office-æ–‡æ¡£çš„-java-å¤„ç†åŒ…"},{"categories":null,"content":"\ræ–‡ä»¶ input æ¡†çš„ä½¿ç”¨ ä¸ºæ–‡ä»¶ input æ¡†æ·»åŠ  Form è¡¨å• ä¸º Form è¡¨å•æ·»åŠ  enctype å±æ€§ä¸º multipart/form-data application/x-www-form-urlencodedã€é»˜è®¤ã€‘åªèƒ½ä¸Šä¼ æ–‡æœ¬æ ¼å¼çš„æ–‡ä»¶ multipart/form-data ä»¥äºŒè¿›åˆ¶å½¢å¼ä¸Šä¼ ï¼Œå¯ä»¥ä¸Šä¼ æ‰€æœ‰ç±»å‹æ–‡ä»¶ å†åç«¯ä½¿ç”¨ MultipartFile ç±»å‹æ¥æ”¶æ–‡ä»¶ String originalFilename = activityFile.getOriginalFilename(); è·å–æ–‡ä»¶å activityFile.transferTo(new File(url+\"/\"+fileName)); å°†æ–‡ä»¶å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:20:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æ–‡ä»¶-input-æ¡†çš„ä½¿ç”¨"},{"categories":null,"content":"\rè°ƒç”¨æµè§ˆå™¨çš„æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ åˆ©ç”¨ response å¯¹è±¡åˆ›å»ºè¾“å‡ºæµï¼ŒPOI å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè¾“å‡ºæµè¾“å‡ºæ–‡ä»¶ //å£°æ˜è¿”å›ç±»å‹ response.setContentType(\"octets/stream\"); response.setHeader(\"Content-Disposition\",\"attachment;filename=Activity-\"+DateTimeUtil.getSysTime()+\".xls\"); //åˆ›å»ºè¾“å‡ºæµ OutputStream out = response.getOutputStream(); //é€šè¿‡è¾“å‡ºæµè¾“å‡ºworkbookçš„å†…å®¹ workbook.write(out); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:21:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#è°ƒç”¨æµè§ˆå™¨çš„æ–‡ä»¶ä¸‹è½½åŠŸèƒ½"},{"categories":null,"content":"\rä¸ºå¼‚æ­¥åŠ è½½å‡ºçš„æ ‡ç­¾ç»‘å®šäº‹ä»¶ ä½¿ç”¨å¼‚æ­¥åˆ·æ–°åŠ è½½å‡ºæ¥çš„ä»£ç ä¸èƒ½ä½¿ç”¨ $(\"...\") jQuery æ–¹å¼ç»‘å®šDOMå¯¹è±¡ è§£å†³æ–¹å¼ï¼š // ä¸æ˜¯ç”± ajax å¼‚æ­¥å‡ºæ¥çš„ html æ ‡ç­¾ äº‹ä»¶å å­å®¹å™¨å¯¹è±¡ å›è°ƒæ–¹æ³• $(\"#dictionaryValueListBody\").on(\"click\", \"input[name=ck]\", function (){ $(\"#checkAll\").prop(\"checked\", $(\"input[name=ck]:checked\").length == $(\"input[name=ck]\").length) }) ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:22:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#ä¸ºå¼‚æ­¥åŠ è½½å‡ºçš„æ ‡ç­¾ç»‘å®šäº‹ä»¶"},{"categories":null,"content":"\ræœåŠ¡å™¨ç¼“å­˜ ä½¿ç”¨å…¨å±€ä½œç”¨åŸŸ ServletContext ä½œä¸ºç¼“å­˜åŒºåŸŸï¼Œå°†å¸¸ç”¨å­—å…¸å€¼å­˜åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œéœ€è¦æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­å– éœ€è¦æ³¨æ„ï¼š å½“æŒä¹…åŒ–æ•°æ®åº“çš„å€¼å¢åˆ æ”¹æ—¶ï¼Œç¼“å­˜æ•°æ®åº”åŠæ—¶æ›´æ–° éœ€è¦å¤„ç†ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©çš„é—®é¢˜ ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:23:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#æœåŠ¡å™¨ç¼“å­˜"},{"categories":null,"content":"\rå¦‚ä½•å°†å¯¹è±¡å­˜è‡³Redisä¸­ï¼Ÿ Redis ä¸­åªæ”¯æŒ String ç±»å‹ï¼Œä½†æ˜¯ String ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€ String ç±»å‹å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹æ•°æ®ã€‚ ä»»ä½•å›¾ç‰‡ã€è§†é¢‘ç­‰ç­‰æ ¼å¼æ–‡ä»¶ï¼Œåªè¦å¯ä»¥åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒéƒ½å¯ä»¥ä¿å­˜è‡³ Redis ä¸­ã€‚ Redis çš„ String ç±»å‹æœ€å¤§å¯ä»¥å­˜å‚¨ 512MB å†…å®¹ã€‚ åœ¨ Java ä¸­ï¼Œä¸€ä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚ åºåˆ—åŒ–å·¥å…·ç±»ï¼š import java.io.*; public class SerializableUtil { //åºåˆ—åŒ– public static byte [] serialize(Object obj){ ObjectOutputStream obi=null; ByteArrayOutputStream bai=null; try { bai=new ByteArrayOutputStream(); obi=new ObjectOutputStream(bai); obi.writeObject(obj); byte[] byt=bai.toByteArray(); return byt; } catch (IOException e) { e.printStackTrace(); } return null; } //ååºåˆ—åŒ– public static Object unserizlize(byte[] byt){ ObjectInputStream oii=null; ByteArrayInputStream bis=null; bis=new ByteArrayInputStream(byt); try { oii=new ObjectInputStream(bis); Object obj=oii.readObject(); return obj; } catch (Exception e) { e.printStackTrace(); } return null; } } ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:24:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å¦‚ä½•å°†å¯¹è±¡å­˜è‡³redisä¸­"},{"categories":null,"content":"\rJQueryä¸­ï¼Œè·å–é”®ç›˜äº‹ä»¶ åœ¨ç›¸åº”çš„äº‹ä»¶å›è°ƒæ–¹æ³•ä¸ŠåŠ  event å½¢å‚ï¼ŒJQuery ä¼šè‡ªåŠ¨å°†äº‹ä»¶å¯¹è±¡ä¼ å…¥ $(\"#searchActivity\").keydown(function (event){ console.log(event.keyCode); if (event.keyCode == 13){ alert(\"æ•²å‡»äº†å›è½¦\"); return false; } }); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:25:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#jqueryä¸­è·å–é”®ç›˜äº‹ä»¶"},{"categories":null,"content":"\rå…³é—­è¾“å…¥æ¡†è‡ªåŠ¨æç¤º ä¸ºè¾“å…¥æ¡†æ·»åŠ å±æ€§ autocomplete å€¼ä¸º off \u003cinput type=\"text\" autocomplete=\"off\"\u003e ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:26:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#å…³é—­è¾“å…¥æ¡†è‡ªåŠ¨æç¤º"},{"categories":null,"content":"\rBootstrap è‡ªåŠ¨è¡¥å…¨æ’ä»¶ typeahead æ’ä»¶ //source: è¾“å…¥æ¡†å†…å®¹å˜åŒ–æ—¶,è‡ªåŠ¨å›è°ƒçš„æ–¹æ³• // query: è¾“å…¥çš„å…³é”®å­— // process: è§£ææ•°æ®çš„æ–¹æ³•(éœ€æŒ‰è§„åˆ™å¯¹å†…å®¹è§£æ) //delay: ç­‰å¾…å¤šä¹…å‘é€ä¸€æ¬¡è¯·æ±‚(æ¯«ç§’) $(\"#create-customerName\").typeahead({ source: function (query, process) { $.post( \"workbench/transaction/getCustomerName.do\", { \"name\" : query }, function (data) { //dataæ ¼å¼: data[\"å¼ ä¸‰æœ‰é™è´£ä»»å…¬å¸\", \"æ³•å¤–ç‹‚å¾’å¼ ä¸‰\", \"æ€é˜å¼ ä¸‰\"] process(data); }, \"json\" ); }, delay: 500 }); ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:27:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#bootstrap-è‡ªåŠ¨è¡¥å…¨æ’ä»¶"},{"categories":null,"content":"\recharts å›¾è¡¨æ’ä»¶ å¯¼å…¥æ’ä»¶ \u003cscript type=\"text/javascript\" src=\"jquery/ECharts/echarts.min.js\"\u003e\u003c/script\u003e ä¸ºæ’ä»¶æä¾›æ˜¾ç¤ºåŒºåŸŸ \u003c!-- ä¸º ECharts å‡†å¤‡ä¸€ä¸ªå®šä¹‰äº†å®½é«˜çš„ DOM --\u003e \u003cdiv id=\"main\" style=\"width: 600px;height:400px;\"\u003e\u003c/div\u003e åˆå§‹åŒ–æ’ä»¶ï¼ŒæŒ‡å®šæ˜¾ç¤ºåŒºåŸŸã€æŒ‡å®šé…ç½®å’Œæ•°æ®ã€æ˜¾ç¤º optionï¼šå›¾è¡¨çš„é…ç½®å’Œæ•°æ® legendï¼šå›¾è¡¨çš„æ•°æ®ç§ç±» xAxisï¼šå›¾è¡¨ x è½´åæ ‡æ˜¾ç¤ºå†…å®¹ yAxisï¼šå›¾è¡¨ y è½´åæ ‡æ˜¾ç¤ºå†…å®¹ï¼ˆé»˜è®¤è‡ªåŠ¨ï¼‰ seriesï¼šæ˜¾ç¤ºå†…å®¹åˆ—è¡¨ nameï¼šå¯¹åº”çš„æ•°æ®ç§ç±» typeï¼šæ˜¾ç¤ºçš„å›¾çš„ç±»å‹ dataï¼šå›¾çš„æ•°æ® // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹ var myChart = echarts.init(document.getElementById('main')); // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ® var option = { title: { text: 'ECharts å…¥é—¨ç¤ºä¾‹' }, tooltip: {}, legend: { data: ['é”€é‡'] }, xAxis: { data: ['è¡¬è¡«', 'ç¾Šæ¯›è¡«', 'é›ªçººè¡«', 'è£¤å­', 'é«˜è·Ÿé‹', 'è¢œå­'] }, yAxis: {}, series: [ { name: 'é”€é‡', // type: 'bar',//æŸ±çŠ¶å›¾ // type: 'pie',//é¥¼çŠ¶å›¾ type: 'line',//æŠ˜çº¿å›¾ data: [5, 20, 36, 10, 10, 20] } ] }; // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚ myChart.setOption(option); æ•ˆæœï¼š äº¤æ˜“å†å²å›¾è¡¨æ•ˆæœï¼š ","date":"2021-10-17","objectID":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/:28:0","series":null,"tags":null,"title":"CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿé¡¹ç›®ç¬”è®°","uri":"/crm%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/#echarts-å›¾è¡¨æ’ä»¶"},{"categories":null,"content":"\rGIT å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-17 ç¬”è®°æ‘˜è‡ªé“¾æ¥ï¼šbjpowernode æå® ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#git"},{"categories":null,"content":"\rGITï¼šç‰ˆæœ¬æ§åˆ¶å·¥å…· ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆï¼Œé«˜é€Ÿçš„ç®¡ç†é¡¹ç›®ç‰ˆæœ¬ã€‚ ç”¨äºå­˜å‚¨ï¼Œè¿½è¸ªç›®å½•å’Œæ–‡ä»¶çš„ä¿®æ”¹å†å² ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gitç‰ˆæœ¬æ§åˆ¶å·¥å…·"},{"categories":null,"content":"\rGITçš„ä½œç”¨ ååŒå¼€å‘ ç‰ˆæœ¬æ§åˆ¶ æ•°æ®å¤‡ä»½ æƒé™æ§åˆ¶ åˆ†æ”¯ç®¡ç† ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gitçš„ä½œç”¨"},{"categories":null,"content":"\rGITçš„ä¼˜ç‚¹ é€‚åˆåˆ†å¸ƒå¼ï¼Œå¼ºè°ƒä¸ªä½“ã€‚ å…¬å…±æœåŠ¡å™¨å‹åŠ›å’Œæ•°æ®é‡éƒ½ä¸å¤§ã€‚ é€Ÿåº¦å¿«ï¼Œçµæ´»ã€‚ ç›¸å¯¹å®¹æ˜“çš„è§£å†³å†²çªã€‚ å¤§éƒ¨åˆ†æ“ä½œåœ¨æœ¬åœ°å®Œæˆï¼Œä¸éœ€è¦è”ç½‘ã€‚ ä»¥å¿«ç…§æµçš„æ–¹å¼å·¥ä½œã€‚ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gitçš„ä¼˜ç‚¹"},{"categories":null,"content":"\rGITçš„ç›®å½• å·¥ä½œç›®å½• ä¿å­˜ä»£ç çš„æ–‡ä»¶å¤¹ æš‚å­˜åŒº ç±»ä¼¼äºå›æ”¶ç«™ï¼Œæš‚æ—¶ä¿å­˜ä»£ç ç”¨ æœ¬åœ°ä»“åº“ git init åˆ›å»ºå‡ºæ¥çš„ .git éšè—ç›®å½• è¿œç¨‹ä»“åº“ ä»£ç çš„æ‰˜ç®¡å¹³å° Github / Gitee ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gitçš„ç›®å½•"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gitå¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŸ¥çœ‹ç‰ˆæœ¬å·-git---version"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»ºæœ¬åœ°ä»“åº“-git-init"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº-add"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½•--reset"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“-commit"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€-git-status"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è®¾ç½®ç­¾åconfig"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯-log"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç‰ˆæœ¬åˆ‡æ¢-reset"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–‡ä»¶åˆ é™¤-rm"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–‡ä»¶æ‰¾å›-restore"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ†æ”¯ç®¡ç†"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»ºåˆ†æ”¯branch"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŸ¥çœ‹åˆ†æ”¯branch"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ‡æ¢åˆ†æ”¯checkout"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout--b"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ é™¤åˆ†æ”¯branch--d"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch--d"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ†æ”¯åˆå¹¶merge"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿œç¨‹ä»“åº“"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote--v"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote-remove"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push--d"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull"},{"categories":null,"content":"\rGIT å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-17 ç¬”è®°æ‘˜è‡ªé“¾æ¥ï¼šbjpowernode æå® ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:0:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#git"},{"categories":null,"content":"\rGITï¼šç‰ˆæœ¬æ§åˆ¶å·¥å…· ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆï¼Œé«˜é€Ÿçš„ç®¡ç†é¡¹ç›®ç‰ˆæœ¬ã€‚ ç”¨äºå­˜å‚¨ï¼Œè¿½è¸ªç›®å½•å’Œæ–‡ä»¶çš„ä¿®æ”¹å†å² ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:1:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#gitç‰ˆæœ¬æ§åˆ¶å·¥å…·"},{"categories":null,"content":"\rGITçš„ä½œç”¨ ååŒå¼€å‘ ç‰ˆæœ¬æ§åˆ¶ æ•°æ®å¤‡ä»½ æƒé™æ§åˆ¶ åˆ†æ”¯ç®¡ç† ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:2:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#gitçš„ä½œç”¨"},{"categories":null,"content":"\rGITçš„ä¼˜ç‚¹ é€‚åˆåˆ†å¸ƒå¼ï¼Œå¼ºè°ƒä¸ªä½“ã€‚ å…¬å…±æœåŠ¡å™¨å‹åŠ›å’Œæ•°æ®é‡éƒ½ä¸å¤§ã€‚ é€Ÿåº¦å¿«ï¼Œçµæ´»ã€‚ ç›¸å¯¹å®¹æ˜“çš„è§£å†³å†²çªã€‚ å¤§éƒ¨åˆ†æ“ä½œåœ¨æœ¬åœ°å®Œæˆï¼Œä¸éœ€è¦è”ç½‘ã€‚ ä»¥å¿«ç…§æµçš„æ–¹å¼å·¥ä½œã€‚ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:3:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#gitçš„ä¼˜ç‚¹"},{"categories":null,"content":"\rGITçš„ç›®å½• å·¥ä½œç›®å½• ä¿å­˜ä»£ç çš„æ–‡ä»¶å¤¹ æš‚å­˜åŒº ç±»ä¼¼äºå›æ”¶ç«™ï¼Œæš‚æ—¶ä¿å­˜ä»£ç ç”¨ æœ¬åœ°ä»“åº“ git init åˆ›å»ºå‡ºæ¥çš„ .git éšè—ç›®å½• è¿œç¨‹ä»“åº“ ä»£ç çš„æ‰˜ç®¡å¹³å° Github / Gitee ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:4:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#gitçš„ç›®å½•"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#gitå¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æŸ¥çœ‹ç‰ˆæœ¬å·-git---version"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ›å»ºæœ¬åœ°ä»“åº“-git-init"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº-add"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½•--reset"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“-commit"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€-git-status"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#è®¾ç½®ç­¾åconfig"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯-log"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#ç‰ˆæœ¬åˆ‡æ¢-reset"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æ–‡ä»¶åˆ é™¤-rm"},{"categories":null,"content":"\rGITå¸¸ç”¨å‘½ä»¤ç§»åŠ¨åˆ°Gitä¸­testæ–‡ä»¶å¤¹ï¼šcd D:/Document/Git/test ==gitæ˜¯ä¸ä¼šç®¡ç†ç©ºæ–‡ä»¶å¤¹çš„== æŸ¥çœ‹ç‰ˆæœ¬å· git --version åˆ›å»ºæœ¬åœ°ä»“åº“ git init æœ¬åœ°ä»“åº“åˆ›å»ºåä¼šå‡ºç°ä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶å¤¹ å·¥ä½œç›®å½•æ·»åŠ åˆ°æš‚å­˜åŒº add git add æ–‡ä»¶ git add . æäº¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ æš‚å­˜åŒºè¿˜åŸåˆ°å·¥ä½œç›®å½• reset git reset æ–‡ä»¶ åˆ é™¤æš‚å­˜åŒºä¸­çš„è¯¥æ–‡ä»¶ æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“ commit git commit git commit -m \"æ—¥å¿—ä¿¡æ¯\" git commit --amend -m \"æ—¥å¿—ä¿¡æ¯\" é‡æ–°æäº¤æ—¥å¿—ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶çŠ¶æ€ git status å·²è·Ÿè¸ªæ–‡ä»¶ï¼šç»¿è‰²ï¼Œå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºã€ä»¥è·Ÿè¸ªã€‘ æœªè·Ÿè¸ªæ–‡ä»¶ï¼šçº¢è‰²ï¼Œæœªæ·»åŠ åˆ°æš‚å­˜åŒºã€æœªè·Ÿè¸ªã€‘ git restore HEAD æ–‡ä»¶å è®©æ–‡ä»¶å˜ä¸ºã€æœªè·Ÿè¸ªã€‘çŠ¶æ€ è®¾ç½®ç­¾åconfig è®¾ç½®ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config user.name \"LiuJN\" â€‹ git config user.email \"LiuJaNing@163.com\" è®¾ç½®å…¨å±€ç­¾åï¼ˆç”¨æˆ·åï¼Œé‚®ç®±ï¼‰ â€‹ git config --global user.name \"LiuJN\" â€‹ git config --global user.email \"LiuJaNing@163.com\" git config --list æŸ¥çœ‹å½“å‰æ‰€æœ‰ config ä¿¡æ¯ æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ log git log æŸ¥çœ‹å½“å‰æ—¥å¿—ä¿¡æ¯ï¼Œå½“å‰æ—¶é—´èŠ‚ç‚¹çš„æ—¥å¿—ä¿¡æ¯ git reflog æŸ¥çœ‹æœ¬åœ°ä»“åº“æ›´æ–°å†å²è®°å½• ç‰ˆæœ¬åˆ‡æ¢ reset git reset --hard ç‰ˆæœ¬çš„Hashå€¼ æ–‡ä»¶åˆ é™¤ rm æ–‡ä»¶è¢«åˆ é™¤ä¹‹åï¼Œè¿˜éœ€è¦ æ·»åŠ ã€æäº¤ æ“ä½œè®©æœ¬åœ°ä»“åº“çŸ¥é“æ–‡ä»¶å·²ç»è¢«åˆ é™¤ é€šè¿‡ git å‘½ä»¤åˆ é™¤æ–‡ä»¶ rm git rm æ–‡ä»¶å åˆ é™¤å·¥ä½œç›®å½•ã€ç¼“å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œç›´æ¥æäº¤å³å¯ æ–‡ä»¶æ‰¾å› restore ==åˆ é™¤çš„æ–‡ä»¶å¦‚æœå·²ç»æäº¤åˆ™æ— æ³•æ‰¾å›== git restore æ–‡ä»¶å æ‰¾å›æ·»åŠ åˆ°æš‚å­˜åŒºåè¢«åˆ é™¤çš„æ–‡ä»¶ git restore --staged æ–‡ä»¶å æ‰¾å›ä½¿ç”¨ git rm å‘½ä»¤åˆ é™¤çš„æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œç„¶å git restore æ–‡ä»¶å æ‰¾å›æ–‡ä»¶åˆ°å·¥ä½œç›®å½• ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:5:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æ–‡ä»¶æ‰¾å›-restore"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ†æ”¯ç®¡ç†"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ›å»ºåˆ†æ”¯branch"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æŸ¥çœ‹åˆ†æ”¯branch"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ‡æ¢åˆ†æ”¯checkout"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout--b"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ é™¤åˆ†æ”¯branch--d"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch--d"},{"categories":null,"content":"\råˆ†æ”¯ç®¡ç†\råˆ›å»ºåˆ†æ”¯branch git branch åˆ†æ”¯å åˆ›å»ºå‡ºæ¥çš„åˆ†æ”¯åŸºäºå½“å‰åˆ†æ”¯çš„ä»£ç ï¼Œåˆ›å»ºä¹‹ååˆ†æ”¯çš„æ“ä½œäº’ä¸å½±å“ æŸ¥çœ‹åˆ†æ”¯branch git branch åˆ‡æ¢åˆ†æ”¯checkout git checkout åˆ†æ”¯å åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯checkout -b git checkout -b åˆ†æ”¯åç§° åˆ é™¤åˆ†æ”¯branch -d æ— æ³•åˆ é™¤å½“å‰æ‰€å¤„çš„åˆ†æ”¯ git branch -d åˆ†æ”¯å å¼ºåˆ¶åˆ é™¤åˆ†æ”¯branch -D å¦‚æœåˆ†æ”¯å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ä½¿ç”¨å¼ºåˆ¶åˆ é™¤ git branch -D åˆ†æ”¯å åˆ†æ”¯åˆå¹¶merge git merge ç›®æ ‡åˆ†æ”¯çš„åç§° å°†ç›®æ ‡åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:6:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ†æ”¯åˆå¹¶merge"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#è¿œç¨‹ä»“åº“"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote-add"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote--v"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote-remove"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push--d"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone"},{"categories":null,"content":"\rè¿œç¨‹ä»“åº“\ræœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“remote add git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€ æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯remote -v git remote -v åˆ é™¤ä¸è¿œç¨‹ä»“åº“çš„å…³è”å…³ç³»remote remove git remote remove è¿œç¨‹ä»“åº“å å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“push git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å ç¬¬ä¸€æ”¯æ¨é€çš„åˆ†æ”¯å°±æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼Œæ— æ³•åˆ é™¤ åˆ é™¤è¿œç¨‹ä»“åº“åˆ†æ”¯push -d git push -d è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å å…‹éš†ä»£ç åˆ°æœ¬åœ°ä»“åº“clone git clone è¿œç¨‹ä»“åº“åœ°å€ å…‹éš†åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ”¾åœ¨è¿œç¨‹ä»“åº“åç§° git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° è‡ªå·±æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹åç§° git clone -b è¿œç¨‹ä»“åº“åˆ†æ”¯ è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°æ–‡ä»¶å¤¹åç§° å…‹éš†è¿œç¨‹ä»“åº“çš„åˆ†æ”¯åˆ°æœ¬åœ° æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull æ‹‰å–æœ¬åœ°ä»“åº“ä¸å­˜åœ¨çš„åˆ†æ”¯ git pull è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åˆ†æ”¯å:æœ¬åœ°ä»“åº“åˆ†æ”¯å æ‹‰å–æœ¬åœ°ä»“åº“å·²ç»å­˜åœ¨çš„åˆ†æ”¯ã€æœ¬åœ°å·²æœ‰åŒååˆ†æ”¯ã€‘ git pull è¿œç¨‹ä»“åº“åç§° è¿œç¨‹ä»“åº“åˆ†æ”¯å å¼ºåˆ¶æ‹‰å–è¿œç¨‹ä»“åº“çš„å†…å®¹åˆ°ä¸åŒç‰ˆæœ¬çš„æœ¬åœ°ä»“åº“ä¸­ git pull origin master --allow-unrelated-histories ","date":"2021-10-17","objectID":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/:7:0","series":null,"tags":null,"title":"GITè‡ªå­¦ç¬”è®°mdç‰ˆminiç‰ˆ","uri":"/git%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88mini%E7%89%88/#æ‹‰å–åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“pull"},{"categories":null,"content":"\rNginxè‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-17 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æ¨éœ‡ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nginxè‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rNginxæœåŠ¡å™¨ é™æ€ç½‘ç«™éƒ¨ç½² è´Ÿè½½å‡è¡¡ è™šæ‹Ÿä¸»æœº åå‘ä»£ç†ï¼Œæ­£å‘ä»£ç† ä»£ç†å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç† ä»£ç†å¯¹è±¡æ˜¯æœåŠ¡ç«¯ã€‚ åŠ¨é™åˆ†ç¦» ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nginxæœåŠ¡å™¨"},{"categories":null,"content":"\rNginxæœåŠ¡å™¨ç‰¹ç‚¹ å ç”¨å†…å­˜å°‘ å¹¶å‘å¤„ç†èƒ½åŠ›å¼º é«˜æ€§èƒ½ ä½ç³»ç»Ÿèµ„æºæ¶ˆè€— ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nginxæœåŠ¡å™¨ç‰¹ç‚¹"},{"categories":null,"content":"\råœ¨Linuxä¸­çš„éƒ¨ç½²é…ç½®Nginx å®‰è£…ä¾èµ–ç¼–è¯‘å™¨ä¸ä¾èµ–çš„ç±»åº“ï¼šgccç¼–è¯‘å™¨ã€opensslåº“ã€pcreåº“ã€zlibåº“ yum install gcc openssl openssl-devel pcre pcre-devel zlib zlib-devel -y ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹ åœ¨nginxè§£å‹è·¯å¾„ä¸‹æ‰§è¡Œ ./configure --prefix=/usr/local/nginx ç¼–è¯‘ make å®‰è£… make install ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åœ¨linuxä¸­çš„éƒ¨ç½²é…ç½®nginx"},{"categories":null,"content":"\rNginxå¸¸ç”¨å‘½ä»¤ å¯åŠ¨Nginxï¼šåœ¨Nginxå®‰è£…ç›®å½•/sbin ä¸‹æ‰§è¡Œå‘½ä»¤ ./nginx master è¿›ç¨‹è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶ç»´æŠ¤ worker è¿›ç¨‹ worker è¿›ç¨‹åˆ™å¯¹è¯·æ±‚è¿›è¡Œå®é™…å¤„ç† å…³é—­Nginx ä¼˜é›…å…³é—­ï¼šå¤„ç†å®Œè¯·æ±‚åå†å…³é—­ kill -quit ä¸»pid æš´åŠ›å…³é—­ï¼šä¸ç®¡è¯·æ±‚æ˜¯å¦å¤„ç†å®Œæˆï¼Œç›´æ¥å…³é—­ kill -term ä¸»pid é‡å¯Nginxï¼š./nginx -s reload ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nginxå¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rä¸€ã€åœ¨Nginxä¸­éƒ¨ç½²é™æ€ç½‘ç«™ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½® serverï¼šè™šæ‹Ÿä¸»æœº locationï¼šå¤„ç†çš„ç½‘ç«™ï¼Œ/å¼€å¤´ rootï¼šç½‘ç«™æ ¹ç›®å½• indexï¼šé¦–é¡µæ–‡ä»¶å é‡å¯æœåŠ¡å™¨ï¼Œè®¿é—® 127.0.0.1/myWeb ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€åœ¨nginxä¸­éƒ¨ç½²é™æ€ç½‘ç«™"},{"categories":null,"content":"\räºŒã€Nginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥\r1. è½®è¯¢ ä¸ºæ¯ä¸ªè®¿é—®çš„urlç”Ÿæˆhashå€¼ï¼ŒæŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚åˆ°å“ªå°æœåŠ¡å™¨ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ åœ¨ server ä¸­æ·»åŠ  location å¹¶è®©proxy_pass å¯¹åº”åˆ° upstreamå 2. æƒé‡ è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„æƒé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚weightå€¼è¶Šå¤§è®¿é—®çš„æ¯”ä¾‹è¶Šå¤§ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å£°æ˜å¯¹åº”çš„ weight æƒé‡å€¼ 3. ipç»‘å®š ipç»‘å®šä¹Ÿå«ip_hashï¼ŒæŒ‰ç…§ipçš„hashå€¼å¯¹åº”æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸¢å¤±é—®é¢˜ 4. æœ€å°‘è¿æ¥ å“ªå°æœåŠ¡å™¨æœ€ç©ºé—²å°±åˆ†é…åˆ°å“ªå°æœåŠ¡å™¨ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒnginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥"},{"categories":null,"content":"\räºŒã€Nginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥\r1. è½®è¯¢ ä¸ºæ¯ä¸ªè®¿é—®çš„urlç”Ÿæˆhashå€¼ï¼ŒæŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚åˆ°å“ªå°æœåŠ¡å™¨ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ åœ¨ server ä¸­æ·»åŠ  location å¹¶è®©proxy_pass å¯¹åº”åˆ° upstreamå 2. æƒé‡ è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„æƒé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚weightå€¼è¶Šå¤§è®¿é—®çš„æ¯”ä¾‹è¶Šå¤§ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å£°æ˜å¯¹åº”çš„ weight æƒé‡å€¼ 3. ipç»‘å®š ipç»‘å®šä¹Ÿå«ip_hashï¼ŒæŒ‰ç…§ipçš„hashå€¼å¯¹åº”æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸¢å¤±é—®é¢˜ 4. æœ€å°‘è¿æ¥ å“ªå°æœåŠ¡å™¨æœ€ç©ºé—²å°±åˆ†é…åˆ°å“ªå°æœåŠ¡å™¨ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#1-è½®è¯¢"},{"categories":null,"content":"\räºŒã€Nginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥\r1. è½®è¯¢ ä¸ºæ¯ä¸ªè®¿é—®çš„urlç”Ÿæˆhashå€¼ï¼ŒæŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚åˆ°å“ªå°æœåŠ¡å™¨ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ åœ¨ server ä¸­æ·»åŠ  location å¹¶è®©proxy_pass å¯¹åº”åˆ° upstreamå 2. æƒé‡ è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„æƒé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚weightå€¼è¶Šå¤§è®¿é—®çš„æ¯”ä¾‹è¶Šå¤§ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å£°æ˜å¯¹åº”çš„ weight æƒé‡å€¼ 3. ipç»‘å®š ipç»‘å®šä¹Ÿå«ip_hashï¼ŒæŒ‰ç…§ipçš„hashå€¼å¯¹åº”æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸¢å¤±é—®é¢˜ 4. æœ€å°‘è¿æ¥ å“ªå°æœåŠ¡å™¨æœ€ç©ºé—²å°±åˆ†é…åˆ°å“ªå°æœåŠ¡å™¨ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#2-æƒé‡"},{"categories":null,"content":"\räºŒã€Nginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥\r1. è½®è¯¢ ä¸ºæ¯ä¸ªè®¿é—®çš„urlç”Ÿæˆhashå€¼ï¼ŒæŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚åˆ°å“ªå°æœåŠ¡å™¨ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ åœ¨ server ä¸­æ·»åŠ  location å¹¶è®©proxy_pass å¯¹åº”åˆ° upstreamå 2. æƒé‡ è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„æƒé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚weightå€¼è¶Šå¤§è®¿é—®çš„æ¯”ä¾‹è¶Šå¤§ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å£°æ˜å¯¹åº”çš„ weight æƒé‡å€¼ 3. ipç»‘å®š ipç»‘å®šä¹Ÿå«ip_hashï¼ŒæŒ‰ç…§ipçš„hashå€¼å¯¹åº”æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸¢å¤±é—®é¢˜ 4. æœ€å°‘è¿æ¥ å“ªå°æœåŠ¡å™¨æœ€ç©ºé—²å°±åˆ†é…åˆ°å“ªå°æœåŠ¡å™¨ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#3-ipç»‘å®š"},{"categories":null,"content":"\räºŒã€Nginxå¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥\r1. è½®è¯¢ ä¸ºæ¯ä¸ªè®¿é—®çš„urlç”Ÿæˆhashå€¼ï¼ŒæŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚åˆ°å“ªå°æœåŠ¡å™¨ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ åœ¨ server ä¸­æ·»åŠ  location å¹¶è®©proxy_pass å¯¹åº”åˆ° upstreamå 2. æƒé‡ è¯·æ±‚æŒ‰ç…§ä¸€å®šçš„æƒé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚weightå€¼è¶Šå¤§è®¿é—®çš„æ¯”ä¾‹è¶Šå¤§ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µ åœ¨ nginxå®‰è£…ç›®å½•/conf/nginx.conf ä¸­ä¿®æ”¹é…ç½®ï¼Œåœ¨http ä¸­æ·»åŠ  upstream å¹¶å¯¹åº”æ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å£°æ˜å¯¹åº”çš„ weight æƒé‡å€¼ 3. ipç»‘å®š ipç»‘å®šä¹Ÿå«ip_hashï¼ŒæŒ‰ç…§ipçš„hashå€¼å¯¹åº”æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸¢å¤±é—®é¢˜ 4. æœ€å°‘è¿æ¥ å“ªå°æœåŠ¡å™¨æœ€ç©ºé—²å°±åˆ†é…åˆ°å“ªå°æœåŠ¡å™¨ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#4-æœ€å°‘è¿æ¥"},{"categories":null,"content":"\rä¸‰ã€åœ¨Nginxä¸­éƒ¨ç½²åŠ¨é™åˆ†ç¦»ç½‘ç«™ç•¥ ","date":"2021-10-17","objectID":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"Nginxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/nginx%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸‰åœ¨nginxä¸­éƒ¨ç½²åŠ¨é™åˆ†ç¦»ç½‘ç«™"},{"categories":null,"content":"\rRedisè‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-11 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æ¨éœ‡ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisè‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rNoSQLï¼ˆNot Only SQLï¼‰ è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆå¤šé‡æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨ã€‚ éå…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®ä¹‹é—´ä¸€æ—¦æ²¡æœ‰å…³ç³»ï¼Œæ‰©å±•æ€§ã€è¯»å†™æ€§èƒ½éƒ½å¤§å¤§æé«˜ã€‚ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#nosqlnot-only-sql"},{"categories":null,"content":"\rRediså’ŒMySQLæ•°æ®åº“çš„åŒºåˆ« MySQL å…³ç³»å‹æ•°æ®åº“ æ˜“äºç»´æŠ¤ æ˜“äºå‘ç”¨æˆ·å±•ç¤ºå…·æœ‰éš¶å±å…³ç³»çš„ä¿¡æ¯ æŸ¥è¯¢æ—¶éœ€è¦ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡ç›¸å¯¹ä½ Redisï¼šRemote Dictionary Server(è¿œç¨‹å­—å…¸æœåŠ¡å™¨) éå…³ç³»å‹æ•°æ®åº“ æ•°æ®ä»¥MAPé›†åˆå½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ ä¸é€‚äºé•¿æœŸå­˜å‚¨ï¼Œé€‚äºé¢‘ç¹å¿«é€Ÿçš„æŸ¥è¯¢ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#rediså’Œmysqlæ•°æ®åº“çš„åŒºåˆ«"},{"categories":null,"content":"\rRedisçš„ç‰¹ç‚¹ æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼šå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚ æ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼škey-valueç±»å‹ã€listã€setã€zsetã€hash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚ æ”¯æŒæ•°æ®å¤‡ä»½ï¼šRedisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisçš„ç‰¹ç‚¹"},{"categories":null,"content":"\rRedisåŸºç¡€çŸ¥è¯† Redisé»˜è®¤ä½¿ç”¨16ä¸ªæ•°æ®åº“ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ portå€¼ å¯åŠ¨Redisæ•°æ®åº“ Redisé»˜è®¤ç«¯å£ï¼š6379 åœ¨å®‰è£…ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼šredis-server åå°å¯åŠ¨RedisæœåŠ¡ï¼šredis-server \u0026 æ ¹æ®é…ç½®æ–‡ä»¶å¯åŠ¨Redisï¼šredis-server é…ç½®æ–‡ä»¶ \u0026 å¦‚æœä¿®æ”¹äº†redisçš„é…ç½®æ–‡ä»¶redis.confï¼Œå¿…é¡»åœ¨å¯åŠ¨æ—¶æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå¦åˆ™ä¿®æ”¹æ— æ•ˆï¼ å…³é—­Redisæ•°æ®åº“ æ‰§è¡Œå‘½ä»¤ï¼šredis-cli shutdown æ‰§è¡Œå‘½ä»¤ï¼š ps -ef | grep redis æŸ¥è¯¢å‡ºredisè¿›ç¨‹çš„PID kill pid æˆ–è€… kill -9 pid æ€æ‰è¿›ç¨‹ è¿æ¥redis åœ¨ä»»æ„ä½ç½®æ‰§è¡Œå‘½ä»¤ï¼šredis-cli ä½¿ç”¨pingå‘½ä»¤æµ‹è¯•æ˜¯å¦è¿é€š ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisåŸºç¡€çŸ¥è¯†"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#rediså¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#stringå­—ç¬¦ä¸²ç±»å‹"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#liståˆ—è¡¨ç±»å‹"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#hashå“ˆå¸Œç±»å‹"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#seté›†åˆç±»å‹"},{"categories":null,"content":"\rRediså¸¸ç”¨å‘½ä»¤ åˆ‡æ¢æ•°æ®åº“ï¼š select æ•°æ®åº“ç¼–å· æŸ¥çœ‹å½“å‰æ•°æ®åº“æœ‰å“ªäº›keyï¼š keys * åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®ï¼š flushdb åˆ é™¤æ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼š flushall æŸ¥çœ‹åº“ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼š dbsize Stringå­—ç¬¦ä¸²ç±»å‹ æœ€å¤§å€¼512MB å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šset keyå€¼ valueå€¼ è·å–keyå€¼å¯¹åº”çš„valueå€¼ï¼šget keyå€¼ ç©ºä¸ºï¼šnil ä¸ºåŸvalueå€¼åè¿½åŠ å­—ç¬¦ï¼šappend keyå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„å­—ç¬¦ä¸² ç±»å‹ é•¿åº¦ è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²å­—ç¬¦ä¸ªæ•°ï¼šstrlen keyå€¼ ä¸å­˜åœ¨è¿”å› 0 æˆªå–å­—ç¬¦ä¸²ï¼šgetrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ æ­£è´Ÿä¸‹æ ‡åŒpathon ==å·¦å³éƒ½åŒæ—¶åŒ…å«== ä¸´æ—¶å‘MAPä¸­å­˜æ”¾é”®å€¼å¯¹ï¼šsetex keyå€¼ ç§’æ•° valueå€¼ Liståˆ—è¡¨ç±»å‹ åœ¨åˆ—è¡¨å·¦è¾¹å‹å…¥é”®å€¼å¯¹ï¼šlpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ åœ¨æŒ‡å®šä¸‹æ ‡åŒºé—´ä¸­å–å€¼ï¼šlrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ ==å·¦å³åŒæ—¶åŒ…å«== åœ¨åˆ—è¡¨å³è¾¹å‹å…¥é”®å€¼å¯¹ï¼šrpush keyå€¼ å€¼... è¿”å›è¿½åŠ åçš„åˆ—è¡¨ é•¿åº¦ ç§»é™¤å·¦ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šlpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ ç§»é™¤å³ä¾§ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šrpop keyå€¼ è¿”å›åˆ é™¤æ‰çš„valueå€¼ å–æŒ‡å®šä¸‹æ ‡ä¸Šçš„å€¼ï¼šlindex keyå€¼ ä¸‹æ ‡ è¿”å›åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªæ•°æ®ï¼šllen keyå€¼ æ›´æ¢åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡ä½çš„å€¼ï¼šlset keyå€¼ ä¸‹æ ‡ valueå€¼ Hashå“ˆå¸Œç±»å‹ åœ¨å“ˆå¸Œåˆ—è¡¨keyä¸­æ·»åŠ  fieldåŸŸå’Œvalueå€¼ å¯¹ï¼šhset keyå€¼ fieldå€¼ valueå€¼ [field value â€¦] è¿”å›å½“å‰å“ˆå¸Œåˆ—è¡¨ä¸­åŸŸå€¼å¯¹çš„æ•°é‡ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æŒ‡å®šfieldåŸŸçš„valueå€¼ï¼šhget keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰ åŸŸå’Œå€¼ ï¼šgetall keyå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰fieldåŸŸåˆ—è¡¨ï¼šhkeys keyå€¼ åˆ é™¤å“ˆå¸Œåˆ—è¡¨ä¸­çš„ä¸€ä¸ª åŸŸå€¼å¯¹ ï¼šhdel keyå€¼ fieldå€¼ è·å–å“ˆå¸Œåˆ—è¡¨ä¸­æ‰€æœ‰valueå€¼åˆ—è¡¨ï¼šhvals keyå€¼ æŸ¥çœ‹å“ˆå¸Œåˆ—è¡¨ä¸­ æ˜¯å¦å­˜åœ¨å¯¹åº”çš„fieldåŸŸï¼šhexists keyå€¼ fieldå€¼ Seté›†åˆç±»å‹ å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šsadd keyå€¼ å…ƒç´ å€¼ [å…ƒç´ å€¼...] è¿”å›è¿½åŠ åçš„é›†åˆ é•¿åº¦ æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼šsmembers keyå€¼ åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„memberå€¼ï¼šsismember keyå€¼ memberå€¼ è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šscard keyå€¼ ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šsrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„é›†åˆ é•¿åº¦ è¿”å›æŒ‡å®šé›†åˆçš„å·®é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆæ²¡æœ‰çš„å€¼ï¼šsdiff keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„äº¤é›†ï¼Œç¬¬ä¸€ä¸ªé›†åˆæœ‰ï¼Œå…¶ä»–é›†åˆä¹Ÿæœ‰çš„å€¼ï¼šsinter keyå€¼ [keyå€¼...] è¿”å›æŒ‡å®šé›†åˆçš„å¹¶é›†ï¼Œæ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ å¹¶åœ¨ä¸€èµ·ï¼šsunion keyå€¼ [keyå€¼...] Zsetæœ‰åºé›†åˆç±»å‹ é€šè¿‡æ¯ä¸ªå…ƒç´ çš„åˆ†æ•°æ¥ç¡®å®šå…ƒç´  å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼šzadd keyå€¼ scoreå€¼ valueå€¼ è¿”å›è¿½åŠ åçš„æœ‰åºé›†åˆ é•¿åº¦ æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrange keyå€¼ å¼€å§‹ä¸‹æ ‡ ç»“æŸä¸‹æ ‡ å…¶å€¼æŒ‰ç…§scoreåˆ†æ•°å‡åºæ’åºï¼Œæœ€å°ä¸ºä¸‹æ ‡0 æŒ‰åˆ†æ•°æŸ¥è¯¢æœ‰åºé›†åˆæŒ‡å®šç©ºé—´å†…çš„å…ƒç´ ï¼šzrangebyscore keyå€¼ minåˆ†æ•° maxåˆ†æ•° ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼šzrem keyå€¼ memberå€¼ [memberå€¼...] è¿”å›ç§»é™¤çš„æœ‰åºé›†åˆ é•¿åº¦ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼šzcard keyå€¼ è·å–æœ‰åºé›†åˆä¸­æˆå‘˜çš„æ’åï¼šzrank keyå€¼ memberå€¼ è·å–æœ‰åºé›†åˆä¸­å…ƒç´ çš„åˆ†æ•°ï¼šzscore keyå€¼ memberå€¼ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#zsetæœ‰åºé›†åˆç±»å‹"},{"categories":null,"content":"\rRedisæŒä¹…åŒ–å°†Redisæ•°æ®åº“ä¸­çš„æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ ä¸€ã€RDBæŒä¹…åŒ– æ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡å†³å®šæ˜¯å¦æŒä¹…åŒ– RedisæœåŠ¡å™¨é»˜è®¤å¼€å¯RDBæŒä¹…åŒ–æ–¹å¼ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / dump.rdb é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ saveå€¼æ˜¯å¦å¼€å¯RDBæŒä¹…åŒ– å•ä½ä¹‹é—´å†…è¾¾åˆ°è¢«ä¿®æ”¹æ¬¡æ•°å°±ä¼šè¢«æŒä¹…åŒ– save 900 1 #900ç§’å†…è¢«ä¿®æ”¹1æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 300 10 #300ç§’å†…è¢«ä¿®æ”¹10æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 60 10000 #60ç§’å†…è¢«ä¿®æ”¹10000æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ dbfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ rdbcompressionå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶æ˜¯å¦éœ€è¦å‹ç¼© ã€yesã€‘å¼€å¯å‹ç¼©ï¼Œé»˜è®¤å¼€å¯ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ stop-writes-on-bgsave-errorå€¼ä¿®æ”¹æŒä¹…åŒ–æ—¶å‘ç”Ÿé”™è¯¯æ˜¯å¦é˜»æ­¢å…¶ä»–å‘½ä»¤æ‰§è¡Œ ã€yesã€‘ä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½ä¸å†æŒä¹…åŒ– ã€noã€‘ä¹‹åæ•°æ®æ›´æ”¹ä¸å—å½±å“ æ‰‹åŠ¨å°†æ•°æ®æŒä¹…åŒ– ä½¿ç”¨bgsaveå‘½ä»¤ï¼šç›´æ¥å°†å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨dump.rdbä¸­ RDBçš„ç¼ºç‚¹ï¼šæ— æ³•ä¿è¯dump.rdbä¸­å­˜å‚¨çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ äºŒã€ROFæŒä¹…åŒ– æ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”æŒä¹…åŒ–æ•°æ®åº“æ•°æ® Append Only Fileï¼ˆAOFï¼‰ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / appendonly.aof é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰ è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendonlyå€¼æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfsyncå€¼ä¿®æ”¹æŒä¹…åŒ–æ–¹å¼ ã€alwaysã€‘æ¯æ¬¡æ•°æ®ä¿®æ”¹éƒ½è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå¢å¤§æœåŠ¡å™¨å‹åŠ› ã€everysecã€‘æ¯éš”ä¸€ç§’å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¸€æ¬¡ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisæŒä¹…åŒ–"},{"categories":null,"content":"\rRedisæŒä¹…åŒ–å°†Redisæ•°æ®åº“ä¸­çš„æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ ä¸€ã€RDBæŒä¹…åŒ– æ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡å†³å®šæ˜¯å¦æŒä¹…åŒ– RedisæœåŠ¡å™¨é»˜è®¤å¼€å¯RDBæŒä¹…åŒ–æ–¹å¼ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / dump.rdb é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ saveå€¼æ˜¯å¦å¼€å¯RDBæŒä¹…åŒ– å•ä½ä¹‹é—´å†…è¾¾åˆ°è¢«ä¿®æ”¹æ¬¡æ•°å°±ä¼šè¢«æŒä¹…åŒ– save 900 1 #900ç§’å†…è¢«ä¿®æ”¹1æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 300 10 #300ç§’å†…è¢«ä¿®æ”¹10æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 60 10000 #60ç§’å†…è¢«ä¿®æ”¹10000æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ dbfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ rdbcompressionå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶æ˜¯å¦éœ€è¦å‹ç¼© ã€yesã€‘å¼€å¯å‹ç¼©ï¼Œé»˜è®¤å¼€å¯ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ stop-writes-on-bgsave-errorå€¼ä¿®æ”¹æŒä¹…åŒ–æ—¶å‘ç”Ÿé”™è¯¯æ˜¯å¦é˜»æ­¢å…¶ä»–å‘½ä»¤æ‰§è¡Œ ã€yesã€‘ä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½ä¸å†æŒä¹…åŒ– ã€noã€‘ä¹‹åæ•°æ®æ›´æ”¹ä¸å—å½±å“ æ‰‹åŠ¨å°†æ•°æ®æŒä¹…åŒ– ä½¿ç”¨bgsaveå‘½ä»¤ï¼šç›´æ¥å°†å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨dump.rdbä¸­ RDBçš„ç¼ºç‚¹ï¼šæ— æ³•ä¿è¯dump.rdbä¸­å­˜å‚¨çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ äºŒã€ROFæŒä¹…åŒ– æ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”æŒä¹…åŒ–æ•°æ®åº“æ•°æ® Append Only Fileï¼ˆAOFï¼‰ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / appendonly.aof é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰ è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendonlyå€¼æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfsyncå€¼ä¿®æ”¹æŒä¹…åŒ–æ–¹å¼ ã€alwaysã€‘æ¯æ¬¡æ•°æ®ä¿®æ”¹éƒ½è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå¢å¤§æœåŠ¡å™¨å‹åŠ› ã€everysecã€‘æ¯éš”ä¸€ç§’å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¸€æ¬¡ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä¸€rdbæŒä¹…åŒ–"},{"categories":null,"content":"\rRedisæŒä¹…åŒ–å°†Redisæ•°æ®åº“ä¸­çš„æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ ä¸€ã€RDBæŒä¹…åŒ– æ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡å†³å®šæ˜¯å¦æŒä¹…åŒ– RedisæœåŠ¡å™¨é»˜è®¤å¼€å¯RDBæŒä¹…åŒ–æ–¹å¼ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / dump.rdb é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ saveå€¼æ˜¯å¦å¼€å¯RDBæŒä¹…åŒ– å•ä½ä¹‹é—´å†…è¾¾åˆ°è¢«ä¿®æ”¹æ¬¡æ•°å°±ä¼šè¢«æŒä¹…åŒ– save 900 1 #900ç§’å†…è¢«ä¿®æ”¹1æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 300 10 #300ç§’å†…è¢«ä¿®æ”¹10æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– save 60 10000 #60ç§’å†…è¢«ä¿®æ”¹10000æ¬¡å°±ä¼šè¢«æŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ dbfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ rdbcompressionå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶æ˜¯å¦éœ€è¦å‹ç¼© ã€yesã€‘å¼€å¯å‹ç¼©ï¼Œé»˜è®¤å¼€å¯ å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ stop-writes-on-bgsave-errorå€¼ä¿®æ”¹æŒä¹…åŒ–æ—¶å‘ç”Ÿé”™è¯¯æ˜¯å¦é˜»æ­¢å…¶ä»–å‘½ä»¤æ‰§è¡Œ ã€yesã€‘ä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½ä¸å†æŒä¹…åŒ– ã€noã€‘ä¹‹åæ•°æ®æ›´æ”¹ä¸å—å½±å“ æ‰‹åŠ¨å°†æ•°æ®æŒä¹…åŒ– ä½¿ç”¨bgsaveå‘½ä»¤ï¼šç›´æ¥å°†å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨dump.rdbä¸­ RDBçš„ç¼ºç‚¹ï¼šæ— æ³•ä¿è¯dump.rdbä¸­å­˜å‚¨çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ äºŒã€ROFæŒä¹…åŒ– æ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”æŒä¹…åŒ–æ•°æ®åº“æ•°æ® Append Only Fileï¼ˆAOFï¼‰ æŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ å®‰è£…ç›®å½• / appendonly.aof é…ç½®è§„åˆ™ å¯ä»¥åœ¨å®‰ è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendonlyå€¼æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ– å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfilenameå€¼ä¿®æ”¹æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ä½ç½® å¯ä»¥åœ¨å®‰è£…ç›®å½•/redis.confæ–‡ä»¶ä¸­ä¿®æ”¹ appendfsyncå€¼ä¿®æ”¹æŒä¹…åŒ–æ–¹å¼ ã€alwaysã€‘æ¯æ¬¡æ•°æ®ä¿®æ”¹éƒ½è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå¢å¤§æœåŠ¡å™¨å‹åŠ› ã€everysecã€‘æ¯éš”ä¸€ç§’å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¸€æ¬¡ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#äºŒrofæŒä¹…åŒ–"},{"categories":null,"content":"\rRedisäº‹åŠ¡ç®¡ç† åœ¨MySQLä¸­äº‹åŠ¡æ˜¯é€šè¿‡ä¸´æ—¶å¤‡ä»½è¡¨æ¥å®ç°çš„ï¼Œå¼€å¯äº‹åŠ¡æ—¶ç”Ÿæˆå¤‡ä»½è¡¨ï¼Œå¦‚æœrollbackå°±ç”¨å¤‡ä»½è¡¨è¦†ç›–åŸè¡¨ åœ¨Redisä¸­äº‹åŠ¡æ˜¯é€šè¿‡å°†å‘½ä»¤å­˜å…¥ä¸€ä¸ªæ ˆæ¥å®ç°çš„ï¼Œå¦‚æœexecæäº¤å°±æ‰§è¡Œæ ˆä¸­æ‰€æœ‰å‘½ä»¤ è§¦å‘äº‹åŠ¡çš„é”™è¯¯ï¼š è¯­æ³•é”™è¯¯:Redisäº‹åŠ¡ç®¡ç†å¯¹è±¡é”€æ¯æ ˆï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½æ— æ•ˆ set key1 100 sets key2 200 # è¯­æ³•é”™è¯¯ï¼Œå°±æ˜¯å‘½ä»¤ä¹¦å†™é”™è¯¯ æ‰§è¡Œé”™è¯¯: ä¸ä¼šå½±å“äº‹åŠ¡ä¸­å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œ set key1 100 set key2 200 # key2å…³è”çš„æ•°æ®æ˜¯string lpush key2 300 # è¯­æ³•æ²¡æœ‰é”™è¯¯/å‘½ä»¤æ²¡æœ‰æ‹¼å†™é”™è¯¯ï¼Œä½†æ˜¯å°†key2çš„ç±»å‹é”™è¯¯ç†è§£ä¸ºåˆ—è¡¨ è¿™ä¸ªé”™è¯¯åªæœ‰åœ¨Redisæ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ—¶æ‰ä¼šçˆ†å‘ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå½±å“å…¶ä»–å‘½ä»¤ äº‹åŠ¡ç›¸å…³å‘½ä»¤ï¼š multi è¦æ±‚RedisæœåŠ¡å™¨æä¾›ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å¯¹è±¡, ç›¸å½“äº start transaction exec è¦æ±‚äº‹åŠ¡ç®¡ç†å¯¹è±¡æ‰§è¡Œæ ˆä¸­æ‰€æœ‰çš„å‘½ä»¤, ç›¸å½“äºcommit discard è¦æ±‚äº‹åŠ¡ç®¡ç†å¯¹è±¡é”€æ¯æ ˆ, ç›¸å½“äºrollback watch é€šè¿‡watchç›‘æ§æŸä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­è¿™ä¸ªè¢«ç›‘æ§çš„æ•°æ®è¢«ä¿®æ”¹äº†åˆ™å–æ¶ˆæœ¬æ¬¡äº‹åŠ¡ä¸­æ‰€æœ‰çš„æ“ä½œ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisäº‹åŠ¡ç®¡ç†"},{"categories":null,"content":"\rRedisæ¶ˆæ¯è®¢é˜…â€œ æ¶ˆæ¯è®¢é˜… â€œ ï¼šä¸€ç§æ•°æ®å…±äº«çš„æœåŠ¡ï¼Œä¾¿äºrediså®¢æˆ·ç«¯ä¹‹é—´æ•°æ®å…±äº«ã€‚ é€š é“ï¼šredisä¿¡æ¯è®¢é˜…æä¾›çš„å­˜æ”¾å…±äº«æ•°æ®çš„å¹³å° å‘å¸ƒè€…ï¼šå†™å…¥å…±äº«æ•°æ®çš„rediså®¢æˆ·ç«¯ è®¢é˜…è€…ï¼šè¯»å–å…±äº«æ•°æ®çš„rediså®¢æˆ·ç«¯ æ¶ˆæ¯è®¢é˜…ç›¸å…³å‘½ä»¤ï¼š 1. `subscribe é€šé“å1 [é€šé“å2]`ï¼šè®¢é˜…ï¼ˆè‡ªåŠ¨æ¥æ”¶ï¼‰é€šé“ä¿¡æ¯\r2. `publish é€šé“å ä¿¡æ¯`ï¼šå‘é€šé“å‘å¸ƒä¿¡æ¯\r","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:8:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisæ¶ˆæ¯è®¢é˜…"},{"categories":null,"content":"\rRedisçš„ä¸»ä»å¤åˆ¶å’Œå“¨å…µæ¨¡å¼ç•¥ ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:9:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#redisçš„ä¸»ä»å¤åˆ¶å’Œå“¨å…µæ¨¡å¼"},{"categories":null,"content":"\rä½¿ç”¨Jedisæ“ä½œRedisJedisï¼šRedisä½œè€…ä½¿ç”¨ Java å†™çš„å·¥å…·ç±»ï¼Œç”¨äºè¿æ¥Redisæ•°æ®åº“ éœ€è¦å…³é—­linuxé˜²ç«å¢™ï¼Œè®©éæœ¬åœ°å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°redisã€‚å¦åˆ™å¯èƒ½ä¼šæŠ›å‡ºè¿æ¥è¶…æ—¶å¼‚å¸¸ å¯¼å…¥ä¾èµ– \u003c!-- jedisä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eredis.clients\u003c/groupId\u003e \u003cartifactId\u003ejedis\u003c/artifactId\u003e \u003cversion\u003e3.7.0\u003c/version\u003e \u003c/dependency\u003e åœ¨redis.confä¸­ å…³é—­Redisçš„ä¿æŠ¤æ¨¡å¼ åœ¨redis.confä¸­ å–æ¶ˆæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯IPçš„ç»‘å®š åœ¨redis.confä¸­ è®¾ç½®è®¿é—®RedisæœåŠ¡å™¨çš„å¯†ç  æŒ‰ç…§redis.conf çš„é…ç½®æ–‡ä»¶å¯åŠ¨Redisæ•°æ®åº“ æµ‹è¯•pingæ•°æ®åº“ @Test public void testJedis() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //3. å‘é€pingå‘½ä»¤, æµ‹è¯•é€šé“å¦å»ºç«‹æˆåŠŸ String result = jedis.ping(); System.out.println(\"result = \" + result); } æ“ä½œStringå­—ç¬¦ä¸² @Test public void testJedisString() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //æ“ä½œStringå­—ç¬¦ä¸² jedis.select(0); jedis.set(\"key1\", \"Hello\"); jedis.set(\"key2\", \"World\"); String key1 = jedis.get(\"key1\"); System.out.println(key1); String key2 = jedis.get(\"key2\"); System.out.println(key2); jedis.flushDB(); Long aLong = jedis.dbSize(); System.out.println(aLong); } æ“ä½œliståˆ—è¡¨ @Test public void testJedisList() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //æ“ä½œliståˆ—è¡¨ jedis.lpush(\"key1\", \"Hello\", \"World\"); List\u003cString\u003e key1 = jedis.lrange(\"key1\", 0, 2); System.out.println(key1); jedis.flushDB(); } æ“ä½œSeté›†åˆ @Test public void testJedisSet() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //æ“ä½œSeté›†åˆ Long num = jedis.sadd(\"key1\", \"10\", \"20\", \"10\"); System.out.println(\"å½“å‰key1ä¸­æ•°æ®æ•°é‡\" + num); Boolean is10 = jedis.sismember(\"key1\", \"10\"); System.out.println(\"key1ä¸­æ˜¯å¦æœ‰10\" + is10); Set\u003cString\u003e key1 = jedis.smembers(\"key1\"); System.out.println(key1); jedis.flushDB(); } æ“ä½œhashå“ˆå¸Œ @Test public void testJedisHash() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //æ“ä½œhashå“ˆå¸Œ jedis.hset(\"key1\", \"deptNo\", \"10\"); jedis.hset(\"key1\", \"dName\", \"sales\"); jedis.hset(\"key1\", \"loc\", \"beijing\"); String hget = jedis.hget(\"key1\", \"deptNo\"); System.out.println(hget); hget = jedis.hget(\"key1\", \"dName\"); System.out.println(hget); hget = jedis.hget(\"key1\", \"loc\"); System.out.println(hget); jedis.flushDB(); } æ“ä½œZSetæœ‰åºé›†åˆ @Test public void testJedisZSet() { //1. åˆ›å»ºJediså¯¹è±¡, æ‰“å¼€è¿æ¥é€šé“ Jedis jedis = new Jedis(\"192.168.50.128\", 6379); //2. æä¾›ç™»å½•å¯†ç ï¼ŒéªŒè¯ jedis.auth(\"123\"); //æ“ä½œZSetæœ‰åºé›†åˆ jedis.zadd(\"key1\", 80, \"mike\"); jedis.zadd(\"key1\", 60, \"smith\"); jedis.zadd(\"key1\", 40, \"tom\"); Set\u003cString\u003e key1 = jedis.zrange(\"key1\", 0, -1); System.out.println(key1); jedis.flushDB(); } ","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:10:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä½¿ç”¨jedisæ“ä½œredis"},{"categories":null,"content":"\råœ¨ SpringMVC ä¸­ä½¿ç”¨ Redis åœ¨ pom.xml ä¸­æ·»åŠ ä¾èµ– \u003c!-- spring-data-redis --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.data\u003c/groupId\u003e \u003cartifactId\u003espring-data-redis\u003c/artifactId\u003e \u003cversion\u003e2.6.4\u003c/version\u003e \u003c/dependency\u003e \u003c!-- jedis --\u003e \u003cdependency\u003e \u003cgroupId\u003eredis.clients\u003c/groupId\u003e \u003cartifactId\u003ejedis\u003c/artifactId\u003e \u003cversion\u003e4.2.2\u003c/version\u003e \u003c/dependency\u003e åœ¨ resources è·¯å¾„ä¸‹åˆ›å»º redis.properties æ–‡ä»¶ redis.host=Redisçš„host redis.port=Redisçš„ç«¯å£å· redis.password=\"Redisçš„å¯†ç \" redis.maxIdle=400 redis.maxTotal=6000 redis.maxWaitMillis=1000 redis.blockWhenExhausted=true redis.testOnBorrow=true redis.db=1 åˆ›å»º RedisService ç±» import org.springframework.beans.factory.annotation.Autowired; import org.springframework.data.redis.core.*; import java.io.Serializable; import java.util.List; import java.util.Set; import java.util.concurrent.TimeUnit; public class RedisService { @Autowired private RedisTemplate redisTemplate; public void setRedisTemplate(RedisTemplate redisTemplate) { this.redisTemplate = redisTemplate; } /** * å†™å…¥ç¼“å­˜ * @param key * @param value * @return */ public boolean set(final String key, Object value) { boolean result = false; try { ValueOperations\u003cSerializable, Object\u003e operations = redisTemplate.opsForValue(); operations.set(key, value); result = true; } catch (Exception e) { e.printStackTrace(); } return result; } /** * å†™å…¥ç¼“å­˜è®¾ç½®æ—¶æ•ˆæ—¶é—´ * @param key * @param value * @return */ public boolean set(final String key, Object value, Long expireTime) { boolean result = false; try { ValueOperations\u003cSerializable, Object\u003e operations = redisTemplate.opsForValue(); operations.set(key, value); redisTemplate.expire(key, expireTime, TimeUnit.SECONDS); result = true; } catch (Exception e) { e.printStackTrace(); } return result; } /** * æ‰¹é‡åˆ é™¤å¯¹åº”çš„value * @param keys */ public void remove(final String... keys) { for (String key : keys) { remove(key); } } /** * æ‰¹é‡åˆ é™¤key * @param pattern */ public void removePattern(final String pattern) { Set\u003cSerializable\u003e keys = redisTemplate.keys(pattern); if (keys.size() \u003e 0) redisTemplate.delete(keys); } /** * åˆ é™¤å¯¹åº”çš„value * @param key */ public void remove(final String key) { if (exists(key)) { redisTemplate.delete(key); } } /** * åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„value * @param key * @return */ public boolean exists(final String key) { return redisTemplate.hasKey(key); } /** * è¯»å–ç¼“å­˜ * @param key * @return */ public Object get(final String key) { Object result = null; ValueOperations\u003cSerializable, Object\u003e operations = redisTemplate.opsForValue(); result = operations.get(key); return result; } /** * å“ˆå¸Œ æ·»åŠ  * @param key * @param hashKey * @param value */ public void hmSet(String key, Object hashKey, Object value){ HashOperations\u003cString, Object, Object\u003e hash = redisTemplate.opsForHash(); hash.put(key,hashKey,value); } /** * å“ˆå¸Œ åˆ é™¤ * @param key * @param hashKey */ public void hmDel(String key, Object hashKey){ HashOperations\u003cString, Object, Object\u003e hash = redisTemplate.opsForHash(); hash.delete(key,hashKey); } /** * å“ˆå¸Œè·å–æ•°æ® * @param key * @param hashKey * @return */ public Object hmGet(String key, Object hashKey){ HashOperations\u003cString, Object, Object\u003e hash = redisTemplate.opsForHash(); return hash.get(key,hashKey); } /** * åˆ—è¡¨æ·»åŠ  * @param k * @param v */ public void lPush(String k,Object v){ ListOperations\u003cString, Object\u003e list = redisTemplate.opsForList(); list.rightPush(k,v); } /** * åˆ—è¡¨è·å– * @param k * @param l * @param l1 * @return */ public List\u003cObject\u003e lRange(String k, long l, long l1){ ListOperations\u003cString, Object\u003e list = redisTemplate.opsForList(); return list.range(k,l,l1); } /** * é›†åˆæ·»åŠ  * @param key * @param value */ public void add(String key,Object value){ SetOperations\u003cString, Object\u003e set = redisTemplate.opsForSet(); set.add(key,value); } /** * é›†åˆè·å– * @param key * @return */ public Set\u003cObject\u003e setMembers(String key){ SetOperations\u003cString, Object\u003e set = redisTemplate.opsForSet(); return set.members(key); } /** * æœ‰åºé›†åˆæ·»åŠ  * @param key * @param value * @param scoure */ public void zAdd(String key,Object value,double scoure){ ZSetOperations\u003cString, Object\u003e zset = redisTemplat","date":"2021-10-11","objectID":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:11:0","series":null,"tags":null,"title":"Redisè‡ªå­¦ç¬”è®°","uri":"/redis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åœ¨-springmvc-ä¸­ä½¿ç”¨-redis"},{"categories":null,"content":"\rLinuxè‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-10-10 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æ¨éœ‡ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#linuxè‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rLinuxæ–‡ä»¶ç›®å½• ==root== : ç³»ç»Ÿç®¡ç†å‘˜ rootç”¨æˆ·ï¼ˆæ‹¥æœ‰è¶…çº§æƒé™ï¼‰çš„ç›®å½•ã€‚ ==bin æˆ– usr/bin== : å­˜æ”¾ç³»ç»Ÿé¢„è£…çš„å¯æ‰§è¡Œç¨‹åºï¼Œç›¸å½“äºwindowsä¸­çš„ç¯å¢ƒå˜é‡ã€‚ usr : ç³»ç»Ÿèµ„æºç›®å½•ï¼Œä¸€äº›ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…ç³»ç»Ÿçš„ä¸€äº›æ–‡ä»¶åº“ã€‚ usr/local/bin : ç”¨æˆ·è‡ªå·±çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›¸å½“äºwindowsä¸­çš„ç”¨æˆ·ç¯å¢ƒå˜é‡ã€‚ lib æˆ– usr/lib : å­˜æ”¾ç€ç³»ç»Ÿæœ€åŸºæœ¬çš„åŠ¨æ€è¿æ¥å…±äº«åº“ï¼Œç›¸å½“äºwindowsé‡Œçš„DLLæ–‡ä»¶ï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚ boot : å­˜æ”¾å¯åŠ¨Linuxæ—¶ä½¿ç”¨çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›è¿æ¥æ–‡ä»¶ä»¥åŠé•œåƒæ–‡ä»¶ã€‚ dev : (Device)å­˜æ”¾Linuxçš„å¤–éƒ¨è®¾å¤‡ï¼ŒLinuxä¸­çš„è®¾å¤‡ä¹Ÿæ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚ ==etc== : å­˜æ”¾æ‰€æœ‰çš„ç³»ç»Ÿç®¡ç†æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶ã€‚ ==home== : æ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªä»¥ç”¨æˆ·çš„è´¦å·å‘½åçš„æ ¹ç›®å½•ï¼Œç”¨æˆ·ç™»å½•åé»˜è®¤æ‰“å¼€è‡ªå·±çš„æ ¹ç›®å½•ã€‚ var : å­˜æ”¾ç€åœ¨ä¸æ–­æ‰©å……ç€çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¹ æƒ¯å°†é‚£äº›ç»å¸¸è¢«ä¿®æ”¹çš„æ–‡ä»¶å­˜æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œæ¯”å¦‚è¿è¡Œçš„å„ç§æ—¥å¿—æ–‡ä»¶ã€‚ mnt : è®©ç”¨æˆ·ä¸´æ—¶æŒ‚è½½åˆ«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥å°†å…‰é©±æŒ‚è½½åœ¨/mnt/ä¸Šï¼Œè¿›å…¥è¯¥ç›®å½•å°±å¯ä»¥æŸ¥çœ‹å…‰é©±é‡Œçš„å†…å®¹ã€‚ opt : é¢å¤–å®‰è£…è½¯ä»¶æ‰€å­˜æ”¾çš„ç›®å½•ã€‚ç›¸å½“äºwindowsä¸­Programe filesç›®å½•ã€‚ tmp : å­˜æ”¾ä¸€äº›ä¸´æ—¶æ–‡ä»¶ã€‚ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#linuxæ–‡ä»¶ç›®å½•"},{"categories":null,"content":"\rè¿œç¨‹æ“ä½œLinux XShellå·¥å…·ï¼šç”¨äºæ¨é€Linuxå‘½ä»¤ XFTPå·¥å…·ï¼šç”¨äºæ–‡ä»¶æ•°æ®ä¼ è¾“ ä½¿ç”¨XShellé“¾æ¥Linuxç³»ç»Ÿ ä½¿ç”¨ifconfigè·å–Linuxçš„IPåœ°å€ åœ¨XShellä¸­å»ºç«‹è¿æ¥ï¼šå¡«å†™åç§°ã€ä¸»æœº å¡«å†™ç”¨æˆ·åï¼šLinuxçš„ç”¨æˆ·åroot å¡«å†™å¯†ç ï¼šLinuxä¸­rootè´¦æˆ·çš„å¯†ç 129807 XFTPåŒç† ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿œç¨‹æ“ä½œlinux"},{"categories":null,"content":"\rLinuxå¸¸ç”¨å‘½ä»¤","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#linuxå¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rä¸€ã€æ–‡ä»¶ç›¸å…³æ“ä½œ pwdï¼šæŸ¥çœ‹å½“å‰æ‰€åœ¨çš„æ–‡ä»¶å¤¹ç›®å½• lsï¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• ls -aï¼šåŒæ—¶åˆ—å‡ºéšè—ä¸ééšè—çš„æ–‡ä»¶å’Œç›®å½• ls -lï¼šä»¥åˆ—è¡¨çš„æ–¹å¼åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• cdï¼šåˆ‡æ¢åˆ°æŒ‡å®šç›®å½• cd æ–‡ä»¶å¤¹çš„uriè·¯å¾„ cd.. ï¼šè¿”å›ä¸Šä¸€çº§ç›®å½• mkdirï¼šåˆ›å»ºå•ä¸ªç›®å½• mkdir è·¯å¾„ mkdir -pï¼šåˆ›å»ºå¤šçº§ç›®å½• mkdir -p è·¯å¾„ touchï¼šåˆ›å»º ä¸€ä¸ª/å¤šä¸ª æ–‡ä»¶ touch æ–‡ä»¶å.åç¼€ touch è·¯å¾„/æ–‡ä»¶å.åç¼€ cpï¼šå¤åˆ¶æ–‡ä»¶ cp æ¥æºæ–‡ä»¶ ç›®æ ‡ç›®å½• cp -rï¼šé€’å½’å¤åˆ¶ç›®å½•åŠç›®å½•ä¸­æ‰€æœ‰å†…å®¹ rmï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½• rm ç›®å½•è·¯å¾„/æ–‡ä»¶ rm -rï¼šé€’å½’åˆ é™¤ç›®å½•åŠç›®å½•ä¸­çš„æ‰€æœ‰å†…å®¹ rm -r ç›®å½•è·¯å¾„ rm -fï¼šå¼ºåˆ¶åˆ é™¤ä¸æç¤º rm -rf ç›®å½•è·¯å¾„ mvï¼šç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½• mv æ¥æºæ–‡ä»¶/ç›®å½• ç›®æ ‡ç›®å½• mv æ¥æºæ–‡ä»¶ åŒçº§ç›®æ ‡æ–‡ä»¶ï¼šé‡å‘½åæ–‡ä»¶ mv æ¥æºæ–‡ä»¶/ç›®å½• . ï¼šç§»åŠ¨åˆ°ä¸Šä¸€çº§ç›®å½•ä¸­ catï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹ cat æ–‡ä»¶ cat -nï¼šå¸¦è¡Œå· æŸ¥çœ‹æ–‡ä»¶å†…å®¹ moreï¼šä½¿ç”¨VIç¼–è¾‘å™¨æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ more æ–‡ä»¶ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:1","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€æ–‡ä»¶ç›¸å…³æ“ä½œ"},{"categories":null,"content":"\räºŒã€VIåŠVIMæ–‡æœ¬ç¼–è¾‘å™¨ vi æ–‡ä»¶ï¼šä½¿ç”¨VIæ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ ä¸€èˆ¬æ¨¡å¼ï¼šåªèƒ½çœ‹ æŒ‰ i æˆ– a(å…‰æ ‡åœ¨ä¸‹ä¸€ä¸ªå­—ç¬¦å¤„) è¿›å…¥ç¼–è¾‘æ¨¡å¼ æŒ‰ / æˆ– : è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ ç¼–è¾‘æ¨¡å¼ï¼šèƒ½ä¿®æ”¹ æŒ‰ esc é€€å›ä¸€èˆ¬æ¨¡å¼ å‘½ä»¤è¡Œæ¨¡å¼ï¼š :wqï¼šä¿å­˜å¹¶é€€å‡º :q!ï¼šä¸ä¿å­˜å¹¶é€€å‡º :qï¼šæœªæ”¹åŠ¨æ—¶é€€å‡º ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:2","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒviåŠvimæ–‡æœ¬ç¼–è¾‘å™¨"},{"categories":null,"content":"\rä¸‰ã€ç”¨æˆ·ç®¡ç† idï¼šæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ id ç”¨æˆ·å useraddï¼šæ·»åŠ ç”¨æˆ· useradd ç”¨æˆ·å useradd -d /home/ç”¨æˆ·çš„æ–‡ä»¶å¤¹å ç”¨æˆ·å passwdç”¨æˆ·å ï¼šä¸ºç”¨æˆ·è®¾ç½®å¯†ç  userdelï¼šåˆ é™¤ç”¨æˆ· userdel ç”¨æˆ·åï¼šåˆ é™¤ç”¨æˆ·ä½†ä¸åˆ é™¤ç”¨æˆ·åœ¨ /homeä¸­çš„æ–‡ä»¶å¤¹ userdel -r ç”¨æˆ·åï¼šåˆ é™¤ç”¨æˆ·åŠå…¶æ–‡ä»¶å¤¹ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:3","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸‰ç”¨æˆ·ç®¡ç†"},{"categories":null,"content":"\rå››ã€è¿›ç¨‹ç®¡ç†\rä»€ä¹ˆæ˜¯Linuxçš„è¿›ç¨‹ï¼š Linuxè¿›ç¨‹çš„æ¦‚å¿µå’Œwindowsä¸€æ · Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªIDç¼–å· Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šå¯¹åº”ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆè°ƒç”¨è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ï¼‰ è¿›ç¨‹çš„åˆ†ç±»ï¼š å‰å°è¿›ç¨‹ï¼Œåœ¨å‰å°å¯è§ åå°è¿›ç¨‹ï¼Œå‰å°ä¸å¯è§ è¿›ç¨‹ç›¸å…³å¸¸ç”¨å‘½ä»¤ï¼š psæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ ps â€“aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“uï¼šä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ps â€“xï¼šæ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•° ps â€“eï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“fï¼šä»¥å…¨æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ USERï¼šç”¨æˆ·åç§° PIDï¼šè¿›ç¨‹å· %CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯” %MEMï¼šè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯” VSZï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ RSSï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ TTï¼šç»ˆç«¯åç§°,ç¼©å†™. STATï¼šè¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰ç­‰ STARTEDï¼šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ TIMEï¼šCPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´ COMMANDï¼šå¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º PPID çˆ¶è¿›ç¨‹çš„ID C CPUä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯” PRIæŒ‡è¿›ç¨‹çš„æ‰§è¡Œä¼˜å…ˆæƒ(Priorityçš„ç®€å†™)ï¼Œå…¶å€¼è¶Šå°è¶Šæ—©è¢«æ‰§è¡Œ SZ ä½¿ç”¨æ‰çš„å†…å­˜å¤§å° killç»ˆæ­¢è¿›ç¨‹ kill è¿›ç¨‹IDï¼šç»ˆæ­¢è¿›ç¨‹ kill -9 è¿›ç¨‹IDï¼šå¼ºè¿«è¿›ç¨‹ç«‹å³åœæ­¢ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:4","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å››è¿›ç¨‹ç®¡ç†"},{"categories":null,"content":"\rå››ã€è¿›ç¨‹ç®¡ç†\rä»€ä¹ˆæ˜¯Linuxçš„è¿›ç¨‹ï¼š Linuxè¿›ç¨‹çš„æ¦‚å¿µå’Œwindowsä¸€æ · Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªIDç¼–å· Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šå¯¹åº”ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆè°ƒç”¨è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ï¼‰ è¿›ç¨‹çš„åˆ†ç±»ï¼š å‰å°è¿›ç¨‹ï¼Œåœ¨å‰å°å¯è§ åå°è¿›ç¨‹ï¼Œå‰å°ä¸å¯è§ è¿›ç¨‹ç›¸å…³å¸¸ç”¨å‘½ä»¤ï¼š psæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ ps â€“aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“uï¼šä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ps â€“xï¼šæ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•° ps â€“eï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“fï¼šä»¥å…¨æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ USERï¼šç”¨æˆ·åç§° PIDï¼šè¿›ç¨‹å· %CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯” %MEMï¼šè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯” VSZï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ RSSï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ TTï¼šç»ˆç«¯åç§°,ç¼©å†™. STATï¼šè¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰ç­‰ STARTEDï¼šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ TIMEï¼šCPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´ COMMANDï¼šå¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º PPID çˆ¶è¿›ç¨‹çš„ID C CPUä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯” PRIæŒ‡è¿›ç¨‹çš„æ‰§è¡Œä¼˜å…ˆæƒ(Priorityçš„ç®€å†™)ï¼Œå…¶å€¼è¶Šå°è¶Šæ—©è¢«æ‰§è¡Œ SZ ä½¿ç”¨æ‰çš„å†…å­˜å¤§å° killç»ˆæ­¢è¿›ç¨‹ kill è¿›ç¨‹IDï¼šç»ˆæ­¢è¿›ç¨‹ kill -9 è¿›ç¨‹IDï¼šå¼ºè¿«è¿›ç¨‹ç«‹å³åœæ­¢ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:4","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯linuxçš„è¿›ç¨‹"},{"categories":null,"content":"\rå››ã€è¿›ç¨‹ç®¡ç†\rä»€ä¹ˆæ˜¯Linuxçš„è¿›ç¨‹ï¼š Linuxè¿›ç¨‹çš„æ¦‚å¿µå’Œwindowsä¸€æ · Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªIDç¼–å· Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šå¯¹åº”ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆè°ƒç”¨è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ï¼‰ è¿›ç¨‹çš„åˆ†ç±»ï¼š å‰å°è¿›ç¨‹ï¼Œåœ¨å‰å°å¯è§ åå°è¿›ç¨‹ï¼Œå‰å°ä¸å¯è§ è¿›ç¨‹ç›¸å…³å¸¸ç”¨å‘½ä»¤ï¼š psæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ ps â€“aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“uï¼šä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ps â€“xï¼šæ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•° ps â€“eï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“fï¼šä»¥å…¨æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ USERï¼šç”¨æˆ·åç§° PIDï¼šè¿›ç¨‹å· %CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯” %MEMï¼šè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯” VSZï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ RSSï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ TTï¼šç»ˆç«¯åç§°,ç¼©å†™. STATï¼šè¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰ç­‰ STARTEDï¼šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ TIMEï¼šCPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´ COMMANDï¼šå¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º PPID çˆ¶è¿›ç¨‹çš„ID C CPUä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯” PRIæŒ‡è¿›ç¨‹çš„æ‰§è¡Œä¼˜å…ˆæƒ(Priorityçš„ç®€å†™)ï¼Œå…¶å€¼è¶Šå°è¶Šæ—©è¢«æ‰§è¡Œ SZ ä½¿ç”¨æ‰çš„å†…å­˜å¤§å° killç»ˆæ­¢è¿›ç¨‹ kill è¿›ç¨‹IDï¼šç»ˆæ­¢è¿›ç¨‹ kill -9 è¿›ç¨‹IDï¼šå¼ºè¿«è¿›ç¨‹ç«‹å³åœæ­¢ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:4","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿›ç¨‹çš„åˆ†ç±»"},{"categories":null,"content":"\rå››ã€è¿›ç¨‹ç®¡ç†\rä»€ä¹ˆæ˜¯Linuxçš„è¿›ç¨‹ï¼š Linuxè¿›ç¨‹çš„æ¦‚å¿µå’Œwindowsä¸€æ · Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªIDç¼–å· Linuxä¸­æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šå¯¹åº”ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆè°ƒç”¨è¿™ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ï¼‰ è¿›ç¨‹çš„åˆ†ç±»ï¼š å‰å°è¿›ç¨‹ï¼Œåœ¨å‰å°å¯è§ åå°è¿›ç¨‹ï¼Œå‰å°ä¸å¯è§ è¿›ç¨‹ç›¸å…³å¸¸ç”¨å‘½ä»¤ï¼š psæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ ps â€“aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“uï¼šä»¥ç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ps â€“xï¼šæ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•° ps â€“eï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ ps â€“fï¼šä»¥å…¨æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ USERï¼šç”¨æˆ·åç§° PIDï¼šè¿›ç¨‹å· %CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯” %MEMï¼šè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯” VSZï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ RSSï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰ TTï¼šç»ˆç«¯åç§°,ç¼©å†™. STATï¼šè¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰ç­‰ STARTEDï¼šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ TIMEï¼šCPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´ COMMANDï¼šå¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º PPID çˆ¶è¿›ç¨‹çš„ID C CPUä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯” PRIæŒ‡è¿›ç¨‹çš„æ‰§è¡Œä¼˜å…ˆæƒ(Priorityçš„ç®€å†™)ï¼Œå…¶å€¼è¶Šå°è¶Šæ—©è¢«æ‰§è¡Œ SZ ä½¿ç”¨æ‰çš„å†…å­˜å¤§å° killç»ˆæ­¢è¿›ç¨‹ kill è¿›ç¨‹IDï¼šç»ˆæ­¢è¿›ç¨‹ kill -9 è¿›ç¨‹IDï¼šå¼ºè¿«è¿›ç¨‹ç«‹å³åœæ­¢ ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:4","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿›ç¨‹ç›¸å…³å¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"\rå‹ç¼©ä¸è§£å‹ç¼© gzipï¼šå‹ç¼©æ–‡ä»¶ gzip æ–‡ä»¶ å‹ç¼©æ ¼å¼ä¸º.gz ä¼šè‡ªåŠ¨åˆ é™¤åŸæ–‡ä»¶ gunzipï¼šè§£å‹ç¼©.gzæ ¼å¼æ–‡ä»¶ gunzip æ–‡ä»¶ è§£å‹ä¸ºåŸæœ¬æ ¼å¼ ä¼šè‡ªåŠ¨åˆ é™¤.gzæ–‡ä»¶ zipï¼šå‹ç¼©æ–‡ä»¶ zip å‹ç¼©åçš„ç›®å½•å’Œæ–‡ä»¶å è¦å‹ç¼©çš„ç›®å½• zip -rï¼šé€’å½’å‹ç¼©ç›®å½•åŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ zip -r å‹ç¼©åçš„ç›®å½•å’Œæ–‡ä»¶å è¦å‹ç¼©çš„ç›®å½•æˆ–æ–‡ä»¶ unzipï¼šè§£å‹ç¼©.zipæ ¼å¼æ–‡ä»¶ unzip è¦è§£å‹çš„ç›®å½•å’Œæ–‡ä»¶åï¼ˆå°å¿ƒè¦†ç›–åŸæ–‡ä»¶ï¼‰ unzip -d è§£å‹åæ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼šæŒ‡å®šè§£å‹ä½ç½® tarï¼šå‹ç¼©/è§£å‹ç¼©æ–‡ä»¶ -cï¼šäº§ç”Ÿ.tar.gzæ‰“åŒ…æ–‡ä»¶ -vï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ -fï¼šæŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å -zï¼šæ‰“åŒ…åŒæ—¶å‹ç¼© -xï¼šè§£å‹.tar.gzæ–‡ä»¶ -C: æŒ‡å®šè§£å‹åˆ°å“ªä¸ªç›®å½• tar -zcvf å‹ç¼©åŒ…æ–‡ä»¶å.tar.gz ç›®å½•å tar -zxvf å‹ç¼©åŒ…æ–‡ä»¶å -C å­˜æ”¾çš„ç›®å½• ","date":"2021-10-10","objectID":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:5","series":null,"tags":null,"title":"Linuxè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/linux%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å‹ç¼©ä¸è§£å‹ç¼©"},{"categories":null,"content":"\rSpringMVCè‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-9-23 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æ¨éœ‡ ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springmvcè‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rSpringMVC æ˜¯Springæ¡†æ¶çš„è¡ç”Ÿç‰ˆ ç®€åŒ–äº†Servletçš„ä½¿ç”¨ ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springmvc"},{"categories":null,"content":"\rè§£å†³äº†Servletè§„èŒƒçš„é—®é¢˜: å­˜åœ¨å¤§é‡çš„Servletæ¥å£å®ç°ç±» éœ€è¦æ‰‹åŠ¨å†™å¤§é‡è·å–è¯·æ±‚å‚æ•°çš„ä»£ç  éœ€è¦æ‰‹åŠ¨è·å–è¾“å‡ºæµï¼šPrintWriter out = response.getWriter( ) â€¦ éœ€è¦æ‰‹åŠ¨é‡å®šå‘å’Œè¯·æ±‚è½¬å‘ ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:1","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è§£å†³äº†servletè§„èŒƒçš„é—®é¢˜"},{"categories":null,"content":"\rä½¿ç”¨SpringMVCæ¡†æ¶ SpringMVCè®¤ä¸ºï¼šä¸€ä¸ªç½‘ç«™ä¸­æœ‰ä¸€ä¸ª Servletï¼ˆ DispatcherServletä¸­å¤®è°ƒåº¦å™¨ ï¼‰ å°±å¤Ÿäº† ç”±è¿™ä¸ª Servlet è°ƒç”¨å¤šä¸ªå¤„ç†å™¨ç±»ï¼ˆControlleræ§åˆ¶å™¨ï¼‰ å†ç”± Controller å¤„ç†å™¨ç±»è°ƒç”¨ Serviceï¼ˆ è°ƒç”¨DAO â€¦ ï¼‰ æ·»åŠ  spring-webmvc çš„ä¾èµ– \u003c!-- servletä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e \u003cversion\u003e4.0.1\u003c/version\u003e \u003cscope\u003eprovided\u003c/scope\u003e \u003c/dependency\u003e \u003c!--spring-webmvc --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-webmvc\u003c/artifactId\u003e \u003cversion\u003e5.3.10\u003c/version\u003e \u003c/dependency\u003e é…ç½®web.xml è®©tomcatæ¥åˆ›å»ºDispatcherServletçš„å®ä¾‹å¯¹è±¡ï¼ˆServletè§„èŒƒï¼šä¸èƒ½ä½¿ç”¨Springåˆ›å»ºServletå¯¹è±¡ï¼‰ DispatcherServletä¼šè‡ªåŠ¨==åˆ›å»ºspringå®¹å™¨å¯¹è±¡å¹¶ä¿å­˜åœ¨æœåŠ¡å™¨å…¨å±€ä½œç”¨åŸŸå¯¹è±¡ä¸­== ä½¿ç”¨init-paramæ ‡ç­¾æŒ‡å®šï¼ˆ åˆ›å»ºspringå®¹å™¨å¯¹è±¡éœ€è¦ç”¨åˆ°çš„ ï¼‰spring.xmlæ–‡ä»¶ä½ç½® é€šçŸ¥tomcatåœ¨å¯åŠ¨æ—¶åˆ›å»ºspringå®¹å™¨çš„å®ä¾‹å¯¹è±¡ \u003c!-- dispatcherServletä¼šè‡ªåŠ¨åˆ›å»ºspringå®¹å™¨å¯¹è±¡ï¼Œ å¹¶è°ƒç”¨springå®¹å™¨ä¸­web-infä¸‹çš„xxx-servlet.xmlï¼ˆkey-servlet.xmlï¼‰æ–‡ä»¶ï¼Œ å¹¶å°†springå®¹å™¨å¯¹è±¡ä¿å­˜åˆ°ç½‘ç«™çš„å…¨å±€ä½œç”¨åŸŸå¯¹è±¡ä¸­ --\u003e \u003cservlet\u003e \u003cservlet-name\u003ekey\u003c/servlet-name\u003e \u003cservlet-class\u003eorg.springframework.web.servlet.DispatcherServlet\u003c/servlet-class\u003e \u003c!--é…ç½®spring.xmlæ–‡ä»¶è·¯å¾„ï¼Œè®©DispatcherServletæŒ‰ç…§è¿™ä¸ªæ–‡ä»¶åˆ›å»ºspringå®¹å™¨å¯¹è±¡--\u003e \u003cinit-param\u003e \u003cparam-name\u003econtextConfigLocation\u003c/param-name\u003e \u003cparam-value\u003eclasspath:spring.xml\u003c/param-value\u003e \u003c/init-param\u003e \u003c!--é€šçŸ¥tomcatåœ¨å¯åŠ¨æ—¶åˆ›å»ºspringå®¹å™¨çš„å®ä¾‹å¯¹è±¡ï¼šé0æ•´æ•°å³å¯--\u003e \u003cload-on-startup\u003e1\u003c/load-on-startup\u003e \u003c/servlet\u003e \u003c!--SpringMVCæ¨èæ‰€æœ‰è¯·æ±‚ä»¥ .do ç»“å°¾ï¼Œè®©æ‰€æœ‰ .do ç»“å°¾çš„è¯·æ±‚ç”±DispatcherServletå¤„ç†--\u003e \u003cservlet-mapping\u003e \u003cservlet-name\u003ekey\u003c/servlet-name\u003e \u003curl-pattern\u003e*.do\u003c/url-pattern\u003e \u003c/servlet-mapping\u003e ç¼–å†™Controllerç±» @Controllerå£°æ˜è®©springå®¹å™¨åˆ›å»ºè¿™ä¸ªControllerç±» @component ã€@Service ã€@Controller å‡æ˜¯è®©springå®¹å™¨åˆ›å»ºå…¶å£°æ˜çš„å®ä¾‹å¯¹è±¡ @RequestMapping(value = \"/one\")è®¾ç½® ç±» / æ–¹æ³• çš„è¯·æ±‚åœ°å€ /** * @component * @Service * @Controller * * å‡æ˜¯è®©springå®¹å™¨åˆ›å»ºå®ä¾‹å¯¹è±¡ * æŒ‰éœ€ä½¿ç”¨ * * * @RequestMapping(Value=\"\") è®¾ç½®å¤„ç†å™¨ç±»çš„è¯·æ±‚åœ°å€ * ä¹Ÿå¯ä»¥æ”¾åœ¨æ–¹æ³•ä¸Šï¼Œè®¾ç½®æ–¹æ³•çš„è¯·æ±‚åœ°å€ */ @Controller @RequestMapping(value = \"/one\") public class OneController { //è¿™ä¸ªç±»çš„è°ƒç”¨åœ°å€ http://locoalhost:8080/myWeb/one/method2.do @RequestMapping(value = \"/method1.do\") public String method1(){ return \"/info.jsp\"; } } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨springmvcæ¡†æ¶"},{"categories":null,"content":"\ré‡åˆ°çš„é—®é¢˜ æŠ¥é”™ï¼šjava.lang.ClassNotFoundException: org.springframework.web.context.ContextLoaderListener ä¼¼ä¹çš„IDEA/Tomcatæ²¡æœ‰å°†éœ€è¦çš„jaråŒ…æ”¾åˆ°ä½ è§£å†³æ–¹å¼ï¼š åœ¨Artifactsä¸­åœ¨ä½¿ç”¨çš„é¡¹ç›®åŒ…ä¸Šç‚¹å‡»Put into Output Rootï¼Œå·¦ä¾§libæ–‡ä»¶å¤¹å‡ºç°å†…å®¹åˆ™æˆåŠŸ ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°çš„é—®é¢˜"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– \u003c!-- jackson-core --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.fasterxml.jackson.core\u003c/groupId\u003e \u003cartifactId\u003ejackson-core\u003c/artifactId\u003e \u003cversion\u003e2.13.0-rc2\u003c/version\u003e \u003c/dependency\u003e \u003c!-- jackson-databind --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.fasterxml.jackson.core\u003c/groupId\u003e \u003cartifactId\u003ejackson-databind\u003c/artifactId\u003e \u003cversion\u003e2.13.0-rc2\u003c/version\u003e \u003c/dependency\u003e åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ \u003c!--æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨--\u003e \u003cmvc:annotation-driven /\u003e åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¤„ç†å™¨æ–¹æ³•"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ "},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€modelandviewç±»å‹è¿”å›å€¼ä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒstringç±»å‹è¿”å›å€¼èµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸‰voidç±»å‹è¿”å›å€¼æ‰‹å†™è¾“å‡ºæµ"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å››è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ä½¿ç”¨ajaxæ—¶è‡ªåŠ¨è§£ææˆjsonè¿”å›"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ "},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€httpservletrequestç±»å‹å‚æ•°requestè¯·æ±‚åŒ…"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒhttpservletresponseç±»å‹å‚æ•°responseå“åº”åŒ…"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸‰httpsessionç±»å‹å‚æ•°sessionä½œç”¨åŸŸ"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å››è‡ªå®šä¹‰å‚æ•°ç±»å‹åŸºæœ¬ç±»å‹å¼•ç”¨ç±»å‹"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ "},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸€é‡å®šå‘"},{"categories":null,"content":"\rå¤„ç†å™¨æ–¹æ³•\ræŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„è¿”å›å€¼å­¦ä¹ ï¼š ModelAndView String void è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ ä¸€ã€ModelAndViewç±»å‹è¿”å›å€¼ï¼šä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸ ModelAndViewæ˜¯SpringMVCæä¾›ä¸€ä¸ªå·¥å…·ç±» ModelAndViewç”¨äºå­˜å‚¨Controllerç±»è¿è¡Œçš„ç»“æœ ModelAndViewå­˜å‚¨éœ€è¦ç”³è¯· è°ƒç”¨çš„èµ„æºæ–‡ä»¶ çš„åœ°å€ ä½¿ç”¨æ–¹å¼ï¼š å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ @RequestMapping(value = \"/method3.do\") public ModelAndView method3() throws Exception{ ModelAndView mv = new ModelAndView(); //å­˜å‚¨åœ¨ModelAndViewä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«DispatcherServletä¿å­˜åˆ°è¯·æ±‚ä½œç”¨åŸŸä¸­ mv.addObject(\"tt\", \"è¿™æ˜¯æˆ‘è‡ªå·±å®šçš„infoä¿¡æ¯\"); mv.setViewName(\"/jsp/test.jsp\"); return mv; } äºŒã€Stringç±»å‹è¿”å›å€¼ï¼šèµ„æºæ–‡ä»¶è¯·æ±‚è½¬å‘ å…¶Stringç±»å‹è¿”å›å€¼æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶è¯·æ±‚åœ°å€ è¿™ä¸ªèµ„æºæ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹å°†ä¼šäº¤ç»™DispatcherServleté€šè¿‡è¯·æ±‚è½¬å‘æ¥å‘HttpæœåŠ¡å™¨ç´¢è¦èµ„æºæ–‡ä»¶ è¿™ä¸ªèµ„æºæ–‡ä»¶å¯ä»¥æ˜¯ jsp / html / å¤„ç†å™¨å…¶ä»–æ–¹æ³• ä½¿ç”¨æ–¹å¼ï¼š é»˜è®¤é€šè¿‡è¯·æ±‚è½¬å‘æ–¹å¼ @RequestMapping(value = \"/method1.do\") public String method1(){ //ä½¿ç”¨è¯·æ±‚è½¬å‘æ‰“å¼€â€œ â€ä¸­çš„ç½‘é¡µ return \"/info.jsp\"; } è°ƒç”¨å¤„ç†å™¨ä¸­å…¶ä»–æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"method2.do\"; } è°ƒç”¨å…¶ä»–å¤„ç†å™¨ä¸­æ–¹æ³• @RequestMapping(value = \"/method6.do\") public String method6(){ return \"/two/method1.do\"; } ä¸‰ã€voidç±»å‹è¿”å›å€¼ï¼šæ‰‹å†™è¾“å‡ºæµ å¤„ç†å™¨æ–¹æ³•åœ¨è¿è¡Œå®Œæ¯•åï¼Œæ˜¯ä¸éœ€è¦å°†ç»“æœäº¤ç»™DispatcherServlet å¤„ç†å™¨æ–¹æ³•å€ŸåŠ©äºå“åº”å¯¹è±¡ï¼Œè‡ªè¡Œå°†ç»“æœå†™å…¥åˆ°å“åº”ä½“ æ­¤æ—¶å¤„ç†å™¨æ–¹æ³•åœ¨å£°æ˜æ—¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªHttpServletResponseå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ç”±DispatcherServletè´Ÿè´£æä¾› ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•1111111111\"); } å››ã€è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šä½¿ç”¨Ajaxæ—¶ï¼Œè‡ªåŠ¨è§£ææˆJSONè¿”å› ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼šè¯´æ˜ä½¿ç”¨ajaxæŠ€æœ¯å‘é€è¯·æ±‚ è¿”å›å¯¹è±¡äº¤ç»™DispatcherServletè´Ÿè´£å°†è¿”å›çš„å¯¹è±¡è§£æä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²å†™å…¥åˆ°å“åº”ä½“ ä½¿ç”¨æ–¹å¼ï¼š æ·»åŠ ä¾èµ– com.fasterxml.jackson.core jackson-core 2.13.0-rc2 com.fasterxml.jackson.core jackson-databind 2.13.0-rc2 åœ¨spring.xmlä¸­æ³¨å†ŒMVCçš„æ³¨è§£é©±åŠ¨ åœ¨å¤„ç†å™¨ç±»æ–¹æ³•ä¸Šå£°æ˜@ResponseBodyæ³¨è§£ï¼Œè®©æ­¤æ–¹æ³•çš„è¿”å›å€¼ç”±DispatcherServletæ‰«æåˆ°å¹¶äº¤ç»™å“åº”ä½“ä¸­ @RequestMapping(value = \"/test1.do\") @ResponseBody public Dept test1(){ return new Dept(\"10\", \"ç‹äº”\", \"ä¸œåŒ—\"); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•çš„æ¥æ”¶å‚æ•°å­¦ä¹ ï¼š HttpServletRequest HttpServletResponse HttpSession è‡ªå®šä¹‰å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹/å¼•ç”¨ç±»å‹ï¼‰ â€‹ 1ï¼‰åŸºæœ¬ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ â€‹ 2ï¼‰å¼•ç”¨ç±»å‹: å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä¸€ã€HttpServletRequestç±»å‹å‚æ•°ï¼šRequestè¯·æ±‚åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method7.do\") public void method7(HttpServletRequest request){ String name = request.getParameter(\"name\"); String age = request.getParameter(\"age\"); System.out.println(\"name = \"+name+\", age = \"+age); } äºŒã€HttpServletResponseç±»å‹å‚æ•°ï¼šResponseå“åº”åŒ…ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method2.do\") public void method2(HttpServletResponse response) throws Exception{ PrintWriter out = response.getWriter(); out.print(\"æµ‹è¯•æµ‹è¯•ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„è¾“å‡ºæµå‘æµè§ˆå™¨è¾“å‡ºå†…å®¹\"); } ä¸‰ã€HttpSessionç±»å‹å‚æ•°ï¼šSessionä½œç”¨åŸŸä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method8.do\") public String method8(HttpSession session){ session.setAttribute(\"info\", \"æµ‹è¯•ä½¿ç”¨SpringMVCçš„sessionä½œç”¨åŸŸ\"); return \"/info.jsp\"; } å››ã€è‡ªå®šä¹‰å‚æ•°ç±»å‹ï¼šåŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ åŸºæœ¬ç±»å‹: å˜é‡å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ å¼•ç”¨ç±»å‹: å±æ€§å å¿…é¡»ä¸æµè§ˆå™¨å‘é€çš„è¯·æ±‚å‚æ•°åç›¸åŒ ä½¿ç”¨æ–¹å¼ï¼š @RequestMapping(value = \"/method9.do\") public void method9(String deptNo, String dName, String loc){ System.out.println(\"deptNo = \" + deptNo); System.out.println(\"dName = \" + dName); System.out.println(\"loc = \" + loc); } @RequestMapping(value = \"/method10.do\") public void method10(Dept dept){ System.out.println(\"deptNo = \" + dept.getDeptNo()); System.out.println(\"dName = \" + dept.getDName()); System.out.println(\"loc = \" + dept.getLoc()); } æŒ‰ç…§å¤„ç†å™¨æ–¹æ³•é—´è°ƒç”¨æ–¹å¼å­¦ä¹ ï¼š\rä¸€ã€é‡å®šå‘ åŸåœ°å€æ ¼å¼ï¼š å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å…¶ä»–ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨url å¦‚æœè¦æ±‚æµè§ˆå™¨è®¿é—®å½“å‰ç½‘ç«™çš„åœ°å€ï¼Œä½¿ç”¨ uri (/myWeb/one/method1.do) ç°åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method4.do\") public String method4() throws Exception{ return \"redirect:/one/method1.do\"; } äºŒã€è¯·æ±‚è½¬å‘ åœ°å€æ ¼å¼ï¼š ç®€åŒ–ç‰ˆ uri ä¸å†™ç½‘ç«™å (/one/method1.do) @RequestMapping(value = \"/method5.do\") public String method5() throws Exception{ return \"forward:/one/method1.do\"; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#äºŒè¯·æ±‚è½¬å‘"},{"categories":null,"content":"\rè§†å›¾è§£æå™¨ SpringMVCä¸ºé¿å…èµ„æºè·¯å¾„çš„å†—ä½™ï¼ŒåŠ å…¥äº†è§†å›¾è§£æå™¨æ¥è‡ªåŠ¨è¡¥å…¨æ‹¼æ¥æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶æ‰©å±•å ä½¿ç”¨æ–¹å¼ï¼š åœ¨spring.xmlä¸­åŠ å…¥ \u003c!--å¸®åŠ©å¤„ç†æ–‡ä»¶çš„è·¯å¾„å’Œæ‰©å±•åï¼Œç”Ÿæˆè§†å›¾å¯¹è±¡--\u003e \u003cbean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"\u003e \u003cproperty name=\"prefix\" value=\"/jsp/\" /\u003e \u003cproperty name=\"suffix\" value=\".jsp\" /\u003e \u003c/bean\u003e æµ‹è¯•ä½¿ç”¨ @RequestMapping(value = \"/method12.do\") public ModelAndView method12(Dept dept){ ModelAndView mv = new ModelAndView(); mv.addObject(\"tt\", \"ä½¿ç”¨äº†è§†å›¾è§£æå™¨è‡ªåŠ¨è¡¥å…¨è·¯å¾„å’Œåç¼€\"); //mv.setViewName(\"/jsp/test.jsp\"); mv.setViewName(\"test\"); return mv; } ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è§†å›¾è§£æå™¨"},{"categories":null,"content":"\ræ‹¦æˆªå™¨è¿‡æ»¤å™¨ï¼šcharacterEncodingFilterâ€¦â€¦ servletè§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä»»ä½•java webå·¥ç¨‹éƒ½å¯ä»¥ä½¿ç”¨ åœ¨url-patternä¸­é…ç½®äº†/*ä¹‹åï¼Œå¯ä»¥å¯¹æ‰€æœ‰è¦è®¿é—®çš„èµ„æºè¿›è¡Œæ‹¦æˆª æ‹¦æˆªå™¨ï¼šæ˜¯AOPæ€æƒ³çš„å…·ä½“åº”ç”¨ æ‹¦æˆªå™¨æ˜¯SpringMVCæ¡†æ¶è‡ªå·±çš„ï¼Œåªæœ‰ä½¿ç”¨äº†SpringMVCæ¡†æ¶çš„å·¥ç¨‹æ‰èƒ½ä½¿ç”¨ æ‹¦æˆªå™¨åªä¼šæ‹¦æˆªè®¿é—®çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œ å¦‚æœè®¿é—®çš„æ˜¯.jsp/.html/.css/.image/.jsæ˜¯ä¸ä¼šè¿›è¡Œæ‹¦æˆªçš„ ä½¿ç”¨æ–¹å¼ï¼š åˆ›å»ºHandlerInterceptorçš„å®ç°ç±»config.MyInterceptor public class MyInterceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { HttpSession session = request.getSession(); //è®¿é—®ç™»é™†é¡µé¢ï¼Œæ”¾è¡Œ if (request.getRequestURL().toString().contains(\"login\")){ System.out.println(request.getRequestURL().toString()+\"æ­£åœ¨ç™»å½•\"); return true; } //ç”¨æˆ·ç™»å½•æˆåŠŸè¿‡ï¼Œæ”¾è¡Œ if (session.getAttribute(\"userLoginInfo\") != null){ System.out.println(\"ç™»é™†è¿‡ï¼Œå­˜åœ¨session\"); return true; } //ä¸é€šè¿‡ï¼Œé‡å®šå‘åˆ°åˆå§‹é¡µé¢ response.sendRedirect(\"/myWeb/index.jsp\"); return false; } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { System.out.println(\"å¤„ç†å\"); } @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { System.out.println(\"æ¸…ç†\"); } } åœ¨spring.xmlä¸­æ³¨å†Œæ‹¦æˆªå™¨ \u003cmvc:interceptors\u003e \u003cmvc:interceptor\u003e \u003c!-- /** ä¸ºæ‹¦æˆªæ‰€æœ‰è·¯å¾„åŠå…¶å­è·¯å¾„ --\u003e \u003cmvc:mapping path=\"/**\"/\u003e \u003cbean class=\"com.bjpn.config.MyInterceptor\"/\u003e \u003c/mvc:interceptor\u003e \u003c/mvc:interceptors\u003e ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ‹¦æˆªå™¨"},{"categories":null,"content":"\rSpringMVCæ‰§è¡ŒåŸç† ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springmvcæ‰§è¡ŒåŸç†"},{"categories":null,"content":"\râœ”âœ” SSMé¡¹ç›®ç”¨åˆ°çš„ä¾èµ–æ±‡æ€»ï¼š \u003cdependency\u003e \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e \u003cversion\u003e4.0.1\u003c/version\u003e \u003cscope\u003eprovided\u003c/scope\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-context\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-jdbc\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis\u003c/artifactId\u003e \u003cversion\u003e3.5.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis-spring\u003c/artifactId\u003e \u003cversion\u003e1.3.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003emysql\u003c/groupId\u003e \u003cartifactId\u003emysql-connector-java\u003c/artifactId\u003e \u003cversion\u003e8.0.26\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003edruid\u003c/artifactId\u003e \u003cversion\u003e1.1.12\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-aspects\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-web\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-webmvc\u003c/artifactId\u003e \u003cversion\u003e5.3.10\u003c/version\u003e \u003cscope\u003ecompile\u003c/scope\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.fasterxml.jackson.core\u003c/groupId\u003e \u003cartifactId\u003ejackson-core\u003c/artifactId\u003e \u003cversion\u003e2.13.0-rc2\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.fasterxml.jackson.core\u003c/groupId\u003e \u003cartifactId\u003ejackson-databind\u003c/artifactId\u003e \u003cversion\u003e2.13.0-rc2\u003c/version\u003e \u003c/dependency\u003e ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#-ssmé¡¹ç›®ç”¨åˆ°çš„ä¾èµ–æ±‡æ€»"},{"categories":null,"content":"\ré‡åˆ°é—®é¢˜\r1. ä¸­æ–‡å‚æ•°ä¹±ç é—®é¢˜ åŸå› ï¼špostè¯·æ±‚é»˜è®¤ä½¿ç”¨ISO-8859-01ä¸œæ¬§å­—ç¬¦é›† è§£å†³ï¼šæ·»åŠ SpringMVCæä¾›çš„è¿‡æ»¤å™¨æ¥å£å®ç°ç±» åœ¨web.xmlä¸­æ·»åŠ  \u003c!--æ·»åŠ è¿‡æ»¤å™¨--\u003e \u003cfilter\u003e \u003cfilter-name\u003echaracterEncodingFilter\u003c/filter-name\u003e \u003cfilter-class\u003eorg.springframework.web.filter.CharacterEncodingFilter\u003c/filter-class\u003e \u003c!--è®¾ç½®å­—ç¬¦é›†--\u003e \u003cinit-param\u003e \u003cparam-name\u003eencoding\u003c/param-name\u003e \u003cparam-value\u003eutf-8\u003c/param-value\u003e \u003c/init-param\u003e \u003c/filter\u003e \u003cfilter-mapping\u003e \u003cfilter-name\u003echaracterEncodingFilter\u003c/filter-name\u003e \u003curl-pattern\u003e*.do\u003c/url-pattern\u003e \u003c/filter-mapping\u003e ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°é—®é¢˜"},{"categories":null,"content":"\ré‡åˆ°é—®é¢˜\r1. ä¸­æ–‡å‚æ•°ä¹±ç é—®é¢˜ åŸå› ï¼špostè¯·æ±‚é»˜è®¤ä½¿ç”¨ISO-8859-01ä¸œæ¬§å­—ç¬¦é›† è§£å†³ï¼šæ·»åŠ SpringMVCæä¾›çš„è¿‡æ»¤å™¨æ¥å£å®ç°ç±» åœ¨web.xmlä¸­æ·»åŠ  characterEncodingFilter org.springframework.web.filter.CharacterEncodingFilter encoding utf-8 characterEncodingFilter *.do ","date":"2021-09-23","objectID":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"SpringMVCè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springmvc%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#1-ä¸­æ–‡å‚æ•°ä¹±ç é—®é¢˜"},{"categories":null,"content":"\rSpringæ¡†æ¶è‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-9-14 ç¬”è®°æ‘˜è‡ªï¼šbjpowernode æ¨éœ‡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springæ¡†æ¶è‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\ræ¡†æ¶ï¼š ä¸€ç»„å·¥å…·ç±» æ¡†æ¶æ˜¯é’ˆå¯¹æŸä¸€ä¸ªæŠ€æœ¯è¿›è¡Œå°è£…ï¼Œç›®çš„é™ä½è¢«å°è£…çš„æŠ€æœ¯çš„ä½¿ç”¨éš¾åº¦ æ¡†æ¶è¿™ä¸ªå·¥å…·ç±»éƒ½æ˜¯å­˜å‚¨åœ¨jaråŒ…æ–‡ä»¶ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ¡†æ¶"},{"categories":null,"content":"\rSpringæ¡†æ¶(ä¼˜ç‚¹)ï¼š Springï¼šç®€åŒ–javaå¼€å‘ï¼Œæ•´åˆäº†ç°æœ‰çš„æŠ€æœ¯æ¡†æ¶ã€‚æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬å’Œé¢å‘åˆ‡é¢çš„æ¡†æ¶ã€‚ å¼€æºçš„å…è´¹çš„å®¹å™¨ï¼ˆæ¡†æ¶ï¼‰ è½»é‡çº§çš„ï¼Œéå…¥ä¾µå¼çš„æ¡†æ¶ æ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ æ”¯æŒäº‹åŠ¡å¤„ç†ï¼Œå¯¹æ¡†æ¶æ•´åˆçš„æ”¯æŒ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springæ¡†æ¶ä¼˜ç‚¹"},{"categories":null,"content":"\rSpringçš„ä¸ƒå¤§æ¨¡å—ï¼š\r","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springçš„ä¸ƒå¤§æ¨¡å—"},{"categories":null,"content":"\rSpringå®¹å™¨ï¼Œä½¿ç”¨ï¼š Springå®¹å™¨å¯¹è±¡ï¼ˆApplicationContextï¼‰ç‰¹ç‚¹ï¼š ç”±Springå®¹å™¨ç®¡ç†çš„ç±»éœ€è¦æä¾›ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ æ–¹æ³• ä¸€ä¸ªbeanæ ‡ç­¾æè¿°çš„ç±»åœ¨Springå®¹å™¨å¯¹è±¡åªæœ‰ä¸€ä¸ªå¯¹åº”å®ä¾‹å¯¹è±¡ å¦‚æœæŸä¸ªç±»åœ¨Springå®¹å™¨å¯¹è±¡éœ€è¦å­˜åœ¨å¤šä¸ªå®ä¾‹å¯¹è±¡ï¼Œå¯ä»¥å€ŸåŠ©äºå¤šä¸ªbeanæ ‡ç­¾ ä½¿ç”¨Springå®¹å™¨å¯¹è±¡ é€šè¿‡xmlæ–‡ä»¶æˆ–æ³¨è§£ åˆ›å»ºå¹¶ä¿å­˜ ä¸€ä¸ªç±» å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥å‘å®¹å™¨ ç´¢è¦ å¯¹è±¡ åˆ›å»ºmavené¡¹ç›®ï¼Œæ·»åŠ spring-contextçš„ä¾èµ– \u003c!-- è¿™é‡Œæ·»åŠ çš„æ˜¯spring-webmvcçš„ä¾èµ– mavenä¼šè‡ªåŠ¨å¯¼å…¥springç”¨åˆ°çš„ç›¸å…³ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-webmvc\u003c/artifactId\u003e \u003cversion\u003e5.3.10\u003c/version\u003e \u003c/dependency\u003e åœ¨resourcesè·¯å¾„ä¸‹åˆ›å»ºspring.xmlæ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cbeans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"\u003e \u003c!--é€šçŸ¥springå®¹å™¨ï¼ŒStudentç±»éœ€è¦ç”±springè´Ÿè´£åˆ›å»ºå¹¶åœ¨å¼€å‘æ—¶å¯¹å¤–æä¾›--\u003e \u003cbean class=\"com.bjpn.Student\" id=\"student\"\u003e\u003c/bean\u003e \u003c/beans\u003e åœ¨spring.xmlæ–‡ä»¶å†…éƒ¨å£°æ˜beanæ ‡ç­¾ classï¼šéœ€è¦è¢«springå®¹å™¨åˆ›å»ºçš„ç±»çš„å…¨é™å®šå idï¼šbeanæ ‡ç­¾çš„å”¯ä¸€æ ‡è¯† nameï¼šåˆ«å Springå®¹å™¨å†…éƒ¨æœ‰ä¸€ä¸ªMap\u003cid, class\u003eç›¸ç­‰äºï¼šmap.put(id, new Student) æµ‹è¯•ä½¿ç”¨Springå®¹å™¨å¯¹è±¡åˆ›å»ºç±» @Test public void appTest1() { /* context:Springå®¹å™¨å¯¹è±¡ ApplicationContextçš„é‡è¦å®ç°ç±»ï¼š 1. ClassPathXmlApplicationContextï¼šç›¸å¯¹è·¯å¾„è·å–é…ç½®æ–‡ä»¶ 2. FileSystemXmlApplicationContextï¼šç»å¯¹è·¯å¾„è·å–é…ç½®æ–‡ä»¶ */ ApplicationContext context = new ClassPathXmlApplicationContext(\"spring.xml\"); //å‘å®¹å™¨ç´¢è¦å¯¹è±¡ Studnet stu = (Studnet) context.getBean(\"student\"); //é€šè¿‡åå°„å£°æ˜ç±»å‹å°±å¯ä»¥ä¸ç”¨å¼ºè½¬ //Studnet stu = context.getBean(\"student\", Studnet.class); //è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•æµ‹è¯• stu.say(); } ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springå®¹å™¨ä½¿ç”¨"},{"categories":null,"content":"\rè¡¥: ä½¿ç”¨JavaConfigå®ç°é…ç½® åœ¨Configç±»ä¸Šå£°æ˜@Configurationï¼Œå®ƒä¼šè¢«springå®¹å™¨æ‰˜ç®¡åˆ›å»º åœ¨Configç±»ä¸Šå£°æ˜@ComponentScanï¼ˆxxx.xxxxï¼‰ï¼Œå¯ä»¥å°†åŒ…ä¸‹æ‰€æœ‰æœ‰@Componentå£°æ˜çš„ç±»ç»‘å®šä¸ºConfigç±» åœ¨å…¶æ–¹æ³•ä¸Šå£°æ˜@Beanï¼Œå®ƒçš„æ–¹æ³•åå°±æ˜¯idå±æ€§ã€è¿”å›å€¼å°±æ˜¯classå±æ€§ ä½¿ç”¨AnnotationConfigApplicationContextè·å–ä¸Šä¸‹æ–‡å®¹å™¨å¯¹è±¡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¡¥-ä½¿ç”¨javaconfigå®ç°é…ç½®"},{"categories":null,"content":"\rSpringæ¡†æ¶æä¾›çš„æœåŠ¡ï¼š IOCå’ŒDIæœåŠ¡ï¼šæä¾›å¯¹è±¡çš„åˆ›å»º DIæœåŠ¡ï¼šæä¾›å¯¹è±¡çš„åˆå§‹åŒ– AOPæœåŠ¡ï¼šæä¾›åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼ï¼Œç®€åŒ–å…¶ä½¿ç”¨éš¾åº¦ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springæ¡†æ¶æä¾›çš„æœåŠ¡"},{"categories":null,"content":"\r1. IOCï¼šæ§åˆ¶åè½¬æœåŠ¡ IOCæ˜¯ä¸€ç§æ§åˆ¶åè½¬çš„æ€æƒ³ æ§åˆ¶åè½¬å°±æ˜¯è·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ï¼šå°†æ‰€æœ‰ä¼šç”¨åˆ°çš„å¯¹è±¡ç»Ÿä¸€ä¿å­˜åœ¨springå®¹å™¨ä¸­ï¼Œä½¿ç”¨çš„æ—¶å€™è°ƒç”¨éœ€è¦çš„å¯¹è±¡å³å¯ï¼Œé¿å…æœ‰å†™æ­»äº†ä¾èµ–å¯¹è±¡çš„ä»£ç ï¼Œå¤§å¤§æé«˜äº†è§£è€¦åˆæ€§ã€‚ IOCçš„å®ç°æ–¹å¼ï¼š é€šè¿‡xmlæ–‡ä»¶æˆ–æ³¨è§£ åˆ›å»ºå¹¶ä¿å­˜ ä¸€ä¸ªç±» ä¸€ã€é€šè¿‡xmlæ–‡ä»¶æè¿°ï¼š åœ¨spring.xmlæ–‡ä»¶ä¸­æ·»åŠ beanæ ‡ç­¾ï¼š \u003c!--é€šçŸ¥springå®¹å™¨ï¼ŒStudentç±»éœ€è¦ç”±springè´Ÿè´£åˆ›å»ºå¹¶åœ¨å¼€å‘æ—¶å¯¹å¤–æä¾›--\u003e \u003cbean class=\"com.bjpn.Student\" id=\"student\"\u003e\u003c/bean\u003e åœ¨spring.xmlæ–‡ä»¶å†…éƒ¨å£°æ˜beanæ ‡ç­¾ classï¼šéœ€è¦è¢«springå®¹å™¨åˆ›å»ºçš„ç±»ä¿¡æ¯ idï¼šbeanæ ‡ç­¾çš„å”¯ä¸€æ ‡è¯† Springå®¹å™¨å†…éƒ¨æœ‰ä¸€ä¸ªMap\u003cid, class\u003eç›¸ç­‰äºï¼šmap.put(id, new Student) æµ‹è¯•ä½¿ç”¨Springå®¹å™¨å¯¹è±¡åˆ›å»ºç±» @Test public void appTest1() { /* context:Springå®¹å™¨å¯¹è±¡ ApplicationContextçš„é‡è¦å®ç°ç±»ï¼š 1. ClassPathXmlApplicationContextï¼šç›¸å¯¹è·¯å¾„è·å–é…ç½®æ–‡ä»¶ 2. FileSystemXmlApplicationContextï¼šç»å¯¹è·¯å¾„è·å–é…ç½®æ–‡ä»¶ */ ApplicationContext context = new ClassPathXmlApplicationContext(\"spring.xml\"); //å‘å®¹å™¨ç´¢è¦å¯¹è±¡ Studnet stu = (Studnet) context.getBean(\"student\"); //è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•æµ‹è¯• stu.say(); } äºŒã€é€šè¿‡Annotationæ³¨è§£æè¿°ï¼š @Componentå£°æ˜è¦è¢«springåˆ›å»ºå®ä¾‹å¯¹è±¡çš„ç±» ==å¿…é¡»å­˜åœ¨æ— å‚æ„é€ æ–¹æ³•== é»˜è®¤idï¼šå°é©¼å³°ç±»å æ‰‹åŠ¨è®¾ç½®idï¼š@Component(value=\"idå\") åœ¨ç±»ä¸Šæ–¹å£°æ˜@Componentæ³¨è§£ åœ¨springé…ç½®æ–‡ä»¶ä¸­æ·»åŠ component-scanæ ‡ç­¾ï¼Œå¹¶ç»‘å®šåˆ°åŒ… \u003ccontext:component-scan base-package=\"org.example\"\u003e\u003c/context:component-scan\u003e ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:1","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#1-iocæ§åˆ¶åè½¬æœåŠ¡"},{"categories":null,"content":"\r2. DIï¼šä¾èµ–æ³¨å…¥æœåŠ¡ä¾èµ–æ³¨å…¥æœåŠ¡ï¼šIOCçš„ä¸€ä¸ªæ‰©å±•ï¼Œè´Ÿè´£å¯¹è±¡ä¸­å±æ€§çš„åˆå§‹åŒ– ä¾èµ–ï¼šbeanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨ æ³¨å…¥ï¼šbeanå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ç”±å®¹å™¨æ¥æ³¨å…¥ DIæœåŠ¡åˆ†ç±»ï¼š åŸºæœ¬å±æ€§åˆå§‹åŒ– å¼•ç”¨ç±»å‹å±æ€§åˆå§‹åŒ– æœ‰å‚æ„é€ æ–¹æ³•å±æ€§åˆå§‹åŒ– DIçš„å®ç°æ–¹å¼ï¼š é€šè¿‡xmlæ–‡ä»¶æˆ–æ³¨è§£ åˆå§‹åŒ– ä¸€ä¸ªç±» ä¸€ã€é€šè¿‡xmlæ–‡ä»¶æè¿°ï¼š åœ¨spring.xmlæ–‡ä»¶çš„beanæ ‡ç­¾ä¸­æ·»åŠ ï¼š propertyæ ‡ç­¾ï¼šé€šè¿‡setæ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼ nameï¼šå±æ€§å valueï¼šåŸºæœ¬å±æ€§å€¼ refï¼šå¼•ç”¨ç±»å‹å±æ€§çš„beanæ ‡ç­¾id \u003cbean class=\"java.util.ArrayList\" id=\"arrayList\"\u003e\u003c/bean\u003e \u003cbean class=\"org.example.App\" id=\"app2\"\u003e \u003c!--é€šè¿‡setæ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼--\u003e \u003c!--æ™®é€šç±»å‹æ³¨å…¥--\u003e \u003cproperty name=\"name\" value=\"æ¯›æ¡‘\"\u003e\u003c/property\u003e \u003c!--å¼•ç”¨ç±»å‹æ³¨å…¥--\u003e \u003cproperty name=\"list\" ref=\"arrayList\"\u003e\u003c/property\u003e \u003c!--æ•°ç»„çš„æ³¨å…¥--\u003e \u003cproperty name=\"array\"\u003e \u003carray\u003e \u003cvalue\u003e1\u003c/value\u003e \u003cvalue\u003e2\u003c/value\u003e \u003cvalue\u003e3\u003c/value\u003e \u003cvalue\u003e4\u003c/value\u003e \u003c/array\u003e \u003c/property\u003e \u003c!--Listé›†åˆçš„æ³¨å…¥--\u003e \u003cproperty name=\"arraylist\"\u003e \u003clist\u003e \u003cvalue\u003eå¬æ­Œ\u003c/value\u003e \u003cvalue\u003eçœ‹ç”µå½±\u003c/value\u003e \u003cvalue\u003eå¹ç‰›é€¼\u003c/value\u003e \u003c/list\u003e \u003c/property\u003e \u003c!--Mapé›†åˆçš„æ³¨å…¥--\u003e \u003cproperty name=\"map\"\u003e \u003cmap\u003e \u003centry key=\"\" value=\"\"\u003e \u003centry key=\"\" value=\"\"\u003e \u003centry key=\"\" value=\"\"\u003e \u003c/map\u003e \u003c/property\u003e \u003c!--Seté›†åˆçš„æ³¨å…¥--\u003e \u003cproperty name=\"set\"\u003e \u003cset\u003e \u003cvalue\u003eå¬æ­Œ\u003c/value\u003e \u003cvalue\u003eçœ‹ç”µå½±\u003c/value\u003e \u003cvalue\u003eå¹ç‰›é€¼\u003c/value\u003e \u003c/set\u003e \u003c/property\u003e \u003c!--Nullç©ºå€¼çš„æ³¨å…¥--\u003e \u003cproperty name=\"nullValue\"\u003e \u003cnull/\u003e \u003c/property\u003e \u003c!--propertiesæ–‡ä»¶çš„æ³¨å…¥--\u003e \u003cproperty\u003e \u003cprops\u003e \u003cprop key=\"username\"\u003eroot\u003c/prop\u003e \u003cprop key=\"password\"\u003e129807\u003c/prop\u003e \u003c/props\u003e \u003c/property\u003e \u003c/bean\u003e \u003c!-- p å‘½åç©ºé—´çš„ä½¿ç”¨--\u003e \u003cbean class=\"org.example.App\" id=\"app4\" p:name=\"æ¯›å˜‰\"\u003e constructor-argæ ‡ç­¾ï¼šé€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼ nameï¼šå±æ€§å valueï¼šåŸºæœ¬å±æ€§å€¼ refï¼šå¼•ç”¨ç±»å‹å±æ€§çš„beanæ ‡ç­¾id \u003cbean class=\"java.util.ArrayList\" id=\"arrayList\"\u003e\u003c/bean\u003e \u003cbean class=\"org.example.App\" id=\"app3\"\u003e \u003c!--é€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼--\u003e \u003c!--é€šè¿‡å½¢å‚åèµ‹å€¼--\u003e \u003cconstructor-arg name=\"name\" value=\"æ¯›æ¡‘\"\u003e\u003c/constructor-arg\u003e \u003cconstructor-arg name=\"list\" ref=\"arrayList\"\u003e\u003c/constructor-arg\u003e \u003c!--é€šè¿‡ä¸‹æ ‡èµ‹å€¼--\u003e \u003cconstructor-arg index=\"0\" value=\"æ¯›æ¡‘\"\u003e\u003c/constructor-arg\u003e \u003cconstructor-arg index=\"1\" ref=\"arrayList\"\u003e\u003c/constructor-arg\u003e \u003c!--é€šè¿‡ä¸‹æ ‡èµ‹å€¼ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼Œå¦‚æœæœ‰ç›¸åŒç±»å‹çš„å‚æ•°å°±GGï¼‰--\u003e \u003cconstructor-arg type=\"java.lang.String\" value=\"æ¯›æ¡‘\"\u003e\u003c/constructor-arg\u003e \u003cconstructor-arg type=\"java.util.ArrayList\" ref=\"arrayList\"\u003e\u003c/constructor-arg\u003e \u003c/bean\u003e \u003c!-- c å‘½åç©ºé—´çš„ä½¿ç”¨--\u003e \u003cbean class=\"org.example.App\" id=\"app4\" c:name=\"æ¯›å˜‰\"\u003e\u003c/bean\u003e xmlçš„è‡ªåŠ¨è£…é… å¿…é¡»ä¿è¯å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªç±»å‹åŒ¹é…çš„å¯¹è±¡ byNameï¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æ‰¾setæ–¹æ³•å¯¹åº”çš„å°é©¼å³°bean id bytypeï¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æ‰¾ç±»å‹åŒ¹é…çš„bean \u003cbean class=\"java.util.ArrayList\" id=\"arrayList\"\u003e\u003c/bean\u003e \u003cbean class=\"org.example.App\" id=\"app6\" autowire=\"byName\"\u003e \u003c!--é€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼--\u003e \u003cconstructor-arg name=\"name\" value=\"æ¯›æ¡‘\"\u003e\u003c/constructor-arg\u003e \u003c!--\u003cconstructor-arg name=\"list\" ref=\"arrayList\"\u003e\u003c/constructor-arg\u003e--\u003e \u003c/bean\u003e äºŒã€é€šè¿‡Annotationæ³¨è§£æè¿°ï¼š ä½¿ç”¨@Valueå¯¹åŸºæœ¬å±æ€§è¿›è¡Œåˆå§‹åŒ– ä¹Ÿå¯ä»¥å£°æ˜åœ¨setæ–¹æ³•ä¸Š ==å‡ºç°@Valueçš„ç±»å¿…é¡»ç”±springå®¹å™¨å¯¹è±¡åˆ›å»º== ä½¿ç”¨@Autowiredå¯¹å¼•ç”¨æ•°æ®ç±»å‹åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨è£…é…ï¼‰ è¦æ±‚springå®¹å™¨æä¾›ç±»å‹åŒ¹é…çš„å¯¹è±¡åˆå§‹åŒ–ï¼Œå¿…é¡»ä¿è¯å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªç±»å‹åŒ¹é…çš„å¯¹è±¡ ä¹Ÿå¯ä»¥å£°æ˜åœ¨setæ–¹æ³•ä¸Š ==å‡ºç°@Autowiredçš„ç±»å¿…é¡»ç”±springå®¹å™¨å¯¹è±¡åˆ›å»º== å€ŸåŠ©@Qualifieræä¾›å¯¹è±¡idæŒ‡å®šåˆå§‹åŒ–å¯¹è±¡ Beançš„ä½œç”¨åŸŸï¼š singletonå•ä¾‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ prototypeåŸå‹æ¨¡å¼ï¼šæ¯æ¬¡ä»å®¹å™¨getBeanæ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ \u003cbean class=\"java.util.ArrayList\" id=\"arrayList\" scope=\"prototype\"\u003e\u003c/bean\u003e ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:2","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#2-diä¾èµ–æ³¨å…¥æœåŠ¡"},{"categories":null,"content":"\r2. DIï¼šä¾èµ–æ³¨å…¥æœåŠ¡ä¾èµ–æ³¨å…¥æœåŠ¡ï¼šIOCçš„ä¸€ä¸ªæ‰©å±•ï¼Œè´Ÿè´£å¯¹è±¡ä¸­å±æ€§çš„åˆå§‹åŒ– ä¾èµ–ï¼šbeanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨ æ³¨å…¥ï¼šbeanå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ç”±å®¹å™¨æ¥æ³¨å…¥ DIæœåŠ¡åˆ†ç±»ï¼š åŸºæœ¬å±æ€§åˆå§‹åŒ– å¼•ç”¨ç±»å‹å±æ€§åˆå§‹åŒ– æœ‰å‚æ„é€ æ–¹æ³•å±æ€§åˆå§‹åŒ– DIçš„å®ç°æ–¹å¼ï¼š é€šè¿‡xmlæ–‡ä»¶æˆ–æ³¨è§£ åˆå§‹åŒ– ä¸€ä¸ªç±» ä¸€ã€é€šè¿‡xmlæ–‡ä»¶æè¿°ï¼š åœ¨spring.xmlæ–‡ä»¶çš„beanæ ‡ç­¾ä¸­æ·»åŠ ï¼š propertyæ ‡ç­¾ï¼šé€šè¿‡setæ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼ nameï¼šå±æ€§å valueï¼šåŸºæœ¬å±æ€§å€¼ refï¼šå¼•ç”¨ç±»å‹å±æ€§çš„beanæ ‡ç­¾id 1 2 3 4 å¬æ­Œ çœ‹ç”µå½± å¹ç‰›é€¼ å¬æ­Œ çœ‹ç”µå½± å¹ç‰›é€¼ root 129807 constructor-argæ ‡ç­¾ï¼šé€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•ä¸ºå®ä¾‹å¯¹è±¡è¿›è¡Œèµ‹å€¼ nameï¼šå±æ€§å valueï¼šåŸºæœ¬å±æ€§å€¼ refï¼šå¼•ç”¨ç±»å‹å±æ€§çš„beanæ ‡ç­¾id xmlçš„è‡ªåŠ¨è£…é… å¿…é¡»ä¿è¯å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªç±»å‹åŒ¹é…çš„å¯¹è±¡ byNameï¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æ‰¾setæ–¹æ³•å¯¹åº”çš„å°é©¼å³°bean id bytypeï¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æ‰¾ç±»å‹åŒ¹é…çš„bean äºŒã€é€šè¿‡Annotationæ³¨è§£æè¿°ï¼š ä½¿ç”¨@Valueå¯¹åŸºæœ¬å±æ€§è¿›è¡Œåˆå§‹åŒ– ä¹Ÿå¯ä»¥å£°æ˜åœ¨setæ–¹æ³•ä¸Š ==å‡ºç°@Valueçš„ç±»å¿…é¡»ç”±springå®¹å™¨å¯¹è±¡åˆ›å»º== ä½¿ç”¨@Autowiredå¯¹å¼•ç”¨æ•°æ®ç±»å‹åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨è£…é…ï¼‰ è¦æ±‚springå®¹å™¨æä¾›ç±»å‹åŒ¹é…çš„å¯¹è±¡åˆå§‹åŒ–ï¼Œå¿…é¡»ä¿è¯å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªç±»å‹åŒ¹é…çš„å¯¹è±¡ ä¹Ÿå¯ä»¥å£°æ˜åœ¨setæ–¹æ³•ä¸Š ==å‡ºç°@Autowiredçš„ç±»å¿…é¡»ç”±springå®¹å™¨å¯¹è±¡åˆ›å»º== å€ŸåŠ©@Qualifieræä¾›å¯¹è±¡idæŒ‡å®šåˆå§‹åŒ–å¯¹è±¡ Beançš„ä½œç”¨åŸŸï¼š singletonå•ä¾‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ prototypeåŸå‹æ¨¡å¼ï¼šæ¯æ¬¡ä»å®¹å™¨getBeanæ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:2","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#beançš„ä½œç”¨åŸŸ"},{"categories":null,"content":"\r3. AOPï¼šé¢å‘åˆ‡é¢é¢å‘åˆ‡é¢(aspect)ï¼šä½¿ç”¨åŠ¨æ€ä»£ç†ç®€åŒ–JDKä»£ç†è®¾è®¡æ¨¡å¼å¼€å‘éš¾åº¦ ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰ï¼šæœ¬æ¬¡è¦å¸®åŠ©çš„æŸä¸ªæ¥å£ä¸‹çš„æŸä¸ªå®ç°ç±»çš„å®ä¾‹å¯¹è±¡, ç›®æ ‡å¯¹è±¡å¹¶ä¸ä¼šç›´æ¥å‡ºç°åœ¨ç¨‹åºã€‚æ‰€æœ‰å¯¹äºç›®æ ‡å¯¹è±¡è¯·æ±‚ï¼Œéƒ½ç”±å…¶å¯¹åº”çš„ä»£ç†å¯¹è±¡è¿›è¡Œæ¥æ”¶ã€‚ åˆ‡é¢ï¼ˆaspectï¼‰ï¼š åˆ‡é¢å°±æ˜¯ä¸€ä¸ªç±»ã€‚ä¸€ä¸ªéœ€è¦åœ¨æŸä¸ªæ¥å£ä¸‹æ‰€æœ‰å®ç°ç±»ä¸­æŒ‡å®šæ–¹æ³•ä¸‹ç»Ÿä¸€æ–°å¢çš„æ–¹æ³• è¿æ¥ç‚¹ï¼ˆjoinPointï¼‰ï¼šæ¥å£ä¸‹éœ€è¦ä¸æ–°å¢åŠŸèƒ½å…³è”çš„æ–¹æ³•ã€‚æ¯”å¦‚ serviceæ–¹æ³• åˆ‡å…¥ç‚¹ï¼ˆpointCutï¼‰ï¼š å®šä½åœ°å€ï¼Œç”¨äºæŒ‡å‘è¿æ¥ç‚¹ä½ç½® é€šçŸ¥ï¼ˆadviceï¼‰ï¼šã€åˆ‡é¢ã€‘ä¸ã€è¿æ¥ç‚¹ã€‘çš„è°ƒç”¨é¡ºåº AOPæœåŠ¡ä¸­é€šçŸ¥åˆ†ç±»ï¼š å‰ç½®é€šçŸ¥ï¼š å…ˆæ‰§è¡Œ[åˆ‡é¢] å†æ‰§è¡Œ[è¿æ¥ç‚¹] ã€@Beforeã€‘ åç½®é€šçŸ¥: å…ˆæ‰§è¡Œ[è¿æ¥ç‚¹] å†æ‰§è¡Œ[åˆ‡é¢] ã€@AfterReturningã€‘ ç¯ç»•é€šçŸ¥ï¼š å…ˆæ‰§è¡Œ[åˆ‡é¢] å†æ‰§è¡Œ[è¿æ¥ç‚¹] æœ€åå†æ‰§è¡Œ[åˆ‡é¢]ã€@Aroundã€‘ å¼‚å¸¸é€šçŸ¥ï¼š åªæœ‰åœ¨[è¿æ¥ç‚¹]è¿è¡Œæ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰ä¼šæ‰§è¡Œ[åˆ‡é¢]ã€@AfterThrowingã€‘ æœ€ç»ˆé€šçŸ¥: æ— è®º[è¿æ¥ç‚¹]æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œæœ€ç»ˆéƒ½è¦æ‰§è¡Œ[åˆ‡é¢] try{}finally{} ã€@Afterã€‘ åœ¨springæ¡†æ¶ä¸­ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼š ä¸€ã€ é€šè¿‡xmlæ–‡ä»¶æ–¹å¼ æ·»åŠ springåŠ¨æ€ä»£ç†aspectsä¾èµ– \u003c!-- spring-aspects --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-aspects\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e åˆ›å»ºç›®æ ‡æ¥å£ã€ç›®æ ‡æ¥å£å®ç°ç±» åˆ›å»ºåˆ‡é¢ç±» å®Œæˆ[åˆ‡é¢]ã€[é€šçŸ¥] åˆ›å»ºç›®æ ‡å¯¹è±¡æ¥å£ã€å®ç°ç±»ã€å®ç°ç±»åŠŸèƒ½ åˆ›å»ºåˆ‡é¢ç±»ï¼Œå†™åˆ‡é¢æ–¹æ³• åœ¨spring.xmlä¸­: åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåˆ‡é¢å¯¹è±¡ é…ç½®aop \u003c!--ä½¿ç”¨beanæ ‡ç­¾è¦æ±‚springå®¹å™¨åˆ›å»ºä»£ç†å¯¹è±¡å’Œåˆ‡é¢å¯¹è±¡--\u003e \u003cbean class=\"com.bjpn.serviceImpl.DeptServiceImpl\" id=\"deptService\"/\u003e \u003cbean class=\"com.bjpn.aspect.MyAspect\" id=\"myAspect\"/\u003e \u003c!--aopé…ç½®æ ‡ç­¾--\u003e \u003caop:config\u003e \u003c!--å£°æ˜åˆ‡å…¥ç‚¹ï¼ˆpointCutï¼‰ï¼Œç»‘å®šè¿æ¥ç‚¹ï¼ˆjoinPointï¼‰çš„å…·ä½“å®ç°æ–¹æ³•--\u003e \u003caop:pointcut id=\"myPointCut\" expression=\"execution(public void com.bjpn.service.BaseService.service())\"/\u003e \u003c!--å£°æ˜åˆ‡é¢ï¼Œç»‘å®šåˆ‡é¢å¯¹è±¡--\u003e \u003caop:aspect ref=\"myAspect\"\u003e \u003c!--å£°æ˜é€šçŸ¥ç±»å‹ï¼Œç»‘å®šåˆ‡é¢ä¸­çš„å¢å¼ºæ–¹æ³•ï¼Œç»‘å®šåˆ‡å…¥ç‚¹--\u003e \u003caop:before method=\"newMethod\" pointcut-ref=\"myPointCut\"/\u003e \u003c/aop:aspect\u003e \u003c/aop:config\u003e æµ‹è¯•ä½¿ç”¨ é—®ï¼šä¸ºä»€ä¹ˆè¿™é‡Œè¦ä¸Šè½¬å‹ä½¿ç”¨æ¥å£åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Ÿ ç­”ï¼šå› ä¸ºAOPåŠ¨æ€ä»£ç†é»˜è®¤ä½¿ç”¨çš„æ˜¯JDKçš„åŠ¨æ€ä»£ç†ï¼ŒJDKçš„åŠ¨æ€ä»£ç†éœ€è¦ç±»æœ‰å¯¹åº”çš„æ¥å£ï¼Œä¸”å¿…é¡»ä½¿ç”¨æ¥å£ä¸Šè½¬å‹ è¡¥ï¼šåœ¨IOCä¸­ä½¿ç”¨springå®¹å™¨åˆ›å»ºå®ç°äº†æ¥å£çš„å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œéœ€è¦ä¸Šè½¬å‹ã€‚å¦‚è‹¥æ˜¯ä½¿ç”¨springå®¹å™¨åˆ›å»ºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯cglibåŠ¨æ€ä»£ç†ï¼Œä¸éœ€è¦ä¸Šè½¬å‹ä½¿ç”¨ã€‚ äºŒã€ é€šè¿‡æ³¨è§£æ–¹å¼ æ·»åŠ springåŠ¨æ€ä»£ç†aspectsä¾èµ– \u003c!-- spring-aspects --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-aspects\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e åˆ›å»ºç›®æ ‡æ¥å£ã€ç›®æ ‡æ¥å£å®ç°ç±» ==ä½¿ç”¨Springå®¹å™¨åˆ›å»º== åˆ›å»ºåˆ‡é¢ç±» ==ä½¿ç”¨Springå®¹å™¨åˆ›å»º== å®Œæˆ[åˆ‡é¢]ã€[é€šçŸ¥] åˆ›å»ºç›®æ ‡å¯¹è±¡æ¥å£ã€å®ç°ç±»ã€å®ç°ç±»åŠŸèƒ½ åˆ›å»ºåˆ‡é¢ç±»ï¼Œå†™åˆ‡é¢æ–¹æ³•newMethodï¼Œå£°æ˜é€šçŸ¥æ–¹å¼çš„æ³¨è§£@Before /** * åŠ @Componentï¼Œåˆ‡é¢ç±»éœ€è¦ç”±springåˆ›å»º * åŠ @Aspectï¼Œè¡¨æ˜æ­¤ç±»ä¸ºåˆ‡é¢ç±»ï¼ˆä¸ç”¨æ‰‹åŠ¨å®ç°InvocationHandleræ¥å£ï¼‰ */ @Component @Aspect //@EnableAspectJAutoProxy(proxyTargetClass = true) //åŠ å…¥è¿™è¡Œå¯æ›¿ä»£xmlæ–‡ä»¶ä¸­çš„\u003caop:aspectj-autoproxy/\u003e public class MyAspect { /** * @ Before()ï¼Œå‰ç½®æ³¨è§£ï¼šå…ˆæ‰§è¡Œã€åˆ‡é¢ã€‘å†æ‰§è¡Œã€è¿æ¥ç‚¹ã€‘ * è®¾ç½®pointCutï¼Œè¯´æ˜ä¸å“ªäº›è¿æ¥ç‚¹å…³è” */ @Before(value = \"execution(public void com.bjpn.service.BaseService.service())\") public void newMethod(){ System.out.println(\"serviceå¼€å§‹è¿è¡Œçš„æ—¶é—´: \"+new Date()); } @Around(value = \"execution(* * com.bjpn.service.BaseService.*\") public void newMethod2(ProceedingJoinPoint jp){ System.out.println(\"serviceå¼€å§‹è¿è¡Œçš„æ—¶é—´: \"+new Date()); //æ‰§è¡Œæ–¹æ³• jp.proceed(); System.out.println(\"serviceç»“æŸè¿è¡Œçš„æ—¶é—´: \"+new Date()); } } åœ¨spring.xmlä¸­: é€šçŸ¥Springå®¹å™¨å¯¹è±¡åœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶å…³è”åˆ‡é¢ç±»å¯¹è±¡å’Œä»£ç†å¯¹è±¡ \u003c!--å£°æ˜åˆ›å»ºã€ç›®æ ‡å¯¹è±¡ã€‘å’Œã€ä»£ç†å¯¹è±¡ã€‘--\u003e \u003ccontext:component-scan base-package=\"com.bjpn\"/\u003e \u003c!--é€šçŸ¥springå®¹å™¨å°†åˆ‡é¢ç±»å¯¹è±¡å’Œä»£ç†å¯¹è±¡å…³è”--\u003e \u003caop:aspectj-autoproxy /\u003e \u003c!--å¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸ºcglibä»£ç†æ¨¡å¼ï¼Œä¸éœ€è¦æ¥å£ä¸Šè½¬å‹--\u003e \u003c!--\u003caop:aspectj-autoproxy proxy-target-class=\"true\"/\u003e--\u003e æµ‹è¯•ä½¿ç”¨ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:3","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#3-aopé¢å‘åˆ‡é¢"},{"categories":null,"content":"\rä½¿ç”¨xmlæ–‡ä»¶å’Œæ³¨è§£çš„åŒºåˆ« åŸºäºXMLæ–‡ä»¶ç´¢è¦æœåŠ¡ï¼š ä¼šå¢åŠ é¡¹ç›®çš„å®¹ç§¯ ç›¸å¯¹çµæ´»ã€‚å¯ä»¥è¦æ±‚Springå®¹å™¨å¯¹è±¡å¯¹æŸä¸€ä¸ªç±»è¿›è¡Œå¤šæ¬¡å¯¹è±¡åˆ›å»º åŸºäºAnnotationæ³¨è§£ç´¢è¦æœåŠ¡ï¼š æœ‰æ•ˆå‡å°‘é¡¹ç›®çš„å®¹ç§¯ ç”±æ³¨è§£ç®¡ç†çš„ç±»åªèƒ½åœ¨Springå®¹å™¨å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:4","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨xmlæ–‡ä»¶å’Œæ³¨è§£çš„åŒºåˆ«"},{"categories":null,"content":"\rå…¶ä»–å¸¸ç”¨æ–¹æ³• åœ¨spring.xmlä¸­å¯ä»¥å¯¼å…¥åŒ…å«å…¶ä»–spring.xmlçš„å†…å®¹ï¼šimport resource=\"ApplicationContexxt.xml\" context.getBeanDefinitionCount();è·å–Springå®¹å™¨ä¸­å¯¹è±¡çš„æ•°é‡ context.getBeanDefinitionNames();è·å–Springå®¹å™¨ä¸­æ‰€æœ‰å¯¹è±¡çš„id åœ¨AOPä¸­ String methodName = targetMethod.getSignature().getName();è·å–å½“å‰å…³è”æ–¹æ³•çš„åç§° ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:5","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…¶ä»–å¸¸ç”¨æ–¹æ³•"},{"categories":null,"content":"\rSpringæ¡†æ¶é›†æˆMyBatis MyBatisæä¾›DAOä»£ç†æœåŠ¡ Springå®¹å™¨è´Ÿè´£SqlSessionFactoryã€SqlSessionå¯¹è±¡ã€Daoä»£ç†å¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ– åœ¨Springä¸­ä½¿ç”¨Mybatiså¼€å‘ï¼š ä¸€ã€ æ·»åŠ ä¾èµ– mysql-jdbcçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šConnection / PreparedStatement / ResultSet / Driver mybatisçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šSqlSessionFactoryBuilder / Configuration / SqlSessionFactory / SqlSession mybatis-springçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šæ˜“äº Spring åˆ›å»º SqlSessionFactory å®ç°ç±» / SqlSession å®ç°ç±» druidçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šConnection ï¼ˆä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ï¼Œæ¥è‡ªé˜¿é‡Œå·´å·´ï¼‰ spring-contextçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šClassPathXmlApplication spring-jdbcçš„ä¾èµ–ï¼Œè´Ÿè´£ï¼šspring å’Œ jdbc çš„åè°ƒç®¡ç† \u003cdependency\u003e \u003cgroupId\u003emysql\u003c/groupId\u003e \u003cartifactId\u003emysql-connector-java\u003c/artifactId\u003e \u003cversion\u003e8.0.26\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis\u003c/artifactId\u003e \u003cversion\u003e3.5.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis-spring\u003c/artifactId\u003e \u003cversion\u003e1.3.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003edruid\u003c/artifactId\u003e \u003cversion\u003e1.1.12\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-context\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-jdbc\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e åˆ›å»ºå®ä½“ç±»ã€DAOæ¥å£ã€mapperæ–‡ä»¶ã€mybatis-configæ–‡ä»¶ æœ€å¥½ä¿è¯mapperæ–‡ä»¶åå’ŒDAOç±»åä¸€æ · æœ€å¥½ä¿è¯mapperæ–‡ä»¶å’Œdaoç±»åœ¨åŒä¸€åŒ…ä¸‹ mapperæ–‡ä»¶çš„namespaceå¿…é¡»æ˜¯å¯¹åº”DAOæ¥å£å…¨é™å®šå mapperæ–‡ä»¶ä¸­SQLè¯­å¥çš„IDå¿…é¡»å¯¹åº”DAOæ¥å£çš„æ–¹æ³•å åœ¨mybatis-config.xmlåªéœ€è®¾ç½®åˆ«åå’Œè®¾ç½®å³å¯ åœ¨spring.xmlä¸­: ä½¿ç”¨Springåˆ›å»ºã€DruidDataSourceã€‘æ•°æ®åº“è¿æ¥æ± ç®¡ç†å¯¹è±¡ ä½¿ç”¨Springåˆ›å»ºã€SqlSessionFactoryã€‘å¯¹è±¡ï¼Œé€šè¿‡dataSourceæŒ‡å®šã€Druidã€‘å¯¹è±¡ ä½¿ç”¨Springåˆ›å»ºã€MapperScannerConfigurerã€‘å¯¹è±¡ï¼Œé€šè¿‡ã€SqlSessionFactoryã€‘å¯¹è±¡åˆ›å»ºã€Sqlsessionã€‘å¯¹è±¡ï¼Œåˆ›å»ºã€DAOæ¥å£å®ç°ç±»ã€‘å¯¹è±¡ï¼Œä½¿ç”¨æ—¶ç´¢è¦å³å¯ \u003c!-- ä¸€ã€åˆ›å»ºé…ç½®Druidå¯¹è±¡--\u003e \u003cbean class=\"com.alibaba.druid.pool.DruidDataSource\" id=\"dataSource\"\u003e \u003c!--é€šè¿‡driverClassNameæŒ‡å®šé©±åŠ¨ä½ç½®--\u003e \u003cproperty name=\"driverClassName\" value=\"com.mysql.cj.jdbc.Driver\"/\u003e \u003c!--é…ç½®æ•°æ®åº“å‚æ•°å±æ€§--\u003e \u003cproperty name=\"url\" value=\"jdbc:mysql://localhost:3306/bjpowernode\"/\u003e \u003cproperty name=\"username\" value=\"root\"/\u003e \u003cproperty name=\"password\" value=\"129807\"/\u003e \u003c/bean\u003e \u003c!-- äºŒã€åˆ›å»ºSqlSessionFactoryå¯¹è±¡--\u003e \u003cbean class=\"org.mybatis.spring.SqlSessionFactoryBean\" id=\"sqlSessionFactory\"\u003e \u003c!--é€šè¿‡dataSourceæŒ‡å®šDruidå¯¹è±¡--\u003e \u003cproperty name=\"dataSource\" ref=\"dataSource\"/\u003e \u003c!--é€šè¿‡configLocationæŒ‡å®šmybatisé…ç½®æ–‡ä»¶ä½ç½®--\u003e \u003cproperty name=\"configLocation\" value=\"classpath:mybatis-config.xml\"/\u003e \u003c/bean\u003e \u003c!-- ä¸‰ã€åˆ›å»ºMapperScannerConfigurerå¯¹è±¡--\u003e \u003cbean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\"\u003e \u003c!--ç”ŸæˆSqlSessionå¯¹è±¡--\u003e \u003cproperty name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\"/\u003e \u003c!--æ‰«æåŒ…: ç”ŸæˆDAOæ¥å£å®ç°ç±», ä»¥idä¸ºå°é©¼å³°ç±»åä¿å­˜åœ¨springå®¹å™¨ä¸­--\u003e \u003cproperty name=\"basePackage\" value=\"com.bjpn.dao\"/\u003e \u003c/bean\u003e æµ‹è¯•ä½¿ç”¨ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springæ¡†æ¶é›†æˆmybatis"},{"categories":null,"content":"\rå®ç°äº‹åŠ¡ç®¡ç† ä½¿ç”¨TransactionManageräº‹åŠ¡ç®¡ç†ç±»çš„å®ç°ç±»ï¼šDataSourceTransactionManager Springå®¹å™¨ä½¿ç”¨AOPæœåŠ¡å°†TransactionManagerä½œä¸ºåˆ‡é¢ç±»ä¸è¿æ¥ç‚¹ï¼ˆserviceæ–¹æ³•ï¼‰è¿›è¡Œç»‘å®š åœ¨Springä¸­ä½¿ç”¨Mybatiså®ç°äº‹åŠ¡ç®¡ç†ï¼š ä¸€ã€é€šè¿‡XMLæ–¹æ³•ï¼š æ·»åŠ ä¾èµ– \u003c!--äº‹åŠ¡ç®¡ç†ä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-tx\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e \u003c!--åŠ¨æ€ä»£ç†çš„ä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-aspects\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e åˆ›å»ºmybatisè¿è¡Œç¯å¢ƒï¼Œserviceæ¥å£ï¼Œç¼–å†™æ¥å£å®ç°ç±» åœ¨spring.xmlä¸­æ·»åŠ  \u003c!--å£°æ˜äº‹åŠ¡ç®¡ç†å™¨--\u003e \u003cbean class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\" id=\"transactionManager\"\u003e \u003c!--æŒ‡å®šæ•°æ®åº“è¿æ¥æ± --\u003e \u003cproperty name=\"dataSource\" ref=\"dataSource\"/\u003e \u003c/bean\u003e \u003c!--é€šçŸ¥springå®¹å™¨å¯¹è±¡å“ªä¸ªæ˜¯æä¾›äº‹åŠ¡æœåŠ¡çš„å¯¹è±¡ äº‹åŠ¡ç®¡ç†å™¨--\u003e \u003ctx:advice transaction-manager=\"transactionManager\" id=\"transactionInterceptor\"\u003e \u003ctx:attributes\u003e \u003c!--æŒ‡å®šæ–¹æ³•çš„äº‹åŠ¡å±æ€§ name:æ–¹æ³•åç§° isolationï¼šéš”ç¦»çº§åˆ« propagationï¼šä¼ æ’­è¡Œä¸º rollback-forï¼šå›æ»šçš„å¼‚å¸¸ç±»ï¼Œ å¯¹äºè‡ªå®šä¹‰çš„å¼‚å¸¸è¦ä½¿ç”¨å…¨é™å®šåç§°ï¼Œç³»ç»Ÿçš„å¼‚å¸¸ç±»å¯ä»¥åç§° --\u003e \u003ctx:method name=\"save*\" isolation=\"DEFAULT\" propagation=\"REQUIRED\" rollback-for=\"com.bjpn.crm.exception.AjaxRequestException, com.bjpn.crm.exception.TraditionRequestException\" /\u003e \u003c/tx:attributes\u003e \u003c/tx:advice\u003e \u003c!--é€šçŸ¥springå®¹å™¨å¯¹è±¡, ç›®æ ‡æ–¹æ³•ï¼Œä½ç½®--\u003e \u003caop:config\u003e \u003c!--ç»‘å®šåˆ‡å…¥ç‚¹ï¼šä»»æ„è¿”å›å€¼ç±»å‹ï¼ŒserviceåŒ…ä¸‹æ‰€æœ‰æ¥å£ä¸‹çš„æ‰€æœ‰ç±»ï¼Œæ‰€æœ‰æœ‰æ— å‚æ•°çš„ç±»--\u003e \u003caop:pointcut id=\"myPointCut\" expression=\"execution(* com.bjpn.service.*.*(..))\"/\u003e \u003c!--ç»‘å®šå®¹å™¨å¯¹è±¡å’Œåˆ‡å…¥ç‚¹--\u003e \u003caop:advisor advice-ref=\"transactionInterceptor\" pointcut-ref=\"myPointCut\"/\u003e \u003c/aop:config\u003e æµ‹è¯•ä½¿ç”¨ äºŒã€é€šè¿‡æ³¨è§£æ–¹å¼ï¼š æ·»åŠ ä¾èµ– \u003c!--springframeworkäº‹åŠ¡ç®¡ç†--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-tx\u003c/artifactId\u003e \u003cversion\u003e4.3.16.RELEASE\u003c/version\u003e \u003c/dependency\u003e åœ¨éœ€è¦ä½¿ç”¨äº‹åŠ¡çš„è¿æ¥ç‚¹ï¼ˆserviceæ–¹æ³•ï¼‰ä¸Šå£°æ˜@Transactionalæ³¨è§£ æ³¨è§£å‘springå®¹å™¨ç´¢è¦transactionalManager ç”±transactionalManageræ‰®æ¼”åˆ‡é¢ç±»ï¼Œç®¡ç†äº‹åŠ¡ åœ¨spring.xmlä¸­ \u003c!--å£°æ˜äº‹åŠ¡ç®¡ç†å™¨--\u003e \u003cbean class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\" id=\"transactionManager\"\u003e \u003c!--æŒ‡å®šä¸Šæ–¹å£°æ˜å¥½çš„æ•°æ®åº“è¿æ¥æ± --\u003e \u003cproperty name=\"dataSource\" ref=\"dataSource\"/\u003e \u003c/bean\u003e \u003c!--æ³¨è§£é©±åŠ¨ï¼šä¸ºæ‰€æœ‰å£°æ˜äº†@Transactionalçš„æ–¹æ³•ç»‘å®šæä¾›äº‹åŠ¡ç®¡ç†æœåŠ¡--\u003e \u003ctx:annotation-driven transaction-manager=\"transactionManager\"/\u003e æµ‹è¯•ä½¿ç”¨ ä½¿ç”¨XMlæ–‡ä»¶ä¸æ³¨è§£çš„åŒºåˆ« ä½¿ç”¨æ³¨è§£çš„æ–¹å¼éœ€è¦åœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ä¸Šéƒ½æ·»åŠ æ³¨è§£ï¼ˆé‡å¤æ€§å¼€å‘ï¼‰ æ¨èä½¿ç”¨xmlï¼Œä¸€æ¬¡ç¼–å†™è®©æ‰€æœ‰ä¸šåŠ¡åŠ ä¸Šäº‹åŠ¡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:1","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å®ç°äº‹åŠ¡ç®¡ç†"},{"categories":null,"content":"\råœ¨WEBé¡¹ç›®ä¸­ä½¿ç”¨spring ä¸èƒ½ç”¨springå®¹å™¨æ¥åˆ›å»ºservlerå¯¹è±¡ ä½¿ç”¨springå®¹å™¨åˆ›å»ºserviceå¯¹è±¡ ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åœ¨webé¡¹ç›®ä¸­ä½¿ç”¨spring"},{"categories":null,"content":"\rçµæ´»è¿ç”¨ç›‘å¬å™¨ åœ¨WEBé¡¹ç›®ä¸­ä½¿ç”¨ContextLoaderListenerç›‘å¬å™¨å°†springå®¹å™¨å¯¹è±¡å­˜åœ¨å…¨å±€ä½œç”¨åŸŸå¯¹è±¡ä¸­ æ·»åŠ ä¾èµ– \u003c!--spring-web springæä¾›çš„ç›‘å¬å™¨ä¾èµ–--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-web\u003c/artifactId\u003e \u003cversion\u003e5.3.9\u003c/version\u003e \u003c/dependency\u003e åœ¨web.xmlä¸­æ ‡ç­¾ä¸­æŒ‡å®šspring.xmlçš„ä½ç½®ï¼ŒContextLoaderListenerå°±æŒ‰ç…§è¿™ä¸ªæ–‡ä»¶åˆ›å»ºspringå®¹å™¨ \u003c!--æŒ‡å®šspring.xmlæ–‡ä»¶ä½ç½®ï¼Œç¡®ä¿ç›‘å¬å™¨è¯»å–çš„ä¸æ˜¯é»˜è®¤çš„web-infä¸‹çš„applicationContext.xmlæ–‡ä»¶--\u003e \u003ccontext-param\u003e \u003cparam-name\u003econtextConfigLocation\u003c/param-name\u003e \u003cparam-value\u003eclasspath:spring.xml\u003c/param-value\u003e \u003c/context-param\u003e è®©ç›‘å¬å™¨åŒæ—¶ç»§æ‰¿ContextLoaderListenerç±» public class LoaderListener extends ContextLoaderListener implements ServletContextListener{ /** * initWebApplicationContextæ–¹æ³•ï¼šå¦‚æœå…¨å±€ä½œç”¨åŸŸå¯¹è±¡ä¸­ä¸å­˜åœ¨springå®¹å™¨å¯¹è±¡ï¼Œé‚£ä¹ˆå°±åˆ›å»ºå®ƒ */ @Override public WebApplicationContext initWebApplicationContext(ServletContext servletContext) { return super.initWebApplicationContext(servletContext); } @Override public void contextInitialized(ServletContextEvent sce) { initWebApplicationContext(sce.getServletContext()); } } åœ¨éœ€è¦ç”¨åˆ°springå®¹å™¨çš„ä½ç½®ï¼ˆServlet æ§åˆ¶å™¨ï¼‰é€šè¿‡å…¨å±€ä½œç”¨åŸŸå¯¹è±¡è·å– ApplicationContext context = (ApplicationContext) req.getServletContext().getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE); ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:1","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#çµæ´»è¿ç”¨ç›‘å¬å™¨"},{"categories":null,"content":"\ré‡åˆ°çš„é—®é¢˜ åœ¨jspæ–‡ä»¶ä¸­æ— æ³•ä½¿ç”¨elè¡¨è¾¾å¼ åœ¨pageæŒ‡ä»¤ä¸­æ·»åŠ  isELIgnored=\"false\" ","date":"2021-09-14","objectID":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"Springè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/spring%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°çš„é—®é¢˜"},{"categories":null,"content":"\rMyBatisè‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® 2021-08-22 ç¬”è®°æ‘˜è‡ªé“¾æ¥ï¼šhttps://www.bilibili.com/video/BV1NE411Q7Nx ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:0:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#mybatisè‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯MyBatisï¼š ä¸€ä¸ªä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ æ”¯æŒå®šåˆ¶åŒ–SQLï¼Œå­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ é¿å…äº†å‡ ä¹æ‰€æœ‰çš„JDBCä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›† MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’ŒJava POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½• ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:1:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä»€ä¹ˆæ˜¯mybatis"},{"categories":null,"content":"\rMyBatisçš„ç‰¹ç‚¹ï¼š ç®€å•æ˜“å­¦ã€‚ çµæ´»ã€‚ è§£é™¤sqlä¸ç¨‹åºä»£ç çš„è€¦åˆã€‚ æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„ormå­—æ®µ\"å¯¹è±¡-å…³ç³»æ˜ å°„\"ï¼ˆObject/Relational Mappingï¼‰å…³ç³»æ˜ å°„ã€‚ æä¾›å¯¹è±¡å…³ç³»æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡å…³ç³»ç»„å»ºç»´æŠ¤ã€‚ æä¾›xmlæ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€sqlã€‚ ç¼ºç‚¹ï¼šsqlè¯­å¥ä¾èµ–äºæ•°æ®åº“,ä¸èƒ½éšæ„çš„æ›´æ¢æ•°æ®åº“,ç§»æ¤æ€§å·® ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:2:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#mybatisçš„ç‰¹ç‚¹"},{"categories":null,"content":"\rIDEAä¸­ä½¿ç”¨mavenåˆ›å»ºMyBatisé¡¹ç›®ï¼š çˆ¶å·¥ç¨‹ï¼ˆmybatisProjectï¼‰ä¸­åˆ›å»ºé…ç½®å¥½çš„ä¾èµ–ä¼šåœ¨å­æ¨¡å—ï¼ˆmybatis-01ï¼‰ä¸­è¢«ç»§æ‰¿ åˆ›å»ºmavenåœ¨pom.xmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–ï¼Œmybatisçš„ä¾èµ–ã€‚ \u003c!-- MyBatisçš„ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis\u003c/artifactId\u003e \u003cversion\u003e3.4.6\u003c/version\u003e \u003c/dependency\u003e åœ¨æ¨¡å—src\\main\\resourcesç›®å½•ä¸‹åˆ›å»ºmybatis-config.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e \u003c!--æ ¸å¿ƒé…ç½®æ–‡ä»¶--\u003e \u003cconfiguration\u003e \u003cenvironments default=\"development\"\u003e \u003cenvironment id=\"development\"\u003e \u003ctransactionManager type=\"JDBC\"/\u003e \u003cdataSource type=\"POOLED\"\u003e \u003cproperty name=\"driver\" value=\"com.mysql.cj.jdbc.Driver\"/\u003e \u003cproperty name=\"url\" value=\"jdbc:mysql://localhost:3306/mybatis?useSSL=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf-8\"/\u003e \u003cproperty name=\"username\" value=\"root\"/\u003e \u003cproperty name=\"password\" value=\"129807\"/\u003e \u003c/dataSource\u003e \u003c/environment\u003e \u003c/environments\u003e \u003c!--æ³¨å†Œmapper, æ¯ä¸€ä¸ªmapper.xmléƒ½éœ€è¦åœ¨MyBatisæ ¸å¿ƒé…ç½®ä¸­æ³¨å†Œ--\u003e \u003cmappers\u003e \u003cmapper resource=\"com/kuang/dao/UserMapper.xml\"/\u003e \u003c/mappers\u003e \u003c/configuration\u003e åœ¨utilsåŒ…ä¸‹å°è£…MybatisUtilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ /** * sqlSessionFactory --\u003e sqlSession å·¥å…·ç±» * @author åˆ˜å˜‰å® */ public class MybatisUtils { private static SqlSessionFactory sqlSessionFactory = null; static{ try { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); } catch (Exception e) { e.printStackTrace(); } } /** * sqlSessionä¸­åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³• */ public static SqlSession getSqlSession(){ //openSession(true) è‡ªåŠ¨æäº¤äº‹åŠ¡ return sqlSessionFactory.openSession(); } } åœ¨daoåŒ…ä¸‹æ ¹æ®DAOæ¥å£åˆ›å»ºMapperçš„xmlæ–‡ä»¶å†…å®¹ /** * userè¡¨çš„DAOæ¥å£(æä¾›æ•°æ®åº“è®¿é—®å¯¹è±¡) * @author åˆ˜å˜‰å® */ public interface UserDao { /** * æŸ¥è¯¢userè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯çš„æ–¹æ³• * @return ç”¨æˆ·çš„Listé›†åˆ */ List\u003cUser\u003e getUserList(); } \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e \u003c!--namespace: ç»‘å®šä¸€ä¸ªå¯¹åº”çš„Dao/Mapperæ¥å£--\u003e \u003cmapper namespace=\"com.kuang.dao.UserDao\"\u003e \u003c!--id: namespaceä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œ resultType: è¿”å›ç±»å‹--\u003e \u003cselect id=\"getUserList\" resultType=\"com.kuang.pojo.User\"\u003e select * from åº“.user; \u003c/select\u003e \u003c/mapper\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ideaä¸­ä½¿ç”¨mavenåˆ›å»ºmybatisé¡¹ç›®"},{"categories":null,"content":"\rIDEAä¸­ä½¿ç”¨mavenåˆ›å»ºMyBatisé¡¹ç›®ï¼š çˆ¶å·¥ç¨‹ï¼ˆmybatisProjectï¼‰ä¸­åˆ›å»ºé…ç½®å¥½çš„ä¾èµ–ä¼šåœ¨å­æ¨¡å—ï¼ˆmybatis-01ï¼‰ä¸­è¢«ç»§æ‰¿ åˆ›å»ºmavenåœ¨pom.xmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–ï¼Œmybatisçš„ä¾èµ–ã€‚ org.mybatis mybatis 3.4.6 åœ¨æ¨¡å—src\\main\\resourcesç›®å½•ä¸‹åˆ›å»ºmybatis-config.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e åœ¨utilsåŒ…ä¸‹å°è£…MybatisUtilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ /** * sqlSessionFactory --\u003e sqlSession å·¥å…·ç±» * @author åˆ˜å˜‰å® */ public class MybatisUtils { private static SqlSessionFactory sqlSessionFactory = null; static{ try { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); } catch (Exception e) { e.printStackTrace(); } } /** * sqlSessionä¸­åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³• */ public static SqlSession getSqlSession(){ //openSession(true) è‡ªåŠ¨æäº¤äº‹åŠ¡ return sqlSessionFactory.openSession(); } } åœ¨daoåŒ…ä¸‹æ ¹æ®DAOæ¥å£åˆ›å»ºMapperçš„xmlæ–‡ä»¶å†…å®¹ /** * userè¡¨çš„DAOæ¥å£(æä¾›æ•°æ®åº“è®¿é—®å¯¹è±¡) * @author åˆ˜å˜‰å® */ public interface UserDao { /** * æŸ¥è¯¢userè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯çš„æ–¹æ³• * @return ç”¨æˆ·çš„Listé›†åˆ */ List getUserList(); } \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e select * from åº“.user; ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åˆ›å»ºmavenåœ¨pomxmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–mybatisçš„ä¾èµ–"},{"categories":null,"content":"\rIDEAä¸­ä½¿ç”¨mavenåˆ›å»ºMyBatisé¡¹ç›®ï¼š çˆ¶å·¥ç¨‹ï¼ˆmybatisProjectï¼‰ä¸­åˆ›å»ºé…ç½®å¥½çš„ä¾èµ–ä¼šåœ¨å­æ¨¡å—ï¼ˆmybatis-01ï¼‰ä¸­è¢«ç»§æ‰¿ åˆ›å»ºmavenåœ¨pom.xmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–ï¼Œmybatisçš„ä¾èµ–ã€‚ org.mybatis mybatis 3.4.6 åœ¨æ¨¡å—src\\main\\resourcesç›®å½•ä¸‹åˆ›å»ºmybatis-config.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e åœ¨utilsåŒ…ä¸‹å°è£…MybatisUtilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ /** * sqlSessionFactory --\u003e sqlSession å·¥å…·ç±» * @author åˆ˜å˜‰å® */ public class MybatisUtils { private static SqlSessionFactory sqlSessionFactory = null; static{ try { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); } catch (Exception e) { e.printStackTrace(); } } /** * sqlSessionä¸­åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³• */ public static SqlSession getSqlSession(){ //openSession(true) è‡ªåŠ¨æäº¤äº‹åŠ¡ return sqlSessionFactory.openSession(); } } åœ¨daoåŒ…ä¸‹æ ¹æ®DAOæ¥å£åˆ›å»ºMapperçš„xmlæ–‡ä»¶å†…å®¹ /** * userè¡¨çš„DAOæ¥å£(æä¾›æ•°æ®åº“è®¿é—®å¯¹è±¡) * @author åˆ˜å˜‰å® */ public interface UserDao { /** * æŸ¥è¯¢userè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯çš„æ–¹æ³• * @return ç”¨æˆ·çš„Listé›†åˆ */ List getUserList(); } \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e select * from åº“.user; ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åœ¨æ¨¡å—srcmainresourcesç›®å½•ä¸‹åˆ›å»ºmybatis-configxmlé…ç½®æ–‡ä»¶"},{"categories":null,"content":"\rIDEAä¸­ä½¿ç”¨mavenåˆ›å»ºMyBatisé¡¹ç›®ï¼š çˆ¶å·¥ç¨‹ï¼ˆmybatisProjectï¼‰ä¸­åˆ›å»ºé…ç½®å¥½çš„ä¾èµ–ä¼šåœ¨å­æ¨¡å—ï¼ˆmybatis-01ï¼‰ä¸­è¢«ç»§æ‰¿ åˆ›å»ºmavenåœ¨pom.xmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–ï¼Œmybatisçš„ä¾èµ–ã€‚ org.mybatis mybatis 3.4.6 åœ¨æ¨¡å—src\\main\\resourcesç›®å½•ä¸‹åˆ›å»ºmybatis-config.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e åœ¨utilsåŒ…ä¸‹å°è£…MybatisUtilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ /** * sqlSessionFactory --\u003e sqlSession å·¥å…·ç±» * @author åˆ˜å˜‰å® */ public class MybatisUtils { private static SqlSessionFactory sqlSessionFactory = null; static{ try { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); } catch (Exception e) { e.printStackTrace(); } } /** * sqlSessionä¸­åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³• */ public static SqlSession getSqlSession(){ //openSession(true) è‡ªåŠ¨æäº¤äº‹åŠ¡ return sqlSessionFactory.openSession(); } } åœ¨daoåŒ…ä¸‹æ ¹æ®DAOæ¥å£åˆ›å»ºMapperçš„xmlæ–‡ä»¶å†…å®¹ /** * userè¡¨çš„DAOæ¥å£(æä¾›æ•°æ®åº“è®¿é—®å¯¹è±¡) * @author åˆ˜å˜‰å® */ public interface UserDao { /** * æŸ¥è¯¢userè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯çš„æ–¹æ³• * @return ç”¨æˆ·çš„Listé›†åˆ */ List getUserList(); } \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e select * from åº“.user; ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åœ¨utilsåŒ…ä¸‹å°è£…mybatisutilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶"},{"categories":null,"content":"\rIDEAä¸­ä½¿ç”¨mavenåˆ›å»ºMyBatisé¡¹ç›®ï¼š çˆ¶å·¥ç¨‹ï¼ˆmybatisProjectï¼‰ä¸­åˆ›å»ºé…ç½®å¥½çš„ä¾èµ–ä¼šåœ¨å­æ¨¡å—ï¼ˆmybatis-01ï¼‰ä¸­è¢«ç»§æ‰¿ åˆ›å»ºmavenåœ¨pom.xmlä¸­æ·»åŠ mysqlé©±åŠ¨çš„ä¾èµ–ï¼Œmybatisçš„ä¾èµ–ã€‚ org.mybatis mybatis 3.4.6 åœ¨æ¨¡å—src\\main\\resourcesç›®å½•ä¸‹åˆ›å»ºmybatis-config.xmlé…ç½®æ–‡ä»¶ \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e åœ¨utilsåŒ…ä¸‹å°è£…MybatisUtilså·¥å…·ç±»è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ /** * sqlSessionFactory --\u003e sqlSession å·¥å…·ç±» * @author åˆ˜å˜‰å® */ public class MybatisUtils { private static SqlSessionFactory sqlSessionFactory = null; static{ try { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); } catch (Exception e) { e.printStackTrace(); } } /** * sqlSessionä¸­åŒ…å«äº†é¢å‘æ•°æ®åº“æ‰§è¡Œsqlå‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³• */ public static SqlSession getSqlSession(){ //openSession(true) è‡ªåŠ¨æäº¤äº‹åŠ¡ return sqlSessionFactory.openSession(); } } åœ¨daoåŒ…ä¸‹æ ¹æ®DAOæ¥å£åˆ›å»ºMapperçš„xmlæ–‡ä»¶å†…å®¹ /** * userè¡¨çš„DAOæ¥å£(æä¾›æ•°æ®åº“è®¿é—®å¯¹è±¡) * @author åˆ˜å˜‰å® */ public interface UserDao { /** * æŸ¥è¯¢userè¡¨ä¸­æ‰€æœ‰ä¿¡æ¯çš„æ–¹æ³• * @return ç”¨æˆ·çš„Listé›†åˆ */ List getUserList(); } \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e select * from åº“.user; ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:3:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åœ¨daoåŒ…ä¸‹æ ¹æ®daoæ¥å£åˆ›å»ºmapperçš„xmlæ–‡ä»¶å†…å®¹"},{"categories":null,"content":"\rå¢åˆ æ”¹çš„å®ç°ï¼š ç¼–å†™æ¥å£æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† /** * æ·»åŠ ç”¨æˆ· * @param user ç”¨æˆ· * @return æ·»åŠ æˆåŠŸæ¡æ•° 1:æˆåŠŸ 0:å¤±è´¥ */ int addUser(User user); ç¼–å†™å¯¹åº”çš„Mapper.xmlä¸­çš„è¯­å¥æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† \u003c!--id: namespaceä¸­å¯¹åº”çš„æ–¹æ³•, parameter: å½¢å‚ç±»å‹--\u003e \u003cinsert id=\"addUser\" parameterType=\"com.kuang.pojo.User\"\u003e insert into mybatis.user (id, name, pwd) values(#{id}, #{name}, #{pwd}); \u003c/insert\u003e æµ‹è¯•ä½¿ç”¨æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† @Test public void addUserTest() { SqlSession sqlSession = null; try { sqlSession = MyBatisUtils.getSqlSession(); UserDao mapper = sqlSession.getMapper(UserDao.class); int res = mapper.addUser(new User(5, \"mike\", \"mike123\")); if (res == 1){ System.out.println(\"æ·»åŠ æˆåŠŸ\"); }else { System.out.println(\"æ·»åŠ å¤±è´¥\"); } } catch (Exception e) { e.printStackTrace(); } finally { //å¢åˆ æ”¹æ—¶æ³¨æ„æäº¤äº‹åŠ¡!! sqlSession.commit(); sqlSession.close(); } } ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å¢åˆ æ”¹çš„å®ç°"},{"categories":null,"content":"\rå¢åˆ æ”¹çš„å®ç°ï¼š ç¼–å†™æ¥å£æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† /** * æ·»åŠ ç”¨æˆ· * @param user ç”¨æˆ· * @return æ·»åŠ æˆåŠŸæ¡æ•° 1:æˆåŠŸ 0:å¤±è´¥ */ int addUser(User user); ç¼–å†™å¯¹åº”çš„Mapper.xmlä¸­çš„è¯­å¥æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† insert into mybatis.user (id, name, pwd) values(#{id}, #{name}, #{pwd}); æµ‹è¯•ä½¿ç”¨æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† @Test public void addUserTest() { SqlSession sqlSession = null; try { sqlSession = MyBatisUtils.getSqlSession(); UserDao mapper = sqlSession.getMapper(UserDao.class); int res = mapper.addUser(new User(5, \"mike\", \"mike123\")); if (res == 1){ System.out.println(\"æ·»åŠ æˆåŠŸ\"); }else { System.out.println(\"æ·»åŠ å¤±è´¥\"); } } catch (Exception e) { e.printStackTrace(); } finally { //å¢åˆ æ”¹æ—¶æ³¨æ„æäº¤äº‹åŠ¡!! sqlSession.commit(); sqlSession.close(); } } ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç¼–å†™æ¥å£"},{"categories":null,"content":"\rå¢åˆ æ”¹çš„å®ç°ï¼š ç¼–å†™æ¥å£æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† /** * æ·»åŠ ç”¨æˆ· * @param user ç”¨æˆ· * @return æ·»åŠ æˆåŠŸæ¡æ•° 1:æˆåŠŸ 0:å¤±è´¥ */ int addUser(User user); ç¼–å†™å¯¹åº”çš„Mapper.xmlä¸­çš„è¯­å¥æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† insert into mybatis.user (id, name, pwd) values(#{id}, #{name}, #{pwd}); æµ‹è¯•ä½¿ç”¨æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† @Test public void addUserTest() { SqlSession sqlSession = null; try { sqlSession = MyBatisUtils.getSqlSession(); UserDao mapper = sqlSession.getMapper(UserDao.class); int res = mapper.addUser(new User(5, \"mike\", \"mike123\")); if (res == 1){ System.out.println(\"æ·»åŠ æˆåŠŸ\"); }else { System.out.println(\"æ·»åŠ å¤±è´¥\"); } } catch (Exception e) { e.printStackTrace(); } finally { //å¢åˆ æ”¹æ—¶æ³¨æ„æäº¤äº‹åŠ¡!! sqlSession.commit(); sqlSession.close(); } } ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç¼–å†™å¯¹åº”çš„mapperxmlä¸­çš„è¯­å¥"},{"categories":null,"content":"\rå¢åˆ æ”¹çš„å®ç°ï¼š ç¼–å†™æ¥å£æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† /** * æ·»åŠ ç”¨æˆ· * @param user ç”¨æˆ· * @return æ·»åŠ æˆåŠŸæ¡æ•° 1:æˆåŠŸ 0:å¤±è´¥ */ int addUser(User user); ç¼–å†™å¯¹åº”çš„Mapper.xmlä¸­çš„è¯­å¥æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† insert into mybatis.user (id, name, pwd) values(#{id}, #{name}, #{pwd}); æµ‹è¯•ä½¿ç”¨æ·»åŠ ï¼šåˆ é™¤ä¿®æ”¹åŒç† @Test public void addUserTest() { SqlSession sqlSession = null; try { sqlSession = MyBatisUtils.getSqlSession(); UserDao mapper = sqlSession.getMapper(UserDao.class); int res = mapper.addUser(new User(5, \"mike\", \"mike123\")); if (res == 1){ System.out.println(\"æ·»åŠ æˆåŠŸ\"); }else { System.out.println(\"æ·»åŠ å¤±è´¥\"); } } catch (Exception e) { e.printStackTrace(); } finally { //å¢åˆ æ”¹æ—¶æ³¨æ„æäº¤äº‹åŠ¡!! sqlSession.commit(); sqlSession.close(); } } ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:4:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#æµ‹è¯•ä½¿ç”¨"},{"categories":null,"content":"\ræ¨¡ç³ŠæŸ¥è¯¢å®ç°æ–¹å¼ï¼š åœ¨javaæ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œä¼ é€’é€šé…ç¬¦% % HashMap\u003cString, Object\u003e map = new HashMap\u003c\u003e(); map.put(\"userName\", \"%ç‹%\"); åœ¨sqlæ‹¼æ¥ä¸­ä½¿ç”¨é€šé…ç¬¦ select * from mybatis.user where name like \"%\"#{userName}\"%\"; ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:5:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#æ¨¡ç³ŠæŸ¥è¯¢å®ç°æ–¹å¼"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value \u003c!--å±æ€§: å®ç°å¼•ç”¨å¤–ç½®é…ç½®æ–‡ä»¶ï¼ˆä¼˜å…ˆï¼‰--\u003e \u003cproperties resource=\"db.properties\"\u003e \u003c!--åœ¨å…¶ä¸­å¢åŠ å±æ€§é…ç½®--\u003e \u003cproperty name=\"driver\" value=\"com.mysql.cj.jdbc.Driver\"/\u003e \u003c/properties\u003e åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ \u003c!--åˆ«å--\u003e \u003ctypeAliases\u003e \u003c!--ä¸ºå®ä½“ç±»èµ·åˆ«å--\u003e \u003ctypeAlias type=\"com.kuang.pojo.User\" alias=\"User\" /\u003e \u003c!--ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™--\u003e \u003cpackage name=\"com.kuang.pojo\" /\u003e \u003c/typeAliases\u003e åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº \u003c!--ç¯å¢ƒé…ç½®--\u003e \u003cenvironments default=\"development\"\u003e \u003cenvironment id=\"development\"\u003e \u003c!--äº‹åŠ¡ç®¡ç†å™¨ï¼šJDBC/MANAGED--\u003e \u003ctransactionManager type=\"JDBC\"/\u003e \u003c!--æ•°æ®æºï¼šUNPOOLEDæ²¡æœ‰æ± /POOLEDæœ‰æ± /UNDI--\u003e \u003cdataSource type=\"POOLED\"\u003e \u003cproperty name=\"driver\" value=\"${driver}\"/\u003e \u003cproperty name=\"url\" value=\"${url}\"/\u003e \u003cproperty name=\"username\" value=\"${username}\"/\u003e \u003cproperty name=\"password\" value=\"${password}\"/\u003e \u003c/dataSource\u003e \u003c/environment\u003e \u003c/environments\u003e æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ \u003c!--æ³¨å†Œmapper, æ¯ä¸€ä¸ªmapper.xmléƒ½éœ€è¦åœ¨MyBatisæ ¸å¿ƒé…ç½®ä¸­æ³¨å†Œ--\u003e \u003cmappers\u003e \u003cmapper resource=\"com/kuang/dao/UserMapper.xml\"/\u003e \u003c/mappers\u003e æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ \u003c!--æ³¨å†Œmapper, æ¯ä¸€ä¸ªmapper.xmléƒ½éœ€è¦åœ¨MyBatisæ ¸å¿ƒé…ç½®ä¸­æ³¨å†Œ--\u003e \u003cmappers\u003e \u003cmapper class=\"com.kuang.dao.UserMapper\"/\u003e \u003c/mappers\u003e æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ \u003cmappers\u003e \u003cpackage name=\"com.bjpn.crm.settings.dao\"/\u003e \u003c/mappers\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#mybatis-configxmlæ ¸å¿ƒé…ç½®æ–‡ä»¶"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å±æ€§"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åˆ«å"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#è®¾ç½®"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç¯å¢ƒ"},{"categories":null,"content":"\rmybatis-config.xmlæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š å±æ€§ï¼š å¯ä»¥å®ç°å¤–éƒ¨é…ç½®æ–‡ä»¶çš„å¼•ç”¨ã€‚ resourceå¼•ç”¨çš„.propertiesé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§é«˜ï¼Œå±æ€§é…ç½®æ ‡ç­¾ä¸­èµ·åˆ°è¡¥å……é…ç½®çš„ä½œç”¨ä¼˜å…ˆçº§ä½ã€‚ å±æ€§é…ç½®ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨ä¸‹æ–‡ä½¿ç”¨${ å±æ€§çš„name }å¼•ç”¨åˆ°å…¶value åˆ«åï¼š ä¸ºjavaç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åˆ«å ä¸ºåŒ…èµ·åˆ«åï¼Œé»˜è®¤åæ˜¯åŒ…ä¸­çš„ç±»åé¦–å­—æ¯å°å†™ åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å¯ä»¥ä»£æ›¿ç¬¬ä¸€ç§æ–¹å¼ï¼š @Alias(\"user\") public class User{ ... } ä¸€äº›javaåˆ›å»ºçš„ç±»å‹éƒ½æœ‰é»˜è®¤åˆ«å: int â€“\u003e _int Integer â€“\u003e int Map â€“\u003e map è®¾ç½®ï¼š å®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸º, å¸¸ç”¨è®¾ç½®ï¼š è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ cacheEnabled å…¨å±€æ€§åœ°å¼€å¯æˆ–å…³é—­æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ã€‚ true | false true lazyLoadingEnabled å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® fetchType å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚ true | false false useGeneratedKeys å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦æ•°æ®åº“é©±åŠ¨æ”¯æŒã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œå°†å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚å°½ç®¡ä¸€äº›æ•°æ®åº“é©±åŠ¨ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼Œä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆå¦‚ Derbyï¼‰ã€‚ true | false False mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN æ˜ å°„åˆ°ç»å…¸ Java å±æ€§å aColumnã€‚ true | false False logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® ç¯å¢ƒï¼š æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ æŒ‡å®šæ•°æ®æº æ˜ å°„ï¼šæ˜ å°„ï¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶ æ–¹å¼ä¸€ï¼šä½¿ç”¨è·¯å¾„ç»‘å®šxmlæ–‡ä»¶ æ–¹å¼äºŒï¼šä½¿ç”¨classæ–‡ä»¶ç»‘å®š æ³¨æ„1ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åŒå æ³¨æ„2ï¼šæ¥å£å’Œå®ƒçš„Mapperé…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ æ–¹å¼ä¸‰ï¼špackageæ ‡ç­¾ å®šä½åˆ°åŒ…ä¸‹ï¼Œä¿è¯mapperæ–‡ä»¶åœ¨daoåŒ…ä¸‹ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:6:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#æ˜ å°„"},{"categories":null,"content":"\rç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼š MyBatisæ‰§è¡ŒåŸç†ï¼šç¨‹åºé€šè¿‡mybatis-config.xmlæ–‡ä»¶é€šè¿‡SqlSessionFactoryBuilderå»ºé€ SqlSessionFactoryå¾—åˆ°SqlSessionå¯¹è±¡ï¼Œé€šè¿‡åå°„åŠ¨æ€ä»£ç†å‡ºæ¥å£çš„mapperå¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚ SqlSessionFactoryBuilderï¼š ç”±ç”¨æˆ·åˆ›å»ºï¼Œåœ¨æ‰§è¡Œå®Œbuildï¼ˆï¼‰æ–¹æ³•åè‡ªåŠ¨é”€æ¯ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ±  ç”±SqlSessionFactoryBuilderåˆ›å»ºï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€é™æ€å•ä¾‹æ¨¡å¼ï¼Œæœ€ä½³ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ SqlSession ç›¸å½“äºè¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½å…±äº« åœ¨ä½¿ç”¨æ—¶è¢«åˆ›å»ºï¼Œåå°„å‡ºmapperå¯¹è±¡ï¼Œæäº¤äº‹åŠ¡åè¢«æ‰‹åŠ¨å…³é—­é”€æ¯ æœ€ä½³ä½œç”¨åŸŸä¸ºè¯·æ±‚æ—¶æˆ–ä½¿ç”¨æ—¶çš„æ–¹æ³•å†… ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ"},{"categories":null,"content":"\rç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼š MyBatisæ‰§è¡ŒåŸç†ï¼šç¨‹åºé€šè¿‡mybatis-config.xmlæ–‡ä»¶é€šè¿‡SqlSessionFactoryBuilderå»ºé€ SqlSessionFactoryå¾—åˆ°SqlSessionå¯¹è±¡ï¼Œé€šè¿‡åå°„åŠ¨æ€ä»£ç†å‡ºæ¥å£çš„mapperå¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚ SqlSessionFactoryBuilderï¼š ç”±ç”¨æˆ·åˆ›å»ºï¼Œåœ¨æ‰§è¡Œå®Œbuildï¼ˆï¼‰æ–¹æ³•åè‡ªåŠ¨é”€æ¯ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ±  ç”±SqlSessionFactoryBuilderåˆ›å»ºï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€é™æ€å•ä¾‹æ¨¡å¼ï¼Œæœ€ä½³ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ SqlSession ç›¸å½“äºè¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½å…±äº« åœ¨ä½¿ç”¨æ—¶è¢«åˆ›å»ºï¼Œåå°„å‡ºmapperå¯¹è±¡ï¼Œæäº¤äº‹åŠ¡åè¢«æ‰‹åŠ¨å…³é—­é”€æ¯ æœ€ä½³ä½œç”¨åŸŸä¸ºè¯·æ±‚æ—¶æˆ–ä½¿ç”¨æ—¶çš„æ–¹æ³•å†… ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#mybatisæ‰§è¡ŒåŸç†"},{"categories":null,"content":"\rç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼š MyBatisæ‰§è¡ŒåŸç†ï¼šç¨‹åºé€šè¿‡mybatis-config.xmlæ–‡ä»¶é€šè¿‡SqlSessionFactoryBuilderå»ºé€ SqlSessionFactoryå¾—åˆ°SqlSessionå¯¹è±¡ï¼Œé€šè¿‡åå°„åŠ¨æ€ä»£ç†å‡ºæ¥å£çš„mapperå¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚ SqlSessionFactoryBuilderï¼š ç”±ç”¨æˆ·åˆ›å»ºï¼Œåœ¨æ‰§è¡Œå®Œbuildï¼ˆï¼‰æ–¹æ³•åè‡ªåŠ¨é”€æ¯ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ±  ç”±SqlSessionFactoryBuilderåˆ›å»ºï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€é™æ€å•ä¾‹æ¨¡å¼ï¼Œæœ€ä½³ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ SqlSession ç›¸å½“äºè¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½å…±äº« åœ¨ä½¿ç”¨æ—¶è¢«åˆ›å»ºï¼Œåå°„å‡ºmapperå¯¹è±¡ï¼Œæäº¤äº‹åŠ¡åè¢«æ‰‹åŠ¨å…³é—­é”€æ¯ æœ€ä½³ä½œç”¨åŸŸä¸ºè¯·æ±‚æ—¶æˆ–ä½¿ç”¨æ—¶çš„æ–¹æ³•å†… ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#sqlsessionfactorybuilder"},{"categories":null,"content":"\rç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼š MyBatisæ‰§è¡ŒåŸç†ï¼šç¨‹åºé€šè¿‡mybatis-config.xmlæ–‡ä»¶é€šè¿‡SqlSessionFactoryBuilderå»ºé€ SqlSessionFactoryå¾—åˆ°SqlSessionå¯¹è±¡ï¼Œé€šè¿‡åå°„åŠ¨æ€ä»£ç†å‡ºæ¥å£çš„mapperå¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚ SqlSessionFactoryBuilderï¼š ç”±ç”¨æˆ·åˆ›å»ºï¼Œåœ¨æ‰§è¡Œå®Œbuildï¼ˆï¼‰æ–¹æ³•åè‡ªåŠ¨é”€æ¯ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ±  ç”±SqlSessionFactoryBuilderåˆ›å»ºï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€é™æ€å•ä¾‹æ¨¡å¼ï¼Œæœ€ä½³ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ SqlSession ç›¸å½“äºè¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½å…±äº« åœ¨ä½¿ç”¨æ—¶è¢«åˆ›å»ºï¼Œåå°„å‡ºmapperå¯¹è±¡ï¼Œæäº¤äº‹åŠ¡åè¢«æ‰‹åŠ¨å…³é—­é”€æ¯ æœ€ä½³ä½œç”¨åŸŸä¸ºè¯·æ±‚æ—¶æˆ–ä½¿ç”¨æ—¶çš„æ–¹æ³•å†… ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#sqlsessionfactory"},{"categories":null,"content":"\rç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸï¼š MyBatisæ‰§è¡ŒåŸç†ï¼šç¨‹åºé€šè¿‡mybatis-config.xmlæ–‡ä»¶é€šè¿‡SqlSessionFactoryBuilderå»ºé€ SqlSessionFactoryå¾—åˆ°SqlSessionå¯¹è±¡ï¼Œé€šè¿‡åå°„åŠ¨æ€ä»£ç†å‡ºæ¥å£çš„mapperå¯¹è±¡æ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚ SqlSessionFactoryBuilderï¼š ç”±ç”¨æˆ·åˆ›å»ºï¼Œåœ¨æ‰§è¡Œå®Œbuildï¼ˆï¼‰æ–¹æ³•åè‡ªåŠ¨é”€æ¯ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ±  ç”±SqlSessionFactoryBuilderåˆ›å»ºï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸæ—¶é”€æ¯ ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€é™æ€å•ä¾‹æ¨¡å¼ï¼Œæœ€ä½³ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ SqlSession ç›¸å½“äºè¿æ¥åˆ°è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯å•ç‹¬çš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½å…±äº« åœ¨ä½¿ç”¨æ—¶è¢«åˆ›å»ºï¼Œåå°„å‡ºmapperå¯¹è±¡ï¼Œæäº¤äº‹åŠ¡åè¢«æ‰‹åŠ¨å…³é—­é”€æ¯ æœ€ä½³ä½œç”¨åŸŸä¸ºè¯·æ±‚æ—¶æˆ–ä½¿ç”¨æ—¶çš„æ–¹æ³•å†… ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:7:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#sqlsession"},{"categories":null,"content":"\rç»“æœé›†æ˜ å°„ï¼š MyBatisä¼šå°†mapper.xmlä¸­æŸ¥è¯¢åˆ°çš„å†…å®¹ä¾ç…§resultTypeè¿”å›ï¼Œåœ¨è¿”å›æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€éœ€å®ä¾‹(MyBatisåœ¨å¹•åä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªresultMapï¼Œå†åŸºäºå±æ€§åæ¥æ˜ å°„åˆ—åˆ°JavaBeançš„å±æ€§ä¸Š)ï¼Œä¼šè‡ªåŠ¨æ‰¾ä¸è¡¨ä¸­å­—æ®µåç›¸åŒçš„å±æ€§åèµ‹å€¼ å¦‚ä½•è§£å†³è¡¨å­—æ®µåä¸ç±»å±æ€§åä¸ä¸€è‡´ï¼šä½¿ç”¨ç»“æœé›†æ˜ å°„ è§£å†³æ–¹å¼ï¼š ä¸ºå­—æ®µèµ·åˆ«åï¼Œåˆ«åä¸ç±»å˜é‡åä¸€è‡´ \u003cselect id=\"getUserById\" resultType=\"User\" parameterType=\"int\"\u003e select id, name, pwd as pswd from mybatis.user where id = #{id}; \u003c/select\u003e ç»“æœé›†æ˜ å°„ï¼šå°†mapper.xmlä¸­selectæ ‡ç­¾çš„resultTypeæ›¿æ¢ä¸ºresultMap \u003cresultMap id=\"UserMap\" type=\"User\"\u003e \u003c!--å°†æ•°æ®åº“ä¸­çš„ä¸»é”®å­—æ®µæ˜ å°„ä¸ºå®ä½“ç±»ä¸­çš„ID--\u003e \u003cid column=\"id\" property=\"ID\" /\u003e \u003c!--å°†æ•°æ®åº“ä¸­çš„pwdå­—æ®µæ˜ å°„ä¸ºå®ä½“ç±»ä¸­çš„pswd--\u003e \u003cresult column=\"pwd\" property=\"pswd\" /\u003e \u003c/resultMap\u003e \u003c!--id: namespaceä¸­å¯¹åº”çš„æ–¹æ³•, resultType: è¿”å›ç±»å‹, parameter: å½¢å‚ç±»å‹--\u003e \u003cselect id=\"getUserById\" resultMap=\"UserMap\" parameterType=\"int\"\u003e select * from mybatis.user where id = #{id}; \u003c/select\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:8:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç»“æœé›†æ˜ å°„"},{"categories":null,"content":"\ræ—¥å¿—å·¥å‚ï¼š æ—¥å¿—ï¼šæ’é”™ï¼Œæ’æŸ¥å¼‚å¸¸ç”¨ã€‚ æ—¥å¿—å·¥å‚ï¼šlogImpl è®¾ç½®å æè¿° æœ‰æ•ˆå€¼ é»˜è®¤å€¼ logImpl æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚ SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING æœªè®¾ç½® LOG4J : é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶æ—¥å¿—å·¥å‚è¾“å‡ºå†…å®¹ STDOUT_LOGGING : æ ‡å‡†æ—¥å¿—å·¥å‚è¾“å‡ºå†…å®¹ NO_LOGGING : æ— æ—¥å¿— log4jï¼š å¯¼åŒ…ï¼šå¯¼å…¥mavenä¸­çš„log4j \u003c!-- https://mvnrepository.com/artifact/log4j/log4j --\u003e \u003cdependency\u003e \u003cgroupId\u003elog4j\u003c/groupId\u003e \u003cartifactId\u003elog4j\u003c/artifactId\u003e \u003cversion\u003e1.2.17\u003c/version\u003e \u003c/dependency\u003e è®¾ç½®ç›®å½•å®ç°ï¼šè®¾ç½®æ—¥å¿—çš„å…·ä½“å®ç°ä¸ºlog4jï¼Œåœ¨mybatis-config.xmlä¸­æ·»åŠ ï¼š \u003c!--è®¾ç½®--\u003e \u003csettings\u003e \u003c!--è®¾ç½®æ—¥å¿—å·¥å‚--\u003e \u003csetting name=\"logImpl\" value=\"LOG4J\"/\u003e \u003c/settings\u003e é…ç½®æ–‡ä»¶ï¼šåœ¨resourcesç›®å½•ä¸‹åˆ›å»ºlog4j.propertiesé…ç½®æ–‡ä»¶ï¼š #å°†ç­‰çº§ä¸ºDEBUGçš„æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°consoleå’Œfileè¿™ä¸¤ä¸ªç›®çš„åœ°ï¼Œconsoleå’Œfileçš„å®šä¹‰åœ¨ä¸‹é¢çš„ä»£ç  log4j.rootLogger=DEBUG,console,file #æ§åˆ¶å°è¾“å‡ºçš„ç›¸å…³è®¾ç½® log4j.appender.console = org.apache.log4j.ConsoleAppender log4j.appender.console.Target = System.out log4j.appender.console.Threshold=DEBUG log4j.appender.console.layout = org.apache.log4j.PatternLayout log4j.appender.console.layout.ConversionPattern=[%c]-%m%n #æ–‡ä»¶è¾“å‡ºçš„ç›¸å…³è®¾ç½® log4j.appender.file = org.apache.log4j.RollingFileAppender log4j.appender.file.File=./log/kuang.log log4j.appender.file.MaxFileSize=10mb log4j.appender.file.Threshold=DEBUG log4j.appender.file.layout=org.apache.log4j.PatternLayout log4j.appender.file.layout.ConversionPattern=[%p][%d{yy-MM-dd}][%c]%m%n #æ—¥å¿—è¾“å‡ºçº§åˆ« log4j.logger.org.mybatis=DEBUG log4j.logger.java.sql=DEBUG log4j.logger.java.sql.Statement=DEBUG log4j.logger.java.sql.ResultSet=DEBUG log4j.logger.java.sql.PreparedStatement=DEBUG ä½¿ç”¨: å¯¼åŒ…ï¼šimport org.apache.log4j.Logger; åˆ›å»ºæ—¥å¿—ç±»å¯¹è±¡ï¼Œå‚æ•°ä¸ºå½“å‰ç±»çš„classï¼šstatic Logger logger = Logger.getLogger(UserDaoTest.class); è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œåœ¨é€‚å½“ä½ç½®åŠ å…¥ï¼š logger.info(\"info: è¿›å…¥äº†testlog4j\"); logger.debug(\"debug: è¿›å…¥äº†testlog4j\"); logger.error(\"error: è¿›å…¥äº†testlog4j\"); åœ¨log/ç½‘ç«™å.logä¸‹è¿½åŠ æ—¥å¿— ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:9:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#æ—¥å¿—å·¥å‚"},{"categories":null,"content":"\råˆ†é¡µæŸ¥è¯¢ï¼š ä½¿ç”¨pageHelperï¼šhttps://pagehelper.github.io/ é€šè¿‡mapä¼ å…¥limitçš„å€¼ï¼š \u003cselect id=\"getUserByLimit\" resultType=\"user\" parameterType=\"map\"\u003e select * from mybatis.user limit #{startIndex},#{pageSize}; \u003c/select\u003e //åœ¨æµ‹è¯•ä¸­ï¼šæŸ¥è¯¢ç¬¬äºŒé¡µçš„ä¸¤æ¡æ•°æ® Map map = new HashMap(); map.put(\"startIndex\", 2 * 1); map.put(\"pageSize\", 2); List user = mapper.getUserByLimit(map); ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:10:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åˆ†é¡µæŸ¥è¯¢"},{"categories":null,"content":"\rä½¿ç”¨æ³¨è§£å¼€å‘ï¼š é¢å‘æ¥å£ç¼–ç¨‹ï¼šå®šä¹‰ä¸å®ç°çš„åˆ†ç¦»ï¼Œè§£è€¦åˆ ä¸æ¨èä½¿ç”¨æ³¨è§£æ˜ å°„MyBatis ä½¿ç”¨æ³¨è§£æ˜ å°„ç®€å•çš„sqlè¯­å¥ï¼ˆå½“éœ€è¦ç”¨åˆ°resultMapç­‰åŠŸèƒ½å°±GGï¼‰ /** * æ ¹æ®nameæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ * @return ç”¨æˆ·ä¿¡æ¯çš„Listé›†åˆ */ @Select(\"select * from mybatis.user where name = #{sname};\") List\u003cUser\u003e getUserListById(@Param(\"sname\")int name); ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:11:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä½¿ç”¨æ³¨è§£å¼€å‘"},{"categories":null,"content":"\rMyBatisåº•å±‚åŸç†ï¼š Resourcesè·å–åŠ è½½å…¨å±€é…ç½®æ–‡ä»¶ å®ä¾‹åŒ–SqlSessionFactoryBuilderæ„é€ å™¨ è§£æé…ç½®æ–‡ä»¶æµXMLConfigBuilder Configurationæ‰€æœ‰çš„é…ç½®ä¿¡æ¯ SqlSessionFactoryå®ä¾‹åŒ– transactionaläº‹åŠ¡ç®¡ç† åˆ›å»ºexecutoræ‰§è¡Œå™¨ åˆ›å»ºSqlSession å®ç°CRUDï¼Œæ‰§è¡Œå¤±è´¥è¿”å›ç¬¬å…­æ­¥ æäº¤äº‹åŠ¡ å…³é—­SqlSession ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:12:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#mybatisåº•å±‚åŸç†"},{"categories":null,"content":"\rLombokï¼šlombok: é€šè¿‡ç®€å•çš„æ³¨è§£å½¢å¼æ¥ç®€åŒ–javaä»£ç ï¼Œæé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ Lombokæ²¡æ³•å®ç°å¤šç§å‚æ•°æ„é€ å™¨çš„é‡è½½ã€‚ å¤§å¤§é™ä½äº†æºä»£ç çš„å¯è¯»æ€§å’Œå®Œæ•´æ€§ ä½¿ç”¨lombokï¼š åœ¨IDEAä¸­å®‰è£…lombokæ’ä»¶ï¼Œ åœ¨é¡¹ç›®ä¸­å¯¼å…¥lombokçš„jaråŒ… åœ¨å®ä½“ç±»ä¸ŠåŠ æ³¨è§£ @Getter / @Setterï¼šä¸ºç›¸åº”çš„å±æ€§è‡ªåŠ¨ç”Ÿæˆ Getter / Setter æ–¹æ³• @FieldNameConstants @ToStringï¼šç”Ÿæˆä¸€ä¸ªtoString()æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šè¾“å‡ºç±»åã€æ‰€æœ‰å±æ€§ï¼ˆä¼šæŒ‰ç…§å±æ€§å®šä¹‰é¡ºåºï¼‰ï¼Œç”¨é€—å·æ¥åˆ†å‰²ã€‚ @EqualsAndHashCodeï¼šç”Ÿæˆequalså’ŒhasCode @AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructorï¼šæ— å‚æ„é€ å™¨ã€éƒ¨åˆ†å‚æ•°æ„é€ å™¨ã€å…¨å‚æ„é€ å™¨ã€‚ @Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog @Dataï¼šä¸ºç±»çš„æ‰€æœ‰å±æ€§è‡ªåŠ¨ç”Ÿæˆsetter/getterã€equalsã€canEqualã€hashCodeã€toStringæ–¹æ³•ï¼Œfinalå±æ€§æ— setteræ–¹æ³•ã€‚ @Builder @SuperBuilder @Singular @Delegate @Value @Accessors @Wither @With @SneakyThrows @val @var @UtilityClass ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:13:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#lombok"},{"categories":null,"content":"\rå¤šå¯¹ä¸€çš„å¤„ç†ï¼š åœ¨å­è¡¨å®ä½“ç±»ä¸­ç»„åˆä¸»è¡¨å®ä½“ç±»ï¼ˆæ›¿ä»£å¤–é”®ï¼‰ æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç†ï¼š å†™ä¸¤ä¸ªæŸ¥è¯¢ç±»ä¼¼å­æŸ¥è¯¢ï¼Œç„¶åå†æŸ¥è¯¢ç¬¬ä¸€ä¸ªçš„æ—¶å€™å¸¦ä¸Šå­æŸ¥è¯¢çš„å†…å®¹ \u003cresultMap id=\"studentTeacher\" type=\"Student\"\u003e \u003cresult column=\"id\" property=\"id\" /\u003e \u003cresult column=\"name\" property=\"name\" /\u003e \u003c!--å¤æ‚çš„å±æ€§éœ€è¦å•ç‹¬å¤„ç†ï¼š å¯¹è±¡(å…³è”)ï¼šassociation--\u003e \u003cassociation javaType=\"Teacher\" property=\"teacher\" select=\"getTeacher\" column=\"tid\" /\u003e \u003c/resultMap\u003e \u003cselect id=\"getStudentWithTeacherList\" resultMap=\"studentTeacher\"\u003e select * from student; \u003c/select\u003e \u003cselect id=\"getTeacher\" resultType=\"teacher\"\u003e select * from teacher where id = #{tid(éšä¾¿å†™è‡ªåŠ¨åŒ¹é…)}; \u003c/select\u003e æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç†ï¼š æŠŠè¦æŸ¥çš„SQLå†™å¥½ï¼Œç„¶ååœ¨resultMapä¸­æŒ‡å®šå…¶å¯¹åº”å¯¹è±¡ã€å¯¹åº”åå­— \u003cresultMap id=\"studentTeacher2\" type=\"Student\"\u003e \u003cresult column=\"sid\" property=\"id\" /\u003e \u003cresult column=\"sname\" property=\"name\" /\u003e \u003cassociation javaType=\"Teacher\" property=\"teacher\"\u003e \u003cresult column=\"tid\" property=\"id\"/\u003e \u003cresult column=\"tname\" property=\"name\" /\u003e \u003c/association\u003e \u003c/resultMap\u003e \u003cselect id=\"getStudentWithTeacherList2\" resultMap=\"studentTeacher2\"\u003e select s.id sid, s.name sname, t.id tid, t.name tname from student s, teacher t where s. tid = t.id; \u003c/select\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:14:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#å¤šå¯¹ä¸€çš„å¤„ç†"},{"categories":null,"content":"\rä¸€å¯¹å¤šçš„å¤„ç†ï¼š åœ¨ä¸»è¡¨å®ä½“ç±»ä¸­æ·»åŠ å­è¡¨å®ä½“ç±»çš„é›†åˆï¼ˆä¸€ä¸ªä¸»å¯¹åº”å¤šä¸ªå­ï¼‰ æŒ‰ç…§æŸ¥è¯¢åµŒå¥—å¤„ç† ä¸¤ä¸ªSQLä¸­éƒ½æ‰¾çš„æ˜¯ç¬¦åˆæ¡ä»¶çš„å†…å®¹ \u003cresultMap id=\"teacherStudent2\" type=\"Teacher\"\u003e \u003cresult column=\"id\" property=\"id\"/\u003e \u003cresult column=\"name\" property=\"name\"/\u003e \u003c!--å¤æ‚çš„å±æ€§éœ€è¦å•ç‹¬å¤„ç†ï¼š é›†åˆï¼šcollection--\u003e \u003c!--ofType: é›†åˆä¸­çš„æ³›å‹ä¿¡æ¯--\u003e \u003ccollection javaType=\"List\" ofType=\"Student\" property=\"students\" select=\"getStudentList2\" column=\"id\"/\u003e \u003c/resultMap\u003e \u003cselect id=\"getTeacherWithStudentList2\" resultMap=\"teacherStudent2\"\u003e select * from teacher where id = #{tid}; \u003c/select\u003e \u003cselect id=\"getStudentList2\" resultType=\"Student\"\u003e select * from student where tid = #{tid}; \u003c/select\u003e æŒ‰ç…§ç»“æœåµŒå¥—å¤„ç† å°†æ¯ä¸€ä¸ªæŸ¥è¯¢çš„å­—æ®µå‡é‡æ–°å‘½åå¹¶é‡æ–°æ˜ å°„ \u003cresultMap id=\"teacherStudent\" type=\"Teacher\"\u003e \u003cresult column=\"tid\" property=\"id\"/\u003e \u003cresult column=\"tname\" property=\"name\"/\u003e \u003ccollection ofType=\"Student\" property=\"students\"\u003e \u003cresult column=\"sid\" property=\"id\" /\u003e \u003cresult column=\"sname\" property=\"name\" /\u003e \u003cresult column=\"stid\" property=\"tid\" /\u003e \u003c/collection\u003e \u003c/resultMap\u003e \u003cselect id=\"getTeacherWithStudentList\" resultMap=\"teacherStudent\" \u003e select t.id tid, t.name tname, s.id sid, s.name sname, s.tid stid from teacher t join student s where t.id = s.tid and t.id = #{tid}; \u003c/select\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:15:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ä¸€å¯¹å¤šçš„å¤„ç†"},{"categories":null,"content":"\råŠ¨æ€SQLï¼šä»€ä¹ˆæ˜¯åŠ¨æ€SQLï¼šæŒ‡æ ¹æ®ä¸åŒçš„æ¡ä»¶ç”Ÿæˆä¸åŒçš„SQLè¯­å¥ï¼ˆæ‹¼æ¥SQLè¯­å¥ï¼‰ï¼Œåœ¨SQLå±‚é¢å»æ‰§è¡Œä¸€ä¸ªé€»è¾‘ä»£ç ã€‚ é€šè¿‡åŠ¨æ€å†…å®¹æŸ¥è¯¢ï¼šå¦‚æœmapé‡Œæœ‰titleé‚£å°±ä»¥titleä¸ºæ¡ä»¶ï¼Œå¦‚æœmapé‡Œæœ‰authoré‚£å°±ä»¥authorä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œé‚£å°±æŸ¥è¯¢æ‰€æœ‰ \u003cselect id=\"queryBookIf\" parameterType=\"map\" resultType=\"Blog\"\u003e select * from blog where 2\u003e1 \u003c!--ifæ ‡ç­¾ï¼Œtestä¸­ä¸ºå¸ƒå°”ç±»å‹è¡¨è¾¾å¼ï¼ˆè¿‡æ»¤æ¡ä»¶ï¼‰--\u003e \u003cif test=\"title != null\"\u003e and title=#{title} \u003c/if\u003e \u003cif test=\"author != null\"\u003e and author=#{author} \u003c/if\u003e \u003c/select\u003e choose, when, otherwiseæ ‡ç­¾ ç›¸å½“äºswitch case: â€¦break; defaule \u003cselect id=\"findActiveBlogLike\" resultType=\"Blog\"\u003e SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™ \u003cchoose\u003e \u003cwhen test=\"title != null\"\u003e AND title like #{title} \u003c/when\u003e \u003cwhen test=\"author != null and author.name != null\"\u003e AND author_name like #{author.name} \u003c/when\u003e \u003cotherwise\u003e AND featured = 1 \u003c/otherwise\u003e \u003c/choose\u003e \u003c/select\u003e if, trim, where/set trimè‡ªåŠ¨å»é™¤é‚£äº›æ ‡ç­¾çš„å‰ç¼€/åç¼€ where å…ƒç´ åªä¼šåœ¨å­å…ƒç´ æœ‰è¿”å›ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥ â€œWHEREâ€ å­å¥ã€‚ setä¼šè‡ªåŠ¨å»é™¤å¤šä½™é€—å·ï¼Œ \u003cselect id=\"findActiveBlogLike\" resultType=\"Blog\"\u003e SELECT * FROM BLOG \u003cwhere\u003e \u003c!--è¿™é‡Œçš„ç¬¬ä¸€ä¸ªandä¼šè‡ªåŠ¨æ’å…¥--\u003e \u003cif test=\"state != null\"\u003e state = #{state} \u003c/if\u003e \u003cif test=\"title != null\"\u003e AND title like #{title} \u003c/if\u003e \u003cif test=\"author != null and author.name != null\"\u003e AND author_name like #{author.name} \u003c/if\u003e \u003c/where\u003e \u003c/select\u003e foreach å¯¹ä¼ å…¥çš„é›†åˆè¿›è¡Œéå†ï¼ˆæ ¼å¼åŒ–ï¼‰, å¸¸ç”¨åœ¨inå­å¥ä¸Š \u003cselect id=\"selectPostIn\" resultType=\"domain.blog.Post\" parameterType=\"map\"\u003e SELECT * FROM POST P WHERE ID in \u003c!--listæ˜¯mapä¸­çš„ä¸€ä¸ªkeyå¯¹åº”çš„æ˜¯ä¸€ä¸ªé›†åˆ æœ€åæ‹¼æ¥ä¸ºï¼š(item1, item2, item3, ... ) --\u003e \u003cforeach item=\"item\" index=\"index\" collection=\"list\" open=\"(\" separator=\",\" close=\")\"\u003e #{item} \u003c/foreach\u003e \u003c/select\u003e sqlæ ‡ç­¾ æŠŠå…¬ç”¨çš„sqlä»£ç å—ç‹¬ç«‹ï¼Œå…è®¸å¤šå¤„includeå¼•ç”¨ æ³¨æ„1ï¼šæœ€å¥½åŸºäºå•è¡¨æ¥å®šä¹‰sqlæ ‡ç­¾ æ³¨æ„2ï¼šä¸è¦å­˜åœ¨whereæ ‡ç­¾ \u003c!--å…¬ç”¨çš„sqlè¯­å¥å—--\u003e \u003csql id=\"if-title-author\"\u003e \u003cif test=\"title != null\"\u003e and title=#{title} \u003c/if\u003e \u003cif test=\"author != null\"\u003e and author=#{author} \u003c/if\u003e \u003c/sql\u003e \u003c!--é€šè¿‡åŠ¨æ€å†…å®¹æŸ¥è¯¢ï¼šå¦‚æœmapé‡Œæœ‰titleé‚£å°±ä»¥titleä¸ºæ¡ä»¶ï¼Œå¦‚æœmapé‡Œæœ‰authoré‚£å°±ä»¥authorä¸ºæ¡ä»¶æŸ¥è¯¢ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œé‚£å°±æŸ¥è¯¢æ‰€æœ‰--\u003e \u003cselect id=\"queryBookIf\" parameterType=\"map\" resultType=\"Blog\"\u003e select * from blog \u003cwhere\u003e \u003cinclude refid=\"if-title-author\"\u003e\u003c/include\u003e \u003c/where\u003e \u003c/select\u003e ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:16:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#åŠ¨æ€sql"},{"categories":null,"content":"\rç¼“å­˜ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜ï¼šä¸´æ—¶æ”¾åœ¨å†…å­˜ä¸­çš„è¡¨æ•°æ®ä¿¡æ¯ ä¸ºä»€ä¹ˆä½¿ç”¨ç¼“å­˜ï¼šå‡å°‘å’Œæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ ä»€ä¹ˆæ ·çš„æ•°æ®é€‚åˆä½¿ç”¨ç¼“å­˜ï¼šç»å¸¸æŸ¥è¯¢å¹¶ä¸ç»å¸¸æ”¹å˜çš„æ•°æ® ä¸€çº§ç¼“å­˜ï¼šé»˜è®¤å¼€å¯ï¼ŒSqlSessionçº§åˆ«ï¼Œæœ¬åœ°ç¼“å­˜ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ LRUï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸ç”¨çš„ç¼“å­˜ ä¸€çº§ç¼“å­˜æ˜¯ä»¥statemntId, param, boundsql, rowsboundä¸ºkeyçš„hashmap,åœ¨ä¸‹æ¬¡å¦‚æœä¸‹æ¬¡æŸ¥è¯¢ä¹ŸåŒ¹é…åˆ°äº†è¿™ä¸ªkey, å°±å¯ä»¥ç›´æ¥å–å‡ºè¿™ä¸ªå¯¹è±¡è€Œä¸ç”¨å»æŸ¥æ•°æ®åº“ å½“å‰ä¼šè¯è¢«å…³é—­æ—¶ï¼Œä¸€çº§ç¼“å­˜å°±æ²¡äº†ï¼Œå°±å¯ä»¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–å†…å®¹ selectè¯­å¥ä½¿ç”¨ç¼“å­˜ï¼Œ insertã€updateã€deleteè¯­å¥åˆ·æ–°ç¼“å­˜ sqlSession.clearCache()æ¸…ç†ç¼“å­˜ äºŒçº§ç¼“å­˜ï¼šæ‰‹åŠ¨å¼€å¯ï¼Œnamespaceçº§åˆ«ï¼Œå…¨å±€ç¼“å­˜ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ å½“å‰ä¼šè¯è¢«å…³é—­æ—¶ï¼Œä¸€çº§ç¼“å­˜å°±æ²¡äº†ï¼Œå°±å¯ä»¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–å†…å®¹ï¼ˆåŒä¸€ä¸ªmapperå†…å…±äº«äºŒçº§ç¼“å­˜ï¼‰ å¼€å¯æ–¹å¼ï¼š åœ¨mybatis-config.xmlä¸­æ·»åŠ setting \u003c!--æ˜¾å¼çš„å¼€å¯å…¨å±€ç¼“å­˜--\u003e \u003csetting name=\"cacheEnabled\" value=\"true\"/\u003e åœ¨mapper.xmlä¸­æ·»åŠ è¡Œ \u003c!--å¼€å¯äºŒçº§ç¼“å­˜--\u003e \u003ccache/\u003e æˆ– \u003ccache eviction=\"FIFO\" flushInterval=\"60000\" size=\"512\" readOnly=\"true\"/\u003e äºŒçº§ç¼“å­˜é—®é¢˜ï¼š \u003ccache/\u003eæ ‡ç­¾é»˜è®¤readOnlyä¸ºfalseï¼Œéœ€è¦å®ä¾‹åŒ–å®ä½“ç±»è§£å†³ ç”¨æˆ·åœ¨æŸ¥è¯¢æ—¶å…ˆç»è¿‡mapperï¼Œå…ˆçœ‹äºŒçº§ç¼“å­˜æœ‰æ²¡æœ‰ï¼Œå†çœ‹ä¸€çº§ç¼“å­˜æœ‰æ²¡æœ‰ï¼Œå¦‚æœéƒ½æ²¡æœ‰æ‰ä¼šæŸ¥è¯¢æ•°æ®åº“ è‡ªå®šä¹‰ç¼“å­˜ï¼š åœ¨cacheæ ‡ç­¾ä¸­æ‰§è¡Œtypeå±æ€§ ehcacheï¼šhibernateç”¨åˆ°äº†ï¼Œç•¥ redisçš„ç¼“å­˜ï¼Œç•¥ ","date":"2021-08-22","objectID":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/:17:0","series":null,"tags":null,"title":"MyBatisè‡ªå­¦ç¬”è®°","uri":"/mybatis%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/#ç¼“å­˜"},{"categories":null,"content":"\rSpringCloud è‡ªå­¦ç¬”è®° å¤§è¿äº¤é€šå¤§å­¦ ä¿¡æ¯å­¦é™¢ åˆ˜å˜‰å® ç¬”è®°æ‘˜è‡ª å°šç¡…è°· ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:0:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springcloud-è‡ªå­¦ç¬”è®°"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ SpringCloud æœ€æ—©æ˜¯ç”±å¥¶é£å…¬å¸æå‡ºçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œåæ¥è¢« Spring å…¬å¸æŠ„äº†ä½œä¸š æ‰€æœ‰è¯·æ±‚éƒ½ç”± æœåŠ¡ç½‘å…³ é€šè¿‡ æœåŠ¡æ³¨å†Œå’Œå‘ç° æ ¹æ® é…ç½®ä¸­å¿ƒ æ‰¾åˆ°å¯¹åº”çš„ SpringBoot æœåŠ¡æ¨¡å—è¿›è¡Œåè°ƒå’Œè°ƒåº¦ å¦‚æœæœ‰å®¹é”™ å’Œ é™æµ æ¯”å¦‚ é™çº§ã€ç†”æ–­ è¿›è¡ŒæœåŠ¡ç›‘æ§ã€å¥åº·æ£€æŸ¥å’ŒæŠ¥è­¦ æ˜¯åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ æ˜¯å¤šç§å¾®æœåŠ¡æ¶æ„è½åœ°æŠ€æœ¯çš„é›†åˆä½“ æ˜¯ä¸€ç³»åˆ—æŠ€æœ¯çš„é›†åˆï¼Œä¿—ç§°å¾®æœåŠ¡å…¨å®¶æ¡¶ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:1:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-springcloud"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ã€ä»€ä¹ˆæ˜¯å¾®æœåŠ¡","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„ç¨‹åºã€åŠŸèƒ½æ‹†åˆ†æˆä¸åŒçš„å­ç³»ç»Ÿï¼Œéƒ¨ç½²åœ¨å¤šå°ä¸åŒçš„æœåŠ¡å™¨ä¸Š è¿™äº›å­ç³»ç»Ÿç›¸äº’åä½œå…±åŒå¯¹å¤–æä¾›æœåŠ¡ï¼Œè€Œå¯¹ç”¨æˆ·è€Œè¨€ä»–å¹¶ä¸çŸ¥é“åå°æ˜¯å¤šä¸ªå­ç³»ç»Ÿå’Œå¤šå°æœåŠ¡å™¨åœ¨æä¾›æœåŠ¡ï¼Œåœ¨ä½¿ç”¨ä¸Šå’Œé›†ä¸­å¼ç³»ç»Ÿä¸€æ · ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯å¾®æœåŠ¡ å¾®æœåŠ¡æ˜¯ç³»ç»Ÿæ¶æ„ä¸Šçš„ä¸€ç§è®¾è®¡é£æ ¼ï¼Œ å®ƒçš„ä¸»æ—¨æ˜¯å°†ä¸€ä¸ªåŸæœ¬ç‹¬ç«‹çš„ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªå°å‹æœåŠ¡ è¿™äº›å°å‹æœåŠ¡éƒ½åœ¨å„è‡ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡åŸºäº HTTP çš„ RESTful API è¿›è¡Œé€šä¿¡åä½œ è¢«æ‹†åˆ†åçš„æ¯ä¸€ä¸ªå°å‹æœåŠ¡éƒ½å›´ç»•ç€ç³»ç»Ÿä¸­çš„æŸä¸€é¡¹ä¸šåŠ¡åŠŸèƒ½è¿›è¡Œæ„å»ºï¼Œ å¹¶ä¸”æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œå¯ä»¥è¿›è¡Œç‹¬ç«‹çš„æµ‹è¯•ã€å¼€å‘å’Œéƒ¨ç½²ç­‰ ç”±äºå„ä¸ªç‹¬ç«‹çš„æœåŠ¡ä¹‹é—´ä½¿ç”¨çš„æ˜¯åŸºäº HTTP çš„ä½œä¸ºæ•°æ®é€šä¿¡åä½œçš„åŸºç¡€ï¼Œæ‰€ä»¥è¿™äº›å¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥å¼€å‘ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"},{"categories":null,"content":"\rä¸¤è€…çš„åŒºåˆ« åˆ†å¸ƒå¼å¼ºè°ƒç³»ç»Ÿçš„æ‹†åˆ†ï¼Œå¾®æœåŠ¡ä¹Ÿæ˜¯å¼ºè°ƒç³»ç»Ÿçš„æ‹†åˆ†ï¼Œå¾®æœåŠ¡æ¶æ„å±äºåˆ†å¸ƒå¼æ¶æ„çš„èŒƒç•´ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:2:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸¤è€…çš„åŒºåˆ«"},{"categories":null,"content":"\rå¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š å°†ç³»ç»Ÿä¸­çš„ä¸åŒåŠŸèƒ½æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªä¸åŒçš„æœåŠ¡ï¼Œç‹¬ç«‹åœ°å¼€å‘å’Œéƒ¨ç½²ï¼Œéƒ½è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹å†…ï¼Œæ¯ä¸ªæœåŠ¡çš„æ›´æ–°éƒ½ä¸å½±å“å…¶ä»–æœåŠ¡çš„è¿è¡Œ ç”±äºæ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œå¯ä»¥æ›´å‡†ç¡®åœ°ç›‘æ§æ¯ä¸ªæœåŠ¡çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œè¿›è¡Œæ€§èƒ½å®¹é‡çš„è¯„ä¼°ï¼Œé€šè¿‡å‹åŠ›æµ‹è¯•ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‘ç°å„ä¸ªæœåŠ¡é—´çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ ç‹¬ç«‹å¼€å‘æ¯”è¾ƒæ–¹ä¾¿ï¼Œå‡å°‘ä»£ç çš„å†²çªã€ä»£ç çš„é‡å¤ï¼Œé€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œæ˜“äºåç»­çš„ç»´æŠ¤ä¸æ‰©å±• å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œå¼€å‘ ç¼ºç‚¹ï¼š å¾®æœåŠ¡æ¶æ„å¢åŠ äº†ç³»ç»Ÿç»´æŠ¤ã€éƒ¨ç½²çš„éš¾åº¦ï¼Œå¯¼è‡´ä¸€äº›åŠŸèƒ½æ¨¡å—æˆ–ä»£ç æ— æ³•å¤ç”¨ éšç€ç³»ç»Ÿè§„æ¨¡çš„æ—¥æ¸å¢é•¿ï¼Œå¾®æœåŠ¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ äº†é›†æˆæµ‹è¯•çš„å¤æ‚åº¦ éšç€å¾®æœåŠ¡çš„å¢å¤šï¼Œæ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡æˆæœ¬ç­‰éƒ½å‡¸æ˜¾äº†å‡ºæ¥ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:3:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹"},{"categories":null,"content":"\rBoot å’Œ Cloud ç‰ˆæœ¬å¯¹åº”å…³ç³» SpringCloud ä½¿ç”¨ä¼¦æ•¦åœ°é“ç«™å‘½åå…¶ç‰ˆæœ¬ï¼ŒAxxx ~ Zxxx (ç›®å‰ Kilburn 3.0.x) æ¯å½“é‡å¤§ BUG è¢«ä¿®å¤ï¼Œå°±ä¼šå‘å¸ƒä¸€ä¸ª SR (Server Releases ç‰ˆæœ¬) 2021å¹´ Hoxton.SR12 ç¬¬åäºŒä¸ªç‰ˆæœ¬ 2020 å¹´å¼€å§‹å¼ºçƒˆæ¨èå‡çº§åˆ° SpringCloud 2.0 ä»¥ä¸Šç‰ˆæœ¬ SpringCloud å®˜ç½‘ç‰ˆæœ¬å¯¹åº”æ¨è https://start.spring.io/actuator/info åœ¨ SpringCloud å®˜ç½‘ LEARN æ ‡ç­¾ä¸­æŸ¥çœ‹æ¨èçš„å¯¹åº” Boot ç‰ˆæœ¬ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:4:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#boot-å’Œ-cloud-ç‰ˆæœ¬å¯¹åº”å…³ç³»"},{"categories":null,"content":"\rSpringCloud ç»„ä»¶çš„å˜æ›´\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:5:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springcloud-ç»„ä»¶çš„å˜æ›´"},{"categories":null,"content":"\råˆ›å»º SpringCloud å·¥ç¨‹ ç¼–ç¨‹é£æ ¼ï¼šçº¦å®š \u003e é…ç½® \u003e ç¼–ç  åˆ›å»ºè¯¦æƒ…è§ angenin çš„åšå®¢ç¬”è®° SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ1-4åŸºç¡€å…¥é—¨ï¼Œåˆ›å»ºé¡¹ç›®ï¼‰CSDNåšå®¢ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-springcloud-å·¥ç¨‹"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ RestTemplate RestTemplate æ˜¯ä¸€ä¸ªåŒæ­¥çš„ web http å®¢æˆ·ç«¯è¯·æ±‚æ¨¡æ¿å·¥å…· å®ƒå°è£…äº†httpè¿æ¥, å¯ä»¥å‘ä¸€ä¸ª REST æ¥å£å‘é€è¯·æ±‚å¹¶è·å–å“åº” postForObject è¯·æ±‚åœ°å€ï¼Œè¯·æ±‚å‚æ•°ï¼Œè¿”å›çš„å¯¹è±¡ç±»å‹ getForObject è¯·æ±‚åœ°å€ï¼Œè¿”å›çš„å¯¹è±¡ç±»å‹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-resttemplate"},{"categories":null,"content":"\rå¦‚ä½•å¯¼å…¥å›¢é˜Ÿè‡ªå·±çš„å·¥å…·åŒ… åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åˆ›å»ºå¤šä¸ªæ¨¡å—ï¼Œå…¶ä¸­ä¸€ä¸ªä¸“é—¨ç”¨æ¥åšå·¥å…·åŒ…æ¨¡å— å°†è‡ªå·±å›¢é˜Ÿå†™çš„ commons æ¨¡å—ä½¿ç”¨ maven install åˆ°è‡ªå·±æœ¬åœ°ä»“åº“ä¸­ åœ¨éœ€è¦çš„æ¨¡å—çš„ pom æ–‡ä»¶ä¸­å¯¼å…¥å·¥å…·æ¨¡å—çš„ä¾èµ–ï¼Œå®ç°ä¸€å¤„ä¿®æ”¹å¤„å¤„åº”ç”¨ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¦‚ä½•å¯¼å…¥å›¢é˜Ÿè‡ªå·±çš„å·¥å…·åŒ…"},{"categories":null,"content":"\rSpringBoot ä¸€èˆ¬é€šç”¨é…ç½® pom.xml \u003c!-- ä¸€èˆ¬é€šç”¨é…ç½® --\u003e \u003c!-- SpringBoot WEB å¯åŠ¨ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-web\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- SpringBoot æµ‹è¯•å¯åŠ¨ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-test\u003c/artifactId\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c!-- SpringBoot çƒ­éƒ¨ç½²ä¾èµ– --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-devtools\u003c/artifactId\u003e \u003cscope\u003eruntime\u003c/scope\u003e \u003coptional\u003etrue\u003c/optional\u003e \u003c/dependency\u003e \u003c!-- lombok æ³¨è§£å¼€å‘ --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.projectlombok\u003c/groupId\u003e \u003cartifactId\u003elombok\u003c/artifactId\u003e \u003coptional\u003etrue\u003c/optional\u003e \u003c/dependency\u003e ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:6:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springboot-ä¸€èˆ¬é€šç”¨é…ç½®-pomxml"},{"categories":null,"content":"\rEureka æœåŠ¡æ³¨å†Œä¸å‘ç°ã€ç»´æŠ¤ã€‘","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#eureka-æœåŠ¡æ³¨å†Œä¸å‘ç°ç»´æŠ¤"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç† åœ¨ä¼ ç»Ÿ RPC è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ æœåŠ¡æ²»ç†å°±æ˜¯å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°ä¸æ³¨å†Œ åœ¨ RPC è¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³åœ¨äºæ³¨å†Œä¸­å¿ƒ, ä½¿ç”¨æ³¨å†Œä¸­å¿ƒ (å­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ (æ¥å£åœ°å€) ) ç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ã€æœåŠ¡æ²»ç†ã€‘ å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ (æœåŠ¡åœ°å€ã€é€šä¿¡åœ°å€) ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼Œæ¶ˆè´¹è€…/æœåŠ¡æä¾›è€… ä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šä¿¡åœ°å€ï¼Œç„¶åå†å®ç° RPC è°ƒç”¨ Eureka ä»ç”¨ C/S çš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå…¶å®ƒå¾®æœåŠ¡ä½¿ç”¨ Eureka å®¢æˆ·ç«¯è¿æ¥åˆ°æ³¨å†Œä¸­å¿ƒå¹¶ç»´æŒå¿ƒè·³è¿æ¥ï¼Œç»´æŠ¤äººå‘˜é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°ä¸æ³¨å†Œ"},{"categories":null,"content":"\ræ­å»º Eureka å·¥ç¨‹\råˆ›å»º Eureka Server å·¥ç¨‹æ­¥éª¤ æ·»åŠ  pom ä¾èµ– \u003c!-- eureka-server --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- ç›‘æ§ --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- å¼•ç”¨è‡ªå·±å®šä¹‰çš„ api é€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ Payment æ”¯ä»˜ Entity --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.atguigu.springcloud\u003c/groupId\u003e \u003cartifactId\u003ecloud-api-commons\u003c/artifactId\u003e \u003cversion\u003e${project.version}\u003c/version\u003e \u003c/dependency\u003e \u003c!-- ä¸€èˆ¬é€šç”¨é…ç½® --\u003e é…ç½® application.yml server: port: 7001 eureka: instance: hostname: localhost # eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: # false è¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼ˆæƒ³æ³¨å†Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ²¡å¿…è¦ï¼‰ register-with-eureka: false # false è¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å» æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸ eurekaServer äº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableEurekaServer // æ ‡è¯†æ­¤å·¥ç¨‹æ˜¯ Eureka Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } è®¿é—® localhost:7001 çœ‹åˆ° application ä¸ºç©ºçš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å…¶å®ƒé¡¹ç›®æ³¨å†Œè¿›æ¥ ä¿®æ”¹ Eureka Client å·¥ç¨‹æ­¥éª¤ æ·»åŠ  Eureka Client ä¾èµ– \u003c!-- eureka-client --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-client\u003c/artifactId\u003e \u003c/dependency\u003e åœ¨ application.yml ä¸­æ·»åŠ  # æ­¤å¾®æœåŠ¡é¡¹ç›®çš„åˆ«åå°±æ˜¯ä¸Šé¢é…ç½®çš„ spring.application.name eureka: client: # true è¡¨ç¤ºå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤ä¸º true register-with-eureka: true # æ˜¯å¦ä» EurekaServer æŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º trueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true service-url: defaultZone: http://localhost:7001/eureka åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableEurekaClient è®¿é—® localhost:7001 çœ‹åˆ° application å·²ç»æœ‰é¡¹ç›®æ³¨å†Œè¿›æ¥äº†applicaiton çš„é¡¹ç›®åå°±æ˜¯åœ¨ yml ä¸­é…ç½®çš„ spring.application.name åç§° æ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤\rä¸ºé¿å…å•ä¸€æ³¨å†Œä¸­å¿ƒçªç„¶å®•æœºå¯¼è‡´æ•´ä½“é¡¹ç›®ä¸å¯ç”¨ï¼Œæ­å»ºæ³¨å†Œä¸­å¿ƒé›†ç¾¤å®ç° è´Ÿè½½å‡è¡¡ã€æ•…éšœå®¹é”™ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼šç›¸äº’æ³¨å†Œï¼Œç›¸äº’å®ˆæœ› ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ  # ä»¥ä¸‹ä¸º SpringCloud Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤é…ç½® 127.0.0.1 eureka7001.com 127.0.0.1 eureka7002.com 127.0.0.1 eureka7003.com ä¿®æ”¹ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„ yml é…ç½®æ–‡ä»¶ hostname å’Œ defaultZone é¦–å°¾ç›¸è¿ï¼Œ7001 æ³¨å†Œ 7002ï¼Œ7002 æ³¨å†Œ 7001 å¦‚æœæ˜¯ä¸‰å°äº’ç›¸æ˜ å°„ï¼Œé‚£ä¹ˆ defaultZone åº”å†™ä¸¤ä¸ªåœ°å€ä¸­é—´é€—å·åˆ†éš” è®¿é—®æµ‹è¯• ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—çš„ yml #é›†ç¾¤ç‰ˆ defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/ å¯åŠ¨é¡ºåº å…ˆå¯åŠ¨ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡ æ­å»º ç”Ÿäº§è€… é›†ç¾¤ æ ¹æ®åŸæœ‰ç”Ÿäº§è€…å¤åˆ¶å‡ºä¸€ä»½ ä½¿ç”¨ç›¸åŒçš„å¾®æœåŠ¡åï¼Œä¿®æ”¹ç«¯å£åœ°å€ å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒä¸­ç”Ÿäº§è€…æœ‰ä¸¤ä¸ª ä¿®æ”¹ æ¶ˆè´¹è€… è¿æ¥åœ°å€ä¸º ç”Ÿäº§è€…æœåŠ¡å å¼€å¯ RestTemplate çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ Ribbon é»˜è®¤ä¸ºè½®è¯¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¸€æ¬¡è®¿é—® 8001 ä¸€æ¬¡è®¿é—® 8002 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-eureka-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Eureka å·¥ç¨‹\råˆ›å»º Eureka Server å·¥ç¨‹æ­¥éª¤ æ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-server org.springframework.boot spring-boot-starter-actuator com.atguigu.springcloud cloud-api-commons ${project.version} é…ç½® application.yml server: port: 7001 eureka: instance: hostname: localhost # eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: # false è¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼ˆæƒ³æ³¨å†Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ²¡å¿…è¦ï¼‰ register-with-eureka: false # false è¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å» æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸ eurekaServer äº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableEurekaServer // æ ‡è¯†æ­¤å·¥ç¨‹æ˜¯ Eureka Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } è®¿é—® localhost:7001 çœ‹åˆ° application ä¸ºç©ºçš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å…¶å®ƒé¡¹ç›®æ³¨å†Œè¿›æ¥ ä¿®æ”¹ Eureka Client å·¥ç¨‹æ­¥éª¤ æ·»åŠ  Eureka Client ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-client åœ¨ application.yml ä¸­æ·»åŠ  # æ­¤å¾®æœåŠ¡é¡¹ç›®çš„åˆ«åå°±æ˜¯ä¸Šé¢é…ç½®çš„ spring.application.name eureka: client: # true è¡¨ç¤ºå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤ä¸º true register-with-eureka: true # æ˜¯å¦ä» EurekaServer æŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º trueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true service-url: defaultZone: http://localhost:7001/eureka åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableEurekaClient è®¿é—® localhost:7001 çœ‹åˆ° application å·²ç»æœ‰é¡¹ç›®æ³¨å†Œè¿›æ¥äº†applicaiton çš„é¡¹ç›®åå°±æ˜¯åœ¨ yml ä¸­é…ç½®çš„ spring.application.name åç§° æ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤\rä¸ºé¿å…å•ä¸€æ³¨å†Œä¸­å¿ƒçªç„¶å®•æœºå¯¼è‡´æ•´ä½“é¡¹ç›®ä¸å¯ç”¨ï¼Œæ­å»ºæ³¨å†Œä¸­å¿ƒé›†ç¾¤å®ç° è´Ÿè½½å‡è¡¡ã€æ•…éšœå®¹é”™ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼šç›¸äº’æ³¨å†Œï¼Œç›¸äº’å®ˆæœ› ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ  # ä»¥ä¸‹ä¸º SpringCloud Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤é…ç½® 127.0.0.1 eureka7001.com 127.0.0.1 eureka7002.com 127.0.0.1 eureka7003.com ä¿®æ”¹ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„ yml é…ç½®æ–‡ä»¶ hostname å’Œ defaultZone é¦–å°¾ç›¸è¿ï¼Œ7001 æ³¨å†Œ 7002ï¼Œ7002 æ³¨å†Œ 7001 å¦‚æœæ˜¯ä¸‰å°äº’ç›¸æ˜ å°„ï¼Œé‚£ä¹ˆ defaultZone åº”å†™ä¸¤ä¸ªåœ°å€ä¸­é—´é€—å·åˆ†éš” è®¿é—®æµ‹è¯• ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—çš„ yml #é›†ç¾¤ç‰ˆ defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/ å¯åŠ¨é¡ºåº å…ˆå¯åŠ¨ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡ æ­å»º ç”Ÿäº§è€… é›†ç¾¤ æ ¹æ®åŸæœ‰ç”Ÿäº§è€…å¤åˆ¶å‡ºä¸€ä»½ ä½¿ç”¨ç›¸åŒçš„å¾®æœåŠ¡åï¼Œä¿®æ”¹ç«¯å£åœ°å€ å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒä¸­ç”Ÿäº§è€…æœ‰ä¸¤ä¸ª ä¿®æ”¹ æ¶ˆè´¹è€… è¿æ¥åœ°å€ä¸º ç”Ÿäº§è€…æœåŠ¡å å¼€å¯ RestTemplate çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ Ribbon é»˜è®¤ä¸ºè½®è¯¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¸€æ¬¡è®¿é—® 8001 ä¸€æ¬¡è®¿é—® 8002 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-eureka-server-å·¥ç¨‹æ­¥éª¤"},{"categories":null,"content":"\ræ­å»º Eureka å·¥ç¨‹\råˆ›å»º Eureka Server å·¥ç¨‹æ­¥éª¤ æ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-server org.springframework.boot spring-boot-starter-actuator com.atguigu.springcloud cloud-api-commons ${project.version} é…ç½® application.yml server: port: 7001 eureka: instance: hostname: localhost # eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: # false è¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼ˆæƒ³æ³¨å†Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ²¡å¿…è¦ï¼‰ register-with-eureka: false # false è¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å» æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸ eurekaServer äº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableEurekaServer // æ ‡è¯†æ­¤å·¥ç¨‹æ˜¯ Eureka Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } è®¿é—® localhost:7001 çœ‹åˆ° application ä¸ºç©ºçš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å…¶å®ƒé¡¹ç›®æ³¨å†Œè¿›æ¥ ä¿®æ”¹ Eureka Client å·¥ç¨‹æ­¥éª¤ æ·»åŠ  Eureka Client ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-client åœ¨ application.yml ä¸­æ·»åŠ  # æ­¤å¾®æœåŠ¡é¡¹ç›®çš„åˆ«åå°±æ˜¯ä¸Šé¢é…ç½®çš„ spring.application.name eureka: client: # true è¡¨ç¤ºå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤ä¸º true register-with-eureka: true # æ˜¯å¦ä» EurekaServer æŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º trueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true service-url: defaultZone: http://localhost:7001/eureka åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableEurekaClient è®¿é—® localhost:7001 çœ‹åˆ° application å·²ç»æœ‰é¡¹ç›®æ³¨å†Œè¿›æ¥äº†applicaiton çš„é¡¹ç›®åå°±æ˜¯åœ¨ yml ä¸­é…ç½®çš„ spring.application.name åç§° æ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤\rä¸ºé¿å…å•ä¸€æ³¨å†Œä¸­å¿ƒçªç„¶å®•æœºå¯¼è‡´æ•´ä½“é¡¹ç›®ä¸å¯ç”¨ï¼Œæ­å»ºæ³¨å†Œä¸­å¿ƒé›†ç¾¤å®ç° è´Ÿè½½å‡è¡¡ã€æ•…éšœå®¹é”™ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼šç›¸äº’æ³¨å†Œï¼Œç›¸äº’å®ˆæœ› ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ  # ä»¥ä¸‹ä¸º SpringCloud Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤é…ç½® 127.0.0.1 eureka7001.com 127.0.0.1 eureka7002.com 127.0.0.1 eureka7003.com ä¿®æ”¹ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„ yml é…ç½®æ–‡ä»¶ hostname å’Œ defaultZone é¦–å°¾ç›¸è¿ï¼Œ7001 æ³¨å†Œ 7002ï¼Œ7002 æ³¨å†Œ 7001 å¦‚æœæ˜¯ä¸‰å°äº’ç›¸æ˜ å°„ï¼Œé‚£ä¹ˆ defaultZone åº”å†™ä¸¤ä¸ªåœ°å€ä¸­é—´é€—å·åˆ†éš” è®¿é—®æµ‹è¯• ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—çš„ yml #é›†ç¾¤ç‰ˆ defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/ å¯åŠ¨é¡ºåº å…ˆå¯åŠ¨ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡ æ­å»º ç”Ÿäº§è€… é›†ç¾¤ æ ¹æ®åŸæœ‰ç”Ÿäº§è€…å¤åˆ¶å‡ºä¸€ä»½ ä½¿ç”¨ç›¸åŒçš„å¾®æœåŠ¡åï¼Œä¿®æ”¹ç«¯å£åœ°å€ å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒä¸­ç”Ÿäº§è€…æœ‰ä¸¤ä¸ª ä¿®æ”¹ æ¶ˆè´¹è€… è¿æ¥åœ°å€ä¸º ç”Ÿäº§è€…æœåŠ¡å å¼€å¯ RestTemplate çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ Ribbon é»˜è®¤ä¸ºè½®è¯¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¸€æ¬¡è®¿é—® 8001 ä¸€æ¬¡è®¿é—® 8002 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¿®æ”¹-eureka-client-å·¥ç¨‹æ­¥éª¤"},{"categories":null,"content":"\ræ­å»º Eureka å·¥ç¨‹\råˆ›å»º Eureka Server å·¥ç¨‹æ­¥éª¤ æ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-server org.springframework.boot spring-boot-starter-actuator com.atguigu.springcloud cloud-api-commons ${project.version} é…ç½® application.yml server: port: 7001 eureka: instance: hostname: localhost # eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: # false è¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼ˆæƒ³æ³¨å†Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ²¡å¿…è¦ï¼‰ register-with-eureka: false # false è¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å» æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸ eurekaServer äº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableEurekaServer // æ ‡è¯†æ­¤å·¥ç¨‹æ˜¯ Eureka Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } è®¿é—® localhost:7001 çœ‹åˆ° application ä¸ºç©ºçš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å…¶å®ƒé¡¹ç›®æ³¨å†Œè¿›æ¥ ä¿®æ”¹ Eureka Client å·¥ç¨‹æ­¥éª¤ æ·»åŠ  Eureka Client ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-client åœ¨ application.yml ä¸­æ·»åŠ  # æ­¤å¾®æœåŠ¡é¡¹ç›®çš„åˆ«åå°±æ˜¯ä¸Šé¢é…ç½®çš„ spring.application.name eureka: client: # true è¡¨ç¤ºå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤ä¸º true register-with-eureka: true # æ˜¯å¦ä» EurekaServer æŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º trueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true service-url: defaultZone: http://localhost:7001/eureka åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableEurekaClient è®¿é—® localhost:7001 çœ‹åˆ° application å·²ç»æœ‰é¡¹ç›®æ³¨å†Œè¿›æ¥äº†applicaiton çš„é¡¹ç›®åå°±æ˜¯åœ¨ yml ä¸­é…ç½®çš„ spring.application.name åç§° æ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤\rä¸ºé¿å…å•ä¸€æ³¨å†Œä¸­å¿ƒçªç„¶å®•æœºå¯¼è‡´æ•´ä½“é¡¹ç›®ä¸å¯ç”¨ï¼Œæ­å»ºæ³¨å†Œä¸­å¿ƒé›†ç¾¤å®ç° è´Ÿè½½å‡è¡¡ã€æ•…éšœå®¹é”™ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼šç›¸äº’æ³¨å†Œï¼Œç›¸äº’å®ˆæœ› ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ  # ä»¥ä¸‹ä¸º SpringCloud Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤é…ç½® 127.0.0.1 eureka7001.com 127.0.0.1 eureka7002.com 127.0.0.1 eureka7003.com ä¿®æ”¹ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„ yml é…ç½®æ–‡ä»¶ hostname å’Œ defaultZone é¦–å°¾ç›¸è¿ï¼Œ7001 æ³¨å†Œ 7002ï¼Œ7002 æ³¨å†Œ 7001 å¦‚æœæ˜¯ä¸‰å°äº’ç›¸æ˜ å°„ï¼Œé‚£ä¹ˆ defaultZone åº”å†™ä¸¤ä¸ªåœ°å€ä¸­é—´é€—å·åˆ†éš” è®¿é—®æµ‹è¯• ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—çš„ yml #é›†ç¾¤ç‰ˆ defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/ å¯åŠ¨é¡ºåº å…ˆå¯åŠ¨ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡ æ­å»º ç”Ÿäº§è€… é›†ç¾¤ æ ¹æ®åŸæœ‰ç”Ÿäº§è€…å¤åˆ¶å‡ºä¸€ä»½ ä½¿ç”¨ç›¸åŒçš„å¾®æœåŠ¡åï¼Œä¿®æ”¹ç«¯å£åœ°å€ å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒä¸­ç”Ÿäº§è€…æœ‰ä¸¤ä¸ª ä¿®æ”¹ æ¶ˆè´¹è€… è¿æ¥åœ°å€ä¸º ç”Ÿäº§è€…æœåŠ¡å å¼€å¯ RestTemplate çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ Ribbon é»˜è®¤ä¸ºè½®è¯¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¸€æ¬¡è®¿é—® 8001 ä¸€æ¬¡è®¿é—® 8002 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-eureka-æ³¨å†Œä¸­å¿ƒé›†ç¾¤"},{"categories":null,"content":"\ræ­å»º Eureka å·¥ç¨‹\råˆ›å»º Eureka Server å·¥ç¨‹æ­¥éª¤ æ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-server org.springframework.boot spring-boot-starter-actuator com.atguigu.springcloud cloud-api-commons ${project.version} é…ç½® application.yml server: port: 7001 eureka: instance: hostname: localhost # eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: # false è¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼ˆæƒ³æ³¨å†Œä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ²¡å¿…è¦ï¼‰ register-with-eureka: false # false è¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å» æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: # è®¾ç½®ä¸ eurekaServer äº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableEurekaServer // æ ‡è¯†æ­¤å·¥ç¨‹æ˜¯ Eureka Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run(EurekaMain7001.class, args); } } è®¿é—® localhost:7001 çœ‹åˆ° application ä¸ºç©ºçš„ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å…¶å®ƒé¡¹ç›®æ³¨å†Œè¿›æ¥ ä¿®æ”¹ Eureka Client å·¥ç¨‹æ­¥éª¤ æ·»åŠ  Eureka Client ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-eureka-client åœ¨ application.yml ä¸­æ·»åŠ  # æ­¤å¾®æœåŠ¡é¡¹ç›®çš„åˆ«åå°±æ˜¯ä¸Šé¢é…ç½®çš„ spring.application.name eureka: client: # true è¡¨ç¤ºå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œé»˜è®¤ä¸º true register-with-eureka: true # æ˜¯å¦ä» EurekaServer æŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸º trueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½é…åˆ ribbon ä½¿ç”¨è´Ÿè½½å‡è¡¡ fetch-registry: true service-url: defaultZone: http://localhost:7001/eureka åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableEurekaClient è®¿é—® localhost:7001 çœ‹åˆ° application å·²ç»æœ‰é¡¹ç›®æ³¨å†Œè¿›æ¥äº†applicaiton çš„é¡¹ç›®åå°±æ˜¯åœ¨ yml ä¸­é…ç½®çš„ spring.application.name åç§° æ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤\rä¸ºé¿å…å•ä¸€æ³¨å†Œä¸­å¿ƒçªç„¶å®•æœºå¯¼è‡´æ•´ä½“é¡¹ç›®ä¸å¯ç”¨ï¼Œæ­å»ºæ³¨å†Œä¸­å¿ƒé›†ç¾¤å®ç° è´Ÿè½½å‡è¡¡ã€æ•…éšœå®¹é”™ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼šç›¸äº’æ³¨å†Œï¼Œç›¸äº’å®ˆæœ› ä¿®æ”¹ hosts æ–‡ä»¶ï¼Œæ·»åŠ  # ä»¥ä¸‹ä¸º SpringCloud Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤é…ç½® 127.0.0.1 eureka7001.com 127.0.0.1 eureka7002.com 127.0.0.1 eureka7003.com ä¿®æ”¹ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„ yml é…ç½®æ–‡ä»¶ hostname å’Œ defaultZone é¦–å°¾ç›¸è¿ï¼Œ7001 æ³¨å†Œ 7002ï¼Œ7002 æ³¨å†Œ 7001 å¦‚æœæ˜¯ä¸‰å°äº’ç›¸æ˜ å°„ï¼Œé‚£ä¹ˆ defaultZone åº”å†™ä¸¤ä¸ªåœ°å€ä¸­é—´é€—å·åˆ†éš” è®¿é—®æµ‹è¯• ä¿®æ”¹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—çš„ yml #é›†ç¾¤ç‰ˆ defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/ å¯åŠ¨é¡ºåº å…ˆå¯åŠ¨ Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ å¯åŠ¨ç”Ÿäº§è€…æœåŠ¡ å¯åŠ¨æ¶ˆè´¹è€…æœåŠ¡ æ­å»º ç”Ÿäº§è€… é›†ç¾¤ æ ¹æ®åŸæœ‰ç”Ÿäº§è€…å¤åˆ¶å‡ºä¸€ä»½ ä½¿ç”¨ç›¸åŒçš„å¾®æœåŠ¡åï¼Œä¿®æ”¹ç«¯å£åœ°å€ å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒä¸­ç”Ÿäº§è€…æœ‰ä¸¤ä¸ª ä¿®æ”¹ æ¶ˆè´¹è€… è¿æ¥åœ°å€ä¸º ç”Ÿäº§è€…æœåŠ¡å å¼€å¯ RestTemplate çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ Ribbon é»˜è®¤ä¸ºè½®è¯¢çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¸€æ¬¡è®¿é—® 8001 ä¸€æ¬¡è®¿é—® 8002 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-ç”Ÿäº§è€…-é›†ç¾¤"},{"categories":null,"content":"\rä¿¡æ¯åŠŸèƒ½å®Œå–„åŠä¿®æ”¹ æœåŠ¡åç§°ä¿®æ”¹ ä¸ºç”Ÿäº§è€…æ·»åŠ  eureka.instance.instance-id å±æ€§å€¼ æ·»åŠ è®¿é—®è·¯å¾„ IP ä¿¡æ¯ åœ¨ç”Ÿäº§è€…é…ç½® yml ä¸­æ·»åŠ  eureka.instance.prefer-ip-address å±æ€§å€¼ä¸º true ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¿¡æ¯åŠŸèƒ½å®Œå–„åŠä¿®æ”¹"},{"categories":null,"content":"\ræœåŠ¡å‘ç° Discovery é€šè¿‡ æœåŠ¡å‘ç° æ¥è·å– Eureka ä¸­ç°æœ‰å¾®æœåŠ¡çš„ä¿¡æ¯ ä¸ºå¾®æœåŠ¡æ³¨å…¥ DiscoveryClient @Resource private DiscoveryClient discoveryClient; é€šè¿‡å…¶ getServices()ã€discoveryClient.getInstances(\"æœåŠ¡å\") å¯ä»¥è·å–åˆ°å¯¹åº”æœåŠ¡çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡å‘ç°-discovery"},{"categories":null,"content":"\rEureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ åœ¨ä¸€ç»„å®¢æˆ·ç«¯ä¸ eureka server å­˜åœ¨ç½‘ç»œåˆ†åŒºæ—¶ä¼šè‡ªåŠ¨å¼€å¯ä¿æŠ¤ï¼Œä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸ä¼šåˆ é™¤æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ å‡ºç°è¿™ä¸€è¡Œçº¢å­—å°±æ˜¯ä¿æŠ¤æ¨¡å¼ï¼Œè¿™å±äº CAP ä¸­çš„ AP åˆ†æ”¯ é»˜è®¤æƒ…å†µä¸‹ Eureka Server åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼Œå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤ 90 ç§’ï¼‰ ä½†æ˜¯å› ä¸ºç½‘ç»œå¡é¡¿ã€å»¶æ—¶ã€æ‹¥æŒ¤æ—¶ï¼Œå¾®æœåŠ¡è¿˜æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶å¹¶ä¸åº”è¯¥åˆ é™¤è¯¥å¾®æœåŠ¡ã€é«˜å¯ç”¨ï¼Œå¥å£®æ€§ã€‘ æ‰€ä»¥ Eureka åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶å°±ä¼šè‡ªåŠ¨è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œå®å¯ä¿ç•™é”™è¯¯çš„ä¿¡æ¯ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¯èƒ½å¥åº·çš„æœåŠ¡å®ä¾‹ å¦‚ä½•å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ é…ç½® Eureka Server æ³¨å†Œä¸­å¿ƒé…ç½® ä¿®æ”¹ eureka å®¢æˆ·ç«¯å¿ƒè·³é—´éš”å’Œç›´çº¿ä¸Šé™æ—¶é—´ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#eureka-çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"},{"categories":null,"content":"\rEureka çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ åœ¨ä¸€ç»„å®¢æˆ·ç«¯ä¸ eureka server å­˜åœ¨ç½‘ç»œåˆ†åŒºæ—¶ä¼šè‡ªåŠ¨å¼€å¯ä¿æŠ¤ï¼Œä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸ä¼šåˆ é™¤æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ å‡ºç°è¿™ä¸€è¡Œçº¢å­—å°±æ˜¯ä¿æŠ¤æ¨¡å¼ï¼Œè¿™å±äº CAP ä¸­çš„ AP åˆ†æ”¯ é»˜è®¤æƒ…å†µä¸‹ Eureka Server åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼Œå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤ 90 ç§’ï¼‰ ä½†æ˜¯å› ä¸ºç½‘ç»œå¡é¡¿ã€å»¶æ—¶ã€æ‹¥æŒ¤æ—¶ï¼Œå¾®æœåŠ¡è¿˜æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶å¹¶ä¸åº”è¯¥åˆ é™¤è¯¥å¾®æœåŠ¡ã€é«˜å¯ç”¨ï¼Œå¥å£®æ€§ã€‘ æ‰€ä»¥ Eureka åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶å°±ä¼šè‡ªåŠ¨è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œå®å¯ä¿ç•™é”™è¯¯çš„ä¿¡æ¯ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¯èƒ½å¥åº·çš„æœåŠ¡å®ä¾‹ å¦‚ä½•å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ é…ç½® Eureka Server æ³¨å†Œä¸­å¿ƒé…ç½® ä¿®æ”¹ eureka å®¢æˆ·ç«¯å¿ƒè·³é—´éš”å’Œç›´çº¿ä¸Šé™æ—¶é—´ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:7:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¦‚ä½•å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"},{"categories":null,"content":"\rZookeeper æœåŠ¡æ³¨å†Œä¸å‘ç° Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œå¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#zookeeper-æœåŠ¡æ³¨å†Œä¸å‘ç°"},{"categories":null,"content":"\rä¸´æ—¶èŠ‚ç‚¹ or æŒä¹…èŠ‚ç‚¹ Zookeeper ä¹Ÿæ˜¯æœ‰å¿ƒè·³æœºåˆ¶ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…å¦‚æœä¸€ç›´æ²¡å¿ƒè·³è¿”å›ï¼ŒZookeeperå°±ä¼šæŠŠæœåŠ¡èŠ‚ç‚¹å‰”é™¤æ‰ åœ¨ Eureka ä¸­å¦‚æœæ²¡æœ‰å¿ƒè·³äº†è¿˜ä¼šå†ä¿æŠ¤æ¨¡å¼ä¸­ç»§ç»­æœåŠ¡ï¼Œæ‰€ä»¥åœ¨ Zookeeper ä¸Šçš„æœåŠ¡èŠ‚ç‚¹æ˜¯ ä¸´æ—¶èŠ‚ç‚¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸´æ—¶èŠ‚ç‚¹-or-æŒä¹…èŠ‚ç‚¹"},{"categories":null,"content":"\ræ­å»º Zookeeper å·¥ç¨‹\råˆ›å»º Zookeeper ç”Ÿäº§è€…æ­¥éª¤ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º Zookeeper æœåŠ¡ ç•¥ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œæ·»åŠ  pom ä¾èµ– \u003c!-- Zookeeper --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-zookeeper-discovery\u003c/artifactId\u003e \u003c/dependency\u003e é…ç½® yml æ–‡ä»¶ server: port: 8004 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Zookeeper åˆ°æ³¨å†Œä¸­å¿ƒåç§° cloud: zookeeper: connect-string: 192.168.30.129:2181 åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient // è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨ consul æˆ–è€… Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run(PaymentMain8004.class, args); } } è¿›å…¥ docker ä¸­çš„ zookeeper å¹¶æŸ¥çœ‹å½“å‰æœåŠ¡ åœ¨æœ‰æœåŠ¡è¿æ¥åˆ° zookeeper ä¹‹å ls / å³å¯çœ‹åˆ° services ç›®å½• services ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿäº§è€…ä¸­é…ç½®å¥½çš„å¾®æœåŠ¡åˆ«å, å…¶ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡æµæ°´å· ä½¿ç”¨ get å‘½ä»¤è·å–æŸä¸€æœåŠ¡ä¸­çš„æŸä¸€æ³¨å†Œç›¸å…³ä¿¡æ¯ (JSON æ ¼å¼) åˆ›å»º Zookeeper æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Zookeeper æœåŠ¡ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å Zookeeper æ³¨å†Œä¸­å¿ƒé›†ç¾¤ åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­åˆ›å»ºå¤šä¸ª Zookeeper æœåŠ¡ åœ¨ yml é…ç½®ç±»ä¸­ connect-string: IP:ç«¯å£, IP:ç«¯å£ å³å¯ é‡åˆ°çš„é—®é¢˜ï¼šä¾èµ–å†²çª ç”±äºæœåŠ¡å™¨ä¸­ zookeeper ç‰ˆæœ¬è¾ƒä½ï¼Œè€Œ SpringBoot å¯åŠ¨ä¾èµ–ä¸­é»˜è®¤ç‰ˆæœ¬è¾ƒé«˜ åœ¨ POM ä¸­æ’é™¤è‡ªå¸¦çš„é«˜ç‰ˆæœ¬ Zookeeper ä¾èµ–ï¼Œè‡ªè¡Œå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–å³å¯ \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-zookeeper-discovery\u003c/artifactId\u003e \u003cexclusions\u003e \u003c!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--\u003e \u003cexclusion\u003e \u003cgroupId\u003eorg.apache.zookeeper\u003c/groupId\u003e \u003cartifactId\u003ezookeeper\u003c/artifactId\u003e \u003c/exclusion\u003e \u003c/exclusions\u003e \u003c/dependency\u003e \u003c!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬ï¼ˆå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–ï¼‰--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.zookeeper\u003c/groupId\u003e \u003cartifactId\u003ezookeeper\u003c/artifactId\u003e \u003cversion\u003e3.4.9\u003c/version\u003e \u003c/dependency\u003e ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-zookeeper-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Zookeeper å·¥ç¨‹\råˆ›å»º Zookeeper ç”Ÿäº§è€…æ­¥éª¤ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º Zookeeper æœåŠ¡ ç•¥ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œæ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-zookeeper-discovery é…ç½® yml æ–‡ä»¶ server: port: 8004 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Zookeeper åˆ°æ³¨å†Œä¸­å¿ƒåç§° cloud: zookeeper: connect-string: 192.168.30.129:2181 åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient // è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨ consul æˆ–è€… Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run(PaymentMain8004.class, args); } } è¿›å…¥ docker ä¸­çš„ zookeeper å¹¶æŸ¥çœ‹å½“å‰æœåŠ¡ åœ¨æœ‰æœåŠ¡è¿æ¥åˆ° zookeeper ä¹‹å ls / å³å¯çœ‹åˆ° services ç›®å½• services ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿäº§è€…ä¸­é…ç½®å¥½çš„å¾®æœåŠ¡åˆ«å, å…¶ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡æµæ°´å· ä½¿ç”¨ get å‘½ä»¤è·å–æŸä¸€æœåŠ¡ä¸­çš„æŸä¸€æ³¨å†Œç›¸å…³ä¿¡æ¯ (JSON æ ¼å¼) åˆ›å»º Zookeeper æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Zookeeper æœåŠ¡ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å Zookeeper æ³¨å†Œä¸­å¿ƒé›†ç¾¤ åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­åˆ›å»ºå¤šä¸ª Zookeeper æœåŠ¡ åœ¨ yml é…ç½®ç±»ä¸­ connect-string: IP:ç«¯å£, IP:ç«¯å£ å³å¯ é‡åˆ°çš„é—®é¢˜ï¼šä¾èµ–å†²çª ç”±äºæœåŠ¡å™¨ä¸­ zookeeper ç‰ˆæœ¬è¾ƒä½ï¼Œè€Œ SpringBoot å¯åŠ¨ä¾èµ–ä¸­é»˜è®¤ç‰ˆæœ¬è¾ƒé«˜ åœ¨ POM ä¸­æ’é™¤è‡ªå¸¦çš„é«˜ç‰ˆæœ¬ Zookeeper ä¾èµ–ï¼Œè‡ªè¡Œå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–å³å¯ org.springframework.cloud spring-cloud-starter-zookeeper-discovery org.apache.zookeeper zookeeper org.apache.zookeeper zookeeper 3.4.9 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-zookeeper-ç”Ÿäº§è€…æ­¥éª¤"},{"categories":null,"content":"\ræ­å»º Zookeeper å·¥ç¨‹\råˆ›å»º Zookeeper ç”Ÿäº§è€…æ­¥éª¤ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º Zookeeper æœåŠ¡ ç•¥ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œæ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-zookeeper-discovery é…ç½® yml æ–‡ä»¶ server: port: 8004 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Zookeeper åˆ°æ³¨å†Œä¸­å¿ƒåç§° cloud: zookeeper: connect-string: 192.168.30.129:2181 åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient // è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨ consul æˆ–è€… Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run(PaymentMain8004.class, args); } } è¿›å…¥ docker ä¸­çš„ zookeeper å¹¶æŸ¥çœ‹å½“å‰æœåŠ¡ åœ¨æœ‰æœåŠ¡è¿æ¥åˆ° zookeeper ä¹‹å ls / å³å¯çœ‹åˆ° services ç›®å½• services ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿäº§è€…ä¸­é…ç½®å¥½çš„å¾®æœåŠ¡åˆ«å, å…¶ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡æµæ°´å· ä½¿ç”¨ get å‘½ä»¤è·å–æŸä¸€æœåŠ¡ä¸­çš„æŸä¸€æ³¨å†Œç›¸å…³ä¿¡æ¯ (JSON æ ¼å¼) åˆ›å»º Zookeeper æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Zookeeper æœåŠ¡ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å Zookeeper æ³¨å†Œä¸­å¿ƒé›†ç¾¤ åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­åˆ›å»ºå¤šä¸ª Zookeeper æœåŠ¡ åœ¨ yml é…ç½®ç±»ä¸­ connect-string: IP:ç«¯å£, IP:ç«¯å£ å³å¯ é‡åˆ°çš„é—®é¢˜ï¼šä¾èµ–å†²çª ç”±äºæœåŠ¡å™¨ä¸­ zookeeper ç‰ˆæœ¬è¾ƒä½ï¼Œè€Œ SpringBoot å¯åŠ¨ä¾èµ–ä¸­é»˜è®¤ç‰ˆæœ¬è¾ƒé«˜ åœ¨ POM ä¸­æ’é™¤è‡ªå¸¦çš„é«˜ç‰ˆæœ¬ Zookeeper ä¾èµ–ï¼Œè‡ªè¡Œå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–å³å¯ org.springframework.cloud spring-cloud-starter-zookeeper-discovery org.apache.zookeeper zookeeper org.apache.zookeeper zookeeper 3.4.9 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-zookeeper-æ¶ˆè´¹è€…æ­¥éª¤"},{"categories":null,"content":"\ræ­å»º Zookeeper å·¥ç¨‹\råˆ›å»º Zookeeper ç”Ÿäº§è€…æ­¥éª¤ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º Zookeeper æœåŠ¡ ç•¥ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œæ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-zookeeper-discovery é…ç½® yml æ–‡ä»¶ server: port: 8004 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Zookeeper åˆ°æ³¨å†Œä¸­å¿ƒåç§° cloud: zookeeper: connect-string: 192.168.30.129:2181 åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient // è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨ consul æˆ–è€… Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run(PaymentMain8004.class, args); } } è¿›å…¥ docker ä¸­çš„ zookeeper å¹¶æŸ¥çœ‹å½“å‰æœåŠ¡ åœ¨æœ‰æœåŠ¡è¿æ¥åˆ° zookeeper ä¹‹å ls / å³å¯çœ‹åˆ° services ç›®å½• services ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿäº§è€…ä¸­é…ç½®å¥½çš„å¾®æœåŠ¡åˆ«å, å…¶ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡æµæ°´å· ä½¿ç”¨ get å‘½ä»¤è·å–æŸä¸€æœåŠ¡ä¸­çš„æŸä¸€æ³¨å†Œç›¸å…³ä¿¡æ¯ (JSON æ ¼å¼) åˆ›å»º Zookeeper æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Zookeeper æœåŠ¡ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å Zookeeper æ³¨å†Œä¸­å¿ƒé›†ç¾¤ åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­åˆ›å»ºå¤šä¸ª Zookeeper æœåŠ¡ åœ¨ yml é…ç½®ç±»ä¸­ connect-string: IP:ç«¯å£, IP:ç«¯å£ å³å¯ é‡åˆ°çš„é—®é¢˜ï¼šä¾èµ–å†²çª ç”±äºæœåŠ¡å™¨ä¸­ zookeeper ç‰ˆæœ¬è¾ƒä½ï¼Œè€Œ SpringBoot å¯åŠ¨ä¾èµ–ä¸­é»˜è®¤ç‰ˆæœ¬è¾ƒé«˜ åœ¨ POM ä¸­æ’é™¤è‡ªå¸¦çš„é«˜ç‰ˆæœ¬ Zookeeper ä¾èµ–ï¼Œè‡ªè¡Œå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–å³å¯ org.springframework.cloud spring-cloud-starter-zookeeper-discovery org.apache.zookeeper zookeeper org.apache.zookeeper zookeeper 3.4.9 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#zookeeper-æ³¨å†Œä¸­å¿ƒé›†ç¾¤"},{"categories":null,"content":"\ræ­å»º Zookeeper å·¥ç¨‹\råˆ›å»º Zookeeper ç”Ÿäº§è€…æ­¥éª¤ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º Zookeeper æœåŠ¡ ç•¥ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œæ·»åŠ  pom ä¾èµ– org.springframework.cloud spring-cloud-starter-zookeeper-discovery é…ç½® yml æ–‡ä»¶ server: port: 8004 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Zookeeper åˆ°æ³¨å†Œä¸­å¿ƒåç§° cloud: zookeeper: connect-string: 192.168.30.129:2181 åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient // è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨ consul æˆ–è€… Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run(PaymentMain8004.class, args); } } è¿›å…¥ docker ä¸­çš„ zookeeper å¹¶æŸ¥çœ‹å½“å‰æœåŠ¡ åœ¨æœ‰æœåŠ¡è¿æ¥åˆ° zookeeper ä¹‹å ls / å³å¯çœ‹åˆ° services ç›®å½• services ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿäº§è€…ä¸­é…ç½®å¥½çš„å¾®æœåŠ¡åˆ«å, å…¶ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡æµæ°´å· ä½¿ç”¨ get å‘½ä»¤è·å–æŸä¸€æœåŠ¡ä¸­çš„æŸä¸€æ³¨å†Œç›¸å…³ä¿¡æ¯ (JSON æ ¼å¼) åˆ›å»º Zookeeper æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Zookeeper æœåŠ¡ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å Zookeeper æ³¨å†Œä¸­å¿ƒé›†ç¾¤ åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­åˆ›å»ºå¤šä¸ª Zookeeper æœåŠ¡ åœ¨ yml é…ç½®ç±»ä¸­ connect-string: IP:ç«¯å£, IP:ç«¯å£ å³å¯ é‡åˆ°çš„é—®é¢˜ï¼šä¾èµ–å†²çª ç”±äºæœåŠ¡å™¨ä¸­ zookeeper ç‰ˆæœ¬è¾ƒä½ï¼Œè€Œ SpringBoot å¯åŠ¨ä¾èµ–ä¸­é»˜è®¤ç‰ˆæœ¬è¾ƒé«˜ åœ¨ POM ä¸­æ’é™¤è‡ªå¸¦çš„é«˜ç‰ˆæœ¬ Zookeeper ä¾èµ–ï¼Œè‡ªè¡Œå¼•å…¥å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–å³å¯ org.springframework.cloud spring-cloud-starter-zookeeper-discovery org.apache.zookeeper zookeeper org.apache.zookeeper zookeeper 3.4.9 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:8:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°çš„é—®é¢˜ä¾èµ–å†²çª"},{"categories":null,"content":"\rConsul æœåŠ¡æ³¨å†Œä¸å‘ç° å®˜ç½‘ï¼šhttps://www.consul.io/intro/index.html æ˜¯ä¸€å¥—å¼€æºçš„ï¼Œåˆ†å¸ƒå¼æœåŠ¡å‘ç° å’Œ é…ç½®ç®¡ç†ç³»ç»Ÿ ç”± HashiCorp å…¬å¸ç”¨ go è¯­è¨€å¼€å‘ ä¸»è¦ç‰¹ç‚¹ æœåŠ¡å‘ç°ï¼šConsul çš„å®¢æˆ·ç«¯å¯ä»¥æ³¨å†ŒæœåŠ¡ï¼Œä¾‹å¦‚ api æˆ– mysqlï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ Consul æ¥å‘ç°ç»™å®šæœåŠ¡çš„æä¾›è€…ã€‚ä½¿ç”¨ DNS æˆ– HTTPï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾æ‰¾åˆ°å®ƒä»¬ä¾èµ–çš„æœåŠ¡ å¥åº·æ£€æµ‹ï¼šConsul å®¢æˆ·ç«¯å¯ä»¥æä¾›ä»»æ„æ•°é‡çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œè¿™äº›æ£€æŸ¥å¯ä»¥ä¸ç»™å®šæœåŠ¡ï¼ˆâ€œ WebæœåŠ¡å™¨æ˜¯å¦è¿”å› 200 OKâ€ï¼‰æˆ–æœ¬åœ°èŠ‚ç‚¹ï¼ˆâ€œå†…å­˜åˆ©ç”¨ç‡ä½äº90ï¼…â€ï¼‰ç›¸å…³ã€‚æ“ä½œå‘˜å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥ç›‘è§†ç¾¤é›†çš„è¿è¡ŒçŠ¶å†µï¼ŒæœåŠ¡å‘ç°ç»„ä»¶å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯å°†æµé‡ä»ä¸æ­£å¸¸çš„ä¸»æœºå‘é€å‡ºå» K-Vå­˜å‚¨ï¼šåº”ç”¨ç¨‹åºå¯ä»¥å°† Consul çš„åˆ†å±‚ é”®/å€¼ å­˜å‚¨ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬åŠ¨æ€é…ç½®ï¼ŒåŠŸèƒ½æ ‡è®°ï¼Œåè°ƒï¼Œé¢†å¯¼è€…é€‰ä¸¾ç­‰ã€‚ç®€å•çš„ HTTP API ä½¿å…¶æ˜“äºä½¿ç”¨ å®‰å…¨çš„æœåŠ¡é€šä¿¡ï¼šConsul å¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå¹¶åˆ†å‘ TLS è¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’ TLS è¿æ¥ã€‚ æ„å›¾å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥ä½¿ç”¨å¯ä»¥å®æ—¶æ›´æ”¹çš„æ„å›¾è½»æ¾ç®¡ç†æœåŠ¡åˆ†æ®µï¼Œè€Œä¸å¿…ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™ å¤šæ•°æ®ä¸­å¿ƒï¼šConsul å¼€ç®±å³ç”¨åœ°æ”¯æŒå¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™æ„å‘³ç€ Consul çš„ç”¨æˆ·ä¸å¿…æ‹…å¿ƒä¼šæ„å»ºå…¶ä»–æŠ½è±¡å±‚ä»¥æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#consul-æœåŠ¡æ³¨å†Œä¸å‘ç°"},{"categories":null,"content":"\ræ­å»º Consul å·¥ç¨‹ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º consul æœåŠ¡ æˆåŠŸåå³å¯æ ¹æ®è™šæ‹Ÿæœº IP:8500 è¿›å…¥ consul ç®¡ç†é¡µé¢ åˆ›å»º Consul ç”Ÿäº§è€…æ­¥éª¤ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œé…ç½® POM æ–‡ä»¶ \u003c!-- consul --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-consul-discovery\u003c/artifactId\u003e \u003c/dependency\u003e ç¼–å†™ YML é…ç½®æ–‡ä»¶ server: port: 8006 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Consul cloud: consul: host: 192.168.30.129 port: 8500 discovery: service-name: ${spring.application.name} # æ·»åŠ ä¸‹æ–¹é…ç½®è§£å†³ Consul çº¢å‰é—®é¢˜ heartbeat: enabled: true åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient åœ¨ Consul çš„ UI ç•Œé¢å¯ä»¥çœ‹åˆ°åˆšåˆšæ³¨å†Œçš„ç”Ÿäº§è€…æœåŠ¡ æ­¤å¤„å¯ä»¥çœ‹åˆ°æœåŠ¡åˆ—è¡¨ï¼Œç‚¹è¿›å»çœ‹åˆ°å…¶ä¸­æœ‰å“ªäº›æœåŠ¡å®ä¾‹ åˆ›å»º Consul æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Consul UI ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-consul-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Consul å·¥ç¨‹ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º consul æœåŠ¡ æˆåŠŸåå³å¯æ ¹æ®è™šæ‹Ÿæœº IP:8500 è¿›å…¥ consul ç®¡ç†é¡µé¢ åˆ›å»º Consul ç”Ÿäº§è€…æ­¥éª¤ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œé…ç½® POM æ–‡ä»¶ org.springframework.cloud spring-cloud-starter-consul-discovery ç¼–å†™ YML é…ç½®æ–‡ä»¶ server: port: 8006 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Consul cloud: consul: host: 192.168.30.129 port: 8500 discovery: service-name: ${spring.application.name} # æ·»åŠ ä¸‹æ–¹é…ç½®è§£å†³ Consul çº¢å‰é—®é¢˜ heartbeat: enabled: true åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient åœ¨ Consul çš„ UI ç•Œé¢å¯ä»¥çœ‹åˆ°åˆšåˆšæ³¨å†Œçš„ç”Ÿäº§è€…æœåŠ¡ æ­¤å¤„å¯ä»¥çœ‹åˆ°æœåŠ¡åˆ—è¡¨ï¼Œç‚¹è¿›å»çœ‹åˆ°å…¶ä¸­æœ‰å“ªäº›æœåŠ¡å®ä¾‹ åˆ›å»º Consul æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Consul UI ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-consul-ç”Ÿäº§è€…æ­¥éª¤"},{"categories":null,"content":"\ræ­å»º Consul å·¥ç¨‹ åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ docker æ­å»º consul æœåŠ¡ æˆåŠŸåå³å¯æ ¹æ®è™šæ‹Ÿæœº IP:8500 è¿›å…¥ consul ç®¡ç†é¡µé¢ åˆ›å»º Consul ç”Ÿäº§è€…æ­¥éª¤ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œé…ç½® POM æ–‡ä»¶ org.springframework.cloud spring-cloud-starter-consul-discovery ç¼–å†™ YML é…ç½®æ–‡ä»¶ server: port: 8006 spring: # æœåŠ¡åˆ«å application: name: cloud-provider-payment # æ³¨å†Œ Consul cloud: consul: host: 192.168.30.129 port: 8500 discovery: service-name: ${spring.application.name} # æ·»åŠ ä¸‹æ–¹é…ç½®è§£å†³ Consul çº¢å‰é—®é¢˜ heartbeat: enabled: true åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient åœ¨ Consul çš„ UI ç•Œé¢å¯ä»¥çœ‹åˆ°åˆšåˆšæ³¨å†Œçš„ç”Ÿäº§è€…æœåŠ¡ æ­¤å¤„å¯ä»¥çœ‹åˆ°æœåŠ¡åˆ—è¡¨ï¼Œç‚¹è¿›å»çœ‹åˆ°å…¶ä¸­æœ‰å“ªäº›æœåŠ¡å®ä¾‹ åˆ›å»º Consul æ¶ˆè´¹è€…æ­¥éª¤ æ·»åŠ ä¸Šæ–¹åŒä¸€ä¸ªä¾èµ– é…ç½®ä¸Šæ–¹ yml æ–‡ä»¶ï¼Œæ³¨æ„ä¿®æ”¹ ç«¯å£å· å’Œ å¾®æœåŠ¡åˆ«å åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableDiscoveryClient ç¼–å†™é…ç½®ç±»ï¼Œæ³¨æ„æ·»åŠ  @LoadBalanced ä¸º RestTemplate å¼€å¯è´Ÿè½½æµšèˆªï¼Œé…ç½®ä¸šåŠ¡ç±» å¼€å¯æœåŠ¡å³å¯åœ¨ Consul UI ä¸­çœ‹åˆ°æ¶ˆè´¹è€…åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:9:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ›å»º-consul-æ¶ˆè´¹è€…æ­¥éª¤"},{"categories":null,"content":"\ræœåŠ¡æ³¨å†Œä¸å‘ç° ä¸‰è€…çš„å¼‚åŒ ç»„ä»¶å è¯­è¨€ CAP æœåŠ¡å¥åº·æ£€æŸ¥ å¯¹å¤–æš´éœ²æ¥å£ SpringCloud é›†æˆ Eureka Java AP å¯é… HTTP å·²é›†æˆ Zookeeper Java CP æ”¯æŒ å®¢æˆ·ç«¯ å·²é›†æˆ Consul GO CP æ”¯æŒ HTPP / DNS å·²é›†æˆ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡æ³¨å†Œä¸å‘ç°-ä¸‰è€…çš„å¼‚åŒ"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ CAP C**ï¼ˆConsistencyï¼‰**ï¼šä¸€è‡´æ€§ A**ï¼ˆAvailabilityï¼‰**ï¼šå¯ç”¨æ€§ P**ï¼ˆPartition toleranceï¼‰**ï¼šåˆ†åŒºå®¹é”™æ€§ï¼ˆå¾®æœåŠ¡æ¶æ„å¿…é¡»ä¿è¯æœ‰Pï¼‰ CAP ç†è®ºå…³æ³¨æ•°æ®æ˜¯ç²’åº¦ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥ Eureka ä¿è¯äº† APï¼š å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»Ÿ B å¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ ç»“è®ºï¼šè¿èƒŒäº† ä¸€è‡´æ€§ C çš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ AP Consul å’Œ zookeeper ä¿è¯äº† CPï¼š å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§ ç»“è®ºï¼šè¿èƒŒäº† å¯ç”¨æ€§ A çš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ CP ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:10:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-cap"},{"categories":null,"content":"\rRibbon è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ã€ç»´æŠ¤ã€‘ Ribbon æ˜¯ Netflix å®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯ æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶ è´Ÿè½½å‡è¡¡ ç®—æ³•å’Œ æœåŠ¡è°ƒç”¨ï¼Œæä¾›å®Œå–„çš„é…ç½®é¡¹ï¼ˆè¿æ¥è¶…æ—¶ã€é‡è¯•ï¼‰ Load Balancerï¼ˆLBï¼‰çš„æ‰€æœ‰æœºå™¨ï¼ŒRibbon ä¼šè‡ªåŠ¨çš„æ ¹æ®è´Ÿè½½å‡è¡¡è§„åˆ™è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå®¹æ˜“çš„è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³• åœ¨ SpringBoot æä¾›çš„ Eureka Client å¯åŠ¨ä¾èµ–ä¸­å·²ç»å¼•å…¥äº† Ribbon ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ribbon-è´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ç»´æŠ¤"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šåˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„ HAï¼ˆé«˜å¯ç”¨ï¼‰ Nginxã€LVSã€ç¡¬ä»¶ F5 ç­‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡"},{"categories":null,"content":"\rRibbon ä¸ Nginx çš„åŒºåˆ« Ribbon æ˜¯æœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€è¿›ç¨‹å†… LBã€‘å°†æ³¨å†Œä¸­å¿ƒçš„æ³¨å†Œä¿¡æ¯ç¼“å­˜åˆ° JVM ä¸­ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç° RPC è¿œç¨‹æœåŠ¡è°ƒç”¨ Nginx æ˜¯æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ã€é›†ä¸­å¼ LBã€‘å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™ Nginx å®ç°è¯·æ±‚è½¬å‘ï¼Œå±äºæ˜¯çœ‹å¤§é—¨çš„æœåŠ¡ç«¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ribbon-ä¸-nginx-çš„åŒºåˆ«"},{"categories":null,"content":"\rRibbon çš„å·¥ä½œæµç¨‹ é€‰æ‹©åŒä¸€åŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„æ³¨å†Œä¸­å¿ƒ Server æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ Server å–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ribbon-çš„å·¥ä½œæµç¨‹"},{"categories":null,"content":"\ré‡æ¸© RestTemplate å®˜ç½‘ï¼šhttps://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html getForEntity() å’Œ getForObject() postForEntity() å’Œ postForObject() ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡æ¸©-resttemplate"},{"categories":null,"content":"\rRibbon æä¾›çš„ IRule æ¥å£ æ ¹æ®ç‰¹å®šç®—æ³•ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡ IRule è‡ªå¸¦çš„å®ç°ç±»ï¼šé»˜è®¤ä¸º RoundRobinRule è½®è¯¢ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ribbon-æä¾›çš„-irule-æ¥å£"},{"categories":null,"content":"\ræ›´æ¢ Ribbon è´Ÿè½½å‡è¡¡è§„åˆ™ Ribbon çš„è‡ªå®šä¹‰é…ç½®ç±»ä¸å¯ä»¥æ”¾åœ¨ @ComponentScan æ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„ Ribbon å®¢æˆ·ç«¯å…±äº«ï¼Œè¾¾ä¸åˆ°ä¸ºæŒ‡å®šçš„ Ribbon å®šåˆ¶é…ç½® è€Œ @SpringBootApplication æ³¨è§£é‡Œå°±æœ‰ @ComponentScan æ³¨è§£ï¼Œæ‰€ä»¥ä¸å¯ä»¥æ”¾åœ¨ä¸»å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ä¸‹ã€‚ï¼ˆå› ä¸º Ribbon æ˜¯å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹è€…ï¼‰è¿™è¾¹çš„ï¼Œæ‰€ä»¥ Ribbon çš„è‡ªå®šä¹‰é…ç½®ç±»æ˜¯åœ¨å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹è€…ï¼‰æ·»åŠ ï¼Œä¸éœ€è¦åœ¨æä¾›è€…æˆ–æ³¨å†Œä¸­å¿ƒæ·»åŠ ï¼‰ åœ¨å½“å‰åŒ…å¤–é¢æ–°å»º com.atguigu.myrule åŒ… @Configuration public class MySelfRule { @Bean public IRule myRule(){ return new RandomRule(); //è´Ÿè½½å‡è¡¡æœºåˆ¶æ”¹ä¸ºéšæœº } } ä¸ºå¯åŠ¨ç±»æ·»åŠ æ³¨è§£ name ä¸ºæŒ‡å®šçš„æœåŠ¡åï¼ˆæœåŠ¡åå¿…é¡»ä¸æ³¨å†Œä¸­å¿ƒæ˜¾ç¤ºçš„æœåŠ¡åå¤§å°å†™ä¸€è‡´ï¼‰ configuration ä¸ºæŒ‡å®šæœåŠ¡ä½¿ç”¨è‡ªå®šä¹‰é…ç½®ï¼ˆè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼‰ @RibbonClient(name = \"CLOUD-PAYMENT-SERVICE\", configuration = MySelfRule.class) é‡å¯æ­¤æ¶ˆè´¹è€…å·¥ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶ä¸å†æ˜¯è½®è¯¢è€Œæ˜¯éšæœº ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ›´æ¢-ribbon-è´Ÿè½½å‡è¡¡è§„åˆ™"},{"categories":null,"content":"\rRibbon è½®è¯¢è´Ÿè½½å‡è¡¡åŸç† è½®è¯¢ç®—æ³•ï¼šå½“å‰è¯·æ±‚è®¡æ•° % é›†ç¾¤æ€»æ•° = N å·æœåŠ¡ 1 % 2 = 1 å·æœåŠ¡ 2 % 2 = 0 å·æœåŠ¡ 3 % 2 = 1 å·æœåŠ¡ ç”± RoundRobin å®ç°çš„ IRule æ¥å£ä¸­ choose æ–¹æ³• public Server choose(ILoadBalancer lb, Object key) { // åˆ¤æ–­è´Ÿè½½å‡è¡¡ç®—æ³•æ˜¯å¦ä¸º NULL å¦‚æœä¸º NULL åˆ™è¿”å›ç©º if (lb == null) { log.warn(\"no load balancer\"); return null; } Server server = null; int count = 0; while (server == null \u0026\u0026 count++ \u003c 10) {ã€ // è·å–å¯è¾¾çš„æœåŠ¡ List\u003cServer\u003e reachableServers = lb.getReachableServers(); // è·å¾—æ‰€æœ‰çš„æœåŠ¡ List\u003cServer\u003e allServers = lb.getAllServers(); // è·å–å¯è¾¾çš„æœåŠ¡æ•°é‡ã€æ‰€æœ‰çš„æœåŠ¡æ•°é‡ int upCount = reachableServers.size(); int serverCount = allServers.size(); // åˆ¤æ–­å¯è¾¾çš„å’Œæ‰€æœ‰çš„æœåŠ¡æ•°é‡æ˜¯å¦ä¸º 0, å¦‚æœä¸º 0 åˆ™è¿”å›ç©º if ((upCount == 0) || (serverCount == 0)) { log.warn(\"No up servers available from load balancer: \" + lb); return null; } // è·å–åˆ°å½“å‰è½®åˆ°çš„æœåŠ¡ä¸‹æ ‡ int nextServerIndex = incrementAndGetModulo(serverCount); // è·å–è¯¥ä¸‹æ ‡çš„æœåŠ¡ server = allServers.get(nextServerIndex); // å¦‚æœæœåŠ¡ä¸º NULL åˆ™è¿”å›ç©º if (server == null) { /* Transient. */ Thread.yield(); continue; } if (server.isAlive() \u0026\u0026 (server.isReadyToServe())) { return (server); } // Next. server = null; } if (count \u003e= 10) { log.warn(\"No available alive servers after 10 tries from load balancer: \" + lb); } return server; } é€šè¿‡ CAS è‡ªæ—‹é”ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰å¦‚æœå½“å‰å€¼çš„å†…å­˜åœ°å€å’ŒæœŸæœ›å€¼ç›¸åŒåˆ™äº¤æ¢å¹¶è¿”å› true å¦åˆ™åœ¨æ­¤è‡ªæ—‹ æ¯”è¾ƒå¹¶äº¤æ¢: å°†æœŸæœ›å€¼ expect ä¸ä¼ å…¥å¯¹è±¡ this åœ¨å†…å­˜ä¸­çš„åç§»é‡ä¸º valueoffset çš„å€¼ï¼ˆæ—§å€¼ï¼‰ä½œæ¯”è¾ƒ, å¦‚æœç›¸ç­‰, å°±æŠŠ update ï¼ˆæ–°å€¼ï¼‰èµ‹å€¼ç»™ valueoffset , è¿”å› true å…·ä½“çš„æ“ä½œæ˜¯ç”±ç±» sun.misc.Unsafe æ¥è´Ÿè´£çš„ï¼ŒUnsafe ç±»æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œï¼Œä½¿ç”¨ native æ–¹æ³•æ¥é—´æ¥è®¿é—®æ“ä½œç³»ç»Ÿåº•å±‚ï¼ˆå¦‚ç³»ç»Ÿç¡¬ä»¶ç­‰) ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:7","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ribbon-è½®è¯¢è´Ÿè½½å‡è¡¡åŸç†"},{"categories":null,"content":"\ræ‰‹å†™è½®è¯¢ç®—æ³• å»é™¤ @LoadBalanced æ³¨è§£ æ–°å»º lb åŒ…ï¼Œåˆ›å»º ILoadBalancer æ¥å£ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼‰ public interface ILoadBalancer { //ä¼ å…¥å…·ä½“å®ä¾‹çš„é›†åˆï¼Œè¿”å›é€‰ä¸­çš„å®ä¾‹ ServiceInstance instances(List\u003cServiceInstance\u003e serviceInstance); } åˆ›å»ºå®ç°ç±» @Component // åŠ å…¥å®¹å™¨ public class MyLB implements ILoadBalancer { // æ–°å»ºä¸€ä¸ªåŸå­æ•´å½¢ç±» private AtomicInteger atomicInteger = new AtomicInteger(0); // è·å–å½“å‰è®¿é—®è®¡æ•° public final int getAndIncrement() { int current; int next; do { current = this.atomicInteger.get(); // å¦‚æœ current æ˜¯æœ€å¤§å€¼ï¼Œé‡æ–°è®¡ç®—ï¼Œå¦åˆ™åŠ  1ï¼ˆé˜²æ­¢è¶Šç•Œï¼‰ next = current \u003e= Integer.MAX_VALUE ? 0 : current + 1; // è¿›è¡Œ CAS åˆ¤æ–­ï¼Œå¦‚æœä¸ä¸º trueï¼Œè¿›è¡Œè‡ªæ—‹ } while (!this.atomicInteger.compareAndSet(current, next)); System.out.println(\"****ç¬¬å‡ æ¬¡è®¿é—®ï¼Œæ¬¡æ•°nextï¼š\" + next); return next; } @Override public ServiceInstance instances(List\u003cServiceInstance\u003e serviceInstance) { // éç©ºåˆ¤æ–­ if (serviceInstance.size() \u003c= 0) { return null; } // è¿›è¡Œå–ä½™ int index = getAndIncrement() % serviceInstance.size(); // è¿”å›é€‰ä¸­çš„æœåŠ¡å®ä¾‹ return serviceInstance.get(index); } } åœ¨ Controller ä¸­æ·»åŠ æ–¹æ³•ï¼Œä½¿ç”¨è‡ªå·±è½®è¯¢ç®—æ³•è·å–åˆ°çš„æœåŠ¡å®ä¾‹ URI è¿›è¡Œè®¿é—® // æ³¨å…¥è‡ªå·±å†™çš„è´Ÿè½½å‡è¡¡ @Resource private ILoadBalancer iLoadBalancer; // æ³¨å…¥è·å–æ‰€æœ‰æœåŠ¡å®ä¾‹åˆ—è¡¨æ‰€éœ€çš„ @Resource private DiscoveryClient discoveryClient; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB(){ //è·å– CLOUD-PAYMENT-SERVICE æœåŠ¡çš„æ‰€æœ‰å…·ä½“å®ä¾‹ List\u003cServiceInstance\u003e instances = discoveryClient.getInstances(\"CLOUD-PAYMENT-SERVICE\"); if(instances == null || instances.size() \u003c= 0){ return null; } // è°ƒç”¨è‡ªå·±å†™çš„è´Ÿè½½å‡è¡¡è½®è¯¢ ServiceInstance serviceInstance = iLoadBalancer.instances(instances); // è·å–åˆ°å½“å‰è½®åˆ°çš„ URI URI uri = serviceInstance.getUri(); System.out.println(uri); // ä½¿ç”¨è½®è¯¢åˆ°çš„ URI è¿›è¡Œè®¿é—® return restTemplate.getForObject(uri + \"/payment/lb\", String.class); } ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:11:8","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ‰‹å†™è½®è¯¢ç®—æ³•"},{"categories":null,"content":"\rOpenFeign æœåŠ¡æ¥å£è°ƒç”¨ Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ web æœåŠ¡å®¢æˆ·ç«¯ï¼Œè®©ç¼–å†™ web æœåŠ¡å®¢æˆ·ç«¯å˜å¾—éå¸¸å®¹æ˜“ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£å³å¯ æ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œå°±æ˜¯åœ¨å‚è€ƒ Ribbon çš„åŸºç¡€ä¸Šåšçš„ä¸€å¥—æœåŠ¡æ¥å£åŠ æ³¨è§£æ–¹å¼è°ƒç”¨çš„æ•´åˆ Feign å·²ç»è¿‡æ—¶ï¼ŒOpenFeign æ›¿ä»£äº†å®ƒã€‚å®˜ç½‘ï¼šhttps://github.com/spring-cloud/spring-cloud-openfeign ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#openfeign-æœåŠ¡æ¥å£è°ƒç”¨"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ Feignã€OpenFeign Feign æ—¨è®©ç¼–å†™ Java HTTP å®¢æˆ·ç«¯æ›´å®¹æ˜“ åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºæœåŠ¡ä»¥æ¥çš„è°ƒç”¨å¯èƒ½è¿œè¿œä¸æ­¢ä¸€å¤„ï¼Œä¸€ä¸ªæ¥å£å¯èƒ½ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦å¯¹æ¯ä¸ªå¾®æœåŠ¡è¿›è¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›è°ƒç”¨ ä½¿ç”¨ Feign åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒå³å¯ï¼Œå®ŒæˆæœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®š Feign é›†æˆäº† Ribbonï¼ˆç»´æŠ¤æœåŠ¡åˆ—è¡¨ä¿¡æ¯å†é€šè¿‡è½®è¯¢å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼‰Feign åªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£å¹¶ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-feignopenfeign"},{"categories":null,"content":"\ræ­å»º OpenFeign å·¥ç¨‹ åˆ›å»ºæ¶ˆè´¹è€…å·¥ç¨‹ï¼Œæ·»åŠ  POM ä¾èµ– \u003c!-- openfeign --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-openfeign\u003c/artifactId\u003e \u003c/dependency\u003e åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œæ¿€æ´»å¹¶å¼€å¯ Feign @SpringBootApplication @EnableFeignClients // æ¿€æ´» Feign public class OrderFeignMain80 { public static void main(String[] args) { SpringApplication.run(OrderFeignMain80.class, args); } } åœ¨ service åŒ…ä¸­åˆ›å»º FeignService æ¥å£å¹¶æ·»åŠ æ³¨è§£æŒ‡å®šç”Ÿäº§è€…å¾®æœåŠ¡åˆ«å @FeignClient(value = \"CLOUD-PAYMENT-SERVICE\") public interface PaymentFeignService { @GetMapping(\"/payment/get/{id}\") public CommonResult\u003cPayment\u003e getPaymentById(@PathVariable(\"id\") Long id); } åœ¨æ§åˆ¶å±‚ä¸­æ³¨å…¥ Feign æ¥å£ï¼Œè°ƒç”¨å…¶ä¸­æ–¹æ³•å°±æ˜¯è°ƒç”¨ç”Ÿäº§è€… @RestController @Slf4j public class OrderFeignController { @Resource private PaymentFeignService paymentFeignService; @GetMapping(\"/consumer/payment/get/{id}\") public CommonResult\u003cPayment\u003e getPaymentById(@PathVariable(\"id\") Long id) { return paymentFeignService.getPaymentById(id); } } åœ¨å¯åŠ¨ç±»ä¸Šæ ‡æ³¨æ¿€æ´» Feign çš„æ³¨è§£ @EnableFeignClients åˆ›å»º FeignClient çš„æ¥å£ï¼ˆè¿™é‡Œæ˜¯ PaymentFeignServiceï¼‰æ ‡æ³¨ @FeignClient() æ³¨è§£å¹¶æŒ‡å®šç”Ÿäº§è€…æœåŠ¡åˆ«å åœ¨è¿™ä¸ªæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•è¦å’Œç”Ÿäº§è€…ä¸­çš„æ–¹æ³•ä¸€æ ·ï¼ˆå¤åˆ¶è¿‡æ¥ï¼ŒåŒ…æ‹¬æ³¨è§£ï¼‰ï¼Œåœ¨ä¸šåŠ¡å±‚ä¸­å³å¯æ³¨å…¥è¿™ä¸ªæ¥å£è°ƒç”¨å…¶æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨ç”Ÿäº§è€…ï¼‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-openfeign-å·¥ç¨‹"},{"categories":null,"content":"\rFeign çš„è¶…æ—¶æ§åˆ¶ æ¶ˆè´¹è€…çš„è¶…æ—¶æŠ¥é”™ï¼šç”Ÿäº§è€…ä¸€ä¸ªä¸šåŠ¡éœ€è¦ç”¨ 3 ç§’ç§æ‰èƒ½å¤„ç†å®Œæˆï¼Œä½†æ˜¯æ¶ˆè´¹è€…åªæ„¿æ„ç­‰ 1 ç§’é’Ÿï¼Œ1 ç§’ä¹‹åå°±æŠ¥é”™ é»˜è®¤çš„è¶…æ—¶ç­–ç•¥é‡åˆ°è¿™ç§é•¿æµç¨‹è°ƒç”¨ã€å¤æ‚ä¸šåŠ¡å°±ä¼šå‡ºç°æŠ¥é”™ï¼ˆæ¶ˆè´¹è€…é»˜è®¤ç­‰å¾… 1 ç§’é’Ÿï¼‰æ­¤æ—¶æˆ‘ä»¬éœ€è¦é…ç½® Feign çš„è¶…æ—¶ç­–ç•¥ # æ²¡æç¤ºä¸ç®¡å®ƒï¼Œå¯ä»¥è®¾ç½® (æˆ–ä½¿ç”¨ feign.client.config.default.ConnectTimeOut) ribbon: # æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 # æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥ä½¿ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#feign-çš„è¶…æ—¶æ§åˆ¶"},{"categories":null,"content":"\rFeign çš„æ—¥å¿—å¢å¼º é€šè¿‡è°ƒæ•´æ—¥å¿—çº§åˆ«æ¥å¯¹ Feign æ¥å£è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º åœ¨æ¶ˆè´¹è€… config.FeignConfig ç±»ä¸­è¿›è¡Œé…ç½® import feign.Logger; // ä¸è¦å¯¼é”™åŒ… @Configuration public class FeignConfig { @Bean Logger.Level feignLoggerLevel(){ //æ‰“å°æœ€è¯¦ç»†çš„æ—¥å¿— return Logger.Level.FULL; } } åœ¨ YML ä¸­æ·»åŠ é…ç½® #å¼€å¯æ—¥å¿—çš„ feign å®¢æˆ·ç«¯ logging: level: # feign æ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£ com.atguigu.springcloud.service.PaymentFeignService: debug # å†™åˆ° Feign çš„æœåŠ¡æ¥å£ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:12:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#feign-çš„æ—¥å¿—å¢å¼º"},{"categories":null,"content":"\rHystrix æ–­è·¯å™¨ã€ç»´æŠ¤ã€‘","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#hystrix-æ–­è·¯å™¨ç»´æŠ¤"},{"categories":null,"content":"\ræœåŠ¡é™çº§ è§£å†³ä»€ä¹ˆé—®é¢˜ åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–æœåŠ¡ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»éƒ½ä¸å¯é¿å…å‡ºç°å¤±è´¥ æœåŠ¡é›ªå´© ä¸€ä¸ªå¾®æœåŠ¡è°ƒç”¨ N ä¸ªå¾®æœåŠ¡ï¼Œè¿™ N ä¸ªå¾®æœåŠ¡åˆä¼šè°ƒç”¨ M ä¸ªå¾®æœåŠ¡â€¦ ã€æ‰‡å‡ºã€‘ å¦‚æœæ‰‡å‡ºé“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡è°ƒç”¨æ—¶é—´è¿‡é•¿æˆ–ä¸å¯ç”¨ï¼Œå¯¹ç¬¬ä¸€ä¸ªæœåŠ¡çš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æº ä¸ºäº†è§£å†³è¿™ç§é›ªå´©ï¼ˆçº§è”æ•…éšœï¼‰é—®é¢˜ï¼Œæå‡ºæœåŠ¡é™çº§çš„æ¦‚å¿µï¼ˆé“¾è·¯ä¸­æ–­çš„è§£å†³æ–¹æ¡ˆï¼‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡é™çº§-è§£å†³ä»€ä¹ˆé—®é¢˜"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ Hystrix æ˜¯ä¸€ç§ç”¨äºå¤„ç†åˆ†å¸ƒå¼çš„ å»¶è¿Ÿã€å®¹é”™ çš„å¼€æºåº“ï¼Œä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ æ–­è·¯å™¨ å½“ç›‘æ§åˆ°æŸä¸ªæœåŠ¡æ•…éšœåï¼Œå‘è°ƒç”¨æ–¹æ³•è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰æ–¹æ¡ˆï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´ç­‰å¾…æˆ–å¼‚å¸¸ ä¿è¯æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´© å®˜ç½‘ï¼šhttps://github.com/Netflix/Hystrix/wiki/How-To-Use ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-hystrix"},{"categories":null,"content":"\ræœåŠ¡é™çº§ ç›¸å…³æ¦‚å¿µ æœåŠ¡é™çº§ï¼ˆfallbackï¼‰ åœ¨æœåŠ¡å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªå¤‡é€‰å¤„ç†æ–¹æ¡ˆï¼ˆå‹å¥½æç¤ºï¼‰ è§¦å‘é™çº§ï¼šè¿è¡Œå¼‚å¸¸ã€æœåŠ¡è¶…æ—¶ã€æœåŠ¡ç†”æ–­ã€çº¿ç¨‹æ±  / ä¿¡å·é‡ æ»¡ æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½å¯ä»¥è¿›è¡ŒæœåŠ¡é™çº§ã€‚ï¼ˆä¸€èˆ¬éƒ½æ˜¯æ”¾åœ¨å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼‰ æœåŠ¡ç†”æ–­ï¼ˆbreakï¼‰ ç›¸å½“äºä¿é™©ä¸è¾¾åˆ°æœ€å¤§è®¿é—®é‡åï¼Œæ‹’ç»è®¿é—®ï¼Œè·³é—¸åœç”µ è°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ¡ˆè¿”å›å‹å¥½æç¤º æœåŠ¡é™æµï¼ˆflowlimitï¼‰ å½“å‡ºç°é«˜å¹¶å‘æƒ…å†µï¼Œä¸€çªèœ‚çš„æ‹¥æŒ¤ï¼Œæ­¤æ—¶æœåŠ¡é™æµè®©å¤§å®¶æ’é˜Ÿï¼Œæ¯ç§’å¤„ç† N ä¸ªï¼Œæœ‰åºè¿›è¡Œ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡é™çº§-ç›¸å…³æ¦‚å¿µ"},{"categories":null,"content":"\ræ­å»º Hystrix å·¥ç¨‹ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œé…ç½® POM æ–‡ä»¶æ·»åŠ  Hystrix å¯åŠ¨ä¾èµ– \u003c!-- hystrix--\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-hystrix\u003c/artifactId\u003e \u003c/dependency\u003e ç¼–å†™ YML é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯å£ã€å¾®æœåŠ¡åã€æ³¨å†Œä¸­å¿ƒ server: port: 8001 spring: application: name: cloud-provider-hystrix-payment eureka: client: register-with-eureka: true fetch-registry: true service-url: # å•æœºç‰ˆ defaultZone: http://localhost:7001/eureka ç¼–å†™å¯åŠ¨ç±»ï¼Œå¼€å¯ Eureka é…ç½®ä¸­å¿ƒ @SpringBootApplication @EnableEurekaClient public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run(PaymentHystrixMain8001.class, args); } } é«˜å¹¶å‘æµ‹è¯• è¿™é‡Œé…ç½®ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ­£å¸¸æ¥å£ç«‹å³è¿”å›å†…å®¹ï¼Œä¸€ä¸ªè¶…æ—¶æ¥å£ç­‰å¾…ä¸‰ç§’å†è¿”å› è¿™æ—¶ä½¿ç”¨ JMeter è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¼€å¯çº¿ç¨‹ç»„æ¯ç§’ 200 ä¸ªçº¿ç¨‹ï¼Œå¾ªç¯ 100 æ¬¡ï¼Œå‘ è¶…æ—¶æ¥å£ å‘é€ HTTP è¯·æ±‚ æ­¤æ—¶å‘ç°é—®é¢˜ï¼šè¶…æ—¶æ¥å£è½¬åœˆå¡é¡¿ï¼Œæ­£å¸¸æ¥å£ä¹Ÿå‘ç”Ÿè½¬åœˆå¡é¡¿ Tomcat çº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•ï¼Œæ²¡æœ‰å¤šä½™çš„çº¿ç¨‹æ¥åˆ†è§£å‹åŠ›å’Œå¤„ç†ã€‚ å¦‚æœæ­¤æ—¶å†åŠ ä¸Šæ¶ˆè´¹è€…è¯·æ±‚ï¼Œè¿˜æœ‰å¯èƒ½é€ æˆ æ¶ˆè´¹ç«¯æŠ¥è¶…æ—¶é”™è¯¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-hystrix-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Hystrix å·¥ç¨‹ åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ï¼Œé…ç½® POM æ–‡ä»¶æ·»åŠ  Hystrix å¯åŠ¨ä¾èµ– org.springframework.cloud spring-cloud-starter-netflix-hystrix ç¼–å†™ YML é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯å£ã€å¾®æœåŠ¡åã€æ³¨å†Œä¸­å¿ƒ server: port: 8001 spring: application: name: cloud-provider-hystrix-payment eureka: client: register-with-eureka: true fetch-registry: true service-url: # å•æœºç‰ˆ defaultZone: http://localhost:7001/eureka ç¼–å†™å¯åŠ¨ç±»ï¼Œå¼€å¯ Eureka é…ç½®ä¸­å¿ƒ @SpringBootApplication @EnableEurekaClient public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run(PaymentHystrixMain8001.class, args); } } é«˜å¹¶å‘æµ‹è¯• è¿™é‡Œé…ç½®ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ­£å¸¸æ¥å£ç«‹å³è¿”å›å†…å®¹ï¼Œä¸€ä¸ªè¶…æ—¶æ¥å£ç­‰å¾…ä¸‰ç§’å†è¿”å› è¿™æ—¶ä½¿ç”¨ JMeter è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¼€å¯çº¿ç¨‹ç»„æ¯ç§’ 200 ä¸ªçº¿ç¨‹ï¼Œå¾ªç¯ 100 æ¬¡ï¼Œå‘ è¶…æ—¶æ¥å£ å‘é€ HTTP è¯·æ±‚ æ­¤æ—¶å‘ç°é—®é¢˜ï¼šè¶…æ—¶æ¥å£è½¬åœˆå¡é¡¿ï¼Œæ­£å¸¸æ¥å£ä¹Ÿå‘ç”Ÿè½¬åœˆå¡é¡¿ Tomcat çº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•ï¼Œæ²¡æœ‰å¤šä½™çš„çº¿ç¨‹æ¥åˆ†è§£å‹åŠ›å’Œå¤„ç†ã€‚ å¦‚æœæ­¤æ—¶å†åŠ ä¸Šæ¶ˆè´¹è€…è¯·æ±‚ï¼Œè¿˜æœ‰å¯èƒ½é€ æˆ æ¶ˆè´¹ç«¯æŠ¥è¶…æ—¶é”™è¯¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é«˜å¹¶å‘æµ‹è¯•"},{"categories":null,"content":"\ræœåŠ¡é™çº§ çš„æƒ…å†µ æœåŠ¡æä¾›è€…è¶…æ—¶äº†ï¼Œæ¶ˆè´¹è€…ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œæ­¤æ—¶éœ€è¦æœåŠ¡é™çº§ æœåŠ¡æä¾›è€…å®•æœºäº†ï¼Œæ¶ˆè´¹è€…ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œæ­¤æ—¶éœ€è¦æœåŠ¡é™çº§ æœåŠ¡æä¾›è€…æ²¡é—®é¢˜ï¼Œæ¶ˆè´¹è€…è‡ªå·±å‡ºæ•…éšœã€ç­‰å¾…æ—¶é—´è¶…äº†ï¼Œæ­¤æ—¶è‡ªå·±å¤„ç†é™çº§ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡é™çº§-çš„æƒ…å†µ"},{"categories":null,"content":"\råœ¨ç”Ÿäº§è€…ç«¯ æœåŠ¡é™çº§é…ç½® ä¸ºå®¹æ˜“å‘ç”Ÿè¶…æ—¶çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼ŒæŒ‡å®šè¶…æ—¶çš„æ¡ä»¶ï¼Œè¶…æ—¶çš„å›è°ƒæ–¹æ³• @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\", commandProperties = { // è®¾ç½®è‡ªèº«è¶…æ—¶è°ƒç”¨æ—¶é—´çš„å³°å€¼ä¸º 3 ç§’ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼ŒæœåŠ¡é™çº§ fallback @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"3000\") }) public String paymentInfo_TimeOut(Integer id) { int timeNumber = 5; try { TimeUnit.SECONDS.sleep(timeNumber); } catch (InterruptedException e) { e.printStackTrace(); } return \"çº¿ç¨‹æ± ï¼š\" + Thread.currentThread().getName() + \"\\tpaymentInfo_TimeOutï¼Œidï¼š\" + id + \"ï¼Œè€—æ—¶ï¼š\" + timeNumber + \"ç§’\"; } public String paymentInfo_TimeOutHandler(Integer id) { return \"çº¿ç¨‹æ± ï¼š\" + Thread.currentThread().getName() + \"\\tpaymentInfo_TimeOutHandlerï¼Œidï¼š\" + id; } åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ @EnableCircuitBreaker // å¯ç”¨æ–­è·¯å™¨ æ­¤æ—¶è°ƒç”¨æ¥å£è®¿é—®æ­¤æ–¹æ³•ï¼Œåœ¨æ»¡è¶³è¶…æ—¶æ¡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶å¯¹åº”çš„ fallback æ–¹æ³•ã€å¯ä»¥çœ‹åˆ°æ­¤å¤„ç”¨çš„æ˜¯ Hystrix çš„çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‘ å¦‚æœæ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨å…¶å¯¹åº”çš„ fallback æ–¹æ³• SpringBoot çš„çƒ­éƒ¨ç½²æ’ä»¶å¯¹ @HystrixCommand å†…å±æ€§çš„ä¿®æ”¹ä¸çµï¼Œå»ºè®®æ‰‹åŠ¨é‡å¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åœ¨ç”Ÿäº§è€…ç«¯-æœåŠ¡é™çº§é…ç½®"},{"categories":null,"content":"\råœ¨æ¶ˆè´¹è€…ç«¯ æœåŠ¡é™çº§é…ç½® åœ¨æ¶ˆè´¹è€…çš„ YML é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼Œå¼€å¯ Feign å¯¹ Hystrix æ–­è·¯å™¨çš„æ”¯æŒ feign: hystrix: enabled: true åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£å¼€å¯ Hystrix çš„æ”¯æŒ @EnableHystrix // å…¶ä¸­åŒ…å«äº† @EnableCircuitBreaker å’Œç”Ÿäº§è€…ä¸€æ ·é…ç½®æ–­è·¯çš„å¤„ç† @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id){ String result = paymentHystrixService.paymentInfo_TimeOut(id); return result; } public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id){ return \"æ¶ˆè´¹è€…80ï¼Œæ”¯ä»˜ç³»ç»Ÿç¹å¿™\"; } æµ‹è¯•å‘ç°ï¼š å¦‚æœæ˜¯ç”±äºç”Ÿäº§è€…çš„è¶…æ—¶é€ æˆçš„æœåŠ¡é™çº§ï¼Œåˆ™ä¼˜å…ˆè¿›å…¥ æ¶ˆè´¹è€… fallback å¦‚æœæ˜¯ç”±äºç”Ÿäº§è€…çš„å¼‚å¸¸é€ æˆçš„æœåŠ¡é™çº§ï¼Œåˆ™ä¼˜å…ˆè¿›å…¥ ç”Ÿäº§è€… fallback å¦‚æœæ˜¯ç”±äºæ¶ˆè´¹è€…ç­‰ä¸åŠé€ æˆçš„æœåŠ¡é™çº§ï¼Œåˆ™ä¼˜å…ˆè¿›å…¥ æ¶ˆè´¹è€… fallback ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:7","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åœ¨æ¶ˆè´¹è€…ç«¯-æœåŠ¡é™çº§é…ç½®"},{"categories":null,"content":"\ré‡åˆ°çš„é—®é¢˜ æ¯ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½è¦é…ç½®ä¸€ä¸ªå…œåº•æ–¹æ³•ï¼Œå¯¼è‡´ä»£ç è†¨èƒ€ é™¤äº†ä¸ªåˆ«ä¸šåŠ¡æœ‰ä¸“å± fallbackï¼Œå…¶å®ƒæ™®é€šä¸šåŠ¡å¯ä»¥é…ç½®å…¨å±€ç»Ÿä¸€å…œåº•æ–¹æ³•ï¼šä¸ºç±»æ·»åŠ æ³¨è§£å¹¶è®¾ç½®ç»Ÿä¸€å…œåº•æ–¹æ³•ï¼Œåœ¨ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ @Slf4j @RestController @DefaultProperties(defaultFallback = \"payment_Global_FallbackMethod\") public class OrderHystrixController { @Resource private PaymentHystrixService paymentHystrixService; @HystrixCommand @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id){ String result = paymentHystrixService.paymentInfo_OK(id); return result; } // ...... å¦‚æœæœ‰éœ€è¦ç‹¬äº«å…œåº•æ–¹æ³•çš„ä¸šåŠ¡æ–¹æ³•ä¹Ÿå¯ä»¥æ ¹æ®ä¸Šæ–¹ä¸“å± fallback é…ç½®æ¥å¤„ç† /** * å…¨å±€ä¸šåŠ¡å¤„ç†å…œåº• fallback æ–¹æ³• * * @return æç¤º */ public String payment_Global_FallbackMethod(){ return \"æ¶ˆè´¹è€…80ï¼Œæ”¯ä»˜ç³»ç»Ÿç¹å¿™, è¿›å…¥å…¨å±€å…œåº•æ–¹æ³•\"; } } å…œåº•æ–¹æ³•å’Œä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œå¯¼è‡´ä»£ç æ··ä¹±ï¼Œè€¦åˆåº¦é«˜ ä¸º FeignClient æ¥å£åˆ›å»ºå®ç°ç±»ï¼Œåœ¨å®ç°ç±»ä¸­é‡å†™æ‰€æœ‰æ¥å£æ–¹æ³•ï¼Œå°±æ˜¯å…œåº•æ–¹æ³• ä¸ºæ¥å£ @FeignClient æ³¨è§£æ·»åŠ  fallback å±æ€§æŒ‡å®šåˆ°è¿™ä¸ªå®ç°ç±»ä¸Š æ­¤æ—¶å½“æ‰€æœ‰ç”Ÿäº§è€…æœåŠ¡éƒ½å®•æœºæ— æ³•åšå‡ºå›åº”æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨è¿™é‡Œçš„å…œåº•æ–¹æ³• ä½†æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯å¯ç”¨çŠ¶æ€åªæ˜¯æ— æ³•åœ¨æ¶ˆè´¹è€…æ¥å—çš„æ—¶é—´å†…å“åº”çš„è¯ï¼Œä¼šè°ƒç”¨æ¶ˆè´¹è€…çš„å…¨å±€å…œåº•æ–¹æ³•ï¼ˆæœ‰é…ç½®ç‹¬äº«å…œåº•æ–¹æ³•é™¤å¤–ï¼‰ å½“ç”Ÿäº§è€…å‘ç”Ÿä¸æ˜¯é…ç½®çš„è¶…æ—¶é—®é¢˜æ—¶ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰åˆ™ä¼šè°ƒç”¨ç”Ÿäº§è€…çš„å…œåº•æ–¹æ³• æ­¤æ—¶æœåŠ¡ç«¯ provider å·²ç» down äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åšäº†æœåŠ¡é™çº§å¤„ç†ï¼Œè®©å®¢æˆ·ç«¯åœ¨æœåŠ¡ç«¯ä¸å¯ç”¨æ—¶ä¹Ÿä¼šè·å¾—æç¤ºä¿¡æ¯è€Œä¸ä¼šæŒ‚èµ·è€—æ­»æœåŠ¡å™¨ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:8","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°çš„é—®é¢˜-a-idhystrixproblem-a"},{"categories":null,"content":"\ræœåŠ¡ç†”æ–­ çš„æƒ…å†µ æœåŠ¡è°ƒç”¨å¤±è´¥ä¼šè§¦å‘é™çº§ï¼Œé™çº§ä¼šè°ƒç”¨å…¶ fallback æ–¹æ³•ï¼Œæ— è®ºå¦‚ä½•é™çº§çš„æµç¨‹æ˜¯å…ˆè°ƒç”¨æ­£å¸¸æ–¹æ³•åè°ƒç”¨ fallback æ–¹æ³• æœåŠ¡ç†”æ–­æ˜¯æŒ‡å•ä½æ—¶é—´å†…å¤±è´¥çš„æ¬¡æ•°è¿‡å¤šï¼Œä¹Ÿå°±æ˜¯é™çº§æ¬¡æ•°è¿‡å¤šï¼Œåˆ™è§¦å‘ç†”æ–­ è·³è¿‡æ­£å¸¸æ–¹æ³•ç›´æ¥è°ƒç”¨ fallback æ–¹æ³• ç†”æ–­åä¸å¯ç”¨ å°±åƒæ˜¯ä¿é™©ä¸è·³é—¸äº†ï¼Œéœ€è¦æ£€æµ‹åˆ°èŠ‚ç‚¹è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:9","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡ç†”æ–­-çš„æƒ…å†µ"},{"categories":null,"content":"\råœ¨ç”Ÿäº§è€…ç«¯ æœåŠ¡ç†”æ–­é…ç½® åœ¨ç”Ÿäº§è€… Service ä¸­é…ç½® @HystrixCommand æ³¨è§£ä¸­é…ç½®å¼€å¯æ–­è·¯å™¨ï¼Œè®¾ç½®åœ¨ 10 ç§’æ—¶é—´å†…ï¼Œæ€»é˜ˆå€¼ä¸º 10 æ¬¡ï¼Œå¦‚æœé”™è¯¯ç‡è¾¾åˆ° 60%ï¼ˆä¹Ÿå°±æ˜¯ 6 æ¬¡ï¼‰ï¼Œè·³é—¸ æ·»åŠ å¯¹åº”æ§åˆ¶å±‚æ–¹æ³•è¿›è¡Œè®¿é—® åœ¨ 10 ç§’å†…è¿›è¡Œå¤šæ¬¡é”™è¯¯å°è¯•ï¼Œè§¦å‘æ–­è·¯å™¨æœåŠ¡ç†”æ–­ï¼Œæ­¤æ—¶å¦‚æœå†è¿›è¡Œæ­£ç¡®çš„è®¿é—®ä¾ç„¶è¿›å…¥ fallback æ–¹æ³•ï¼Œ10 ç§’åå¼€å¯åŠå¼€æ¨¡å¼ï¼Œç›´åˆ°æ­£ç¡®çš„å¤„ç†è¯·æ±‚ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:10","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åœ¨ç”Ÿäº§è€…ç«¯-æœåŠ¡ç†”æ–­é…ç½®"},{"categories":null,"content":"\ræœåŠ¡é™æµ çš„æƒ…å†µ åé¢ä¼šåœ¨ SpringCloud Alibaba ä¸­çš„ Sentinel è¯´æ˜ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:11","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡é™æµ-çš„æƒ…å†µ"},{"categories":null,"content":"\ræ€»ç»“ å¦‚æœè¯·æ±‚æ¬¡æ•°çš„é”™è¯¯ç‡è¶…è¿‡æŒ‡å®šå€¼ï¼Œå¼€å¯ç†”æ–­ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œå˜ä¸ºåŠå¼€æ¨¡å¼ç„¶åæ”¾è¿›ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¯·æ±‚å¤„ç†æˆåŠŸï¼Œå…³é—­ç†”æ–­ï¼›å¦‚æœè¿˜æ˜¯æŠ¥é”™ï¼Œç»§ç»­è¿›å…¥ç†”æ–­ï¼Œå†ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œå˜ä¸ºåŠå¼€æ¨¡å¼ï¼Œå†è¿›è¡Œå¯¹ä¸‹ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œä¸€ç›´åœ¨ç†”æ–­ï¼ŒåŠå¼€æ¨¡å¼æ¥å›åˆ‡æ¢ï¼Œç›´åˆ°è¯·æ±‚æˆåŠŸï¼Œå…³é—­ç†”æ–­ã€‚ æ–­è·¯å™¨åœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹èµ·ä½œç”¨ å¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€ éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„ 10 ç§’ è¯·æ±‚æ€»æ•°é˜ˆå€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜ˆå€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ 20ï¼Œæ„å‘³ç€åœ¨ 10 ç§’å†…ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°ä¸è¶³ 20 æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å¤±è´¥ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜ˆå€¼ï¼Œæ¯”å¦‚å‘ç”Ÿäº† 30 æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™ 30 æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰ 15 æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡äº† 50% çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤ï¼‰è¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:12","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ€»ç»“"},{"categories":null,"content":"\rHystrix çš„ dashboard ä»ªè¡¨ç›˜ å¦‚ä½•æ­å»ºæŒ‰ç…§å®˜ç½‘ WIKIï¼šHome Â· Netflix-Skunkworks/hystrix-dashboard Wiki (github.com) ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:13:13","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#hystrix-çš„-dashboard-ä»ªè¡¨ç›˜"},{"categories":null,"content":"\rZuul æœåŠ¡ç½‘å…³ zuul æ ¸å¿ƒäººå‘˜è¢«æŒ–èµ°äº†ä¸‰ä¸ªã€å†…éƒ¨åˆ†æ­§ï¼Œzuul2 çš„ç ”å‘è¿‡ä¹…ï¼Œspring å…¬å¸ç­‰ä¸åŠï¼Œè‡ªå·±ç ”å‘çš„ Gateway ç½‘å…³ Zuul çš„å®˜ç½‘ WIKIï¼šHome Â· Netflix/zuul Wiki (github.com) Zuul 1.x æ˜¯ä¸€ä¸ªåŸºäº Servlet 2.5 é˜»å¡ I/O çš„ API Gatewayï¼Œæ¯æ¬¡ I/O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œå®Œæˆå®Œæˆ Zuul 1.x çš„è®¾è®¡æ¨¡å¼å’Œ Nginx æœ‰ç‚¹åƒï¼Œä½†æ˜¯ Nginx æ˜¯ç”¨ C/C++ å®ç°çš„ï¼ŒZuul æ˜¯ç”¨ Java å®ç°å…·æœ‰ JVM é¦–æ¬¡åŠ è½½è¾ƒæ…¢çš„ç‰¹æ€§ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·® Zuul 2.x æ˜¯åŸºäº Netty éé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ã€‚SpringCloud çš„ Gateway æ˜¯ Zuul çš„ 1.6 å€ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:14:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#zuul-æœåŠ¡ç½‘å…³"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³ ç»Ÿä¸€çš„æŒ¡åœ¨å‰é¢è¿›è¡Œæ—¥å¿—ã€é™æµã€æƒé‰´ã€å®‰å…¨åŠ å›ºç­‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:14:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³"},{"categories":null,"content":"\rGateway æœåŠ¡ç½‘å…³ Gateway æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹ API è¿›è¡Œè·¯ç”± åŸºäº Filter é“¾çš„æ–¹å¼æä¾›ç½‘å…³çš„åŸºæœ¬åŠŸèƒ½ï¼šå®‰å…¨ã€ç›‘æ§/æŒ‡æ ‡ã€é™æµ ä¸ºäº†æå‡æ€§èƒ½ Gateway æ˜¯åŸºäº WebFlux æ¡†æ¶å®ç°çš„ WebFlux æ¡†æ¶æ˜¯ Spring5 æä¾›çš„ä¸€ç§åº•å±‚ä½¿ç”¨äº†é«˜æ€§èƒ½çš„ Reactor æ¨¡å¼é€šä¿¡æ¡†æ¶ Nettyï¼Œåœ¨é«˜å¹¶å‘å’Œéé˜»å¡å¼é€šä¿¡åœºæ™¯ä¸‹éå¸¸æœ‰ä¼˜åŠ¿ é˜»å¡å¼ I/O æ¨¡å‹ä¸­ï¼Œä¾‹å¦‚ Servletï¼Œå½“è¯·æ±‚è¿›å…¥ servlet container æ—¶ï¼Œservlet container å°±ä¼šä¸ºå…¶ç»‘å®šä¸€ä¸ªçº¿ç¨‹, åœ¨å¹¶å‘ä¸é«˜çš„åœºæ™¯ä¸‹è¿™ç§æ¨¡å‹æ˜¯é€‚ç”¨çš„ã€‚ä½†æ˜¯ä¸€æ—¦é«˜å¹¶å‘ (æ¯”å¦‚ç”¨ jemeter å‹æµ‹) ï¼Œçº¿ç¨‹æ•°é‡å°±ä¼šä¸Šæ¶¨ï¼Œè€Œçº¿ç¨‹èµ„æºä»£ä»·æ˜¯æ˜‚è´µçš„ (ä¸Šçº¿æ–‡åˆ‡æ¢ï¼Œå†…å­˜æ¶ˆè€—å¤§) ä¸¥é‡å½±å“è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚åœ¨ä¸€äº›ç®€å•ä¸šåŠ¡åœºæ™¯ä¸‹, ä¸å¸Œæœ›ä¸ºæ¯ä¸ª request åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œ åªéœ€è¦ 1 ä¸ªæˆ–å‡ ä¸ªçº¿ç¨‹å°±èƒ½åº”å¯¹æå¤§å¹¶å‘çš„è¯·æ±‚ï¼Œè¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹ servlet æ¨¡å‹æ²¡æœ‰ä¼˜åŠ¿ã€‚ æ‰€ä»¥ Zuul 1.X æ˜¯åŸºäº Servlet ä¹‹ä¸Šçš„ä¸€ä¸ªé˜»å¡å¼å¤„ç†æ¨¡å‹, å³ spring å®ç°äº†å¤„ç†æ‰€æœ‰ request è¯·æ±‚çš„ä¸€ä¸ª servlet (DispatcherServlet) å¹¶ç”±è¯¥ servlet é˜»å¡å¼å¤„ç†å¤„ç†ã€‚æ‰€ä»¥Springcloud Zuulæ— æ³•æ‘†è„± servlet æ¨¡å‹çš„å¼Šç«¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gateway-æœåŠ¡ç½‘å…³"},{"categories":null,"content":"\rGateway çš„ç‰¹æ€§ åŠ¨æ€è·¯ç”±ï¼ˆRouteï¼‰ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§ é›†æˆæœåŠ¡å‘ç°åŠŸèƒ½ã€Hystrix çš„æ–­è·¯å™¨åŠŸèƒ½ æ‹¥æœ‰æ˜“äºç¼–å†™çš„ æ–­è¨€ï¼ˆPredicateï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ è¯·æ±‚é™æµåŠŸèƒ½ã€æ”¯æŒè·¯å¾„é‡å†™ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gateway-çš„ç‰¹æ€§"},{"categories":null,"content":"\rGateway çš„æ ¸å¿ƒæ¦‚å¿µ è·¯ç”±ï¼ˆRouteï¼‰ è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”± æ–­è¨€ï¼ˆPredicateï¼‰ å‚è€ƒçš„æ˜¯ java8 çš„ java.util.function.Predicate å¼€å‘äººå‘˜å¯ä»¥åŒ¹é… HTTP è¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”± è¿‡æ»¤ï¼ˆFilterï¼‰ æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gateway-çš„æ ¸å¿ƒæ¦‚å¿µ"},{"categories":null,"content":"\rGateway å·¥ä½œæµç¨‹ å®¢æˆ·ç«¯å‘ Gateway å‘å‡ºè¯·æ±‚ï¼Œç„¶ååœ¨ Gateway handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ã€è·¯ç”±è½¬å‘ã€‘ å°†å…¶å‘é€åˆ° Gateway Web Handler é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€æ‰§è¡Œè¿‡æ»¤é“¾ã€‘ åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆpreï¼‰å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ åœ¨å¤„ç†å®Œè¯·æ±‚ä¹‹åï¼ˆpostï¼‰å¯ä»¥åšç›¸åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ã€æ—¥å¿—çš„è¾“å‡ºã€æµé‡ç›‘æ§ç­‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#gateway-å·¥ä½œæµç¨‹"},{"categories":null,"content":"\ræ­å»º Gateway å·¥ç¨‹ æ·»åŠ  POM ä¾èµ– \u003c!-- gateway --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-gateway\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- eureka client(é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±) --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-netflix-eureka-client\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- ä¸€èˆ¬é€šç”¨ä¾èµ– --\u003e \u003c!-- æ­¤å¤„ä¸éœ€è¦ spring-boot-starter-web ä¾èµ–ï¼Œå› ä¸ºæ˜¯ç½‘å…³ï¼Œç”¨çš„æ˜¯ Webflux --\u003e é…ç½® YML æ–‡ä»¶ åœ¨é…ç½®äº†ç½‘å…³è·¯ç”±ä¹‹åï¼Œæƒ³è®¿é—®æ–­è¨€ä¸­çš„è·¯å¾„çš„è¯å°±ä¼šå…ˆç»ç”±æ­¤é¡¹ç›®è¿‡æ»¤ server: port: 9527 spring: application: name: cloud-gateway # ä¸‹æ–¹é…ç½® Gateway cloud: gateway: routes: - id: payment_route # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_route2 # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: fetch-registry: true register-with-eureka: true service-url: defaultZone: http://eureka7001.com:7001/eureka/ ç¼–å†™å¯åŠ¨ç±» @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run(GatewayMain9527.class, args); } } æµ‹è¯•ï¼Œæ­¤æ—¶é€šè¿‡ http://localhost:8001/payment/get/1 ä¹Ÿå¯ä»¥è®¿é—® ç¬¬äºŒç§é…ç½®æ–¹å¼ ä½¿ç”¨æ³¨å…¥ RouteLocator çš„ Bean çš„æ–¹å¼é…ç½® æ–°å»ºé…ç½®ç±» config.GatewayConfig @Configuration public class GatewayConfig { @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder) { RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); routes.route(\"path_route_auguigu\", // id r -\u003e r.path(\"/guonei\") // è®¿é—® http://localhost:9527/guonei .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com routes.route(\"path_route_atguigu2\", // id r -\u003e r.path(\"/guoji\") // è®¿é—® http://localhost:9527/guoji .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com return routes.build(); } // @Bean // public RouteLocator customRouteLocator2(RouteLocatorBuilder routeLocatorBuilder){ // RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); // // routes.route(\"path_route_atguigu2\", //id // r -\u003e r.path(\"/guoji\") //è®¿é—® http://localhost:9527/guoji // .uri(\"https://news.baidu.com/\")); //å°±ä¼šè½¬å‘åˆ° https://news.baidu.com // // return routes.build(); // } } å®ç°åŠ¨æ€è·¯ç”± å½“å‰æƒ…å†µä¸‹è·¯ç”±åœ°å€æ˜¯å†™æ­»çš„ï¼Œä½†æ˜¯ç”Ÿäº§è€…å¾€å¾€éƒ½æ˜¯é›†ç¾¤ï¼Œæ‰€ä»¥éœ€è¦é…ç½®åˆ°ç”Ÿäº§è€…å¾®æœåŠ¡åˆ«åï¼Œè¿›è¡ŒåŠ¨æ€è·¯ç”±è½¬å‘ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä¿®æ”¹æä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ä¸ºç”Ÿäº§è€…å¾®æœåŠ¡åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-gateway-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Gateway å·¥ç¨‹ æ·»åŠ  POM ä¾èµ– org.springframework.cloud spring-cloud-starter-gateway org.springframework.cloud spring-cloud-starter-netflix-eureka-client é…ç½® YML æ–‡ä»¶ åœ¨é…ç½®äº†ç½‘å…³è·¯ç”±ä¹‹åï¼Œæƒ³è®¿é—®æ–­è¨€ä¸­çš„è·¯å¾„çš„è¯å°±ä¼šå…ˆç»ç”±æ­¤é¡¹ç›®è¿‡æ»¤ server: port: 9527 spring: application: name: cloud-gateway # ä¸‹æ–¹é…ç½® Gateway cloud: gateway: routes: - id: payment_route # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_route2 # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: fetch-registry: true register-with-eureka: true service-url: defaultZone: http://eureka7001.com:7001/eureka/ ç¼–å†™å¯åŠ¨ç±» @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run(GatewayMain9527.class, args); } } æµ‹è¯•ï¼Œæ­¤æ—¶é€šè¿‡ http://localhost:8001/payment/get/1 ä¹Ÿå¯ä»¥è®¿é—® ç¬¬äºŒç§é…ç½®æ–¹å¼ ä½¿ç”¨æ³¨å…¥ RouteLocator çš„ Bean çš„æ–¹å¼é…ç½® æ–°å»ºé…ç½®ç±» config.GatewayConfig @Configuration public class GatewayConfig { @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder) { RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); routes.route(\"path_route_auguigu\", // id r -\u003e r.path(\"/guonei\") // è®¿é—® http://localhost:9527/guonei .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com routes.route(\"path_route_atguigu2\", // id r -\u003e r.path(\"/guoji\") // è®¿é—® http://localhost:9527/guoji .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com return routes.build(); } // @Bean // public RouteLocator customRouteLocator2(RouteLocatorBuilder routeLocatorBuilder){ // RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); // // routes.route(\"path_route_atguigu2\", //id // r -\u003e r.path(\"/guoji\") //è®¿é—® http://localhost:9527/guoji // .uri(\"https://news.baidu.com/\")); //å°±ä¼šè½¬å‘åˆ° https://news.baidu.com // // return routes.build(); // } } å®ç°åŠ¨æ€è·¯ç”± å½“å‰æƒ…å†µä¸‹è·¯ç”±åœ°å€æ˜¯å†™æ­»çš„ï¼Œä½†æ˜¯ç”Ÿäº§è€…å¾€å¾€éƒ½æ˜¯é›†ç¾¤ï¼Œæ‰€ä»¥éœ€è¦é…ç½®åˆ°ç”Ÿäº§è€…å¾®æœåŠ¡åˆ«åï¼Œè¿›è¡ŒåŠ¨æ€è·¯ç”±è½¬å‘ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä¿®æ”¹æä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ä¸ºç”Ÿäº§è€…å¾®æœåŠ¡åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç¬¬äºŒç§é…ç½®æ–¹å¼"},{"categories":null,"content":"\ræ­å»º Gateway å·¥ç¨‹ æ·»åŠ  POM ä¾èµ– org.springframework.cloud spring-cloud-starter-gateway org.springframework.cloud spring-cloud-starter-netflix-eureka-client é…ç½® YML æ–‡ä»¶ åœ¨é…ç½®äº†ç½‘å…³è·¯ç”±ä¹‹åï¼Œæƒ³è®¿é—®æ–­è¨€ä¸­çš„è·¯å¾„çš„è¯å°±ä¼šå…ˆç»ç”±æ­¤é¡¹ç›®è¿‡æ»¤ server: port: 9527 spring: application: name: cloud-gateway # ä¸‹æ–¹é…ç½® Gateway cloud: gateway: routes: - id: payment_route # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_route2 # è·¯ç”±çš„id, æ²¡æœ‰è§„å®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€, å»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 # åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€, è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: fetch-registry: true register-with-eureka: true service-url: defaultZone: http://eureka7001.com:7001/eureka/ ç¼–å†™å¯åŠ¨ç±» @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run(GatewayMain9527.class, args); } } æµ‹è¯•ï¼Œæ­¤æ—¶é€šè¿‡ http://localhost:8001/payment/get/1 ä¹Ÿå¯ä»¥è®¿é—® ç¬¬äºŒç§é…ç½®æ–¹å¼ ä½¿ç”¨æ³¨å…¥ RouteLocator çš„ Bean çš„æ–¹å¼é…ç½® æ–°å»ºé…ç½®ç±» config.GatewayConfig @Configuration public class GatewayConfig { @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder) { RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); routes.route(\"path_route_auguigu\", // id r -\u003e r.path(\"/guonei\") // è®¿é—® http://localhost:9527/guonei .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com routes.route(\"path_route_atguigu2\", // id r -\u003e r.path(\"/guoji\") // è®¿é—® http://localhost:9527/guoji .uri(\"https://news.baidu.com/\")); // å°±ä¼šè½¬å‘åˆ° https://news.baidu.com return routes.build(); } // @Bean // public RouteLocator customRouteLocator2(RouteLocatorBuilder routeLocatorBuilder){ // RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); // // routes.route(\"path_route_atguigu2\", //id // r -\u003e r.path(\"/guoji\") //è®¿é—® http://localhost:9527/guoji // .uri(\"https://news.baidu.com/\")); //å°±ä¼šè½¬å‘åˆ° https://news.baidu.com // // return routes.build(); // } } å®ç°åŠ¨æ€è·¯ç”± å½“å‰æƒ…å†µä¸‹è·¯ç”±åœ°å€æ˜¯å†™æ­»çš„ï¼Œä½†æ˜¯ç”Ÿäº§è€…å¾€å¾€éƒ½æ˜¯é›†ç¾¤ï¼Œæ‰€ä»¥éœ€è¦é…ç½®åˆ°ç”Ÿäº§è€…å¾®æœåŠ¡åˆ«åï¼Œè¿›è¡ŒåŠ¨æ€è·¯ç”±è½¬å‘ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä¿®æ”¹æä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ä¸ºç”Ÿäº§è€…å¾®æœåŠ¡åˆ«å ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å®ç°åŠ¨æ€è·¯ç”±"},{"categories":null,"content":"\ræ–­è¨€ Predicate çš„ä½¿ç”¨ åœ¨é¡¹ç›®å¯åŠ¨æ—¶å¯ä»¥çœ‹åˆ°ç”±æ–­è¨€å·¥å‚åŠ è½½äº†å¾ˆå¤š Predicate å¯ä»¥æŸ¥çœ‹å®˜ç½‘ï¼šSpring Cloud Gateway å…³äºè¿™éƒ¨åˆ†çš„ä»‹ç» åœ¨åŸæœ‰ predicates ä¸‹æ–¹æ·»åŠ æ–°çš„æ–­è¨€è§„åˆ™å³å¯ï¼ˆè¿™é‡Œ after è¡¨ç¤ºï¼‰ åœ¨æ·»åŠ äº† cookie æ–­è¨€æ—¶ï¼Œä½¿ç”¨ curl å‘½ä»¤æµ‹è¯• åœ¨æ·»åŠ äº† Header æ–­è¨€æ—¶ï¼Œä½¿ç”¨ curl å‘½ä»¤æµ‹è¯• ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ–­è¨€-predicate-çš„ä½¿ç”¨"},{"categories":null,"content":"\rè¿‡æ»¤å™¨ Filter çš„ä½¿ç”¨ æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ’åˆ† pre å‰ç½®è¿‡æ»¤ post åç½®è¿‡æ»¤ æŒ‰ç…§ç§ç±»åˆ’åˆ† GatewayFilter å•ä¸€çš„ï¼ˆ 31 ç§ï¼‰ GlobaFilter å…¨å±€çš„ï¼ˆ 10 ç§ï¼‰ å¯ä»¥æŸ¥çœ‹å®˜ç½‘ï¼šSpring Cloud Gateway å…³äºè¿‡æ»¤å™¨çš„ä½¿ç”¨ åœ¨ Spring å¯æ‰«æåŒ…ä¸‹åˆ›å»º filter.MyLogGateWayFilter å®ç° GlobalFilter Ordered æ¥å£ åœ¨ filter æ–¹æ³•ä¸‹å†™è¿‡æ»¤æ¡ä»¶ åœ¨ getOrder æ–¹æ³•è¿”å›å½“å‰è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜è¶Šå…ˆè¿‡æ»¤ @Component @Slf4j public class MyLogGateWayFilter implements GlobalFilter, Ordered { @Override public Mono\u003cVoid\u003e filter(ServerWebExchange exchange, GatewayFilterChain chain) { log.info(\"**************come in MyLogGateWayFilterï¼š\" + new Date()); //è·å–requestä¸­çš„unameå‚æ•° String uname = exchange.getRequest().getQueryParams().getFirst(\"uname\"); if(uname == null){ log.info(\"*******ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼ï¼\"); //è®¾ç½®å“åº”ï¼Œä¸è¢«æ¥å— exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE); return exchange.getResponse().setComplete(); } //è¿”å›chain.filter(exchange)ï¼Œæ”¾è¡Œ return chain.filter(exchange); } @Override public int getOrder() { //è¿”å›å€¼æ˜¯è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆæœ€å°-2147483648ï¼Œæœ€å¤§2147483648ï¼‰ return 0; } } æµ‹è¯•ä½¿ç”¨ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:15:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿‡æ»¤å™¨-filter-çš„ä½¿ç”¨"},{"categories":null,"content":"\rConfig åˆ†å¸ƒå¼æœåŠ¡é…ç½® ç”±äºå¾®æœåŠ¡ç§å•ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚æ¯å¥—ç³»ç»Ÿéƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œ æ‰€ä»¥ä¸€å¥—é›†ä¸­çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†ï¼Œä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„ç¯å¢ƒæä¾›ä¸€ç§ä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½® SpringCLoud Config æä¾›åŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œä¸åŒç¯å¢ƒä¸åŒé…ç½®ã€‚å¯ä»¥åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯ä¾¿å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½® å®˜ç½‘ï¼šhttps://docs.spring.io/spring-cloud-config/docs/current/reference/html/ æœåŠ¡ç«¯ï¼šä¹Ÿç§°å¾®æœåŠ¡é…ç½®ä¸­å¿ƒï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ å®¢æˆ·ç«¯ï¼šé€šè¿‡é…ç½®ä¸­å¿ƒæ¥è·å–é…ç½®å†…å®¹ç®¡ç†åº”ç”¨èµ„æº ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#config-åˆ†å¸ƒå¼æœåŠ¡é…ç½®"},{"categories":null,"content":"\ræ­å»ºæœåŠ¡ç«¯é…ç½® åœ¨ Github ä¸­åˆ›å»ºä¸€ä¸ªåä¸º springcloud-config çš„å·¥ç¨‹ï¼Œå…¶ä¸­é…ç½®æ–‡ä»¶å‘½ååº”ç¬¦åˆ {application}-{profile}.yml å†™æ³• åˆ›å»ºé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯ï¼Œåœ¨ POM ä¸­æ·»åŠ  config ä¾èµ– \u003c!-- config server --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-config-server\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- æ³¨å†Œä¸­å¿ƒä¾èµ–ã€ä¸€èˆ¬é€šç”¨ä¾èµ– ... --\u003e é…ç½® YML æ–‡ä»¶ server: port: 3344 spring: application: name: cloud-config-center # æ³¨å†Œè¿› Eureka æœåŠ¡å™¨çš„å¾®æœåŠ¡å cloud: config: server: git: uri: https://github.com/LiuJJJJN/springcloud-config.git # git çš„ä»“åº“åœ°å€ default-label: main # è¯»å–çš„åˆ†æ”¯ # search-paths: # æœç´¢ç›®å½• # - springcloud-config eureka: client: service-url: defaultZone: http://localhost:7001/eureka # æœåŠ¡æ³¨å†Œåˆ°çš„ eureka åœ°å€ é…ç½®ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ æ³¨è§£ @EnableConfigServer @EnableConfigServer @SpringBootApplication public class ConfigCenterMain3344 { public static void main(String[] args) { SpringApplication.run(ConfigCenterMain3344.class, args); } } ä¿®æ”¹ Hosts æ–‡ä»¶æ·»åŠ æ˜ å°„ 127.0.0.1 config-3344 æ­¤æ—¶è®¿é—® config-3344:3344/åˆ†æ”¯å/æ–‡ä»¶å å°±å¯ä»¥çœ‹åˆ° Github ä»“åº“ä¸­å¯¹åº”æ–‡ä»¶çš„å†…å®¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»ºæœåŠ¡ç«¯é…ç½®"},{"categories":null,"content":"\ré…ç½®è¯»å–è§„åˆ™\r/åˆ†æ”¯å/XXX-XX.yml æ–¹å¼ï¼šæ¨èå†™æ³• /XXX-XX.yml æ–¹å¼ï¼šä½¿ç”¨çš„é…ç½®ä¸­çš„åˆ†æ”¯ï¼Œé»˜è®¤ master /XXX-XX.yml/åˆ†æ”¯å æ–¹å¼ï¼šJSON ä¸² ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®è¯»å–è§„åˆ™"},{"categories":null,"content":"\ræ­å»ºå®¢æˆ·ç«¯é…ç½® åˆ›å»ºæ¨¡å—æ·»åŠ  POM ä¾èµ– \u003c!-- config client --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-config\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- æ³¨å†Œä¸­å¿ƒä¾èµ–ã€ä¸€èˆ¬é€šç”¨ä¾èµ– ... --\u003e ç¼–å†™ bootstrap.ymlé…ç½®æ–‡ä»¶ bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆè¢«åŠ è½½ï¼Œä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›– SpringCloud ä¼šåˆ›å»ºä¸€ä¸ª Bootstrap Context ä½œä¸º Spring åº”ç”¨çš„ Application Context çš„çˆ¶ä¸Šä¸‹æ–‡ åˆå§‹åŒ–çš„æ—¶å€™ Bootstrap Context è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ï¼Œä»–ä¿©å…±äº«ä¸€ä¸ªå¤–éƒ¨è·å–çš„ Environment server: port: 3355 spring: application: name: config-client cloud: config: # config å®¢æˆ·ç«¯é…ç½® label: main # åˆ†æ”¯åç§° name: config # é…ç½®æ–‡ä»¶åç§° è¿™ä¸‰ä¸ªç»¼åˆ main åˆ†æ”¯ä¸Šçš„ config-dev.yml çš„é…ç½®æ–‡ä»¶ profile: dev # è¯»å–åç¼€åç§° è¢«è¯»å–åˆ° http://config-3344:3344/main/config/dev uri: http://localhost:3344 # é…ç½®ä¸­å¿ƒåœ°å€ eureka: client: service-url: defaultZone: http://localhost:7001/eureka #æœåŠ¡æ³¨å†Œåˆ°çš„eurekaåœ°å€ ä¸»å¯åŠ¨ç±» @SpringBootApplication @EnableEurekaClient public class ConfigClientMain3355 { public static void main(String[] args) { SpringApplication.run(ConfigClientMain3355.class, args); } } ç¼–å†™æ§åˆ¶å±‚ï¼Œä½¿ç”¨ @Value æ³¨è§£å¯è¯»å–åˆ° bootstrap.yml é…ç½®ä¸­å¯¹åº”æ–‡ä»¶çš„ config.info å†…å®¹ @RestController public class ConfigClientController { @Value(\"${config.info}\") // è¯»å– yml é…ç½®ä¸­å¯¹åº”æ–‡ä»¶çš„ config.info å†…å®¹ private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo(){ return configInfo; } } æµ‹è¯•ï¼Œè¯»å–æˆåŠŸ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»ºå®¢æˆ·ç«¯é…ç½®"},{"categories":null,"content":"\ré…ç½®åŠ¨æ€åˆ·æ–°é—®é¢˜ å½“ Github ä¸Šçš„é…ç½®æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¹‹åï¼ŒConfig æœåŠ¡ç«¯å¯ä»¥ç«‹å³åˆ·æ–°è·å–åˆ°ï¼Œä½†æ˜¯ Config å®¢æˆ·ç«¯è¿˜æ˜¯ä¹‹å‰çš„é…ç½®ï¼Œæ— æ³•åˆ·æ–°åˆ°æ–°é…ç½®ï¼ˆé‡å¯æ‰èƒ½è·å¾—ï¼‰ ä¸º Config å®¢æˆ·ç«¯æ·»åŠ  Spring æœåŠ¡ç›‘æ§ä¾èµ–ã€é™¤äº†ç½‘å…³ä¹‹å¤–ï¼Œéƒ½åº”æ·»åŠ æ­¤ä¾èµ–ã€‘ \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e \u003c/dependency\u003e æ·»åŠ æ–°çš„ YML é…ç½® # æš´éœ²ç›‘æ§ç«¯ç‚¹ management: endpoints: web: exposure: include: \"*\" ä¸ºä¸šåŠ¡ç±»æ·»åŠ  @RefreshScope æ³¨è§£ å®ç°é…ç½®è‡ªåŠ¨æ›´æ–° @RestController @RefreshScope public class ConfigClientController { @Value(\"${config.info}\") // è¯»å– yml é…ç½®ä¸­å¯¹åº”æ–‡ä»¶çš„ config.info å†…å®¹ private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo(){ return configInfo; } } æµ‹è¯•ï¼Œå…ˆå¯åŠ¨ Config å®¢æˆ·ç«¯ï¼Œå†ä¿®æ”¹ Github ä¸­æ–‡ä»¶å†…å®¹ï¼Œå†åˆ·æ–°æ¥å£è·å–å†…å®¹ æ­¤æ—¶å‘ç°ï¼šè¿˜æ˜¯æ— æ•ˆå•Šï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ æ­¤æ—¶éœ€è¦è¿ç»´äººå‘˜ä½¿ç”¨ POST æ–¹å¼å‘ http://localhost:3355/actuator/refresh å‘é€åˆ·æ–°è¯·æ±‚ curl -X POST http://localhost:3355/actuator/refresh å†åˆ·æ–° Config å®¢æˆ·ç«¯æ¥å£ï¼Œå³å¯è®¿é—®åˆ·æ–°åçš„å†…å®¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:16:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®åŠ¨æ€åˆ·æ–°é—®é¢˜"},{"categories":null,"content":"\rBus æ¶ˆæ¯æ€»çº¿ æ¶ˆæ¯æ€»çº¿å¯ä»¥å®ç° å¾®æœåŠ¡é…ç½®ä¸­å¿ƒ çš„å¢å¼ºè¡¥å……ï¼šæ‰¹é‡åˆ·æ–°ï¼Œå¹¿æ’­ã€å·®å¼‚åŒ–ã€åŠ¨æ€åˆ·æ–° Bus æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯èŠ‚ç‚¹ /bus/refresh ç«¯ç‚¹ï¼Œä»è€Œåˆ·æ–°æ‰€æœ‰çš„å®¢æˆ·ç«¯é…ç½® Bug æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥è§¦å‘ä¸€ä¸ªé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯ /bus/refresh ç«¯ç‚¹ï¼Œä»è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯é…ç½® Bus å°±æ˜¯å°† åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ ä¸ è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿ é“¾æ¥èµ·æ¥çš„æ¡†æ¶ Bus æ•´åˆäº† Java çš„äº‹ä»¶å¤„ç†æœºåˆ¶ å’Œ æ¶ˆæ¯ä¸­é—´ä»¶ åŠŸèƒ½ SpringCloud Bus æ”¯æŒä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼šRabbitMQ å’Œ Kafka ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#bus-æ¶ˆæ¯æ€»çº¿"},{"categories":null,"content":"\rä»€ä¹ˆæ˜¯ æ€»çº¿ åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šç”¨è½»é‡çº§çš„ä¿¡æ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œè®©æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹è¿æ¥åˆ° ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„ä¿¡æ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ï¼Œè®©è¿æ¥åœ¨è¯¥ä¸»é¢˜çš„å®ä¾‹éƒ½æ”¶åˆ°é€šçŸ¥ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä»€ä¹ˆæ˜¯-æ€»çº¿"},{"categories":null,"content":"\ré…ç½® Bus å·¥ç¨‹å®ç°å…¨å±€å¹¿æ’­ æ­å»ºè‰¯å¥½çš„ RabbitMQ ç¯å¢ƒ å†åˆ›å»ºä¸€ä¸ªé…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ï¼Œä»¥ä¾¿æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼ˆå‚ç…§ä¸Šæ–¹ cloud-config-client-3355 æ¨¡å—ï¼‰ ä¸ºé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ ä¿¡æ¯æ€»çº¿ è¿™é‡Œä½¿ç”¨ Bus æ¶ˆæ¯æ€»çº¿å‘é…ç½®ä¸­å¿ƒ Center å‘é€åˆ·æ–°ï¼Œä¸ºä½•ï¼Ÿ å¦‚æœå‘å®¢æˆ·ç«¯å‘é€åˆ·æ–°ä»»åŠ¡ï¼Œæ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œä¸šåŠ¡æ¨¡å—ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°èŒè´£ å¦‚æœå‘å®¢æˆ·ç«¯å‘é€åˆ·æ–°ä»»åŠ¡ï¼Œç ´åäº†å¾®æœåŠ¡å„ä¸ªèŠ‚ç‚¹çš„å¯¹ç­‰æ€§ï¼Œä¸šåŠ¡æ¨¡å—é›†ç¾¤åº”ä¼—ç”Ÿå¹³ç­‰ å¦‚æœå‘å®¢æˆ·ç«¯å‘é€åˆ·æ–°ä»»åŠ¡ï¼Œæœ‰ä¸€å®šçš„å±€é™æ€§ï¼ŒæœåŠ¡è¿ç§»æ—¶åœ°å€å˜åŒ–ï¼Œæ­¤æ—¶åˆ·æ–°éœ€åšæ›´å¤šä¿®æ”¹ ä¸ºé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ  POM ä¾èµ– \u003c!-- æ·»åŠ æ¶ˆæ¯æ€»çº¿ RabbitMQ çš„æ”¯æŒ --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-bus-amqp\u003c/artifactId\u003e \u003c/dependency\u003e ä¸ºé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ  YML é…ç½® spring: rabbitmq: host: 10.211.55.17 port: 5672 # å®¢æˆ·ç«¯å’Œ RabbitMQ è¿›è¡Œé€šä¿¡çš„ç«¯å£ username: guest password: guest management: endpoints: # æš´éœ² bus åˆ·æ–°é…ç½®çš„ç›‘æ§ç«¯ç‚¹ web: exposure: include: 'bus-refresh' ä¸ºé…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯æ·»åŠ  POM ä¾èµ– å’Œ YML é…ç½® \u003c!-- æ·»åŠ æ¶ˆæ¯æ€»çº¿ RabbitMQ çš„æ”¯æŒ --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-bus-amqp\u003c/artifactId\u003e \u003c/dependency\u003e spring: rabbitmq: host: 192.168.30.129 port: 5672 # å®¢æˆ·ç«¯å’Œ RabbitMQ è¿›è¡Œé€šä¿¡çš„ç«¯å£ username: guest password: guest # å®¢æˆ·ç«¯åŸå…ˆå·²ç»æš´éœ²äº† \"*\" å·²ç»åŒ…å«äº† refresh ç›‘æ§ç«¯ç‚¹ å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶é…ç½®ä¸­å¿ƒåˆ·æ–°å¯ä»¥è·å¾—åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯ ConfigClient æ— æ³•åˆ·æ–°åˆ°æœ€æ–°ç‰ˆæœ¬é…ç½® æ­¤æ—¶ï¼Œå†åˆ·æ–°å®¢æˆ·ç«¯é›†ç¾¤å°±éƒ½å¯ä»¥è®¿é—®åˆ°æœ€æ–°é…ç½®ç‰ˆæœ¬äº† curl -X POST http://localhost:3344/actuator/bus-refresh ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®-bus-å·¥ç¨‹å®ç°å…¨å±€å¹¿æ’­"},{"categories":null,"content":"\ré…ç½® Bus å·¥ç¨‹å®ç°å®šç‚¹é€šçŸ¥ å‘é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯å‘é€åˆ·æ–°è¯·æ±‚ï¼Œå¹¶æŒ‡å®šåªåˆ·æ–° 3355 è¿™ä¸ªå®¢æˆ·ç«¯ curl -X POST \"http://localhost:3344/actuator/bus-refresh/config-client:3355\" æŸ¥çœ‹æ•ˆæœ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®-bus-å·¥ç¨‹å®ç°å®šç‚¹é€šçŸ¥"},{"categories":null,"content":"\ræ€»ç»“ åœ¨ Github ä»“åº“æ›´æ–°ä¹‹å‰ï¼Œç”±é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯è¯»å–ä»“åº“ä¸­çš„é…ç½®å†…å®¹ï¼Œé…ç½®å®¢æˆ·ç«¯è®¢é˜…é…ç½®ä¸­å¿ƒä¸Šçš„ Bus æ¶ˆæ¯æ€»çº¿æ¶ˆæ¯é˜Ÿåˆ— å½“ Github ä»“åº“æ›´æ–°ä¹‹åï¼Œé…ç½®ä¸­å¿ƒå³å¯é€šè¿‡ Webhook è·å–åˆ°ä»“åº“ä¸­çš„é…ç½®å†…å®¹ï¼Œå½“ç¨‹åºå‘˜é€šè¿‡ actuator å‘é€åˆ·æ–°è¯·æ±‚ä¹‹å å®¢æˆ·ç«¯ç›‘å¬åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘å¸ƒçš„åˆ·æ–°äº‹ä»¶ï¼Œå‘é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯è·å–é…ç½®ä¿¡æ¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:17:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ€»ç»“-1"},{"categories":null,"content":"\rStream æ¶ˆæ¯é©±åŠ¨ æ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ï¼Œä¸ºä¸€äº›æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†ï¼šå‘å¸ƒ-è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒº ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚ï¼Œé™ä½åˆ‡æ¢ç‰ˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ï¼ˆé€šè¿‡ä½¿ç”¨ Spring Integration æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ï¼‰ SpringCloud Stream æ˜¯ç”¨äºæ„å»ºä¸å…±äº«æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿè¿æ¥çš„é«˜åº¦å¯æ‰©å±•çš„äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡æ¡†æ¶ å®˜ç½‘ï¼šSpring Cloud Stream API æ‰‹å†Œï¼šSpring Cloud Stream Reference Documentation ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#stream-æ¶ˆæ¯é©±åŠ¨"},{"categories":null,"content":"\rSpringCloud Stream çš„è®¾è®¡æ€æƒ³ ä¼ ç»Ÿæ ‡å‡† MQï¼š ç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¹‹é—´é æ¶ˆæ¯åª’ä»‹ä¼ é€’æ¶ˆæ¯å†…å®¹ï¼šMessageï¼ˆçº¦å®šå¥½çš„æ ¼å¼ï¼šæ¶ˆæ¯å¤´ã€æ¶ˆæ¯æ­£æ–‡ã€æ¶ˆæ¯é™„ä»¶å±æ€§ï¼‰ æ¶ˆæ¯å¿…é¡»èµ°ç‰¹å®šçš„é€šé“ï¼šæ¶ˆæ¯é€šé“ MessageChannel æ¶ˆæ¯é€šé“é‡Œçš„æ¶ˆæ¯å¦‚ä½•è¢«æ¶ˆè´¹ï¼ˆæ”¶å‘å¤„ç†ï¼‰ï¼šæ¶ˆæ¯é€šé“ä¸­çš„å­æ¥å£ SubscribableChannelï¼Œç”± MessageHandler æ¶ˆæ¯å¤„ç†å™¨è®¢é˜… å¼•å…¥ Stream ä¹‹å RabbitMQ å’Œ Kafka æ¶æ„ä¸Šçš„ä¸åŒï¼šRabbitMQ æœ‰ exchangeï¼ŒKafka æœ‰ Topic å’Œ Partitions åˆ†åŒº é€šè¿‡å®šä¹‰ binder ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„è§£è€¦ã€éš”ç¦» é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„ Channel é€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å†è€ƒè™‘ä¸åŒæ¶ˆæ¯ä¸­é—´ä»¶è½åœ°å®ç° Binderï¼šç»‘å®šå™¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚ Channelï¼šé€šé“ï¼Œæ˜¯é˜Ÿåˆ— Queue çš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡ Channel å¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½® Source / Sinkï¼šä» Stream å‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥ã€‚ç®€å•çš„ç†è§£å°±æ˜¯ç”Ÿäº§è€… / æ¶ˆè´¹è€… å¸¸ç”¨ API å’Œæ³¨è§£ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springcloud-stream-çš„è®¾è®¡æ€æƒ³"},{"categories":null,"content":"\ræ­å»º Stream å·¥ç¨‹\ræ­å»ºæ¶ˆæ¯ç”Ÿäº§è€… 8801 æ¨¡å— åˆ›å»ºç”Ÿäº§è€…æ¨¡å— 8801 \u003c!-- stream rabbit --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-stream-rabbit\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- æ³¨å†Œä¸­å¿ƒåŠä¸€èˆ¬é€šç”¨ä¾èµ–... --\u003e é…ç½® YML æ–‡ä»¶ server: port: 8801 spring: application: name: cloud-stream-provider rabbitmq: # ç”±äº RabbitMQ æ˜¯é…ç½®åœ¨æœåŠ¡å™¨ä¸Šçš„, ä¸ºé¿å…è¯•å›¾è®¿é—® localhost:5672 çš„ç¬¬äºŒæ¬¡è¿æ¥, æ‰€ä»¥ rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½®åœ¨æ­¤é…ç½® host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°, ç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ # environment: # è®¾ç½® rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½® # spring: # rabbitmq: # host: 192.168.30.129 # port: 5672 # username: guest # password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°, è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”Ÿäº§è€… destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰(ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªäº¤æ¢æœº) content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯90s instance-id: send-8801.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ ç¼–å†™ä¸»å¯åŠ¨ç±» @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run(StreamMQMain8801.class, args); } } åˆ›å»ºæ¶ˆæ¯å‘å¸ƒæ¥å£ public interface IMessageProvider { public String send(); } å®ç°æ¥å£ï¼Œæ³¨å…¥æ¶ˆæ¯å‘é€ç®¡é“ï¼Œå‘ç®¡é“å‘é€ä¸€æ¡æ¶ˆæ¯ UUID @EnableBinding(Source.class) // å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“(æ˜¯ç”Ÿäº§è€…çš„è¾“å‡ºç®¡é“) public class IMessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; // æ¶ˆæ¯å‘é€ç®¡é“ @Override public String send() { String serial = UUID.randomUUID().toString(); output.send(MessageBuilder.withPayload(serial).build()); // MessageBuilder æ˜¯ spring çš„ integration.support.MessageBuilder System.out.println(\"*******serial: \" + serial); return null; } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œè°ƒç”¨æ¶ˆæ¯å‘é€åŠŸèƒ½ @RestController public class SendMessageController { @Resource private IMessageProvider iMessageProvider; @GetMapping(\"/sendMessage\") public String sendMessage(){ return iMessageProvider.send(); } } æ­¤æ—¶å¼€å¯æ¶ˆæ¯é˜Ÿåˆ—ã€æ³¨å†Œä¸­å¿ƒæœåŠ¡ã€ç”Ÿäº§è€…æœåŠ¡ï¼Œåˆ·æ–° sendMessage æ¥å£ å¯ä»¥çœ‹åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯æ³¢å³°æµé‡ æ­å»ºæ¶ˆæ¯æ¶ˆè´¹è€… 8802ã€8803 æ¨¡å— åˆ›å»ºæ¶ˆè´¹è€… 8802 å·¥ç¨‹ POM æ–‡ä»¶åŒä¸Šæ–¹ç”Ÿäº§è€… é…ç½® YML server: port: 8802 spring: application: name: cloud-stream-provider rabbitmq: host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° **å…¶å®ƒå’Œç”Ÿäº§è€…ä¸€æ ·, å°±æ˜¯è¿™é‡Œ output å˜ä¸º input** destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹, æœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯ 90s instance-id: receive-8802.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸º IP åœ°å€ é…ç½®ä¸»å¯åŠ¨ç±»åŒä¸Šæ–¹ç”Ÿäº§è€… ç¼–å†™æ¶ˆæ¯ç›‘å¬æ§åˆ¶å±‚ @EnableBinding(Sink.class) // å®šä¹‰æ¶ˆæ¯çš„æ¥æ”¶ç®¡é“(æ˜¯æ¶ˆè´¹è€…çš„è¾“å…¥ç®¡é“) @Controller public class ReceiveMessageListenerController { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) // ç›‘å¬ public void input(Message\u003cString\u003e message) { System.out.println(\"æ¶ˆè´¹è€…1å·------\u003eæ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload() + \"\\t portï¼š\" + serverPort); } } æµ‹è¯•å¯åŠ¨ 8802 æ¶ˆè´¹è€…ï¼Œæ­¤æ—¶åˆ·æ–° 8801 çš„æ¶ˆæ¯å‘å¸ƒæ¥å£ï¼Œå¯ä»¥çœ‹åˆ° 8802 æ¶ˆè´¹è€…çš„æ§åˆ¶å°è¾“å‡ºäº†å¯¹åº”å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°æœ‰æœåŠ¡ç»‘å®šäº†é˜Ÿåˆ—äº¤æ¢æœº æ ¹æ®ä¸Šæ–¹æ­¥éª¤åˆ›å»º 8803 æ¶ˆè´¹è€…æ¨¡å—ï¼Œæ³¨æ„æ›´æ”¹ç«¯å£å·ã€eureka ä¸»æœºåé¿å…é‡å¤ é‡å¤æ¶ˆè´¹é—®é¢˜ï¼šå½“ 8801 ç”Ÿäº§è€…åˆ·æ–°æ¥å£å‘å¸ƒæ¶ˆæ¯ä¹‹åï¼Œ8802ã€8803 éƒ½æ¥æ”¶åˆ°äº†æ•°æ®è¿›è¡Œäº†æ¶ˆè´¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-stream-å·¥ç¨‹"},{"categories":null,"content":"\ræ­å»º Stream å·¥ç¨‹\ræ­å»ºæ¶ˆæ¯ç”Ÿäº§è€… 8801 æ¨¡å— åˆ›å»ºç”Ÿäº§è€…æ¨¡å— 8801 org.springframework.cloud spring-cloud-starter-stream-rabbit é…ç½® YML æ–‡ä»¶ server: port: 8801 spring: application: name: cloud-stream-provider rabbitmq: # ç”±äº RabbitMQ æ˜¯é…ç½®åœ¨æœåŠ¡å™¨ä¸Šçš„, ä¸ºé¿å…è¯•å›¾è®¿é—® localhost:5672 çš„ç¬¬äºŒæ¬¡è¿æ¥, æ‰€ä»¥ rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½®åœ¨æ­¤é…ç½® host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°, ç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ # environment: # è®¾ç½® rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½® # spring: # rabbitmq: # host: 192.168.30.129 # port: 5672 # username: guest # password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°, è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”Ÿäº§è€… destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰(ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªäº¤æ¢æœº) content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯90s instance-id: send-8801.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ ç¼–å†™ä¸»å¯åŠ¨ç±» @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run(StreamMQMain8801.class, args); } } åˆ›å»ºæ¶ˆæ¯å‘å¸ƒæ¥å£ public interface IMessageProvider { public String send(); } å®ç°æ¥å£ï¼Œæ³¨å…¥æ¶ˆæ¯å‘é€ç®¡é“ï¼Œå‘ç®¡é“å‘é€ä¸€æ¡æ¶ˆæ¯ UUID @EnableBinding(Source.class) // å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“(æ˜¯ç”Ÿäº§è€…çš„è¾“å‡ºç®¡é“) public class IMessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; // æ¶ˆæ¯å‘é€ç®¡é“ @Override public String send() { String serial = UUID.randomUUID().toString(); output.send(MessageBuilder.withPayload(serial).build()); // MessageBuilder æ˜¯ spring çš„ integration.support.MessageBuilder System.out.println(\"*******serial: \" + serial); return null; } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œè°ƒç”¨æ¶ˆæ¯å‘é€åŠŸèƒ½ @RestController public class SendMessageController { @Resource private IMessageProvider iMessageProvider; @GetMapping(\"/sendMessage\") public String sendMessage(){ return iMessageProvider.send(); } } æ­¤æ—¶å¼€å¯æ¶ˆæ¯é˜Ÿåˆ—ã€æ³¨å†Œä¸­å¿ƒæœåŠ¡ã€ç”Ÿäº§è€…æœåŠ¡ï¼Œåˆ·æ–° sendMessage æ¥å£ å¯ä»¥çœ‹åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯æ³¢å³°æµé‡ æ­å»ºæ¶ˆæ¯æ¶ˆè´¹è€… 8802ã€8803 æ¨¡å— åˆ›å»ºæ¶ˆè´¹è€… 8802 å·¥ç¨‹ POM æ–‡ä»¶åŒä¸Šæ–¹ç”Ÿäº§è€… é…ç½® YML server: port: 8802 spring: application: name: cloud-stream-provider rabbitmq: host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° **å…¶å®ƒå’Œç”Ÿäº§è€…ä¸€æ ·, å°±æ˜¯è¿™é‡Œ output å˜ä¸º input** destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹, æœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯ 90s instance-id: receive-8802.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸º IP åœ°å€ é…ç½®ä¸»å¯åŠ¨ç±»åŒä¸Šæ–¹ç”Ÿäº§è€… ç¼–å†™æ¶ˆæ¯ç›‘å¬æ§åˆ¶å±‚ @EnableBinding(Sink.class) // å®šä¹‰æ¶ˆæ¯çš„æ¥æ”¶ç®¡é“(æ˜¯æ¶ˆè´¹è€…çš„è¾“å…¥ç®¡é“) @Controller public class ReceiveMessageListenerController { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) // ç›‘å¬ public void input(Message message) { System.out.println(\"æ¶ˆè´¹è€…1å·------\u003eæ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload() + \"\\t portï¼š\" + serverPort); } } æµ‹è¯•å¯åŠ¨ 8802 æ¶ˆè´¹è€…ï¼Œæ­¤æ—¶åˆ·æ–° 8801 çš„æ¶ˆæ¯å‘å¸ƒæ¥å£ï¼Œå¯ä»¥çœ‹åˆ° 8802 æ¶ˆè´¹è€…çš„æ§åˆ¶å°è¾“å‡ºäº†å¯¹åº”å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°æœ‰æœåŠ¡ç»‘å®šäº†é˜Ÿåˆ—äº¤æ¢æœº æ ¹æ®ä¸Šæ–¹æ­¥éª¤åˆ›å»º 8803 æ¶ˆè´¹è€…æ¨¡å—ï¼Œæ³¨æ„æ›´æ”¹ç«¯å£å·ã€eureka ä¸»æœºåé¿å…é‡å¤ é‡å¤æ¶ˆè´¹é—®é¢˜ï¼šå½“ 8801 ç”Ÿäº§è€…åˆ·æ–°æ¥å£å‘å¸ƒæ¶ˆæ¯ä¹‹åï¼Œ8802ã€8803 éƒ½æ¥æ”¶åˆ°äº†æ•°æ®è¿›è¡Œäº†æ¶ˆè´¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»ºæ¶ˆæ¯ç”Ÿäº§è€…-8801-æ¨¡å—"},{"categories":null,"content":"\ræ­å»º Stream å·¥ç¨‹\ræ­å»ºæ¶ˆæ¯ç”Ÿäº§è€… 8801 æ¨¡å— åˆ›å»ºç”Ÿäº§è€…æ¨¡å— 8801 org.springframework.cloud spring-cloud-starter-stream-rabbit é…ç½® YML æ–‡ä»¶ server: port: 8801 spring: application: name: cloud-stream-provider rabbitmq: # ç”±äº RabbitMQ æ˜¯é…ç½®åœ¨æœåŠ¡å™¨ä¸Šçš„, ä¸ºé¿å…è¯•å›¾è®¿é—® localhost:5672 çš„ç¬¬äºŒæ¬¡è¿æ¥, æ‰€ä»¥ rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½®åœ¨æ­¤é…ç½® host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°, ç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ # environment: # è®¾ç½® rabbitmq çš„ç›¸å…³ç¯å¢ƒé…ç½® # spring: # rabbitmq: # host: 192.168.30.129 # port: 5672 # username: guest # password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°, è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”Ÿäº§è€… destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰(ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªäº¤æ¢æœº) content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯90s instance-id: send-8801.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ ç¼–å†™ä¸»å¯åŠ¨ç±» @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run(StreamMQMain8801.class, args); } } åˆ›å»ºæ¶ˆæ¯å‘å¸ƒæ¥å£ public interface IMessageProvider { public String send(); } å®ç°æ¥å£ï¼Œæ³¨å…¥æ¶ˆæ¯å‘é€ç®¡é“ï¼Œå‘ç®¡é“å‘é€ä¸€æ¡æ¶ˆæ¯ UUID @EnableBinding(Source.class) // å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“(æ˜¯ç”Ÿäº§è€…çš„è¾“å‡ºç®¡é“) public class IMessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; // æ¶ˆæ¯å‘é€ç®¡é“ @Override public String send() { String serial = UUID.randomUUID().toString(); output.send(MessageBuilder.withPayload(serial).build()); // MessageBuilder æ˜¯ spring çš„ integration.support.MessageBuilder System.out.println(\"*******serial: \" + serial); return null; } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œè°ƒç”¨æ¶ˆæ¯å‘é€åŠŸèƒ½ @RestController public class SendMessageController { @Resource private IMessageProvider iMessageProvider; @GetMapping(\"/sendMessage\") public String sendMessage(){ return iMessageProvider.send(); } } æ­¤æ—¶å¼€å¯æ¶ˆæ¯é˜Ÿåˆ—ã€æ³¨å†Œä¸­å¿ƒæœåŠ¡ã€ç”Ÿäº§è€…æœåŠ¡ï¼Œåˆ·æ–° sendMessage æ¥å£ å¯ä»¥çœ‹åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯æ³¢å³°æµé‡ æ­å»ºæ¶ˆæ¯æ¶ˆè´¹è€… 8802ã€8803 æ¨¡å— åˆ›å»ºæ¶ˆè´¹è€… 8802 å·¥ç¨‹ POM æ–‡ä»¶åŒä¸Šæ–¹ç”Ÿäº§è€… é…ç½® YML server: port: 8802 spring: application: name: cloud-stream-provider rabbitmq: host: 192.168.30.129 port: 5672 username: guest password: guest cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„ rabbitmq çš„æœåŠ¡ä¿¡æ¯ defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äº binding æ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° **å…¶å®ƒå’Œç”Ÿäº§è€…ä¸€æ ·, å°±æ˜¯è¿™é‡Œ output å˜ä¸º input** destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„ Exchange åç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹, æœ¬æ¬¡ä¸º jsonï¼Œæœ¬æ–‡è¦è®¾ç½®ä¸º â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®ï¼ˆçˆ†çº¢ä¸å½±å“ä½¿ç”¨ï¼Œä½ç½®æ²¡é”™ï¼‰ eureka: client: service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30S) lease-expiration-duration-in-seconds: 5 # å¦‚æœè¶…è¿‡ 5S é—´éš”å°±æ³¨é”€èŠ‚ç‚¹ é»˜è®¤æ˜¯ 90s instance-id: receive-8802.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸º IP åœ°å€ é…ç½®ä¸»å¯åŠ¨ç±»åŒä¸Šæ–¹ç”Ÿäº§è€… ç¼–å†™æ¶ˆæ¯ç›‘å¬æ§åˆ¶å±‚ @EnableBinding(Sink.class) // å®šä¹‰æ¶ˆæ¯çš„æ¥æ”¶ç®¡é“(æ˜¯æ¶ˆè´¹è€…çš„è¾“å…¥ç®¡é“) @Controller public class ReceiveMessageListenerController { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) // ç›‘å¬ public void input(Message message) { System.out.println(\"æ¶ˆè´¹è€…1å·------\u003eæ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload() + \"\\t portï¼š\" + serverPort); } } æµ‹è¯•å¯åŠ¨ 8802 æ¶ˆè´¹è€…ï¼Œæ­¤æ—¶åˆ·æ–° 8801 çš„æ¶ˆæ¯å‘å¸ƒæ¥å£ï¼Œå¯ä»¥çœ‹åˆ° 8802 æ¶ˆè´¹è€…çš„æ§åˆ¶å°è¾“å‡ºäº†å¯¹åº”å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°æœ‰æœåŠ¡ç»‘å®šäº†é˜Ÿåˆ—äº¤æ¢æœº æ ¹æ®ä¸Šæ–¹æ­¥éª¤åˆ›å»º 8803 æ¶ˆè´¹è€…æ¨¡å—ï¼Œæ³¨æ„æ›´æ”¹ç«¯å£å·ã€eureka ä¸»æœºåé¿å…é‡å¤ é‡å¤æ¶ˆè´¹é—®é¢˜ï¼šå½“ 8801 ç”Ÿäº§è€…åˆ·æ–°æ¥å£å‘å¸ƒæ¶ˆæ¯ä¹‹åï¼Œ8802ã€8803 éƒ½æ¥æ”¶åˆ°äº†æ•°æ®è¿›è¡Œäº†æ¶ˆè´¹ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»ºæ¶ˆæ¯æ¶ˆè´¹è€…-88028803-æ¨¡å—"},{"categories":null,"content":"\ré‡å¤æ¶ˆè´¹ å¦‚æœæ˜¯è®¢å•ç³»ç»Ÿï¼Œæœ‰å¤šä¸ªæ¶ˆè´¹è€…éƒ½è·å–åˆ°äº†è®¢å•ä¿¡æ¯ï¼Œé€ æˆé‡å¤æ¶ˆè´¹æŸ¥å¤æ‰£æ¬¾ï¼Œé—®é¢˜ä¸¥é‡ è¿™ç§æƒ…å†µå¯ä»¥ç”± æ¶ˆæ¯åˆ†ç»„ è§£å†³ï¼šåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ ä¸»é¢˜ä¼šç»™æ¯ä¸ªé˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œè€Œæ¯ä¸ªé˜Ÿåˆ—åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥è·å¾—æ¶ˆæ¯ï¼ˆåŒç»„å¹¿æ’­ï¼Œä¸åŒç»„è½®è¯¢ï¼‰ æ¶ˆè´¹è€… 8002ã€8003 ç»„æµæ°´å·ä¸ä¸€è‡´ï¼Œè¢«è®¤ä¸ºä¸åŒç»„ï¼ˆè¿™é‡Œçš„æµæ°´å·å°±æ˜¯ç»„åï¼Œé»˜è®¤æ²¡è®¾ç½®å°±è¿™æ ·ï¼‰ ä¸ºä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½è®¾ç½® group å±æ€§ï¼Œå¹¶æŒ‡å®šç›¸åŒçš„ group åå³å¯è§£å†³ æ­¤æ—¶åˆ·æ–°ä¸¤æ¬¡å‘é€æ¶ˆæ¯æ¥å£ï¼Œ8802 å’Œ 8803 å„æ¥æ”¶åˆ°ä¸€æ¡ä¿¡æ¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡å¤æ¶ˆè´¹"},{"categories":null,"content":"\ræ¶ˆæ¯æŒä¹…åŒ– åœ¨åœæ‰æ‰€æœ‰æ¶ˆè´¹è€…çš„æƒ…å†µä¸‹å‘é€æ¶ˆæ¯ã€ å¦‚æœæ¶ˆè´¹è€… 8802 å»é™¤äº†åˆ†ç»„ï¼Œåˆ™é‡å¯åæ— æ³•è·å–æ¶ˆæ¯ å¦‚æœæ¶ˆè´¹è€… 8803 ä¿ç•™äº†åˆ†ç»„ï¼Œåˆ™é‡å¯åå¯ä»¥è·å–æ¶ˆæ¯ å› ä¸º 8803 æ²¡åˆ é™¤ group: groupA ï¼ŒgroupA é˜Ÿåˆ—æ˜¯åœ¨ 8801 å‘é€æ¶ˆæ¯å‰å­˜åœ¨çš„ï¼Œæ‰€ä»¥å½“ 8803 åœæœºåå†å¯åŠ¨ï¼Œå°±å¯ä»¥è·å–åˆ°åœæœºæ—¶ 8801 å‘é€çš„ä¿¡æ¯ ï¼ˆ å¦‚æœæ­¤æ—¶åŒç»„ï¼ˆé˜Ÿåˆ—ï¼‰é‡Œæœ‰åˆ«çš„æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«åˆ«çš„æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ ï¼‰ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:18:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ¶ˆæ¯æŒä¹…åŒ–"},{"categories":null,"content":"\rSleuth åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½è¦ç»è¿‡å¤šä¸ªä¸åŒçš„æœåŠ¡èŠ‚ç‚¹ååŒè°ƒç”¨æ‰äº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œé“¾è·¯ä¸­ä»»æ„ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚çš„å“åº”å¤±è´¥ SpringCloud Sleuth æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”æ”¯æŒ zipkin å®˜ç½‘ï¼šSpring Cloud Sleuth spring-cloud/spring-cloud-sleuth: Distributed tracing for spring cloud (github.com) ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:19:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sleuth-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª"},{"categories":null,"content":"\rå¦‚ä½•ä½¿ç”¨ ä¸‹è½½ zipkin çš„ jar åŒ…ï¼šCentral Repository: io/zipkin/zipkin-server (maven.org) æ‰“å¼€å‘½ä»¤è¡Œä½¿ç”¨ java -jar å‘½ä»¤è¿è¡Œ jar åŒ… java -jar .\\zipkin-server-2.24.0-exec.jar å¯åŠ¨åè®¿é—® http://localhost:9411/zipkin/ æ¯æ¡é“¾è·¯æœ‰ä¸€ä¸ª trace ID å”¯ä¸€æ ‡è¯†ï¼Œspan æ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„ä¸ª span é€šè¿‡ trace ID å…³è”èµ·æ¥ Traceï¼šç±»ä¼¼äºæ ‘ç»“æ„çš„ Span é›†åˆï¼Œè¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯å­˜åœ¨çš„å”¯ä¸€æ ‡è¯† Spanï¼šæ ‡è¯†æ¯æ¬¡è°ƒç”¨é“¾è·¯æ¥æºï¼Œè¯´ç™½äº† Span å°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:19:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¦‚ä½•ä½¿ç”¨"},{"categories":null,"content":"\ræ­å»ºé“¾è·¯è¿½è¸ªæ­¥éª¤ ä¸ºæœåŠ¡ç”Ÿäº§è€…æ·»åŠ  POM ä¾èµ– \u003c!-- åŒ…å«äº† sleuth + zipkin --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-zipkin\u003c/artifactId\u003e \u003c/dependency\u003e ä¸ºæœåŠ¡ç”Ÿäº§è€…æ·»åŠ  YML é…ç½® zipkin: base-url: http://localhost:9411 # å°†ç›‘æ§çš„æ•°æ®æ‰“åˆ°è¿™ä¸ªåœ°å€ sleuth: sampler: probability: 1 # é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´, 1åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›†ï¼ˆä¸€èˆ¬ä¸ä¸º 1, ä¸ç„¶é«˜å¹¶å‘æ€§èƒ½ä¼šæœ‰å½±å“ï¼‰ ä¸ºæœåŠ¡æ¶ˆè´¹è€…ä¹Ÿæ·»åŠ åŒæ ·çš„é…ç½® å¯åŠ¨æ³¨å†Œä¸­å¿ƒã€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æœåŠ¡ï¼Œè®¿é—®æ¶ˆè´¹è€…æ¥å£è°ƒç”¨ç”Ÿäº§è€…ï¼Œåˆ·æ–° zipkin é¡µé¢ å¯ä»¥çœ‹åˆ°è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ—¶é—´ã€èŠ±è´¹æ—¶é•¿ ç‚¹å‡» show æŒ‰é’® å¯ä»¥çœ‹åˆ°æ˜¯å“ªä¸ªæ¶ˆè´¹è€…æ¥å£è°ƒç”¨çš„å“ªä¸ªç”Ÿäº§è€…æ¥å£ï¼Œå„è‡ªçš„ä¿¡æ¯ ç‚¹å‡»ä¾èµ–æ ‡ç­¾é¡µï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªæ¨¡å—é—´çš„ä¾èµ–å…³ç³»å›¾ç¤º ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:19:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»ºé“¾è·¯è¿½è¸ªæ­¥éª¤"},{"categories":null,"content":"\rSpringCloud Alibaba éƒ¨åˆ† å®˜ç½‘ï¼šhttps://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md äº 2018.10.31 åœ¨ Maven ä¸­å¤®ä»“åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ 0.2.0 ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:0","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springcloud-alibaba-éƒ¨åˆ†"},{"categories":null,"content":"\rSpringCloud Alibaba èƒ½å¹²ä»€ä¹ˆ æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒ WebServletã€WebFluxã€OpenFeignã€RestTemplateã€Spring Cloud Gatewayã€Zuulã€Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚ æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚ åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚ æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚ åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚ é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚ ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:1","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#springcloud-alibaba-èƒ½å¹²ä»€ä¹ˆ"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– \u003c!-- SpringCloud Alibaba nacos --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-alibaba-nacos-discovery\u003c/artifactId\u003e \u003c/dependency\u003e é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– \u003c!-- OpenFeign --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-openfeign\u003c/artifactId\u003e \u003c/dependency\u003e åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nacos-ä½œä¸ºæœåŠ¡æ³¨å†Œ"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å®‰è£…-nacos"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-nacos-å·¥ç¨‹"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®æœåŠ¡ç”Ÿäº§è€…"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®æœåŠ¡ç”Ÿäº§è€…2"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®æœåŠ¡æ¶ˆè´¹è€…"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨-feign"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ap-or-cp"},{"categories":null,"content":"\rNacos ä½œä¸ºæœåŠ¡æ³¨å†Œ Nacosï¼šnamingï¼ˆnaï¼‰ï¼ŒConfigurationï¼ˆcoï¼‰ï¼Œserviceï¼ˆsï¼‰ Dynamic Naming and Configuration Serviceï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å° Nacos ç­‰ä»·äºï¼šeureka + config + Bus å®˜ç½‘ï¼šhome (nacos.io) å®‰è£… Nacos è·å– Nacosï¼šReleases Â· alibaba/nacos (github.com) è§£å‹ï¼Œæ‰“å¼€ bin ç›®å½• è¿è¡Œ cmd startup.cmd -m standalone è®¿é—® http://localhost:8848/nacos/ å³å¯ é»˜è®¤è´¦å·ï¼šnacos é»˜è®¤å¯†ç ï¼šnacos æ­å»º Nacos å·¥ç¨‹å®˜ç½‘ï¼šSpring Cloud Alibaba Reference Documentation (spring-cloud-alibaba-group.github.io) é…ç½®æœåŠ¡ç”Ÿäº§è€… æ–°å»ºå·¥ç¨‹ cloudalibaba-provider-payment9001 æ·»åŠ  Nacos çš„ discovery ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® YML æ–‡ä»¶ server: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±»ï¼Œæ·»åŠ  @EnableDiscoveryClient æ³¨è§£ @SpringBootApplication @EnableDiscoveryClient public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run(PaymentMain9001.class, args); } } ç¼–å†™æ§åˆ¶å±‚ â€¦ å¯åŠ¨é¡¹ç›®ï¼Œåœ¨ nacos æµè§ˆå™¨ç•Œé¢ æœåŠ¡ç®¡ç† \u003e æœåŠ¡åˆ—è¡¨ ä¸­å³å¯çœ‹åˆ° é…ç½®æœåŠ¡ç”Ÿäº§è€…2 æŠ•æœºå–å·§ï¼Œä½¿ç”¨ IDEA çš„ Copy åŠŸèƒ½ å³é”®ä¸€ä¸ªå®ä¾‹ï¼Œé€‰æ‹© Copy Configuration è®¾ç½®åç§°ã€æ·»åŠ  VM Options å€¼ -DServer.port=9011 æ­¤æ—¶åœ¨ nacos çš„ç•Œé¢ä¸­å³å¯çœ‹åˆ°å®ä¾‹æ•°ä¸º 2 é…ç½®æœåŠ¡æ¶ˆè´¹è€… åˆ›å»º cloudalibaba-consumer-nacos-order83 æ·»åŠ  POM ä¾èµ– ç¼–å†™ YML é…ç½®ï¼Œæ³¨æ„é…ç½®ç”Ÿäº§è€…çš„å¾®æœåŠ¡åç§° server: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 127.0.0.1:8848 # é…ç½®çš„ Nacos åœ°å€ # æ¶ˆè´¹è€…è¦è®¿é—®çš„å¾®æœåŠ¡åç§°ï¼ˆæˆåŠŸæ³¨å†Œè¿› nacos çš„æœåŠ¡æä¾›è€…ï¼‰ service-url: nacos-user-service: http://nacos-payment-provider ç¼–å†™ä¸»å¯åŠ¨ç±» å¦‚æœä½¿ç”¨ RestTemplate åˆ™éœ€è¦ç¼–å†™é…ç½®ç±»å°† Bean æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ é…ç½®æ–¹å¼ æ­¤æ—¶å°±å¯ä»¥ç”¨ @Value è¯»å– YML ä¸­çš„æœåŠ¡æä¾›è€…åˆ«åä½œä¸º serverURL ç¼–å†™æ§åˆ¶å±‚ä»£ç  æ­¤æ—¶å¯ä»¥çœ‹åˆ° nacos ä¸­æ³¨å†Œè¿›äº†æ–°çš„æœåŠ¡ ä½¿ç”¨ Feign åŠ å…¥ OpenFeign ä¾èµ– org.springframework.cloud spring-cloud-starter-openfeign åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£æ¿€æ´» Feign @EnableFeignClients å–æ¶ˆé…ç½®ç±»ä¸­çš„ RestTemplate ç›¸å…³é…ç½® åˆ›å»ºæ¥å£ PaymentFeignService ã€ä½¿ç”¨ å‚ç…§ä»£ç  AP or CP å‰é¢æœ‰è¯´ nacos æ˜¯æ”¯æŒ CAP ä¸­çš„ APï¼Œå³ å¯ç”¨æ€§ å’Œ åˆ†åŒºå®¹é”™æ€§ ä½†æ˜¯å®é™…ä¸Š nacos æ˜¯å¯ä»¥æ ¹æ®ä¸šåŠ¡é€‰å‹åˆ‡æ¢ AP å’Œ CP ä¸¤ç§æ¨¡å¼çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§å³ AP å³ä¾§å³ CP ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€ä¿æŒå¿ƒè·³ä¸ŠæŠ¥çš„é¡¹ç›®é»˜è®¤å°±æ˜¯ AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§å‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨æ­¤æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ã€‚CP æ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼ˆæ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œâ€¦ï¼‰ åˆ‡æ¢æ¨¡å¼ï¼šcurl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode\u0026value=CP' ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”\r","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:2","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– \u003c!-- nacos config --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-alibaba-nacos-config\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- nacos discovery --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-alibaba-nacos-discovery\u003c/artifactId\u003e \u003c/dependency\u003e é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-nacos-å·¥ç¨‹-1"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é…ç½®è§„åˆ™å…¬å¼"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åˆ†ç±»é…ç½®"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#data-id-æ–¹æ¡ˆ"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#group-æ–¹æ¡ˆ"},{"categories":null,"content":"\rNacos ä½œä¸ºé…ç½®ä¸­å¿ƒ\ræ­å»º Nacos å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-config-nacos-client3377 æ·»åŠ  Nacos çš„ config ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-config com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery é…ç½® bootstrap.yml å’Œ application.yml bootstrap.yml çš„ä¼˜å…ˆçº§é«˜äº application.ymlï¼Œæ‰€ä»¥åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒæ‹‰å»é…ç½®ä¿¡æ¯ è¿™é‡Œçš„æ„æ€å°±æ˜¯ ä» localhost:8848 è·å– yml æ ¼å¼çš„ dev ç¯å¢ƒçš„é…ç½® bootstrap.yml server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® application.yml spring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ é…ç½®ä¸»å¯åŠ¨ç±» NacosConfigClientMain3377 @SpringBootApplication @EnableDiscoveryClient public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run(NacosConfigClientMain3377.class, args); } } ç¼–å†™æ§åˆ¶å±‚ä»£ç ï¼Œæ ‡æ³¨ @RefreshScope è®©å…¶æ”¯æŒé…ç½®è‡ªåŠ¨æ›´æ–° @RefreshScope // æ”¯æŒ Nacos çš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo(){ return configInfo; } } é…ç½®è§„åˆ™å…¬å¼ è§ Nacos å®˜ç½‘ https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html ${prefix}-${spring.profiles.active}.${file-extension} # ä¹Ÿå°±æ˜¯ ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} ç”±æ­¤å…¬å¼æœ€ç»ˆå¯ä»¥ç»„æˆ nacos-config-client-dev.yml ç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªé…ç½® Data ID å°±æ˜¯ nacos-config-client-dev.yml æ­¤æ—¶è¿è¡Œ 3377 é¡¹ç›®ï¼Œè®¿é—®æ§åˆ¶å±‚æ–¹æ³•å³å¯è·å–åˆ°åœ¨ nacos ä¸­é…ç½®çš„å†…å®¹ 4.æ­¤æ—¶ä¿®æ”¹ nacos ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ¬¡åˆ·æ–°æ§åˆ¶å±‚æ¥å£ã€åŠ¨æ€åˆ·æ–°ã€‘ä¸åƒ Config éœ€è¦æ‰‹åŠ¨åˆ·æ–° åˆ†ç±»é…ç½® é€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰å¤šç§ç¯å¢ƒ dev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒ â€¦â€¦ æ­¤æ—¶å°±éœ€è¦å¯¹ä¸åŒçš„ç¯å¢ƒè¿›è¡Œé…ç½®ç®¡ç† Namespace å‘½åç©ºé—´ \u003e Group ç»„ \u003e Data ID é…ç½®ï¼šä¸‰è€…çš„å…³ç³» é»˜è®¤æƒ…å†µï¼šNamespace=publicã€Group=DEFAULT_GROUPã€Cluster=DEFAULT Namespace å®ç°éš”ç¦»ï¼Œä¸åŒçš„ç¯å¢ƒç”¨ä¸åŒçš„ Namespace Group ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå¾®æœåŠ¡ Service Service ä¸­åŒ…å«å¤šä¸ª Cluster ï¼ˆé›†ç¾¤ï¼Œæ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ï¼‰ Instance å°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ Data ID æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace é»˜è®¤ Group ä¸‹åˆ›å»ºæµ‹è¯•ç¯å¢ƒ Data ID ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-test.yml Group æ–¹æ¡ˆ åœ¨é»˜è®¤ Namespace ä¸­åˆ›å»ºä¸åŒçš„ Group ç»„ï¼Œåœ¨ç»„ä¸­åˆ›å»ºç›¸åŒçš„ Data ID ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.group é…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® ä¿®æ”¹ application.yml å†…å®¹ spring: profiles: # active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ active: info å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ public \u003e DEFAULT_GROUP \u003e nacos-config-client-info.yml Namespace æ–¹æ¡ˆ åˆ›å»ºæ–°çš„å‘½åç©ºé—´ åœ¨é…ç½®åˆ—è¡¨ä¸­å³å¯çœ‹åˆ°æ–°å¢çš„å‘½åç©ºé—´ ä¿®æ”¹ bootstrap.yml ä¸­å†…å®¹ï¼Œæ·»åŠ  spring.cloud.nacos.config.namespace é…ç½®ä¸ºæ–°å‘½åç©ºé—´ ID server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 # Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yml # æŒ‡å®š yml æ ¼å¼é…ç½® group: TEST_GROUP # æŒ‡å®šä» TEST_GROUP ä¸­è¯»å–é…ç½® namespace: d18b3fba-17d6-4492-b9e5-00d0d72ba771 # æŒ‡å®šä»æ­¤ ID çš„ namespace ä¸­è¯»å–é…ç½® å°±å¯ä»¥è¯»å–åˆ°å¯¹åº”é…ç½® ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} # ä¹Ÿå°±æ˜¯ DEV \u003e TEST_GROUP \u003e nacos-config-client-dev.yml ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:3","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#namespace-æ–¹æ¡ˆ"},{"categories":null,"content":"\rNacos é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½® ä¸‹å›¾çš„ SLB åœ¨æ—§ç‰ˆå›¾ç‰‡ä¸­å°±æ˜¯ VIPï¼Œå®˜ç½‘ï¼šé›†ç¾¤éƒ¨ç½²è¯´æ˜ (nacos.io) Nacos é»˜è®¤ä½¿ç”¨å†…åµŒ Derby æ•°æ®åº“ï¼Œä½†æ˜¯åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„ nacos èŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ã€‚ å› æ­¤éœ€è¦ä½¿ç”¨é›†ä¸­å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–å­˜å‚¨ï¼Œéœ€è¦ MySQL æ•°æ®åº“ å•æœºæ¨¡å¼æ”¯æŒ MySQL å®˜ç½‘è¯´æ˜ï¼šNacosæ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼ ä¿®æ”¹ conf ç›®å½•ä¸­ application.properties é…ç½®æ–‡ä»¶ å¯¼å…¥ conf ä¸‹ nacos-mysql.sql æ–‡ä»¶åˆ°æœ¬åœ°æ•°æ®åº“ æ­¤æ—¶å¼€å¯æœåŠ¡å³å¯å‘ç°ï¼Œæ­¤å‰çš„é…ç½®å…¨éƒ¨æ¶ˆå¤±äº†ï¼Œå› ä¸ºæ­¤æ—¶ç”¨çš„æ˜¯æœ¬æœºçš„ MySQL æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ® Linux é›†ç¾¤ç”Ÿäº§ç¯å¢ƒé…ç½® ç”±äºæˆ‘è™šæ‹Ÿæœº Linux ä¸­è¿è¡Œ Docker çš„ Nacos ä¸€ç›´è‡ªåŠ¨ç»“æŸè¿è¡Œï¼Œä¸€æ—¶é—´æ²¡è°ƒå¥½ï¼Œå¾ˆæ°”ï¼Œæ•…æ­¤å¤„ç•¥ å¤§è‡´æ­¥éª¤ï¼š å®‰è£… MySQL åˆ›å»ºæ•°æ®åº“å¹¶ Source è¿› Nacos çš„ sql æ–‡ä»¶ ä¿®æ”¹ application.properties é…ç½®æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç ç­‰ ä¿®æ”¹ nacos çš„é›†ç¾¤é…ç½® cluster.conf é€šè¿‡ç¼–è¾‘ nacos çš„å¯åŠ¨è„šæœ¬startup.sh ä½¿å®ƒèƒ½å¤Ÿä½¿ç”¨ä¸åŒçš„ç«¯å£å¯åŠ¨ ä¿®æ”¹ nginx.conf ä½¿å…¶ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ æµ‹è¯•è®¿é—®ï¼šhttp://IP:1111/nacos/#/login ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#nacos-é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"},{"categories":null,"content":"\rNacos é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½® ä¸‹å›¾çš„ SLB åœ¨æ—§ç‰ˆå›¾ç‰‡ä¸­å°±æ˜¯ VIPï¼Œå®˜ç½‘ï¼šé›†ç¾¤éƒ¨ç½²è¯´æ˜ (nacos.io) Nacos é»˜è®¤ä½¿ç”¨å†…åµŒ Derby æ•°æ®åº“ï¼Œä½†æ˜¯åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„ nacos èŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ã€‚ å› æ­¤éœ€è¦ä½¿ç”¨é›†ä¸­å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–å­˜å‚¨ï¼Œéœ€è¦ MySQL æ•°æ®åº“ å•æœºæ¨¡å¼æ”¯æŒ MySQL å®˜ç½‘è¯´æ˜ï¼šNacosæ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼ ä¿®æ”¹ conf ç›®å½•ä¸­ application.properties é…ç½®æ–‡ä»¶ å¯¼å…¥ conf ä¸‹ nacos-mysql.sql æ–‡ä»¶åˆ°æœ¬åœ°æ•°æ®åº“ æ­¤æ—¶å¼€å¯æœåŠ¡å³å¯å‘ç°ï¼Œæ­¤å‰çš„é…ç½®å…¨éƒ¨æ¶ˆå¤±äº†ï¼Œå› ä¸ºæ­¤æ—¶ç”¨çš„æ˜¯æœ¬æœºçš„ MySQL æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ® Linux é›†ç¾¤ç”Ÿäº§ç¯å¢ƒé…ç½® ç”±äºæˆ‘è™šæ‹Ÿæœº Linux ä¸­è¿è¡Œ Docker çš„ Nacos ä¸€ç›´è‡ªåŠ¨ç»“æŸè¿è¡Œï¼Œä¸€æ—¶é—´æ²¡è°ƒå¥½ï¼Œå¾ˆæ°”ï¼Œæ•…æ­¤å¤„ç•¥ å¤§è‡´æ­¥éª¤ï¼š å®‰è£… MySQL åˆ›å»ºæ•°æ®åº“å¹¶ Source è¿› Nacos çš„ sql æ–‡ä»¶ ä¿®æ”¹ application.properties é…ç½®æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç ç­‰ ä¿®æ”¹ nacos çš„é›†ç¾¤é…ç½® cluster.conf é€šè¿‡ç¼–è¾‘ nacos çš„å¯åŠ¨è„šæœ¬startup.sh ä½¿å®ƒèƒ½å¤Ÿä½¿ç”¨ä¸åŒçš„ç«¯å£å¯åŠ¨ ä¿®æ”¹ nginx.conf ä½¿å…¶ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ æµ‹è¯•è®¿é—®ï¼šhttp://IP:1111/nacos/#/login ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å•æœºæ¨¡å¼æ”¯æŒ-mysql"},{"categories":null,"content":"\rNacos é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½® ä¸‹å›¾çš„ SLB åœ¨æ—§ç‰ˆå›¾ç‰‡ä¸­å°±æ˜¯ VIPï¼Œå®˜ç½‘ï¼šé›†ç¾¤éƒ¨ç½²è¯´æ˜ (nacos.io) Nacos é»˜è®¤ä½¿ç”¨å†…åµŒ Derby æ•°æ®åº“ï¼Œä½†æ˜¯åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„ nacos èŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ã€‚ å› æ­¤éœ€è¦ä½¿ç”¨é›†ä¸­å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–å­˜å‚¨ï¼Œéœ€è¦ MySQL æ•°æ®åº“ å•æœºæ¨¡å¼æ”¯æŒ MySQL å®˜ç½‘è¯´æ˜ï¼šNacosæ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼ ä¿®æ”¹ conf ç›®å½•ä¸­ application.properties é…ç½®æ–‡ä»¶ å¯¼å…¥ conf ä¸‹ nacos-mysql.sql æ–‡ä»¶åˆ°æœ¬åœ°æ•°æ®åº“ æ­¤æ—¶å¼€å¯æœåŠ¡å³å¯å‘ç°ï¼Œæ­¤å‰çš„é…ç½®å…¨éƒ¨æ¶ˆå¤±äº†ï¼Œå› ä¸ºæ­¤æ—¶ç”¨çš„æ˜¯æœ¬æœºçš„ MySQL æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ® Linux é›†ç¾¤ç”Ÿäº§ç¯å¢ƒé…ç½® ç”±äºæˆ‘è™šæ‹Ÿæœº Linux ä¸­è¿è¡Œ Docker çš„ Nacos ä¸€ç›´è‡ªåŠ¨ç»“æŸè¿è¡Œï¼Œä¸€æ—¶é—´æ²¡è°ƒå¥½ï¼Œå¾ˆæ°”ï¼Œæ•…æ­¤å¤„ç•¥ å¤§è‡´æ­¥éª¤ï¼š å®‰è£… MySQL åˆ›å»ºæ•°æ®åº“å¹¶ Source è¿› Nacos çš„ sql æ–‡ä»¶ ä¿®æ”¹ application.properties é…ç½®æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç ç­‰ ä¿®æ”¹ nacos çš„é›†ç¾¤é…ç½® cluster.conf é€šè¿‡ç¼–è¾‘ nacos çš„å¯åŠ¨è„šæœ¬startup.sh ä½¿å®ƒèƒ½å¤Ÿä½¿ç”¨ä¸åŒçš„ç«¯å£å¯åŠ¨ ä¿®æ”¹ nginx.conf ä½¿å…¶ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ æµ‹è¯•è®¿é—®ï¼šhttp://IP:1111/nacos/#/login ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:4","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#linux-é›†ç¾¤ç”Ÿäº§ç¯å¢ƒé…ç½®"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– \u003c!-- SpringCloud alibaba nacos --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-alibaba-nacos-discovery\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- SpringCloud alibaba sentinel-datasource-nacos æŒä¹…åŒ–éœ€è¦ç”¨åˆ° --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.csp\u003c/groupId\u003e \u003cartifactId\u003esentinel-datasource-nacos\u003c/artifactId\u003e \u003c/dependency\u003e \u003c!-- SpringCloud alibaba sentinel --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba.cloud\u003c/groupId\u003e \u003cartifactId\u003espring-cloud-starter-alibaba-sentinel\u003c/artifactId\u003e \u003c/dependency\u003e é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sentinel-ç†”æ–­ä¸é™æµ"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è¿è¡Œ-sentinel"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-sentinel-å·¥ç¨‹"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æµæ§è§„åˆ™æµé‡æ§åˆ¶è§„åˆ™"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç›´æ¥"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…³è”"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é“¾è·¯"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¿«é€Ÿå¤±è´¥"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#warm-upé¢„çƒ­--å†·å¯åŠ¨"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#åŒ€é€Ÿæ’é˜Ÿ"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é™çº§è§„åˆ™ç†”æ–­é™çº§è§„åˆ™"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#rt-æ…¢è°ƒç”¨æ¯”ä¾‹"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¼‚å¸¸æ¯”ä¾‹"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¼‚å¸¸æ•°"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#çƒ­ç‚¹è§„åˆ™çƒ­ç‚¹-key-é™æµ"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å‚æ•°ä¾‹å¤–é¡¹"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¼‚å¸¸æƒ…å†µ"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ç³»ç»Ÿè§„åˆ™"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å…¨å±€-qps"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sentinelresource-æ³¨è§£"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‰-èµ„æºåç§°-é™æµ--åç»­å¤„ç†"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æŒ‰ç…§-url-åœ°å€é™æµ--åç»­å¤„ç†"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#é‡åˆ°é—®é¢˜"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#sentinelresource-æ³¨è§£å…¶ä»–å±æ€§"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æœåŠ¡ç†”æ–­"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨-resttemplate"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#ä½¿ç”¨-feign-1"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#å¸¸è§ç†”æ–­æ¡†æ¶æ¯”è¾ƒ"},{"categories":null,"content":"\rSentinel ç†”æ–­ä¸é™æµ ä¸­æ–‡æ–‡æ¡£ï¼šintroduction | Sentinel (sentinelguard.io) Githubï¼šalibaba/Sentinel: é¢å‘äº‘åŸç”Ÿå¾®æœåŠ¡çš„é«˜å¯ç”¨æµæ§é˜²æŠ¤ç»„ä»¶ (github.com) Sentinel ç”¨æ¥è§£å†³ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† æ ¸å¿ƒåº“ï¼ˆ Java å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒ æ§åˆ¶å°ï¼ˆ DashBoard ï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ è¿è¡Œ Sentinel è¿è¡Œå‰æï¼šJava 8 ç¯å¢ƒï¼Œ8080 ç«¯å£æ²¡æœ‰è¢«å ç”¨ java -jar .\\sentinel-dashboard-1.8.6.jar è®¿é—® http://localhost:8080/ å³å¯çœ‹åˆ° Sentinel ç•Œé¢ ç”¨æˆ·ï¼šsentinel å¯†ç ï¼šsentinel æ­å»º Sentinel å·¥ç¨‹ åˆ›å»ºæ¨¡å— cloudalibaba-sentinel-service8401 é…ç½® POM ä¾èµ– com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery com.alibaba.csp sentinel-datasource-nacos com.alibaba.cloud spring-cloud-starter-alibaba-sentinel é…ç½® YML æ–‡ä»¶ server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: # Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: localhost:8848 sentinel: transport: #é…ç½® Sentinel dashboard åœ°å€ dashboard: localhost:8080 # é»˜è®¤ 8719 ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨äº†ä¼šè‡ªåŠ¨ä» 8719 ç«¯å£ +1 è¿›è¡Œæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ã€é€šä¿¡æœåŠ¡ï¼ˆåå°ç›‘æ§æœåŠ¡ï¼‰ã€‘ port: 8719 management: endpoints: web: exposure: include: '*' ç¼–å†™ä¸»å¯åŠ¨ç±» @EnableDiscoveryClient @SpringBootApplication public class MainApp8401 { public static void main(String[] args) { SpringApplication.run(MainApp8401.class, args); } } ç¼–å†™æ§åˆ¶å±‚ ç”±äº Sentinel é‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œéœ€è¦è°ƒç”¨ä¸€æ¬¡æ¥å£æ‰èƒ½æ˜¾ç¤º åœ¨ç°‡ç‚¹é“¾è·¯ä¸­å°±å¯ä»¥çœ‹åˆ°æ¥å£ä¹‹é—´çš„è°ƒç”¨å…³ç³» æµæ§è§„åˆ™ï¼ˆæµé‡æ§åˆ¶è§„åˆ™ï¼‰\rç›´æ¥ å¯ä»¥åœ¨ç°‡ç‚¹é“¾è·¯ç•Œé¢ä¸­å¿«é€Ÿå¯¹ä¸€ä¸ªæ¥å£æ·»åŠ æµæ§ æ­¤æ—¶ ä¸€ç§’å†… ç‚¹å‡»äº†å¤šæ¬¡å°±ä¼šæ˜¾ç¤º Sentinel çš„æç¤ºã€é»˜è®¤æŠ¥é”™ã€‘ å…³è” å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ï¼ˆä¾‹å¦‚å½“æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶å°±é™æµä¸‹è®¢å•çš„æ¥å£ï¼‰ å½“ /testB è¾¾åˆ°é˜ˆå€¼ QPS 1 æ—¶ï¼Œ/testA é™æµ ä½¿ç”¨ postman è¿›è¡Œå¹¶å‘è®¿é—® æ­¤æ—¶ /testA æ¥å£å·²ç»è¢«é™æµ é“¾è·¯ é“¾è·¯å°±æ˜¯å¯¹ä¸€ä¸ªæŒ‡å®šèµ„æºè¿›è¡Œé™æµï¼Œå¹¶ä¸”æ˜¯æŸä¸ªæ¥å£è°ƒç”¨çš„è¿™ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªè°ƒç”¨é“¾è·¯è¿›è¡Œé™æµ æ­¤å¤„æ²¡æœ‰æµ‹è¯•å‡ºæ•ˆæœï¼Œç•¥ angenin çš„ç¬”è®°ï¼šæœ€æ–°çš„SpringCloud(Hç‰ˆ\u0026Alibaba)æŠ€æœ¯ï¼ˆ19é«˜çº§éƒ¨åˆ†ï¼Œç†”æ–­ä¸é™æµã€Sentinelã€‘ï¼‰_angeninçš„åšå®¢-CSDNåšå®¢ å¿«é€Ÿå¤±è´¥ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController ç±»ä¸­å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸ Warm Upï¼ˆé¢„çƒ­ / å†·å¯åŠ¨ï¼‰ å®˜ç½‘è§£é‡Š é˜™å€¼é™¤ä»¥ coldFactorï¼ˆå†·å› å­ï¼Œé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜™å€¼ åœ¨ com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController ä¸­å¯ä»¥çœ‹åˆ° é»˜è®¤å†·åŠ è½½å› å­ä¸º 3 ï¼Œå‰å‡ ç§’ é¢„çƒ­æ—¶é•¿ å†…é˜ˆå€¼é™åˆ¶åœ¨ å•æœºé˜ˆå€¼ / 3 ï¼Œé¢„çƒ­æ—¶é•¿ å é˜ˆå€¼æ…¢æ…¢å‡é«˜è‡³ å•æœºé˜ˆå€¼ åŒ€é€Ÿæ’é˜Ÿ\rè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼å¿…é¡»è®¾ä¸º QPS ä¸€ç§’å†…ç¬¬äºŒæ¬¡è¯·æ±‚å°±å¤„äºåŠ è½½çŠ¶æ€ï¼Œç‚¹å¤šäº†å°±ä¼šçœ‹åˆ° ç›´æ¥å¤±è´¥ é¡µé¢ é™çº§è§„åˆ™ï¼ˆç†”æ–­é™çº§è§„åˆ™ï¼‰ Sentinel æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œè¦ä¹ˆæ‹‰é—¸åœç”¨ï¼Œè¦ä¹ˆå…³é—­æ–­è·¯å™¨æ¢å¤ï¼ˆè²Œä¼¼æ–°ç‰ˆ 1.8.0 ä¹‹å åŠ å…¥äº† Half-Open æ¢æµ‹æ¢å¤çŠ¶æ€ï¼‰ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç° ä¸ç¨³å®šçŠ¶æ€ æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…å¸‚æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œ é™åˆ¶ã€‚è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“å…¶ä»–èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ï¼ˆé»˜è®¤è¡Œä¸ºæŠ›å‡º DegradeExceptionï¼‰ RT æ…¢è°ƒç”¨æ¯”ä¾‹\ræ·»åŠ  testD æ–¹æ³•ï¼Œæ‰§è¡Œæ—¶é—´éœ€è¦ 1 ç§’ Jmeter è®¾ç½®ä¸ºæ¯ç§’ 10 ä¸ªè¯·æ±‚ï¼Œæ°¸è¿œå¾ªç¯ å½“ JMeter è¿›è¡Œæ—¶æ— æ³•è®¿é—® è¿™æ˜¯å› ä¸ºåœ¨ 1 ç§’å†…è¶…è¿‡ 5 ä¸ªè¯·æ±‚åœ¨ 200 ms å†…æ²¡æœ‰å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ å¼‚å¸¸æ¯”ä¾‹\rä¿®æ”¹ testD æ–¹æ³•ï¼Œä½¿å…¶æŠ›å‡ºå¼‚å¸¸ å½“æ¯ç§’å†…è¯·æ±‚å¤§äº 5 æ¬¡å…¶ä¸­æœ‰ 1 æ¬¡æŠ¥é”™ï¼ˆ0.2 Â» 20%ï¼‰ï¼Œåˆ™æ–­è·¯å™¨æ‰“å¼€ å½“æ—¶é—´çª—å£ç»“æŸï¼Œ1ç§’åæ¢å¤æ­£å¸¸ å¼‚å¸¸æ•°\rå½“è®¿é—® testD ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œè¿›å…¥ç†”æ–­çŠ¶æ€ è¿›å…¥æ—¶é—´çª—å£æœŸä¸å¤„ç†è¯·æ±‚ 60ç§’ çƒ­ç‚¹è§„åˆ™ï¼ˆçƒ­ç‚¹ Key é™æµï¼‰ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµ ç±»ä¼¼è±ªçŒªå“¥çš„ @HystrixCommand æ³¨è§£ï¼ŒSentinel æä¾› @SentinelResource å®ç°å…œåº•æ–¹æ³•çš„è®¾ç½®ç­‰åŠŸèƒ½ valueï¼šèµ„æºåï¼Œå’Œè®¿é—®è·¯å¾„ä¸€è‡´ï¼Œå» / blockHandlerï¼šå…œåº•æ–¹æ³•å @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"deal_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false)String p1, @RequestParam(value = \"p2\", required = false)String p2) { return \"----testHotKey\"; } // å…œåº•æ–¹æ³• å…œåº•æ–¹æ³•å‚æ•°ä¸º åŸæ–¹æ³•çš„å‚æ•° + BlockException public String deal_testHotKey(String p1, String p2, BlockException exception) { // sentinel çš„é»˜è®¤æç¤ºéƒ½æ˜¯ Blocked by Sentinel (flow limiting) return \"----deal_testHotKey, o(â•¥ï¹â•¥)o\"; } é…ç½®çƒ­ç‚¹è§„åˆ™ å‚æ•°ç´¢å¼•æ˜¯å‚æ•°ä¸‹æ ‡ï¼Œä» 0 å¼€å§‹ å•æœºé˜ˆå€¼æ˜¯ QPS çš„é˜ˆå€¼ï¼Œ1 ç§’å†…å¸¦æœ‰ç¬¬ 0 ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ p1ï¼‰çš„è¯·æ±‚è¶…è¿‡ 1 æ¬¡ï¼Œåˆ™è¿›å…¥å…¶å¯¹åº”çš„å…œåº•æ–¹æ³• å¦‚æœæ²¡æœ‰é…ç½® blockHandler å±æ€§å…œåº•æ–¹æ³•ï¼Œä¼šç›´æ¥å°†é”™è¯¯é¡µé¢æ‰“åˆ°å‰ç«¯ @SentinelResource(value = \"testHotKey\") å‚æ•°ä¾‹å¤–é¡¹\rå½“ p1 å‚æ•°çš„å€¼ä¸º 5 çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 æ­¤æ—¶å°±ç®—æ‰‹é€Ÿå†å¿«ä¹Ÿå¾ˆéš¾ç‚¹å‡º 200 QPS å¼‚å¸¸æƒ…å†µ å¦‚æœä¸šåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯é™æµè§„åˆ™ä¸­çš„é—®é¢˜ï¼Œè¿è¡Œæ—¶å‡ºé”™ Sentinel ä¸ç®¡ï¼Œç…§å¸¸æŠ›å‡ºå¼‚å¸¸ @SentinelResource æœ‰ fallback å‚æ•°ï¼Œåç»­è¯´æ˜ ç³»ç»Ÿè§„åˆ™ å®˜ç½‘ï¼šhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81 Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä» æ•´ä½“ç»´åº¦ å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚ åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œ","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:5","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#è§„åˆ™æŒä¹…åŒ–"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#seata-äº‹åŠ¡"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#seata-æœ¯è¯­"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#seata-çš„å®‰è£…éƒ¨ç½²"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#æ­å»º-seata-å·¥ç¨‹"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#éªŒè¯-seata-å·¥ç¨‹"},{"categories":null,"content":"\rSeata äº‹åŠ¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“ ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼ŒSeate å°±æ˜¯æ¥ä¿éšœå…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ä¾‹å¦‚ï¼šå•†å“å”®å–çš„ä¸šåŠ¡é€»è¾‘è¢«æ‹†åˆ†æˆä¸‰ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼Œåˆ†é…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å• è´¦æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·è´¦æˆ·ä¸­æ‰£é™¤ä½™é¢ Seata å®˜ç½‘ï¼šSeata Seata æœ¯è¯­ ä¸€åŠ ä¸‰æ¦‚å¿µç»„æˆ ä¸€ IDï¼š å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ ID ä¸‰ ç»„ä»¶æ¨¡å‹ï¼š TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€… ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚ RM (Resource Manager) - èµ„æºç®¡ç†å™¨ ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚ å¤„ç†è¿‡ç¨‹ TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾– TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®® TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ Seata çš„å®‰è£…éƒ¨ç½² å‰å¾€å®˜ç½‘ä¸‹è½½ Seataï¼šä¸‹è½½ä¸­å¿ƒ (seata.io) è¿™é‡ŒæŒ‰ 0.9.0 ç‰ˆæœ¬ä¸ºä¾‹ ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ file.conf æ–‡ä»¶ ä¿®æ”¹æµ‹è¯•äº‹åŠ¡ç»„åç§° fsp_tx_group ä¿®æ”¹äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸º db cj ?useUnicode=true\u0026characterEncoding=utf-8\u0026useSSL=false åˆ›å»ºæ•°æ®åº“ seata å¯¼å…¥ conf ç›®å½•ä¸‹çš„ db_store.sql ä¿®æ”¹ conf ç›®å½•ä¸‹ registry.conf æ³¨å†Œé…ç½®æ–‡ä»¶ æŒ‡æ˜æ³¨å†Œä¸­å¿ƒä¸º nacos å¹¶é…ç½®é“¾æ¥ä¿¡æ¯ å¯åŠ¨ nacos å¯åŠ¨ seata è¿›å…¥ bin ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ .\\seata-server.bat çœ‹åˆ°æŠ¥é”™ åŸå› æ˜¯æ²¡æ‰¾åˆ° MySQL 8 çš„é©±åŠ¨ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½é©±åŠ¨ jar åŒ…æ”¾åˆ° lib ç›®å½•ä¸‹å³å¯ æ­å»º Seata å·¥ç¨‹\råˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ seata_order: å­˜å‚¨è®¢å•çš„æ•°æ®åº“ seata_storage: å­˜å‚¨åº“å­˜çš„æ•°æ®åº“ seata_account: å­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ åˆ›å»ºå¯¹åº”ä¸šåŠ¡è¡¨ï¼Œå¹¶åˆ›å»ºå„è‡ªçš„ undo_log è¡¨ç”¨äºè®°å½•å›æ»šæ—¥å¿—ã€0.9.0 æ³¨æ„ç‰ˆæœ¬å·®å¼‚ã€‘ # åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œå¯¹åº”çš„ä¸šåŠ¡è¡¨ # order create database seata_order; use seata_order; CREATE TABLE t_order( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11)DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“' )ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; select * from t_order; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # storage create database seata_storage; use seata_storage; CREATE TABLE t_storage( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_storage(`id`,`product_id`,`total`,`used`,`residue`)VALUES('1','1','100','0','100'); SELECT * FROM t_storage; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(100) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT ='AT transaction mode undo table'; # account create database seata_account; use seata_account; CREATE TABLE t_account( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' )ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO t_account(`id`,`user_id`,`total`,`used`,`residue`)VALUES('1','1','1000','0','1000'); SELECT * FROM t_account; CREATE TABLE IF NOT EXISTS `undo_log` ( `branch_id` BIGINT(20) NOT NULL CO","date":"0001-01-01","objectID":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/:20:6","series":null,"tags":null,"title":"SpringCloudè‡ªå­¦ç¬”è®°mdç‰ˆ","uri":"/springcloud%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0md%E7%89%88/#seata-åŸç†ç®€ä»‹"}]